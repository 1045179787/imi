var originSearchDatas = [{"id":2,"parent_id":1,"title":"\u5e8f\u8a00","mdFileName":"README.md","url":"index.html","level":1,"content":"\u5e8f\u8a00\u53d1\u5e03\u672c\u8d44\u6599\u987b\u9075\u5b88\u5f00\u653e\u51fa\u7248\u8bb8\u53ef\u534f\u8bae 1.0 \u6216\u8005\u66f4\u65b0\u7248\u672c\u3002\u672a\u7ecf\u7248\u6743\u6240\u6709\u8005\u660e\u786e\u6388\u6743\uff0c\u7981\u6b62\u53d1\u884c\u672c\u6587\u6863\u53ca\u5176\u88ab\u5b9e\u8d28\u4e0a\u4fee\u6539\u7684\u7248\u672c\u3002\u672a\u7ecf\u7248\u6743\u6240\u6709\u8005\u4e8b\u5148\u6388\u6743\uff0c\u7981\u6b62\u5c06\u6b64\u4f5c\u54c1\u53ca\u5176\u884d\u751f\u4f5c\u54c1\u4ee5\u6807\u51c6\uff08\u7eb8\u8d28\uff09\u4e66\u7c4d\u5f62\u5f0f\u53d1\u884c\u3002\u5982\u679c\u6709\u5174\u8da3\u518d\u53d1\u884c\u6216\u518d\u7248\u672c\u624b\u518c\u7684\u5168\u90e8\u6216\u90e8\u5206\u5185\u5bb9\uff0c\u4e0d\u8bba\u4fee\u6539\u8fc7\u4e0e\u5426\uff0c\u6216\u8005\u6709\u4efb\u4f55\u95ee\u9898\uff0c\u8bf7\u8054\u7cfb\u7248\u6743\u6240\u6709\u8005admin@yurunsoft.com\u672c\u6587\u6863\u7684\u7248\u6743\u5f52IMI\u5f00\u53d1\u56e2\u961f\u6240\u6709\uff0c\u672c\u6587\u6863\u53ca\u5176\u63cf\u8ff0\u7684\u5185\u5bb9\u53d7\u6709\u5173\u6cd5\u5f8b\u7684\u7248\u6743\u4fdd\u62a4\uff0c\u5bf9\u672c\u6587\u6863\u5185\u5bb9\u7684\u4efb\u4f55\u5f62\u5f0f\u7684\u975e\u6cd5\u590d\u5236\uff0c\u6cc4\u9732\u6216\u6563\u5e03\uff0c\u5c06\u5bfc\u81f4\u76f8\u5e94\u7684\u6cd5\u5f8b\u8d23\u4efb\u3002QQ\u7fa4\uff1a17916227 \uff0c\u5982\u6709\u95ee\u9898\uff0c\u8d1f\u8d23\u7684\u5b87\u6da6\u5168\u7a0b\u624b\u628a\u624b\u89e3\u51b3\u3002\u672c\u6587\u6863\u534f\u4f5c\u5730\u5740\u7801\u4e91 Gitee\uff1ahttps:\/\/gitee.com\/yurunsoft\/imidocGithub\uff1ahttps:\/\/github.com\/Yurunsoft\/imidoc"},{"id":3,"parent_id":1,"title":"\u4ecb\u7ecd","mdFileName":"base\/intro.md","url":"base\/intro.html","level":1,"content":"\u4ecb\u7ecdimi \u662f\u57fa\u4e8e PHP \u534f\u7a0b\u5e94\u7528\u5f00\u53d1\u6846\u67b6\uff0c\u5b83\u652f\u6301 HttpApi\u3001WebSocket\u3001TCP\u3001UDP \u5e94\u7528\u5f00\u53d1\u3002\u7531 Swoole \u63d0\u4f9b\u5f3a\u529b\u9a71\u52a8\uff0cSwoole \u62e5\u6709\u5e38\u9a7b\u5185\u5b58\u3001\u534f\u7a0b\u975e\u963b\u585e IO \u7b49\u7279\u6027\u3002\u6846\u67b6\u9075\u5b88 PSR \u6807\u51c6\u89c4\u8303\uff0c\u63d0\u4f9b AOP\u3001\u6ce8\u89e3\u3001\u8fde\u63a5\u6c60\u3001\u8bf7\u6c42\u4e0a\u4e0b\u6587\u7ba1\u7406\u3001ORM\u6a21\u578b\u7b49\u5e38\u7528\u7ec4\u4ef6\u3002imi \u7684\u6a21\u578b\u652f\u6301\u5173\u8054\u5173\u7cfb\u7684\u5b9a\u4e49\uff0c\u589e\u5220\u6539\u67e5\u4e00\u628a\u68ad\uff01QQ\u7fa4\uff1a17916227 \uff0c\u5982\u6709\u95ee\u9898\uff0c\u8d1f\u8d23\u7684\u5b87\u6da6\u5168\u7a0b\u624b\u628a\u624b\u89e3\u51b3\u3002\u4e3a\u4ec0\u4e48\u8981\u7528 Swoole\uff1fhttps:\/\/wiki.swoole.com\/https:\/\/my.oschina.net\/yurun\/blog\/1831238https:\/\/my.oschina.net\/yurun\/blog\/3034196\u529f\u80fd\u7ec4\u4ef6 Server (Http\/Websocket\/Tcp\/Udp) \u5bb9\u5668 (PSR-11) Aop \u6ce8\u5165 Http \u4e2d\u95f4\u4ef6 (PSR-15) MySQL \u8fde\u63a5\u6c60 (\u534f\u7a0b&\u540c\u6b65\uff0c\u4e3b\u4ece\uff0c\u8d1f\u8f7d\u5747\u8861) Redis \u8fde\u63a5\u6c60 (\u534f\u7a0b&\u540c\u6b65\uff0c\u8d1f\u8f7d\u5747\u8861) Db \u8fde\u8d2f\u64cd\u4f5c \u5173\u7cfb\u578b\u6570\u636e\u5e93 \u6a21\u578b \u8de8\u8fdb\u7a0b\u5171\u4eab\u5185\u5b58\u8868 \u6a21\u578b Redis \u6a21\u578b \u65e5\u5fd7 (PSR-3 \/ File + Console) \u7f13\u5b58 (PSR-16 \/ File + Redis) \u9a8c\u8bc1\u5668 (Valitation) Task \u5f02\u6b65\u4efb\u52a1 \u8fdb\u7a0b\/\u8fdb\u7a0b\u6c60 \u547d\u4ee4\u884c\u5f00\u53d1\u8f85\u52a9\u5de5\u5177 \u4e1a\u52a1\u4ee3\u7801\u70ed\u66f4\u65b0"},{"id":4,"parent_id":1,"title":"\u73af\u5883\u8981\u6c42","mdFileName":"base\/env.md","url":"base\/env.html","level":1,"content":"\u73af\u5883\u8981\u6c42\u8fd0\u884c\u73af\u5883Linux \u7cfb\u7edf (Swoole \u4e0d\u652f\u6301\u5728 Windows \u4e0a\u8fd0\u884c)PHP &gt;= 7.1ComposerSwoole &gt;= 4.3.0Redis\u3001PDO \u6269\u5c55Windows \u5f00\u53d1\u8005\u53ef\u4ee5\u4f7f\u7528\u865a\u62df\u673a\u3001Windows 10 Linux \u5b50\u7cfb\u7edf\u7b49\u73af\u5883\uff0c\u5b9e\u73b0\u5728 Windows \u7cfb\u7edf\u4e0a\u5f00\u53d1\u548c\u8c03\u8bd5\u3002"},{"id":5,"parent_id":1,"title":"\u5f00\u59cb\u4e00\u4e2a\u65b0\u9879\u76ee","mdFileName":"base\/new.md","url":"base\/new.html","level":1,"content":"\u5f00\u59cb\u4e00\u4e2a\u65b0\u9879\u76ee\u9879\u76ee\u521d\u59cb\u5316\u8bf7\u4f7f\u7528 git \u514b\u9686\u4e0b\u9762\u7684\u9879\u76ee\u7a7a\u9879\u76ee\uff1ahttps:\/\/gitee.com\/yurunsoft\/empty-imi-demo\u529f\u80fdDemo\uff1ahttps:\/\/gitee.com\/yurunsoft\/imi-demo\u5982\u4f55\u8fd0\u884c\u8bf7\u770b\u4e0a\u9762\u9879\u76ee\u4e2d\u7684README.md\u6d41\u7a0b\u8bf4\u660e\u5728IMI\u6846\u67b6\u4e2d\uff0c\u4e00\u4e2a\u9879\u76ee\u5206\u4e3a\u4e00\u4e2a\u4e3b\u670d\u52a1\u5668\u548c\u591a\u4e2a\u5b50\u670d\u52a1\u5668\u3002\u5176\u4e2d\uff0c\u4e3b\u670d\u52a1\u5668\u4e3a\u5fc5\u987b\uff0c\u5b50\u670d\u52a1\u5668\u4e3a\u53ef\u9009\u3002\u5b50\u670d\u52a1\u5668\u901a\u8fc7\u76d1\u542c\u7aef\u53e3\u5b9e\u73b0\uff0c\u4e00\u822c\u4e0d\u63a8\u8350\u5f00\u542f\u8fc7\u591a\u7684\u5b50\u670d\u52a1\u5668\u3002\u4f60\u9700\u8981\u4e3a\u6846\u67b6\u3001\u6bcf\u4e2a\u670d\u52a1\u5668\u5728\u5176\u547d\u540d\u7a7a\u95f4\u76ee\u5f55\u4e0b\u90fd\u521b\u5efa\u4e00\u4e2aMain.php\uff0c\u5e76\u628a\u7c7b\u547d\u540d\u4e3aMain\u9879\u76ee\u7684Main\u5fc5\u987b\u7ee7\u627fImi\\Main\\AppBaseMain\u7c7b\u3002\u670d\u52a1\u5668\u7684Main\u5fc5\u987b\u7ee7\u627fImi\\Main\\BaseMain\u7c7b\u3002\u5e76\u4e14\u5b9e\u73b0\u4e00\u4e2a__init()\u65b9\u6cd5:public function __init()\n{\n\n}\u4f60\u53ef\u4ee5\u5728\u91cc\u9762\u505a\u4e00\u4e9b\u521d\u59cb\u5316\u7684\u4e8b\u60c5\uff0c\u4e0d\u8fc7\u5927\u591a\u6570\u65f6\u5019\u4ec0\u4e48\u90fd\u4e0d\u9700\u8981\u505a\u3002"},{"id":6,"parent_id":1,"title":"\u914d\u7f6e\u6587\u4ef6","mdFileName":"base\/config.md","url":"base\/config.html","level":1,"content":"\u914d\u7f6e\u6587\u4ef6\u5728\u6bcf\u4e2aMain\u6240\u5728\u76ee\u5f55\u4e0b\u7684config\/config.php\u914d\u7f6e\u6587\u4ef6\uff0c\u4f1a\u5728\u8be5Main\u88ab\u5b9e\u4f8b\u5316\u65f6\u52a0\u8f7d\u3002\u5982\u679c\u4f60\u4e0d\u77e5\u9053Main\u662f\u4ec0\u4e48\uff0c\u8bf7\u770b\u4e0a\u4e00\u7ae0\uff1a\u300a\u5f00\u59cb\u4e00\u4e2a\u65b0\u9879\u76ee\u300bimi \u8fd8\u652f\u6301\u4f60\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\uff0c\u5efa\u7acb\u4e00\u4e2a.env\u6587\u4ef6\uff0c\u5728\u91cc\u9762\u8bbe\u7f6e\u8fd0\u884c\u73af\u5883\u914d\u7f6e\u3002\u914d\u7f6e\u6587\u4ef6\u7ed3\u6784\u5171\u6709\u7ed3\u6784&lt;?php\nreturn [\n    \/\/ \u52a0\u8f7d\u5b50\u914d\u7f6e\u6587\u4ef6\uff0c\u907f\u514d`config.php`\u8fc7\u4e8e\u81c3\u80bf\u4e0d\u4fbf\u7ef4\u62a4\n    \/\/ \u8981\u6ce8\u610f\u8fd9\u91cc\u7684\u522b\u540d\u4e0d\u53ef\u4e0econfigs\u540c\u7ea7\u7684\u540d\u5b57\u91cd\u590d\uff0c\u5426\u5219\u4f1a\u88ab\u8986\u76d6\n    'configs'    =&gt;    [\n        &quot;\u522b\u540d1&quot;    =&gt;    '\u914d\u7f6e\u6587\u4ef6\u8def\u5f841',\n        &quot;\u522b\u540d2&quot;    =&gt;    '\u914d\u7f6e\u6587\u4ef6\u8def\u5f842',\n        \u2026\u2026\n    ],\n    \/\/ bean\u626b\u63cf\u76ee\u5f55\uff0c\u6307\u5b9a\u547d\u540d\u7a7a\u95f4\n    'beanScan'    =&gt;    [\n        'ImiDemo\\WebSocketDemo\\Listener',\n    ],\n];\u9879\u76ee\u914d\u7f6e\u6587\u4ef6return [\n    \/\/ Swoole &gt;= 4.1.0\u53ef\u7528\uff0c\u4e0d\u8bbe\u7f6e\u9ed8\u8ba4\u4e3atrue\uff0c\u5f00\u542f\u4e00\u952e\u534f\u7a0b\u5316\n    'enableCoroutine'    =&gt;    true,\n    \/\/ runtime\u76ee\u5f55\u8bbe\u7f6e\uff0c\u9ed8\u8ba4\u53ef\u4e0d\u8bbe\u7f6e\uff0c\u4e3a\u5f53\u524d\u9879\u76ee\u4e0b\u7684.runtime\u76ee\u5f55\n    \/\/ \u6ce8\u610f\uff0c\u591a\u4e2a\u9879\u76ee\u4e0d\u53ef\u8bbe\u7f6e\u4e3a\u76f8\u540c\u76ee\u5f55\uff01\n    'runtimePath'   =&gt;  '\/tmp\/imidemo-runtime\/',\n    \/\/ \u5b9a\u4e49\u8fdb\u7a0b\u540d\u89c4\u5219\n    'process'   =&gt;  [\n        'master'        =&gt;  'imi:master:{namespace}',\n        'manager'       =&gt;  'imi:manager:{namespace}',\n        'worker'        =&gt;  'imi:worker-{workerId}:{namespace}',\n        'taskWorker'    =&gt;  'imi:taskWorker-{workerId}:{namespace}',\n        'process'       =&gt;  'imi:process-{processName}:{namespace}',\n        'processPool'   =&gt;  'imi:process-pool-{processPoolName}-{workerId}:{namespace}',\n        'tool'          =&gt;  'imi:{toolName}\/{toolOperation}:{namespace}',\n    ],\n    \/\/ \u4e3b\u670d\u52a1\u5668\u914d\u7f6e\n    'mainServer'    =&gt;    [\n        \/\/ \u6307\u5b9a\u670d\u52a1\u5668\u547d\u540d\u7a7a\u95f4\n        'namespace'    =&gt;    'ImiDemo\\HttpDemo\\MainServer',\n        \/\/ \u670d\u52a1\u5668\u7c7b\u578b\uff0c\u6682\u65f6\u4ec5\u652f\u6301Type::HTTP\n        'type'        =&gt;    Type::HTTP,\n        \/\/ \u76d1\u542c\u7684IP\u5730\u5740\uff0c\u53ef\u9009\n        'host'        =&gt;    '0.0.0.0',\n        \/\/ \u76d1\u542c\u7684\u7aef\u53e3\n        'port'        =&gt;    8080,\n        \/\/ \u53c2\u8003 swoole mode\uff0c\u53ef\u9009\n        'mode'        =&gt;    SWOOLE_BASE,\n        \/\/ \u53c2\u8003 swoole sockType\uff0c\u53ef\u9009\n        'sockType'    =&gt;    SWOOLE_SOCK_TCP,\n        \/\/ \u670d\u52a1\u5668\u914d\u7f6e\uff0c\u53c2\u6570\u7528\u6cd5\u540c\\Swoole\\Server-&gt;set($configs)\n        'configs'    =&gt;    [\n            'reactor_num'        =&gt; 8,\n            'worker_num'        =&gt; 8,\n            'task_worker_num'    =&gt; 16,\n        ],\n    ],\n    \/\/ \u5b50\u670d\u52a1\u5668\uff08\u7aef\u53e3\u76d1\u542c\uff09\u914d\u7f6e\n    'subServers'    =&gt;    [\n        \/\/ \u5b50\u670d\u52a1\u5668\u522b\u540d\n        'alias1'    =&gt;    [\n            \/\/ \u8fd9\u91cc\u540c\u4e3b\u670d\u52a1\u5668\u914d\u7f6e\n        ]\n    ],\n];.env\u5728 .env \u4e2d\u7684\u914d\u7f6e\u65b9\u5f0f\uff0c\u548cConfig::set()\u5199\u6cd5\u7c7b\u4f3c\uff0c\u652f\u6301@app\u7b49\u5199\u6cd5\u3002\u5982\u4e0b\uff0c\u662f\u8bbe\u7f6e\u8fde\u63a5\u6c60\u7684uri\u4f8b\u5b50\uff1a@app.pools.maindb.async.resource = &quot;tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60&quot;\u6570\u7ec4\u7684\u652f\u6301\uff1a@app.a.0.id = 1\n@app.a.0.name = name1\n@app.a.1.id = 2\n@app.a.1.name = name2\u540c\uff1a[\n    'a' =&gt;  [\n        ['id'=&gt;1, 'name'=&gt;'name1'],\n        ['id'=&gt;2, 'name'=&gt;'name2'],\n    ]\n]"},{"id":8,"parent_id":7,"title":"\u751f\u547d\u5468\u671f","mdFileName":"core\/lifeCycle.md","url":"core\/lifeCycle.html","level":1,"content":"\u751f\u547d\u5468\u671fimi \u662f\u57fa\u4e8e Swoole \u5f00\u53d1\u7684\u6846\u67b6\uff0c\u6240\u4ee5\u6700\u597d\u5148\u4e86\u89e3 Swoole\uff0c\u4ee5\u4fbf\u4e86\u89e3\u5404\u79cd\u540d\u8bcd\u6982\u5ff5\u3002\u6846\u67b6\u751f\u547d\u5468\u671f\u6846\u67b6\u7684\u751f\u547d\u5468\u671f\u5927\u81f4\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u9636\u6bb5\uff1amaster \u8fdb\u7a0b\u521d\u59cb\u5316\u6846\u67b6\u626b\u63cf\u6ce8\u89e3\uff0c\u6784\u5efa\u8fd0\u884c\u65f6\u7f13\u5b58\u521d\u59cb\u5316 Swoole \u4e2d\u7684 Memory \u6a21\u5757\u52a0\u8f7d\u9879\u76ee\u914d\u7f6e\u521b\u5efa\u670d\u52a1\u5668\u5bf9\u8c61\u542f\u52a8\u670d\u52a1\u5668worker \u8fdb\u7a0bSwoole WorkerStart \u4e8b\u4ef6\u52a0\u8f7d\u8fd0\u884c\u65f6\u7f13\u5b58\u521d\u59cb\u5316\u65e5\u5fd7\u76f8\u5173\u521d\u59cb\u5316\u8fde\u63a5\u6c60\u521d\u59cb\u5316\u7f13\u5b58\u521d\u59cb\u5316\u8def\u7531\u89e6\u53d1\u9879\u76ee\u521d\u59cb\u5316\u4e8b\u4ef6\uff08worker 0 \u7b2c\u4e00\u6b21\u542f\u52a8\uff09\u8bf7\u6c42\u751f\u547d\u5468\u671fimi \u652f\u6301 http\u3001websocket\u3001tcp\u3001udp\uff0c\u4f46\u5176\u5b9e\u90fd\u5927\u540c\u5c0f\u5f02\uff0c\u90fd\u4f7f\u7528\u4e86\u76d1\u542c\u4e8b\u4ef6+\u4e2d\u95f4\u4ef6\u7684\u5957\u8def\uff0c\u8fd9\u91cc\u4ee5 http \u4e3a\u4f8b\u8bf4\u660e\u3002Swoole Request \u4e8b\u4ef6\u521b\u5efa\u8bf7\u6c42\u4e0a\u4e0b\u6587 RequestContext\u8c03\u5ea6\u5668\uff08HttpDispatcher\uff09\u6267\u884c\u4e2d\u95f4\u4ef6\u5339\u914d\u8def\u7531\u63a7\u5236\u5668\u5bf9\u8c61-&gt;\u52a8\u4f5c\u65b9\u6cd5()Response \u54cd\u5e94"},{"id":9,"parent_id":7,"title":"\u5bb9\u5668","mdFileName":"core\/container.md","url":"core\/container.html","level":1,"content":"\u5bb9\u5668\u5bb9\u5668\u7528\u4e8e\u5b58\u653e\u7c7b\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u5bb9\u5668\u4e2d\u7684\u5bf9\u8c61\u7c7b\u6211\u4eec\u79f0\u4e4b\u4e3a Bean\u3002\u901a\u8fc7\u5bb9\u5668\u5b9e\u4f8b\u5316\u51fa\u6765\u7684\u5bf9\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u5b83\u4eec\u8fdb\u884c\u6ce8\u5165\u64cd\u4f5c\u3002\u5bb9\u5668\u5206\u7c7b\u5168\u5c40\u5bb9\u5668\u670d\u52a1\u5668\u5bb9\u5668\u8bf7\u6c42\u4e0a\u4e0b\u6587\u5bb9\u5668\u5168\u5c40\u5bb9\u5668\u5b58\u6d3b\u4e8e\u6846\u67b6\u6574\u4e2a\u751f\u547d\u5468\u671f\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u5168\u5c40\u5bb9\u5668\u3002$object = \\Imi\\App::getBean('XXX');\u670d\u52a1\u5668\u5bb9\u5668\u53ea\u9488\u5bf9\u76ee\u6807\u670d\u52a1\u5668\u7684\u5bb9\u5668\uff0c\u8be5\u5bb9\u5668\u4e2d\u76ee\u524d\u5b58\u50a8\u4e86\u8be5\u670d\u52a1\u5668\u7684\u8def\u7531\u5bf9\u8c61\u53ca\u914d\u7f6e\u7b49\u7b49\u3002$object = \\Imi\\ServerManage::getServer('main')-&gt;getBean('XXX');\u8bf7\u6c42\u4e0a\u4e0b\u6587\u5bb9\u5668\u5f53\u524d\u8bf7\u6c42\u6709\u6548\u7684\u5bb9\u5668\uff0c\u8bf7\u6c42\u7ed3\u675f\u65f6\u5373\u9500\u6bc1\u3002$object = \\Imi\\RequestContext::getBean('XXX');\u5bb9\u5668\u5bf9\u8c61\u7c7b (Bean)getBean()\u65f6\u53ef\u4ee5\u4f20\u5e26\u6709\u5b8c\u6574\u547d\u540d\u7a7a\u95f4\u7684\u7c7b\u540d\uff0c\u6216\u8005\u522b\u540d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7@Bean\u6ce8\u89e3\u6765\u5b9a\u4e49\u522b\u540d\u3002\u4f60\u4e5f\u53ef\u4ee5\u5728\u7c7b\u91cc\u5b9a\u4e49\u4e00\u4e2a__init()\u65b9\u6cd5\uff0cimi \u5c06\u5b83\u4f5c\u4e3a\u7b2c\u4e8c\u4e2a\u6784\u9020\u65b9\u6cd5\u3002\u6267\u884c\u987a\u5e8f\uff1a__construct -&gt; injectProps -&gt; __initinjectProps \u5373\u4e3a\u5c5e\u6027\u6ce8\u5165\uff0c\u5177\u4f53\u8bf7\u770b\u7ae0\u8282\uff1aAOP\u5b9a\u4e49\uff1anamespace Test;\n\n\/**\n * @Bean(&quot;MyTest&quot;)\n *\/\nclass ABCDEFG\n{\n    public function __construct($id)\n    {\n        echo 'first', PHP_EOL;\n    }\n\n    public function __init($id)\n    {\n        echo 'second first', PHP_EOL;\n    }\n}\u83b7\u5f97\u5b9e\u4f8b\uff1aApp::getBean('MyTest');\nApp::getBean(\\Test\\ABCDEFG::class);"},{"id":10,"parent_id":7,"title":"\u4e8b\u4ef6","mdFileName":"core\/events.md","url":"core\/events.html","level":1,"content":"\u4e8b\u4ef6imi \u6846\u67b6\u4e8b\u4ef6IMI.INITED\u6846\u67b6\u521d\u59cb\u5316\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.APP.INIT\u9879\u76ee\u521d\u59cb\u5316\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.LOAD_RUNTIME_INFO\u52a0\u8f7d runtime \u4e8b\u4ef6\uff0c\u5728\u6b64\u4e8b\u4ef6\u4e2d\uff0c\u7edd\u5bf9\u53ef\u4ee5\u4f7f\u7528 App::getRuntimeInfo() \u83b7\u53d6\u5230\u6570\u636e\u3002IMI.MAIN_SERVER.WORKER.START.APP\u5728\u9879\u76ee\u4e2d\u76d1\u542c WorkerStart \u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1aclass WorkerStartEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * Worker\u8fdb\u7a0bID\n     * @var int\n     *\/\n    public $workerID;\n}IMI.SERVER.CREATE.BEFORE\u521b\u5efa\u670d\u52a1\u5668\u5bf9\u8c61\u524d\u7f6e\u64cd\u4f5c\uff0c\u4e3b\u670d\u52a1\u5668+\u5b50\u670d\u52a1\u5668\uff0c\u6bcf\u4e2a\u521b\u5efa\u524d\u90fd\u4f1a\u89e6\u53d1\uff01\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.SERVER.CREATE.AFTER\u521b\u5efa\u670d\u52a1\u5668\u5bf9\u8c61\u524d\u7f6e\u540e\u4f5c\uff0c\u4e3b\u670d\u52a1\u5668+\u5b50\u670d\u52a1\u5668\uff0c\u6bcf\u4e2a\u521b\u5efa\u540e\u90fd\u4f1a\u89e6\u53d1\uff01\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.SERVERS.CREATE.BEFORE\u521b\u5efa\u670d\u52a1\u5668\u5bf9\u8c61\u524d\u7f6e\u540e\u4f5c\uff0c\u53ea\u4f1a\u89e6\u53d1\u4e00\u6b21\uff01\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.SERVERS.CREATE.AFTER\u521b\u5efa\u670d\u52a1\u5668\u5bf9\u8c61\u524d\u7f6e\u540e\u4f5c\uff0c\u53ea\u4f1a\u89e6\u53d1\u4e00\u6b21\uff01\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.INIT.WORKER.BEFOREWorker \u8fdb\u7a0b\u521d\u59cb\u5316\u540e\u7f6e\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.INIT.WORKER.AFTERWorker \u8fdb\u7a0b\u521d\u59cb\u5316\u540e\u7f6e\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.PROCESS.BEGIN\u81ea\u5b9a\u4e49\u8fdb\u7a0b\u5f00\u59cb\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1astring $name, \\Swoole\\Process $processIMI.PROCESS.END\u81ea\u5b9a\u4e49\u8fdb\u7a0b\u7ed3\u675f\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1astring $name, \\Swoole\\Process $processIMI.PROCESS_POOL.PROCESS.BEGIN\u81ea\u5b9a\u4e49\u8fdb\u7a0b\u6c60\u4e2d\u7684\u8fdb\u7a0b\u5f00\u59cb\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1astring $name, \\Swoole\\Process\\Pool $pool, int $workerId, int $workerNum, array $args, int $ipcType, string $msgQueueKeyIMI.PROCESS_POOL.PROCESS.END\u81ea\u5b9a\u4e49\u8fdb\u7a0b\u6c60\u4e2d\u7684\u8fdb\u7a0b\u7ed3\u675f\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1astring $name, \\Swoole\\Process\\Pool $pool, int $workerId, int $workerNum, array $args, int $ipcType, string $msgQueueKeyIMI.SERVER.GROUP.JOIN\u670d\u52a1\u5668\u903b\u8f91\u5206\u7ec4\u52a0\u5165\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1a\\Imi\\Server\\Base $server, string $groupName, int $fdIMI.SERVER.GROUP.LEAVE\u670d\u52a1\u5668\u903b\u8f91\u5206\u7ec4\u79bb\u5f00\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1a\\Imi\\Server\\Base $server, string $groupName, int $fdIMI.REQUEST_CONTENT.CREATE\u8bf7\u6c42\u4e0a\u4e0b\u6587\u521b\u5efa\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.REQUEST_CONTENT.DESTROY\u8bf7\u6c42\u4e0a\u4e0b\u6587\u9500\u6bc1\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0Swoole Server \u5168\u5c40\u4e8b\u4ef6IMI.MAIN_SERVER.STARTOnStart\u4e8b\u4ef6\u53c2\u6570\uff1aclass StartEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n}IMI.MAIN_SERVER.SHUTDOWNOnShutdown\u4e8b\u4ef6\u53c2\u6570\uff1aclass ShutdownEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n}IMI.MAIN_SERVER.WORKER.STARTOnWorkerStart\u4e8b\u4ef6\u53c2\u6570\uff1aclass WorkerStartEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * Worker\u8fdb\u7a0bID\n     * @var int\n     *\/\n    public $workerID;\n}IMI.MAIN_SERVER.WORKER.STOPOnWorkerStop\u4e8b\u4ef6\u53c2\u6570\uff1aclass WorkerStopEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * Worker\u8fdb\u7a0bID\n     * @var int\n     *\/\n    public $workerID;\n}IMI.MAIN_SERVER.MANAGER.STARTOnManagerStart\u4e8b\u4ef6\u53c2\u6570\uff1aclass ManagerStartEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n}IMI.MAIN_SERVER.MANAGER.STOPOnManagerStop\u4e8b\u4ef6\u53c2\u6570\uff1aclass ManagerStopEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n}IMI.MAIN_SERVER.TASKOnTask\u4e8b\u4ef6\u53c2\u6570\uff1aclass TaskEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u4efb\u52a1ID\n     * @var int\n     *\/\n    public $taskID;\n\n    \/**\n     * worker\u8fdb\u7a0bID\n     * @var int\n     *\/\n    public $workerID;\n\n    \/**\n     * \u4efb\u52a1\u6570\u636e\n     * @var mixed\n     *\/\n    public $data;\n}IMI.MAIN_SERVER.FINISHOnFinish\u4e8b\u4ef6\u53c2\u6570\uff1aclass FinishEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u4efb\u52a1ID\n     * @var int\n     *\/\n    public $taskID;\n\n    \/**\n     * \u4efb\u52a1\u6570\u636e\n     * @var mixed\n     *\/\n    public $data;\n}IMI.MAIN_SERVER.PIPE_MESSAGEOnPipeMessage\u4e8b\u4ef6\u53c2\u6570\uff1aclass PipeMessageEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * Worker\u8fdb\u7a0bID\n     * @var int\n     *\/\n    public $workerID;\n\n    \/**\n     * \u6d88\u606f\u5185\u5bb9\uff0c\u53ef\u4ee5\u662f\u4efb\u610fPHP\u7c7b\u578b\n     * @var mixed\n     *\/\n    public $message;\n}IMI.MAIN_SERVER.WORKER_ERROROnWorkerError\u4e8b\u4ef6\u53c2\u6570\uff1aclass WorkerErrorEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * Worker\u8fdb\u7a0bID\n     * @var int\n     *\/\n    public $workerID;\n\n    \/**\n     * Worker\u8fdb\u7a0bPID\n     *\n     * @var int\n     *\/\n    public $workerPid;\n    \n    \/**\n     * \u9000\u51fa\u7684\u72b6\u6001\u7801\uff0c\u8303\u56f4\u662f 1 \uff5e255\n     *\n     * @var int\n     *\/\n    public $exitCode;\n\n    \/**\n     * \u8fdb\u7a0b\u9000\u51fa\u7684\u4fe1\u53f7\n     *\n     * @var int\n     *\/\n    public $signal;\n}Swoole Server \u5bf9\u8c61\u4e8b\u4ef6\u5bf9\u8c61\u4e8b\u4ef6\u662f\u7531\u591a\u4e2a\u670d\u52a1\u5668\u5bf9\u8c61\u53d1\u51fa\u7684\uff0c\u76d1\u542c\u591a\u4e2a\u7aef\u53e3\u5373\u8ba4\u5b9a\u4e3a\u591a\u4e2a\u670d\u52a1\u5668\u3002Http Serverrequest\u4e8b\u4ef6\u53c2\u6570\uff1aclass RequestEventParam extends EventParam\n{\n    \/**\n     * swoole \u8bf7\u6c42\u5bf9\u8c61\n     * @var \\Imi\\Server\\Http\\Message\\Request\n     *\/\n    public $request;\n\n    \/**\n     * swoole \u54cd\u5e94\u5bf9\u8c61\n     * @var \\Imi\\Server\\Http\\Message\\Response\n     *\/\n    public $response;\n}close\u4e8b\u4ef6\u53c2\u6570\uff1aclass CloseEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u6807\u8bc6\u7b26\n     * @var int\n     *\/\n    public $fd;\n\n    \/**\n     * \u6765\u81ea\u90a3\u4e2areactor\u7ebf\u7a0b\n     *\n     * @var int\n     *\/\n    public $reactorID;\n}WebSocket ServerhandShake\u4e8b\u4ef6\u53c2\u6570\uff1aclass HandShakeEventParam extends EventParam\n{\n    \/**\n     * swoole \u8bf7\u6c42\u5bf9\u8c61\n     * @var \\Imi\\Server\\Http\\Message\\Request\n     *\/\n    public $request;\n\n    \/**\n     * swoole \u54cd\u5e94\u5bf9\u8c61\n     * @var \\Imi\\Server\\Http\\Message\\Response\n     *\/\n    public $response;\n}message\u4e8b\u4ef6\u53c2\u6570\uff1aclass MessageEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * swoole \u6570\u636e\u5e27\u5bf9\u8c61\n     * @var \\swoole_websocket_frame\n     *\/\n    public $frame;\n}close\u4e8b\u4ef6\u53c2\u6570\uff1aclass CloseEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u6807\u8bc6\u7b26\n     * @var int\n     *\/\n    public $fd;\n\n    \/**\n     * \u6765\u81ea\u90a3\u4e2areactor\u7ebf\u7a0b\n     *\n     * @var int\n     *\/\n    public $reactorID;\n}TCP Serverconnect\u4e8b\u4ef6\u53c2\u6570\uff1aclass ConnectEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u6807\u8bc6\u7b26\n     * @var int\n     *\/\n    public $fd;\n\n    \/**\n     * Reactor\u7ebf\u7a0bID\n     * @var int\n     *\/\n    public $reactorID;\n}receive\u4e8b\u4ef6\u53c2\u6570\uff1aclass ReceiveEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u6807\u8bc6\u7b26\n     * @var int\n     *\/\n    public $fd;\n\n    \/**\n     * Reactor\u7ebf\u7a0bID\n     * @var int\n     *\/\n    public $reactorID;\n\n    \/**\n     * \u63a5\u6536\u5230\u7684\u6570\u636e\n     *\n     * @var string\n     *\/\n    public $data;\n}close\u4e8b\u4ef6\u53c2\u6570\uff1aclass CloseEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u6807\u8bc6\u7b26\n     * @var int\n     *\/\n    public $fd;\n\n    \/**\n     * \u6765\u81ea\u90a3\u4e2areactor\u7ebf\u7a0b\n     *\n     * @var int\n     *\/\n    public $reactorID;\n}BufferFull\u4e8b\u4ef6\u53c2\u6570\uff1aclass BufferEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u6807\u8bc6\u7b26\n     * @var int\n     *\/\n    public $fd;\n}BufferEmpty\u4e8b\u4ef6\u53c2\u6570\uff1aclass BufferEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u6807\u8bc6\u7b26\n     * @var int\n     *\/\n    public $fd;\n}UDP Serverpacketclass PacketEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u6570\u636e\n     * @var string\n     *\/\n    public $data;\n\n    \/**\n     * \u5ba2\u6237\u7aef\u4fe1\u606f\n     *\n     * @var array\n     *\/\n    public $clientInfo;\n}"},{"id":11,"parent_id":7,"title":"\u4e2d\u95f4\u4ef6","mdFileName":"core\/middleware.md","url":"core\/middleware.html","level":1,"content":"\u4e2d\u95f4\u4ef6\u5728 imi \u4e2d\uff0chttp\u3001WebSocket\u3001TCP\u3001UDP \u670d\u52a1\u90fd\u4f7f\u7528\u4e86\u4e2d\u95f4\u4ef6\uff0c\u4e0b\u9762\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\u4e2d\u95f4\u4ef6\u7684\u6267\u884c\u987a\u5e8f\u3002\u4e2d\u95f4\u4ef6\u662f\u6309\u987a\u5e8f\u5f00\u59cb\u6267\u884c\u7684\uff0c\u4f46\u662f\u540e\u6267\u884c\u7684\u4e2d\u95f4\u4ef6\u5148\u6267\u884c\u5b8c\u6bd5\u3002\u5148\u6267\u884c\u5b8c\u6bd5\u7684\u4e2d\u95f4\u4ef6\uff0c\u8fd4\u56de\u7ed3\u679c\u7ed9\u524d\u9762\u7684\u4e2d\u95f4\u4ef6\u3002\u524d\u9762\u7684\u4e2d\u95f4\u4ef6\u4e0d\u4e00\u5b9a\u4f1a\u91c7\u7528\u83b7\u5f97\u7684\u7ed3\u679c\uff0c\u5b83\u6709\u53ef\u80fd\u5bf9\u8fd9\u4e2a\u7ed3\u679c\u505a\u4fee\u6539\u3002\u4e3e\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff1aA\u3001B\u3001C\u4e09\u4e2a\u4e2d\u95f4\u4ef6\uff0c\u6267\u884c\u987a\u5e8f\u4e3a\uff1a\u5148\u8fdbA\uff0c\u518d\u8fdbB\uff0c\u518d\u8fdbC\uff0cC\u6267\u884c\u5b8c\uff0cB\u6267\u884c\u5b8c\uff0cA\u6267\u884c\u5b8c"},{"id":12,"parent_id":7,"title":"\u8fdb\u7a0b\u540d\u79f0\u7ba1\u7406","mdFileName":"core\/processNameManager.md","url":"core\/processNameManager.html","level":1,"content":"\u8fdb\u7a0b\u540d\u79f0\u7ba1\u7406imi \u4e3a\u542f\u52a8\u51fa\u6765\u7684\u8fdb\u7a0b\u7edf\u4e00\u7ba1\u7406\u4e86\u8fdb\u7a0b\u540d\uff0c\u4f60\u53ef\u4ee5\u5728 @app.process \u4e2d\u81ea\u5b9a\u4e49\uff0c\u5176\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a\uff1a'process'   =&gt;  [\n    'master'        =&gt;  'imi:master:{namespace}',\n    'manager'       =&gt;  'imi:manager:{namespace}',\n    'worker'        =&gt;  'imi:worker-{workerId}:{namespace}',\n    'taskWorker'    =&gt;  'imi:taskWorker-{workerId}:{namespace}',\n    'process'       =&gt;  'imi:process-{processName}:{namespace}',\n    'processPool'   =&gt;  'imi:process-pool-{processPoolName}-{workerId}:{namespace}',\n    'tool'          =&gt;  'imi:{toolName}\/{toolOperation}:{namespace}',\n]"},{"id":14,"parent_id":13,"title":"\u8def\u7531","mdFileName":"components\/httpserver\/route.md","url":"components\/httpserver\/route.html","level":1,"content":"\u8def\u7531\u542f\u7528\u8def\u7531\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165\u4e2d\u95f4\u4ef6\uff1areturn [\n    'beans'    =&gt;    [\n        'HttpDispatcher'    =&gt;    [\n            'middlewares'    =&gt;    [\n                \\Imi\\Server\\Http\\Middleware\\RouteMiddleware::class,\n            ],\n        ],\n    ],\n];\u901a\u8fc7\u914d\u7f6e\u6ce8\u5165\u5f62\u5f0f\uff0c\u5b9e\u73b0\u975e\u5e38\u7075\u6d3b\u7684\u914d\u7f6e\uff0c\u4f60\u751a\u81f3\u53ef\u4ee5\u81ea\u5df1\u53e6\u5916\u5b9e\u73b0\u8def\u7531\u4e2d\u95f4\u4ef6\uff0c\u800c\u4e0d\u7528\u88ab\u6846\u67b6\u81ea\u5e26\u7684\u4e2d\u95f4\u4ef6\u6240\u5f71\u54cd\uff0c\u7528\u54ea\u4e9b\u4e2d\u95f4\u4ef6\u90fd\u5728\u4f60\u7684\u638c\u63a7\u4e4b\u4e2d\uff01\u8def\u7531\u914d\u7f6ereturn [\n    'beans'    =&gt;    [\n        'HttpRoute'    =&gt;    [\n            \/\/ url\u5339\u914d\u7f13\u5b58\u6570\u91cf\uff0c\u9ed8\u8ba41024\n            'urlCacheNumber'    =&gt;    1024,\n            \/\/ \u5168\u5c40\u5ffd\u7565 URL \u8def\u7531\u5927\u5c0f\u5199\n            'ignoreCase'        =&gt;    false,\n        ],\n    ],\n];\u6ce8\u89e3\u8bf4\u660e@Controller\u6ce8\u91ca\u76ee\u6807\uff1a\u7c7b\u8868\u660e\u4e00\u4e2a\u7c7b\u662f\u63a7\u5236\u5668\u7c7b\u5c5e\u6027\u540d\u79f0\u8bf4\u660eprefix\u52a8\u4f5c\u914d\u7f6e\u7684\u8bbf\u95ee\u5730\u5740\u524d\u7f00\uff0c\u5982\u679c\u52a8\u4f5c\u914d\u7f6e\u7684\u8bbf\u95ee\u5730\u5740\u89c4\u5219\u4ee5\/\u5f00\u59cb\uff0c\u5219\u672c\u5c5e\u6027\u65e0\u6548@Route\u6ce8\u91ca\u76ee\u6807\uff1a\u65b9\u6cd5\u6307\u5b9a\u8def\u7531\u89c4\u5219\u5c5e\u6027\u540d\u79f0\u8bf4\u660eurl\u8bf7\u6c42\u5730\u5740\u89c4\u5219\u3002\u4ee5\/\u5f00\u5934\u5219\u5ffd\u89c6@Controller\u4e2d\u7684prefix\u652f\u6301\u4ee3\u5165{name}\u5f62\u5f0f\u5360\u4f4d\u7b26\uff0c\u5339\u914d\u51fa\u6765\u7684\u503c\u53ef\u4ee5\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u52a8\u4f5cmethod\u5982\u679c\u8bbe\u7f6e\u4e86method\uff0c\u5219\u8bf7\u6c42\u65b9\u6cd5\u5fc5\u987b\u5728method\u5217\u8868\u4e2d\u624d\u53ef\u4ee5\u8fdb\u5230\u52a8\u4f5c\u3002\u652f\u6301\u5b57\u7b26\u4e32\u548c\u6570\u7ec4\u3002\u5982\uff1a&quot;GET&quot;\u6216{&quot;GET&quot;, &quot;POST&quot;}domain\u5224\u65ad\u57df\u540d\uff0c\u53ea\u6709\u7b26\u5408\u6761\u4ef6\u624d\u5141\u8bb8\u8bbf\u95ee\u3002\u652f\u6301\u5b57\u7b26\u4e32\u548c\u6570\u7ec4\uff0c\u652f\u6301{name}\u5f62\u5f0f\u5360\u4f4d\u7b26\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u52a8\u4f5cparamsGet\u5224\u65adGET\u53c2\u6570\uff0c\u53ea\u6709\u7b26\u5408\u6761\u4ef6\u624d\u5141\u8bb8\u8bbf\u95ee\u3002\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u6216\u6570\u7ec4\u3002id=100\u5fc5\u987b\u5305\u542bid\uff0c\u5e76\u4e14\u503c\u4e3a100id!=100\u6216id&lt;&gt;100\u5fc5\u987b\u5305\u542bid\uff0c\u5e76\u4e14\u503c\u4e0d\u4e3a100id\u5fc5\u987b\u5305\u542bid\u53c2\u6570!id\u5fc5\u987b\u4e0d\u5305\u542bid\u53c2\u6570[&quot;id&quot; =&gt; &quot;\\d+&quot;]\u652f\u6301\u6b63\u5219paramsPost\u5224\u65adPOST\u53c2\u6570\uff0c\u7528\u6cd5\u540cparamsGetheader\u5224\u65ad\u8bf7\u6c42\u5934\uff0c\u7528\u6cd5\u540cparamsGetrequestMime\u8bf7\u6c42\u7684mime\u7c7b\u578b\u5224\u65ad\u5224\u65ad\u8bf7\u6c42\u5934\u4e2d\u7684Content-Type\u4e2d\u662f\u5426\u5305\u542b\u8fd9\u4e9bmime\u7c7b\u578b\u4e4b\u4e00\u652f\u6301\u5b57\u7b26\u4e32\u548c\u5b57\u7b26\u4e32\u6570\u7ec4ignoreCase\u5ffd\u7565\u8bf7\u6c42\u5730\u5740\u5927\u5c0f\u5199null-\u53d6HttpRoute\u4e2d\u9ed8\u8ba4\u503ctrue-\u5ffd\u7565\u5927\u5c0f\u5199false-\u4e25\u683c\u5224\u65ad@Action\u6ce8\u91ca\u76ee\u6807\uff1a\u65b9\u6cd5\u8868\u660e\u4e00\u4e2a\u65b9\u6cd5\u662f\u52a8\u4f5c\u5c5e\u6027\uff1a\u65e0\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff0c\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u63a7\u5236\u5668+\u8def\u7531\u6ce8\u89e3\u4ee3\u7801\u3002&lt;?php\nnamespace Test;\n\nuse Imi\\Controller\\HttpController;\nuse Imi\\Server\\Route\\Annotation\\Route;\nuse Imi\\Server\\Route\\Annotation\\Action;\nuse Imi\\Server\\Route\\Annotation\\Controller;\n\n\/**\n * \u4e00\u4e2a\u7b80\u5355\u7684\u63a7\u5236\u5668\n * @Controller\n *\/\nclass Index extends HttpController\n{\n    \/**\n     * \u4e00\u4e2a\u52a8\u4f5c\n     * @Action\n     * @Route(url=&quot;\/&quot;)\n     *\/\n    public function index()\n    {\n        return $this-&gt;response-&gt;write('hello imi!');\n    }\n}\u8bbf\u95ee\u5730\u5740\uff1ahttp:\/\/localhost:{port}\/\u8f93\u51fa\u5185\u5bb9\uff1ahello imi!\u914d\u7f6e\u8def\u7531\u914d\u7f6e\u5fc5\u987b\u5199\u5728\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5982\u679c\u4f60\u5199\u5728\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\u662f\u65e0\u6548\u7684\u3002\u8def\u7531\u914d\u7f6e\u652f\u6301\u4e09\u79cd\u65b9\u5f0f\uff1a\u4f20\u7edf\u3001\u56de\u8c03\u3001\u8def\u7531\u56de\u8c03&lt;?php\nreturn [\n    'route' =&gt; [\n        \/\/ \u4f20\u7edf\u65b9\u5f0f\uff0c\u76f4\u63a5\u6307\u5b9a\u63a7\u5236\u5668\u3001\u65b9\u6cd5\u3001\u8def\u7531\uff0c\u548c\u6ce8\u89e3\u65b9\u5f0f\u6bd4\u8f83\u7c7b\u4f3c\n        [\n            'controller' =&gt; \\ImiDemo\\HttpDemo\\MainServer\\Controller\\Test::class,\n            'method' =&gt; 'index',\n            'route' =&gt; [\n                'url' =&gt; '\/test',\n                \/\/ 'method'    =&gt;    'PUT',\n                \/\/ 'method'    =&gt;    ['GET', 'POST'],\n                \/\/ 'domain'    =&gt;    '{name}.xxx.com',\n            ],\n        ],\n        \/\/ \u56de\u8c03\u65b9\u5f0f\uff0c\u7ed9callback\u6307\u5b9a\u4e00\u4e2acallable\u7c7b\u578b\n        [\n            'route' =&gt; [\n                'url' =&gt; '\/callback1',\n            ],\n            'callback' =&gt; function () {\n                return RequestContext::get('response')-&gt;write('callback1');\n            },\n        ],\n        \/\/ \u8def\u7531\u56de\u8c03\u65b9\u5f0f\uff0cnew RouteCallable(\u7c7b\u540d, \u65b9\u6cd5\u540d)\n        [\n            'route' =&gt; [\n                'url' =&gt; '\/callback2',\n            ],\n            'callback' =&gt; new RouteCallable('\\Test', 'abc'),\n        ],\n        \/\/ \u5339\u914dURL\uff0c\u628ainterface\u4ee3\u5165\u5230\u7c7b\u3001\u65b9\u6cd5\u540d\u4e2d\n        [\n            'controller' =&gt; '\\ImiDemo\\HttpDemo\\MainServer\\Controller\\Test{$interface}',\n            'method' =&gt; '{$interface}',\n            'route' =&gt; [\n                'url' =&gt; '\/test\/{interface}',\n            ],\n        ],\n        \/\/ \u61d2\u4eba\u514d\u53bb\u5199@Controller\u548c@Action\u6ce8\u89e3\u7684\u9ebb\u70e6\n        [\n            'controller'    =&gt;    '\\ImiDemo\\HttpDemo\\MainServer\\Controller\\{$controller}',\n            'method'        =&gt;    '{$action}',\n            'route'    =&gt;    [\n                'url'    =&gt;    '\/{controller}\/{action}',\n            ],\n        ],\n    ]\n];\u83b7\u53d6\u5f53\u524d\u8def\u7531\u89e3\u6790\u7ed3\u679c (routeResult)$routeResult = RequestContext::get('routeResult');$routeResult \u5b9a\u4e49\uff1a\/**\n * \u8def\u7531\u914d\u7f6e\u9879\n *\n * @var \\Imi\\Server\\UdpServer\\Route\\RouteItem\n *\/\npublic $routeItem;\n\n\/**\n * \u53c2\u6570\n *\n * @var array\n *\/\npublic $params;\n\n\/**\n * \u56de\u8c03\n *\n * @var callable\n *\/\npublic $callable;$routeResult-&gt;routeItem \u5b9a\u4e49\uff1a\/**\n * \u6ce8\u89e3\n *\n * @var \\Imi\\Server\\Route\\Annotation\\Route\n *\/\npublic $annotation;\n\n\/**\n * \u56de\u8c03\n *\n * @var callable|\\Imi\\Server\\Route\\RouteCallable\n *\/\npublic $callable;\n\n\/**\n * \u4e2d\u95f4\u4ef6\u5217\u8868\n *\n * @var array\n *\/\npublic $middlewares = [];\n\n\/**\n * WebSocket \u914d\u7f6e\n *\n * @var array\n *\/\npublic $wsConfig = [];\n\n\/**\n * \u5176\u5b83\u914d\u7f6e\u9879\n *\n * @var array\n *\/\npublic $options;"},{"id":15,"parent_id":13,"title":"\u4e2d\u95f4\u4ef6","mdFileName":"components\/httpserver\/middleware.md","url":"components\/httpserver\/middleware.html","level":1,"content":"\u4e2d\u95f4\u4ef6IMI \u6846\u67b6\u9075\u5faa PSR-7\u3001PSR-15 \u6807\u51c6\uff0c\u4f7f\u7528\u4e2d\u95f4\u4ef6\u6765\u5b9e\u73b0\u8def\u7531\u3002\u5f00\u53d1\u8005\u4e5f\u53ef\u4ee5\u5f00\u53d1\u4e2d\u95f4\u4ef6\u7c7b\uff0c\u5bf9\u6574\u4e2a\u8bf7\u6c42\u548c\u54cd\u5e94\u8fc7\u7a0b\u8fdb\u884c\u81ea\u5b9a\u4e49\u5904\u7406\u3002\u6ce8\u610f\uff01\u6700\u597d\u4e0d\u8981\u5728\u4e2d\u95f4\u4ef6\u4e2d\u4f7f\u7528\u7c7b\u5c5e\u6027\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u51b2\u7a81\uff01\u5b9a\u4e49\u4e2d\u95f4\u4ef6use Imi\\Bean\\Annotation\\Bean;\nuse Psr\\Http\\Message\\ResponseInterface;\nuse Psr\\Http\\Message\\ServerRequestInterface;\nuse Psr\\Http\\Server\\RequestHandlerInterface;\nuse Psr\\Http\\Server\\MiddlewareInterface;\n\n\/**\n * @Bean\n *\/\nclass TestMiddleware implements MiddlewareInterface\n{\n    \/**\n     * \u5904\u7406\u65b9\u6cd5\n     * @param ServerRequestInterface $request\n     * @param RequestHandlerInterface $handler\n     * @return ResponseInterface\n     *\/\n    public function process(ServerRequestInterface $request, RequestHandlerInterface $handler): ResponseInterface\n    {\n        \/\/ \u524d\u7f6e\u5904\u7406\n        \n        \/\/ \u5148\u6267\u884c\u5176\u5b83\u4e2d\u95f4\u4ef6\n        $response = $handler-&gt;handle($request);\n        \n        \/\/ \u540e\u7f6e\u5904\u7406\n        \n        return $response;\n    }\n}\u5168\u5c40\u4e2d\u95f4\u4ef6return [\n    'beans'    =&gt;    [\n        \/\/ \u4e2d\u95f4\u4ef6\n        'HttpDispatcher'    =&gt;    [\n            'middlewares'    =&gt;    [\n                \/\/ \u4e2d\u95f4\u4ef6\n                \\Imi\\Server\\Session\\Middleware\\HttpSessionMiddleware::class,\n            ],\n        ],\n    ],\n];\u5c40\u90e8\u4e2d\u95f4\u4ef6\u6ce8\u89e3\u4f7f\u7528class Index extends HttpController\n{\n    \/**\n     * PHP \u539f\u751f\u6a21\u7248\u5f15\u64ce\u6f14\u793a\n     * \u8bbf\u95ee\uff1ahttp:\/\/127.0.0.1:8080\/\n     * \n     * @Action\n     * @Route(url=&quot;\/&quot;)\n     * @View(template=&quot;index&quot;)\n     * \n     * \u5355\u4e2a\u4e2d\u95f4\u4ef6\uff0c\u6d4f\u89c8\u5668 F12 \u770bResponse Header\uff1a\n     * @Middleware(\\ImiDemo\\HttpDemo\\Middlewares\\PoweredBy::class)\n     * @return void\n     *\/\n    public function index()\n    {\n        return [\n            'title'        =&gt;    'hello imi',\n            'content'    =&gt;    'imi is very six',\n        ];\n    }\n\n    \/**\n     * \u65e0@View\u6ce8\u89e3\uff0c\u4e0d\u7528\u5199\u4ee3\u7801\uff0c\u4e5f\u53ef\u4ee5\u6e32\u67d3\u6a21\u7248\n     * \u8bbf\u95ee\uff1ahttp:\/\/127.0.0.1:8080\/Index\/test\n     * \n     * @Action\n     * \n     * \u591a\u4e2a\u4e2d\u95f4\u4ef6\uff0c\u6d4f\u89c8\u5668 F12 \u770bResponse Header\uff1a\n     * @Middleware({\n     * \\ImiDemo\\HttpDemo\\Middlewares\\PoweredBy::class,\n     * \\ImiDemo\\HttpDemo\\Middlewares\\Test::class\n     * })\n     * \n     * @return void\n     *\/\n    public function test()\n    {\n\n    }\n}\u5982\u4e0a\u4ee3\u7801\uff0cindex()\u65b9\u6cd5\u4e2d\u7684@Middleware\u662f\u8bbe\u7f6e\u5355\u4e2a\u3002test()\u65b9\u6cd5\u4e2d\u7684\u662f\u8bbe\u7f6e\u591a\u4e2a\u4e2d\u95f4\u4ef6\u3002\u5177\u4f53\u8bf7\u770bimi-demo\u9879\u76ee\u4ee3\u7801\u3002\u914d\u7f6e\u8def\u7531\u4f7f\u7528\u4efb\u4f55\u7c7b\u578b\u7684\u8def\u7531\u914d\u7f6e\u90fd\u662f\u52a0middlewares\u8282\u6765\u5b9e\u73b0\u6307\u5b9a\u5c40\u90e8\u4e2d\u95f4\u4ef6\u3002[\n    'route'    =&gt;    [\n        'url'    =&gt;    '\/callback2',\n    ],\n    'callback'    =&gt;    new RouteCallable('\\Test', 'abc'),\n    'middlewares'    =&gt;    [\n        \\ImiDemo\\HttpDemo\\Middlewares\\PoweredBy::class,\n    ],\n],"},{"id":16,"parent_id":13,"title":"\u63a7\u5236\u5668","mdFileName":"components\/httpserver\/controller.md","url":"components\/httpserver\/controller.html","level":1,"content":"\u63a7\u5236\u5668\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff0c\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u63a7\u5236\u5668\u4ee3\u7801\u3002&lt;?php\nnamespace Test;\n\nuse Imi\\Controller\\HttpController;\nuse Imi\\Server\\Route\\Annotation\\Route;\nuse Imi\\Server\\Route\\Annotation\\Action;\nuse Imi\\Server\\Route\\Annotation\\Controller;\n\n\/**\n * \u4e00\u4e2a\u7b80\u5355\u7684\u63a7\u5236\u5668\n * @Controller\n *\/\nclass Index extends HttpController\n{\n    \/**\n     * \u4e00\u4e2a\u52a8\u4f5c\n     * @Action\n     * @Route(url=&quot;\/&quot;)\n     *\/\n    public function index()\n    {\n        return $this-&gt;response-&gt;write('hello imi!');\n    }\n}\u8bbf\u95ee\u5730\u5740\uff1ahttp:\/\/localhost:{port}\/\u8f93\u51fa\u5185\u5bb9\uff1ahello imi!\u5c5e\u6027$request\u8bf7\u6c42\u4fe1\u606f\u5bf9\u8c61\uff0c\u53ef\u4ee5\u7528\u4e8e\u83b7\u53d6\u53c2\u6570\u3001\u8bf7\u6c42\u5934\u7b49\uff0c\u9075\u5faa PSR-7 \u6807\u51c6\u3002\u83b7\u53d6 GET \u53c2\u6570public function get($name = null, $default = null)\u5f53$name\u4e3anull\u65f6\uff0c\u8fd4\u56de\u5168\u90e8\u83b7\u53d6 POST \u53c2\u6570public function post($name = null, $default = null)\u5f53$name\u4e3anull\u65f6\uff0c\u8fd4\u56de\u5168\u90e8\u662f\u5426\u5b58\u5728 GET \u53c2\u6570public function hasGet($name)\u662f\u5426\u5b58\u5728 POST\u53c2\u6570public function hasPost($name)\u83b7\u53d6\u6240\u6709 Cookiepublic function getCookieParams()\u83b7\u53d6 Cookie \u503cpublic function getCookie($name, $default = null)\u83b7\u53d6\u6240\u6709\u8bf7\u6c42\u5934public function getHeaders()\u8bf7\u6c42\u5934\u662f\u5426\u5b58\u5728\uff0c\u4e0d\u533a\u5206\u5927\u5c0f\u5199public function hasHeader($name)\u83b7\u53d6\u8bf7\u6c42\u5934\uff0c\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff0c\u652f\u6301\u540c\u540d\uff0c\u8fd4\u56de\u6570\u7ec4public function getHeader($name)\u83b7\u53d6\u8bf7\u6c42\u5934\uff0c\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff0c\u652f\u6301\u540c\u540d\uff0c\u8fd4\u56de\u5b57\u7b26\u4e32public function getHeaderLine($name)\u83b7\u53d6\u8bf7\u6c42\u65b9\u6cd5 (GET\/POST\u7b49)public function getMethod()\u83b7\u53d6 HTTP \u534f\u8bae\u7248\u672cpublic function getProtocolVersion()\u83b7\u53d6\u8bf7\u6c42\u5730\u5740public function getUri()\u83b7\u53d6 IMI \u4e2d\u5bf9\u5e94\u670d\u52a1\u5668\u7684\u5bf9\u8c61public function getServerInstance(): \\Imi\\Server\\Http\\Server\u83b7\u53d6\u4e0a\u4f20\u7684\u6587\u4ef6public function getUploadedFiles()\u8fd4\u56de\u503c\u4e3aImi\\Server\\Http\\Message\\UploadedFile\u6570\u7ec4\u83b7\u53d6 Server \u4fe1\u606fvar_dump($this-&gt;request-&gt;getServerParams());\nvar_dump($this-&gt;request-&gt;getServerParam('path_info'));\u8f93\u51fa\uff1aarray(11) {\n  [&quot;request_method&quot;]=&gt;\n  string(3) &quot;GET&quot;\n  [&quot;request_uri&quot;]=&gt;\n  string(47) &quot;\/xxx.html&quot;\n  [&quot;path_info&quot;]=&gt;\n  string(47) &quot;\/xxx.html&quot;\n  [&quot;request_time&quot;]=&gt;\n  int(1538010416)\n  [&quot;request_time_float&quot;]=&gt;\n  float(1538010417.6185)\n  [&quot;server_port&quot;]=&gt;\n  int(8080)\n  [&quot;remote_port&quot;]=&gt;\n  int(62687)\n  [&quot;remote_addr&quot;]=&gt;\n  string(9) &quot;127.0.0.1&quot;\n  [&quot;master_time&quot;]=&gt;\n  int(1538010416)\n  [&quot;server_protocol&quot;]=&gt;\n  string(8) &quot;HTTP\/1.1&quot;\n  [&quot;server_software&quot;]=&gt;\n  string(18) &quot;swoole-http-server&quot;\n}\nstring(47) &quot;\/xxx.html&quot;$response\u54cd\u5e94\u5bf9\u8c61\uff0c\u9075\u5faa PSR-7 \u6807\u51c6\u3002\u76f4\u63a5\u5bf9\u8be5\u5bf9\u8c61\u64cd\u4f5c\u65e0\u6548\uff0c\u9700\u8981\u5982\u4e0b\u4f7f\u7528\u624d\u53ef\u3002\u64cd\u4f5c\u540e\u8d4b\u503c\uff1apublic function action()\n{\n    $this-&gt;response = $this-&gt;response-&gt;write('hello imi!');\n}\u64cd\u4f5c\u540e\u8fd4\u56depublic function action()\n{\n    return $this-&gt;response-&gt;write('hello imi!');\n}\u91cd\u5b9a\u5411public function redirect($url, $status = StatusCode::FOUND)$status \u662f\u72b6\u6001\u7801\uff0c\u9ed8\u8ba4302\uff0c\u53ef\u4ee5\u4f7f\u7528StatusCode::XXX\u5e38\u91cf\u8f93\u51fa\u5185\u5bb9public function write(string $content)\u6e05\u7a7a\u8f93\u51fa\u7f13\u51b2\u533apublic function clear()\u8bbe\u7f6eCookiepublic function withCookie($key, $value, $expire = 0, $path = '\/', $domain = '', $secure = false, $httponly = false)\u8bbe\u7f6eGZIP\u538b\u7f29public function withGzip(boolean $status, $level = null)\u53d1\u9001\u6240\u6709\u54cd\u5e94\u6570\u636epublic function send()\u53d1\u9001\u6587\u4ef6\uff0c\u4e00\u822c\u7528\u4e8e\u6587\u4ef6\u4e0b\u8f7d\/**\n * \u53d1\u9001\u6587\u4ef6\uff0c\u4e00\u822c\u7528\u4e8e\u6587\u4ef6\u4e0b\u8f7d\n * @param string $filename \u8981\u53d1\u9001\u7684\u6587\u4ef6\u540d\u79f0\uff0c\u6587\u4ef6\u4e0d\u5b58\u5728\u6216\u6ca1\u6709\u8bbf\u95ee\u6743\u9650sendfile\u4f1a\u5931\u8d25\n * @param integer $offset \u4e0a\u4f20\u6587\u4ef6\u7684\u504f\u79fb\u91cf\uff0c\u53ef\u4ee5\u6307\u5b9a\u4ece\u6587\u4ef6\u7684\u4e2d\u95f4\u90e8\u5206\u5f00\u59cb\u4f20\u8f93\u6570\u636e\u3002\u6b64\u7279\u6027\u53ef\u7528\u4e8e\u652f\u6301\u65ad\u70b9\u7eed\u4f20\u3002\n * @param integer $length \u53d1\u9001\u6570\u636e\u7684\u5c3a\u5bf8\uff0c\u9ed8\u8ba4\u4e3a\u6574\u4e2a\u6587\u4ef6\u7684\u5c3a\u5bf8\n * @return static\n *\/\npublic function sendFile(string $filename, int $offset = 0, int $length = 0)\u662f\u5426\u5df2\u7ed3\u675f\u8bf7\u6c42public function isEnded()\u83b7\u53d6swoole\u54cd\u5e94\u5bf9\u8c61public function getSwooleResonse(): \\swoole_http_response\u83b7\u53d6\u5bf9\u5e94\u7684\u670d\u52a1\u5668public function getServerInstance(): \\Imi\\Server\\Http\\Server\u8bbe\u7f6e\u72b6\u6001\u7801public function withStatus($code, $reasonPhrase = '')\u8bbe\u7f6e\u8fd4\u56de\u5934public function withHeader($name, $value)$reponse-&gt;withHeader('test', 'v1');\n$reponse-&gt;withHeader('test', ['v2', 'v3']);\n\/\/ \u6700\u7ec8header\u4e2dtest\u4e3av2,v3\u6dfb\u52a0\u8fd4\u56de\u5934public function withAddedHeader($name, $value)$reponse-&gt;withAddedHeader('test', 'v1');\n$reponse-&gt;withAddedHeader('test', ['v2', 'v3']);\n\/\/ \u6700\u7ec8header\u4e2dtest\u4e3av1,v2,v3"},{"id":17,"parent_id":13,"title":"RESTful","mdFileName":"components\/httpserver\/restful.md","url":"components\/httpserver\/restful.html","level":1,"content":"RESTful\u4f7f\u7528 IMI \u63d0\u4f9b\u7684\u8def\u7531\u8bf7\u6c42\u65b9\u6cd5\u5224\u65ad\uff0c\u53ef\u4ee5\u5b9e\u73b0 RESTful \u98ce\u683c\u7684 api \u5f00\u53d1\u3002RESTful \u98ce\u683c\u63a7\u5236\u5668\u793a\u4f8b (query\/find\/create\/update\/delete)\uff1a&lt;?php\nnamespace ImiDemo\\HttpDemo\\MainServer\\Controller;\n\nuse Imi\\Controller\\HttpController;\nuse Imi\\Server\\View\\Annotation\\View;\nuse Imi\\Server\\Route\\Annotation\\Route;\nuse Imi\\Server\\Route\\Annotation\\Action;\nuse Imi\\Server\\Route\\Annotation\\Controller;\n\n\/**\n * @Controller(prefix=&quot;\/Rest\/&quot;)\n * @View(renderType=&quot;json&quot;)\n *\/\nclass Rest extends HttpController\n{\n    \/**\n     * query\n     * \n     * @Action\n     * @Route(url=&quot;&quot;, method={&quot;GET&quot;})\n     * @return void\n     *\/\n    public function query()\n    {\n        return [1, 2, 3];\n    }\n    \n    \/**\n     * find\n     * \n     * @Action\n     * @Route(url=&quot;{id}&quot;, method={&quot;GET&quot;})\n     * \n     * @param int $id\n     * @return void\n     *\/\n    public function find($id)\n    {\n        return [\n            'id'    =&gt;    $id,\n        ];\n    }\n\n    \/**\n     * create\n     * \n     * @Action\n     * @Route(url=&quot;&quot;, method={&quot;POST&quot;})\n     * @return void\n     *\/\n    public function create()\n    {\n        return [\n            'operation'    =&gt;    'create',\n            'postData'    =&gt;    $this-&gt;request-&gt;getParsedBody(),\n            'success'    =&gt;    true,\n        ];\n    }\n\n    \/**\n     * update\n     * \n     * @Action\n     * @Route(url=&quot;{id}&quot;, method={&quot;PUT&quot;})\n     * \n     * @param int $id\n     * @return void\n     *\/\n    public function update($id)\n    {\n        return [\n            'id'        =&gt;    $id,\n            'operation'    =&gt;    'update',\n            'success'    =&gt;    true,\n        ];\n    }\n\n    \/**\n     * delete\n     * \n     * @Action\n     * @Route(url=&quot;{id}&quot;, method={&quot;DELETE&quot;})\n     * \n     * @param int $id\n     * @return void\n     *\/\n    public function delete($id)\n    {\n        return [\n            'id'        =&gt;    $id,\n            'operation'    =&gt;    'delete',\n            'success'    =&gt;    true,\n        ];\n    }\n}"},{"id":18,"parent_id":13,"title":"Session","mdFileName":"components\/httpserver\/session.md","url":"components\/httpserver\/session.html","level":1,"content":"SessionIMI \u7684 Http Session \u76ee\u524d\u5185\u5d4c\u652f\u6301\u6587\u4ef6\u548c Redis \u4e24\u79cd\u5b58\u50a8\u65b9\u5f0f\uff0c\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u81ea\u884c\u6269\u5c55\u66f4\u591a\u5b58\u50a8\u65b9\u5f0f\u3002\u5982\u679c\u60f3\u8981\u542f\u7528 Session\uff0c\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8fdb\u884c\u8bbe\u7f6e\u3002\u914d\u7f6e\u5728\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\uff1areturn [\n    'beans'    =&gt;    [\n        'SessionManager'    =&gt;    [\n            \/\/ \u6307\u5b9a Session \u5b58\u50a8\u9a71\u52a8\u7c7b\n            'handlerClass'    =&gt;    \\Imi\\Server\\Session\\Handler\\File::class,\n        ],\n        'SessionConfig'    =&gt;    [\n            \/\/ session \u540d\u79f0\uff0c\u9ed8\u8ba4\u4e3aimisid\n            'name'    =&gt;    'imisid',\n            \/\/ \u6bcf\u6b21\u8bf7\u6c42\u5b8c\u6210\u540e\u89e6\u53d1\u5783\u573e\u56de\u6536\u7684\u6982\u7387\uff0c\u9ed8\u8ba4\u4e3a1%\uff0c\u53ef\u53d6\u503c0~1.0\uff0c\u6982\u7387\u4e3a0%~100%\n            'gcProbability'    =&gt;    0.01,\n            \/\/ \u6700\u5927\u5b58\u6d3b\u65f6\u95f4\uff0c\u9ed8\u8ba430\u5929\uff0c\u5355\u4f4d\u79d2\n            'maxLifeTime'=&gt;    86400 * 30,\n            \/\/ session \u524d\u7f00\n            'prefix' =&gt; null,\n        ],\n        'SessionCookie'    =&gt;    [\n            \/\/ Cookie \u7684 \u751f\u547d\u5468\u671f\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002\n            'lifetime'    =&gt;    0,\n            \/\/ \u6b64 cookie \u7684\u6709\u6548 \u8def\u5f84\u3002 on the domain where \u8bbe\u7f6e\u4e3a\u201c\/\u201d\u8868\u793a\u5bf9\u4e8e\u672c\u57df\u4e0a\u6240\u6709\u7684\u8def\u5f84\u6b64 cookie \u90fd\u53ef\u7528\u3002\n            'path'        =&gt;    '\/',\n            \/\/ Cookie \u7684\u4f5c\u7528 \u57df\u3002 \u4f8b\u5982\uff1a\u201cwww.php.net\u201d\u3002 \u5982\u679c\u8981\u8ba9 cookie \u5728\u6240\u6709\u7684\u5b50\u57df\u4e2d\u90fd\u53ef\u7528\uff0c\u6b64\u53c2\u6570\u5fc5\u987b\u4ee5\u70b9\uff08.\uff09\u5f00\u5934\uff0c\u4f8b\u5982\uff1a\u201c.php.net\u201d\u3002\n            'domain'    =&gt;    '',\n            \/\/ \u8bbe\u7f6e\u4e3a TRUE \u8868\u793a cookie \u4ec5\u5728\u4f7f\u7528 \u5b89\u5168 \u94fe\u63a5\u65f6\u53ef\u7528\u3002\n            'secure'    =&gt;    false,\n            \/\/ \u8bbe\u7f6e\u4e3a TRUE \u8868\u793a PHP \u53d1\u9001 cookie \u7684\u65f6\u5019\u4f1a\u4f7f\u7528 httponly \u6807\u8bb0\u3002\n            'httponly'    =&gt;    false,\n        ],\n        \/\/ \u914d\u7f6e\u4e2d\u95f4\u4ef6\n        'HttpDispatcher'    =&gt;    [\n            'middlewares'    =&gt;    [\n                \/\/ Session \u4e2d\u95f4\u4ef6\n                \\Imi\\Server\\Session\\Middleware\\HttpSessionMiddleware::class,\n            ],\n        ],\n    ],\n];\u5176\u4e2d\u6bcf\u4e00\u79cd\u5b58\u50a8\u65b9\u5f0f\u8fd8\u6709\u7279\u522b\u7684\u914d\u7f6e\u9879\uff0c\u8bf7\u770b\u4e0b\u6587\u3002\u6587\u4ef6\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6-&gt;beans\u4e2d\u52a0\u5165\uff1a'beans'    =&gt;    [\n    'SessionFile'    =&gt;    [\n        'savePath'    =&gt;    'Session\u6587\u4ef6\u5b58\u50a8\u8def\u5f84',\n    ]\n]\u6587\u4ef6 Session \u672a\u6765\u4e0d\u652f\u6301\u5206\u5e03\u5f0f\uff0c\u63a8\u8350\u4f7f\u7528 Redis\uff01Redis'beans'    =&gt;    [\n    'SessionRedis'    =&gt;    [\n        \/\/ Redis\u8fde\u63a5\u6c60\u540d\u79f0\n        'poolName'    =&gt;    '',\n        \/\/ Redis\u4e2d\u5b58\u50a8\u7684key\u524d\u7f00\uff0c\u53ef\u4ee5\u7528\u4e8e\u591a\u7cfb\u7edfsession\u7684\u5206\u79bb\n        \/\/ 'keyPrefix'    =&gt;    'imi.',\n    ]\n]Session \u5b58\u50a8\u5e8f\u5217\u5316\u65b9\u5f0f\u914d\u7f6e\u6839\u636e\u4f60\u9009\u7528\u7684\u5b58\u50a8\u9a71\u52a8\u7c7b\uff0c\u914d\u7f6e\u5728\u5bf9\u5e94\u7684\u8282\u91cc\uff0c\u4e0b\u9762\u4ee5\u6587\u4ef6\u9a71\u52a8\u6f14\u793a'beans'    =&gt;    [\n    'SessionFile'    =&gt;    [\n        'formatHandlerClass'    =&gt;    \\Imi\\Util\\Format\\PhpSerialize::class,\n    ]\n]\u53ef\u4ee5\u9009\u7528\u7684\u5e8f\u5217\u5316\u7c7b\uff1aJSON:\\Imi\\Util\\Format\\Json::classPHP\u5e8f\u5217\u5316:\\Imi\\Util\\Format\\PhpSerialize::classPHP Session \u5e8f\u5217\u5316:\\Imi\\Util\\Format\\PhpSession::class \uff08\u517c\u5bb9 php-fpm \u9ed8\u8ba4\u7684 Session \u5b58\u50a8\u683c\u5f0f\uff09\u4f7f\u7528\u5f15\u5165 Session \u7c7buse Imi\\Server\\Session\\Session;\u8bfb\u53d6\/\/ \u83b7\u53d6\u503c\nSession::get('aaa');\n\/\/ \u83b7\u53d6\u503c\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5219\u8fd4\u56de\u9ed8\u8ba4\u503c\nSession::get('aaa', 'default value');\n\/\/ \u83b7\u53d6$session['a']['b']\u7684\u503c\nSession::get('a.b');\n\/\/ \u83b7\u53d6$session[\u524d\u7f00]['aaa']\u7684\u503c\uff0c\u524d\u7f00\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\nSession::get('@.aaa');\u5199\u5165Session::set($name, $value)\u5220\u9664Session::delete($name)\u8bfb\u53d6\u5e76\u5220\u9664Session::once($name, $default = false)\u6e05\u7a7aSession::clear();"},{"id":19,"parent_id":13,"title":"\u89c6\u56fe","mdFileName":"components\/httpserver\/view.md","url":"components\/httpserver\/view.html","level":1,"content":"\u89c6\u56fe\u5728\u524d\u9762\u8bb2\u5230\u7684\u4f8b\u5b50\u4e2d\uff0c\u51e0\u4e4e\u90fd\u662f\u76f4\u63a5\u5bf9$response\u8fdb\u884c\u64cd\u4f5c\uff0c\u7136\u800c\u5b9e\u9645\u4e0a\u5f88\u5c11\u9700\u8981\u5bf9\u5176\u76f4\u63a5\u64cd\u4f5c\u7684\u60c5\u51b5\u3002\u5728 IMI \u4e2d\u53ef\u4ee5\u4f7f\u7528\u89c6\u56fe\u6765\u51b3\u5b9a\u54cd\u5e94\u5185\u5bb9\u548c\u683c\u5f0f\uff0c\u5305\u62ecJSON\u3001XML\u3001\u6a21\u7248\u6e32\u67d3\u5728\u5185\u7684 IMI \u8ba4\u4e3a\u90fd\u662f\u89c6\u56fe\uff0c\u89c6\u56fe\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u6ce8\u89e3\u6765\u8bbe\u7f6e\u3002&lt;?php\nnamespace Test;\n\nuse Imi\\Controller\\HttpController;\nuse Imi\\Server\\Route\\Annotation\\Route;\nuse Imi\\Server\\Route\\Annotation\\Action;\nuse Imi\\Server\\Route\\Annotation\\Controller;\nuse Imi\\Server\\View\\Annotation\\View;\n\n\/**\n * \u4e00\u4e2a\u7b80\u5355\u7684\u63a7\u5236\u5668\n * @Controller\n * @View(renderType=&quot;json&quot;)\n *\/\nclass Index extends HttpController\n{\n    \/**\n     * \u4e00\u4e2a\u52a8\u4f5c\n     * @Action\n     * @Route(url=&quot;\/&quot;)\n     * @View(renderType=&quot;html&quot;, template=&quot;index&quot;)\n     *\/\n    public function index()\n    {\n        return $this-&gt;response-&gt;write('hello imi!');\n    }\n}\u5982\u4e0a\u4ee3\u7801\u6240\u793a\uff0c@View\u6ce8\u89e3\u53ef\u4ee5\u5199\u5728\u7c7b\u548c\u65b9\u6cd5\u7684\u6ce8\u91ca\u4e2d\u3002\u7c7b\u6ce8\u89e3\u4ee3\u8868\u9488\u5bf9\u6240\u6709\u52a8\u4f5c\u8bbe\u5b9a\u7684\u89c6\u56fe\u914d\u7f6e\uff0c\u5728\u5355\u4e2a\u65b9\u6cd5\u4e0a\u5199\u6ce8\u89e3\uff0c\u4f1a\u8986\u76d6\u7c7b\u6ce8\u89e3\u3002json\/**\n * @Action\n * @View(renderType=&quot;json&quot;)\n *\/\npublic function index()\n{\n    \/\/ \u6570\u7ec4\n    $jsonData = [\n        'id'    =&gt;    1,\n        'name'    =&gt;    'imi',\n    ];\n    \/\/ \u5bf9\u8c61\n    \/\/ $jsonData = new stdClass;\n    \/\/ $jsonData-&gt;name = 'imi';\n    return $jsonData;\n}\u53ef\u9009\u914d\u7f6ereturn [\n    'beans'        =&gt;    [\n        'JsonView'    =&gt;    [\n            \/\/ json_encode \u7684\u53c2\u6570\u503c\u914d\u7f6e\n            'options'    =&gt;    0,\n            'depth'        =&gt;    512,\n        ]\n    ]\n];xml\/**\n * @Action\n * @View(renderType=&quot;xml&quot;)\n *\/\npublic function index()\n{\n    \/\/ DOMDocument\n    $xml = new \\DOMDocument();\n    $xml-&gt;loadXML($xmlString);\n    \n    \/\/ SimpleXMLElement\n    $xml = \\simplexml_load_string($xmlString);\n    \n    return $xml;\n}\u6a21\u7248\u6e32\u67d3\u5fc5\u9009\u914d\u7f6ereturn [\n    'beans'        =&gt;    [\n        'HtmlView'    =&gt;    [\n            'templatePath'    =&gt;    '\u6a21\u7248\u6587\u4ef6\u6839\u8def\u5f84',\n            \/\/ \u652f\u6301\u7684\u6a21\u7248\u6587\u4ef6\u6269\u5c55\u540d\uff0c\u4f18\u5148\u7ea7\u6309\u5148\u540e\u987a\u5e8f\n            \/\/ 'fileSuffixs'        =&gt;    [\n                'tpl',\n                'html',\n                'php'\n            ],\n        ]\n    ]\n];\u4f7f\u7528\u65b9\u5f0f\u63a7\u5236\u5668-\u52a8\u4f5c\/**\n * @Action\n * @View(&quot;a\/b&quot;)\n *\/\npublic function index()\n{\n    return [\n        'content'    =&gt;    'hello imi',\n    ];\n}\u6a21\u7248\u6587\u4ef6\u6a21\u7248\u6587\u4ef6\u6839\u8def\u5f84\/a\/b.html&lt;?=$content?&gt;\u8fd0\u884c\u7ed3\u679c\uff1ahello imiIMI \u6ca1\u6709\u9020\u6a21\u7248\u5f15\u64ce\u7684\u8f6e\u5b50\uff0c\u662f\u56e0\u4e3a\u73b0\u5728 PHP \u6e32\u67d3 HTML \u7684\u573a\u666f\u8d8a\u6765\u8d8a\u5c11\uff0c\u5982\u679c\u6709\u9700\u8981\u4e5f\u53ef\u4ee5\u81ea\u5df1\u96c6\u6210\u5176\u5b83\u5f00\u6e90\u6a21\u7248\u5f15\u64ce\u3002\u5176\u5b83\u5728\u63a7\u5236\u5668-\u52a8\u4f5c\u4e2d\uff0c\u9664\u4e86\u8fd4\u56de\u6570\u636e\uff0c\u4f60\u8fd8\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de$this-&gt;response\uff0c\u5982\uff1areturn $this-&gt;response-&gt;write('hello world');\u4f60\u8fd8\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de@View\u7684\u6ce8\u89e3\u7c7b\u5b9e\u4f8b\uff1areturn new \\Imi\\Server\\View\\Annotation\\View([\n    'template'    =&gt;    'index',\n    'renderType'=&gt;    'html',\n    'data'        =&gt;    [\n        'name'    =&gt;    'imi',\n    ],\n]);"},{"id":20,"parent_id":13,"title":"\u9519\u8bef\u5f02\u5e38\u5904\u7406","mdFileName":"components\/httpserver\/error.md","url":"components\/httpserver\/error.html","level":1,"content":"\u9519\u8bef\u5f02\u5e38\u5904\u7406\u5f53\u7a0b\u5e8f\u51fa\u73b0\u9519\u8bef\u6216\u8005\u5f02\u5e38\u65f6\uff0c\u6211\u4eec\u4e00\u822c\u4f1a\u5e0c\u671b\u5728\u5f00\u53d1\u65f6\u8f93\u51fa\u62a5\u9519\u4fe1\u606f\uff0c\u5728\u751f\u4ea7\u73af\u5883\u65f6\u9690\u85cf\u8be6\u7ec6\u7684\u4fe1\u606f\u3002\u5728 IMI \u4e2d\uff0c\u63d0\u4f9b\u4e86 Http \u670d\u52a1\u7684\u9519\u8bef\u5f02\u5e38\u9ed8\u8ba4\u5904\u7406\u5668\u652f\u6301\u3002\u9ed8\u8ba4 Http \u9519\u8bef\u5904\u7406\u5668\uff1aImi\\Server\\Http\\Error\\JsonErrorHandler\u6307\u5b9a\u9ed8\u8ba4\u5904\u7406\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\uff1areturn [\n    'beans'    =&gt;    [\n        'HttpErrorHandler'    =&gt;    [\n            \/\/ \u6307\u5b9a\u9ed8\u8ba4\u5904\u7406\u5668\n            'handler'    =&gt;    \\Imi\\Server\\Http\\Error\\JsonErrorHandler::class,\n        ],\n    ],\n];\u5904\u7406\u5668\u53c2\u6570\u8bbe\u7f6ereturn [\n    'beans'    =&gt;    [\n        \\Imi\\Server\\Http\\Error\\JsonErrorHandler::class    =&gt;    [\n            \/\/ debug \u4e3a false\u65f6\u4e5f\u663e\u793a\u9519\u8bef\u4fe1\u606f\n            'releaseShow'    =&gt;    false,\n            \/\/ \u53d6\u6d88\u7ee7\u7eed\u629b\u51fa\u5f02\u5e38\n            'cancelThrow'    =&gt;    true,\n        ],\n    ],\n];\u7f16\u5199\u5904\u7406\u5668\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff0c\u5b9e\u73b0IErrorHandler\u63a5\u53e3\uff0chandle()\u65b9\u6cd5\u8fd4\u56de\u503c\u4e3atrue\u65f6\u5219\u53d6\u6d88\u7ee7\u7eed\u629b\u51fa\u5f02\u5e38\u3002&lt;?php\nnamespace Imi\\Server\\Http\\Error;\n\nuse Imi\\App;\nuse Imi\\RequestContext;\nuse Imi\\Util\\Format\\Json;\nuse Imi\\Util\\Http\\Consts\\MediaType;\nuse Imi\\Util\\Http\\Consts\\RequestHeader;\n\nclass JsonErrorHandler implements IErrorHandler\n{\n    \/**\n     * debug \u4e3a false\u65f6\u4e5f\u663e\u793a\u9519\u8bef\u4fe1\u606f\n     * @var boolean\n     *\/\n    protected $releaseShow = false;\n\n    \/**\n     * \u53d6\u6d88\u7ee7\u7eed\u629b\u51fa\u5f02\u5e38\n     * @var boolean\n     *\/\n    protected $cancelThrow = true;\n\n    public function handle(\\Throwable $throwable): bool\n    {\n        if($this-&gt;releaseShow || App::isDebug())\n        {\n            $data = [\n                'message'    =&gt;    $throwable-&gt;getMessage(),\n                'code'        =&gt;    $throwable-&gt;getCode(),\n                'file'        =&gt;    $throwable-&gt;getFile(),\n                'line'        =&gt;    $throwable-&gt;getLine(),\n                'trace'        =&gt;    explode(PHP_EOL, $throwable-&gt;getTraceAsString()),\n            ];\n        }\n        else\n        {\n            $data = [\n                'success'    =&gt;    false,\n                'message'    =&gt;    'error',\n            ];\n        }\n        RequestContext::get('response')\n        -&gt;withAddedHeader(RequestHeader::CONTENT_TYPE, MediaType::APPLICATION_JSON)\n        -&gt;write(Json::encode($data))\n        -&gt;send();\n        return $this-&gt;cancelThrow;\n    }\n}"},{"id":21,"parent_id":13,"title":"404\u5904\u7406","mdFileName":"components\/httpserver\/404.md","url":"components\/httpserver\/404.html","level":1,"content":"404\u5904\u7406\u5f53\u6ca1\u6709\u5339\u914d\u7684\u8def\u7531\uff0c\u8fd9\u65f6\u5019\u53ef\u80fd\u4f1a\u9700\u8981404\u5904\u7406\u3002\u6846\u67b6\u9ed8\u8ba4\u7684404\u5904\u7406\u4e3a\u72b6\u6001\u7801\u8bbe\u4e3a404\uff0c\u5982\u679c\u9700\u8981\u81ea\u5b9a\u4e49\u5904\u7406\uff0c\u9700\u8981\u7f16\u5199\u81ea\u5b9a\u4e49\u5904\u7406\u7c7b\u3002\u6307\u5b9a\u9ed8\u8ba4\u5904\u7406\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\uff1areturn [\n    'beans'    =&gt;    [\n        'HttpNotFoundHandler'    =&gt;    [\n            \/\/ \u6307\u5b9a\u9ed8\u8ba4\u5904\u7406\u5668\n            'handler'    =&gt;    \\xxx\\HttpNotFoundHandler::class,\n        ],\n    ],\n];\u7f16\u5199\u5904\u7406\u5668\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff0c\u5b9e\u73b0IHttpNotFoundHandler\u63a5\u53e3\uff0chandle()\u65b9\u6cd5\u8fd4\u56de\u503c\u4e3aResponse\u5bf9\u8c61\u3002&lt;?php\nclass HttpNotFoundHandler implements IHttpNotFoundHandler\n{\n    public function handle(ServerRequestInterface $request, ResponseInterface $response): ResponseInterface\n    {\n        return $response-&gt;withStatus(StatusCode::NOT_FOUND);\n    }\n}"},{"id":22,"parent_id":13,"title":"HTTP \u9a8c\u8bc1\u5668","mdFileName":"components\/httpserver\/validation.md","url":"components\/httpserver\/validation.html","level":1,"content":"HTTP \u9a8c\u8bc1\u5668\u8bf7\u5148\u9605\u8bfb \u9a8c\u8bc1\u5668 \u7ae0\u8282\uff0cHTTP \u9a8c\u8bc1\u5668\u57fa\u4e8e\u9a8c\u8bc1\u5668\u6269\u5c55\uff0c\u57fa\u672c\u4f7f\u7528\u65b9\u5f0f\u76f8\u4f3c\u3002\u9996\u5148\uff0cHTTP \u9a8c\u8bc1\u5668\u662f@HttpValidation\u6ce8\u89e3\uff0c\u5b83\u53ea\u80fd\u5199\u5728\u65b9\u6cd5\u4e0a\u3002\u5199\u4e86\u8fd9\u4e2a\u6ce8\u89e3\uff0c\u5728action\u65b9\u6cd5\u8c03\u7528\u524d\u4f1a\u89e6\u53d1\u9a8c\u8bc1\uff0c\u9a8c\u8bc1\u5931\u8d25\u540c\u6837\u7684\u629b\u51fa\u5f02\u5e38\u53e6\u5916\uff0c\u9a8c\u8bc1\u89c4\u5219\u6ce8\u89e3\uff0c\u5982@Required\u7b49\u7684name\u5c5e\u6027\u7528\u6cd5\u4e5f\u7565\u6709\u4e0d\u540c\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528$get\u3001$post\u3001$body\u3001$headers\u3001$cookie\u3001$session\u3001$this\u540e\u9762\u8ddf\u4e0a.\u53c2\u6570\u540d\u6307\u5b9a\u53c2\u6570\uff0c\u5176\u4e2dget\u548cpost\u81ea\u7136\u4e0d\u7528\u591a\u8bf4\uff0c\u8fd9body\u7684\u7528\u5904\u5c31\u662f\uff0c\u6bd4\u5982\u53c2\u6570\u662f\u4ee5json\u4e3abody\u4f20\u7ed9\u4f60\u7684\uff0c\u4ed6\u4f1a\u81ea\u52a8\u7ed9\u4f60json_decode\uff0c\u4f60\u7528$body\u5c31\u53ef\u4ee5\u6307\u5b9a\u4e86\u3002$this \u4ee3\u8868\u662f\u5f53\u524d\u63a7\u5236\u5668\u5bf9\u8c61\u3002\u8fd8\u6709\u4e00\u4e2a@ExtractData\u6ce8\u89e3\uff0c\u5b83\u53ef\u4ee5\u628aget\/post\/body\u4e2d\u7684\u53c2\u6570\u5bfc\u51fa\u5230action\u65b9\u6cd5\u7684\u53c2\u6570\u4e2d\u3002@ExtractData\u6ce8\u89e3\u53ef\u4ee5\u72ec\u7acb\u4f7f\u7528\uff0c\u4e0d\u4f9d\u8d56@HttpValidation\u6ce8\u89e3\uff0c\u4f46\u53ea\u80fd\u5728\u63a7\u5236\u5668\u4e2d\u4f7f\u7528\u3002\u5982\u4e0b\u65b9\u6cd5\u6240\u793a\uff1a\/**\n * http\u53c2\u6570\u9a8c\u8bc1\u6d4b\u8bd5\n * \n * @Action\n * \n * @HttpValidation\n * \n * @Required(name=&quot;$get.id&quot;, message=&quot;\u7528\u6237ID\u4e3a\u5fc5\u4f20\u53c2\u6570&quot;)\n * @Integer(name=&quot;$get.id&quot;, min=&quot;1&quot;, message=&quot;\u7528\u6237ID\u4e0d\u7b26\u5408\u89c4\u5219&quot;)\n * @Required(name=&quot;$get.name&quot;, message=&quot;\u7528\u6237\u59d3\u540d\u4e3a\u5fc5\u4f20\u53c2\u6570&quot;)\n * @Text(name=&quot;$get.name&quot;, min=&quot;2&quot;, message=&quot;\u7528\u6237\u59d3\u540d\u957f\u5ea6\u4e0d\u5f97\u5c11\u4e8e2\u4f4d&quot;)\n * @Required(name=&quot;$get.age&quot;, default=-1)\n * \n * @ExtractData(name=&quot;$get.id&quot;, to=&quot;id&quot;)\n * @ExtractData(name=&quot;$get.name&quot;, to=&quot;name&quot;)\n * @ExtractData(name=&quot;$get.age&quot;, to=&quot;age&quot;)\n *\n * @return void\n *\/\npublic function httpValidation($id, $name, $age)\n{\n    return compact('id', 'name', 'age');\n}"},{"id":24,"parent_id":23,"title":"HTTP \u8def\u7531","mdFileName":"components\/websocketServer\/httpRoute.md","url":"components\/websocketServer\/httpRoute.html","level":1,"content":"HTTP \u8def\u7531\u5728 WebSocket \u670d\u52a1\u5668\u4e2d\uff0cHTTP \u8def\u7531\u7684\u4f5c\u7528\u662f\u8ba9\u6307\u5b9aURI\u624d\u652f\u6301\u63e1\u624b\uff0c\u5e76\u4e14\u5982\u679c\u6709\u9700\u8981\u53ef\u4ee5\u81ea\u884c\u505a\u63e1\u624b\u5904\u7406\u3002\u7528\u6cd5\u540c HTTP \u670d\u52a1\u5668\uff0c\u4e0d\u518d\u7ec6\u8bf4\u3002"},{"id":25,"parent_id":23,"title":"HTTP \u63a7\u5236\u5668","mdFileName":"components\/websocketServer\/httpController.md","url":"components\/websocketServer\/httpController.html","level":1,"content":"HTTP \u63a7\u5236\u5668\u5728 WebSocket \u670d\u52a1\u5668\u4e2d\uff0c\u5982\u679c\u6709\u9700\u8981\u53ef\u4ee5\u5728 HTTP \u63a7\u5236\u5668\u4e2d\u81ea\u884c\u505a\u63e1\u624b\u5904\u7406\u3002\u5177\u4f53\u5199\u6cd5\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\u4e2d\u7684\u6587\u4ef6\\imi-demo\\WebSocketDemo\\MainServer\\Controller\\HandShake.php\u6307\u5b9a WebSocket \u6570\u636e\u5904\u7406\u5668\u5728\u63a7\u5236\u5668\u4e2d\u7684\u65b9\u6cd5\u4e0a\u52a0\u4e0a\u6ce8\u89e3\uff1a@WSConfig(parserClass=\\Imi\\Server\\WebSocket\\Parser\\JsonArrayParser::class)parserClass \u6307\u5b9a\u7684\u5c31\u662f\u5904\u7406\u5668\u7c7b\uff0c\u4f5c\u7528\u5c31\u662f\u63a5\u6536\u5230\u6570\u636e\u540e\u81ea\u52a8\u89e3\u7801\u4e3a\u5bf9\u8c61\u6216\u6570\u7ec4\uff0c\u53d1\u9001\u65f6\u81ea\u52a8\u5c06\u6570\u7ec4\u6216\u5bf9\u8c61\u7f16\u7801\u4e3a\u76f8\u5e94\u6570\u636e\u3002\u76ee\u524d\u652f\u6301\u7684\u7c7b\u5982\u4e0b\uff1aJSON \u6570\u7ec4\uff1a\\Imi\\Server\\WebSocket\\Parser\\JsonArrayParser::classJSON \u5bf9\u8c61\uff1a\\Imi\\Server\\WebSocket\\Parser\\JsonObjectParser::class"},{"id":26,"parent_id":23,"title":"WebSocket \u8def\u7531","mdFileName":"components\/websocketServer\/route.md","url":"components\/websocketServer\/route.html","level":1,"content":"\u8def\u7531\u542f\u7528\u8def\u7531\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165\u4e2d\u95f4\u4ef6\uff1areturn [\n    'beans'    =&gt;    [\n        'WebSocketDispatcher'    =&gt;    [\n            'middlewares'    =&gt;    [\n                \\Imi\\Server\\WebSocket\\Middleware\\RouteMiddleware::class,\n            ],\n        ],\n    ],\n];\u901a\u8fc7\u914d\u7f6e\u6ce8\u5165\u5f62\u5f0f\uff0c\u5b9e\u73b0\u975e\u5e38\u7075\u6d3b\u7684\u914d\u7f6e\uff0c\u4f60\u751a\u81f3\u53ef\u4ee5\u81ea\u5df1\u53e6\u5916\u5b9e\u73b0\u8def\u7531\u4e2d\u95f4\u4ef6\uff0c\u800c\u4e0d\u7528\u88ab\u6846\u67b6\u81ea\u5e26\u7684\u4e2d\u95f4\u4ef6\u6240\u5f71\u54cd\uff0c\u7528\u54ea\u4e9b\u4e2d\u95f4\u4ef6\u90fd\u5728\u4f60\u7684\u638c\u63a7\u4e4b\u4e2d\uff01\u83b7\u53d6\u63e1\u624b\u8bf7\u6c42\u8def\u7531\u89e3\u6790\u7ed3\u679c$httpRouteResult = ConnectContext::get('routeResult');\u83b7\u53d6\u5f53\u524d\u8def\u7531\u89e3\u6790\u7ed3\u679c (routeResult)$routeResult = RequestContext::get('routeResult');$routeResult \u5b9a\u4e49\uff1a\/**\n * \u8def\u7531\u914d\u7f6e\u9879\n *\n * @var \\Imi\\Server\\WebSocket\\Route\\RouteItem\n *\/\npublic $routeItem;\n\n\/**\n * \u53c2\u6570\n *\n * @var array\n *\/\npublic $params;\n\n\/**\n * \u56de\u8c03\n *\n * @var callable\n *\/\npublic $callable;$routeResult-&gt;routeItem \u5b9a\u4e49\uff1a\/**\n * \u6ce8\u89e3\n *\n * @var \\Imi\\Server\\Route\\Annotation\\WebSocket\\WSRoute\n *\/\npublic $annotation;\n\n\/**\n * \u56de\u8c03\n *\n * @var callable|\\Imi\\Server\\Route\\RouteCallable\n *\/\npublic $callable;\n\n\/**\n * \u4e2d\u95f4\u4ef6\u5217\u8868\n *\n * @var array\n *\/\npublic $middlewares = [];\n\n\/**\n * \u5176\u5b83\u914d\u7f6e\u9879\n *\n * @var array\n *\/\npublic $options;"},{"id":27,"parent_id":23,"title":"WebSocket \u63a7\u5236\u5668","mdFileName":"components\/websocketServer\/websocketController.md","url":"components\/websocketServer\/websocketController.html","level":1,"content":"WebSocket \u63a7\u5236\u5668\u5b9a\u4e49&lt;?php\nnamespace ImiDemo\\WebSocketDemo\\MainServer\\WSController\\Index;\n\nuse Imi\\ConnectContext;\nuse Imi\\Controller\\WebSocketController;\nuse Imi\\Server\\Route\\Annotation\\WebSocket\\WSRoute;\nuse Imi\\Server\\Route\\Annotation\\WebSocket\\WSAction;\nuse Imi\\Server\\Route\\Annotation\\WebSocket\\WSController;\n\n\/**\n * \u6570\u636e\u6536\u53d1\u6d4b\u8bd5\n * @WSController\n *\/\nclass Test extends WebSocketController\n{\n    \/**\n     * \u767b\u5f55\n     * \n     * @WSAction\n     * @WSRoute({&quot;action&quot;=&quot;login&quot;})\n     * @return void\n     *\/\n    public function login($data)\n    {\n        ConnectContext::set('username', $data-&gt;username);\n        $this-&gt;server-&gt;joinGroup('g1', $this-&gt;frame-&gt;getFd());\n        return ['success'=&gt;true];\n    }\n}\u9996\u5148\u63a7\u5236\u5668\u7c7b\u5fc5\u987b\u6709@WSController\u6ce8\u89e3\uff0c\u5bf9\u5e94\u52a8\u4f5c\u5fc5\u987b\u6709@WSAction\u548c@WSRoute\u6ce8\u89e3\u3002\u6ce8\u89e3@WSRoute\u6307\u5b9a WebSocket \u8def\u7531\u89e3\u6790\u89c4\u5219\u3002\/\/ \u89e3\u6790 $data['action'] === 'login'\n@WSRoute({&quot;action&quot;=&quot;login&quot;})\n\/\/ \u89e3\u6790 $data['a']['b']['c'] === 'login'\n@WSRoute({&quot;a.b.c&quot;=&quot;login&quot;})\n\/\/ \u89e3\u6790 $data['a'] == '1' &amp;&amp; $data['b'] == '2'\n@WSRoute({&quot;a&quot;=&quot;1&quot;, &quot;b&quot;=&quot;2&quot;})\u5f53\u7136\u5bf9\u8c61\u4e5f\u662f\u652f\u6301\u7684\uff1a\/\/ \u89e3\u6790 $data-&gt;a-&gt;b-&gt;c === 'login'\n@WSRoute({&quot;a.b.c&quot;=&quot;login&quot;})\u8def\u7531\u5339\u914d\u6210\u529f\uff0c\u5c31\u4f1a\u6267\u884c\u8fd9\u4e2a\u52a8\u4f5c\u3002\u52a8\u4f5c\u54cd\u5e94\u6570\u636e\u54cd\u5e94\u5f53\u524d\u8fd9\u4e2a\u8bf7\u6c42\u76f4\u63a5\u5728\u65b9\u6cd5\u4e2d\u8fd4\u56de\u4e00\u4e2a\u6570\u7ec4\u6216\u5bf9\u8c61\uff0c\u5728Http \u63a7\u5236\u5668\u4e2d@WSConfig\u4e2d\u8bbe\u5b9a\u7684\u5904\u7406\u5668\uff0c\u5c31\u4f1a\u628a\u8fd9\u4e2a\u8f6c\u4e3a\u5bf9\u5e94\u6570\u636e\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\u3002return ['success'=&gt;true];\u5206\u7ec4\u53d1\u9001$this-&gt;server-&gt;groupCall('\u7ec4\u540d', 'push', ['success'=&gt;true]);\u5f53\u7136\uff0c\u5e76\u4e0d\u662f\u6bcf\u4e2a\u8bf7\u6c42\u90fd\u9700\u8981\u6709\u54cd\u5e94\u6570\u636e\uff0c\u4ec0\u4e48\u90fd\u4e0dreturn\u6216\u8005return null\u5c31\u662f\u4e0d\u54cd\u5e94\u6570\u636e\u3002\u7c7b\u5c5e\u6027$server\u65b9\u6cd5getSwooleServer\u83b7\u53d6Swoole\u7684Server\u5bf9\u8c61\/**\n * \u7ec4\u662f\u5426\u5b58\u5728\n *\n * @param string $groupName\n * @return boolean\n *\/\npublic function hasGroup(string $groupName);\/**\n * \u521b\u5efa\u7ec4\uff0c\u8fd4\u56de\u7ec4\u5bf9\u8c61\n *\n * @param string $groupName\n * @param integer $maxClients\n * @return \\Imi\\Server\\Group\\Group\n *\/\npublic function createGroup(string $groupName, int $maxClients = -1);\/**\n * \u83b7\u53d6\u7ec4\u5bf9\u8c61\uff0c\u4e0d\u5b58\u5728\u8fd4\u56denull\n *\n * @param string $groupName\n * @return \\Imi\\Server\\Group\\Group|null\n *\/\npublic function getGroup(string $groupName);\/**\n * \u52a0\u5165\u7ec4\uff0c\u7ec4\u4e0d\u5b58\u5728\u5219\u81ea\u52a8\u521b\u5efa\n *\n * @param string $groupName\n * @param integer $fd\n * @return void\n *\/\npublic function joinGroup(string $groupName, int $fd);\/**\n * \u79bb\u5f00\u7ec4\uff0c\u7ec4\u4e0d\u5b58\u5728\u5219\u81ea\u52a8\u521b\u5efa\n *\n * @param string $groupName\n * @param integer $fd\n * @return void\n *\/\npublic function leaveGroup(string $groupName, int $fd);\/**\n * \u8c03\u7528\u7ec4\u65b9\u6cd5\n *\n * @param string $groupName\n * @param string $methodName\n * @param mixed ...$args\n * @return array\n *\/\npublic function groupCall(string $groupName, string $methodName, ...$args);\/**\n * \u83b7\u53d6\u6240\u6709\u7ec4\u5217\u8868\n *\n * @return \\Imi\\Server\\Group\\Group[]\n *\/\npublic function getGroups(): array;$frame\u65b9\u6cd5\/**\n * \u83b7\u53d6\u5ba2\u6237\u7aef\u7684socket id\n * @return int\n *\/\npublic function getFd(): int;\/**\n * \u6570\u636e\u5185\u5bb9\uff0c\u53ef\u4ee5\u662f\u6587\u672c\u5185\u5bb9\u4e5f\u53ef\u4ee5\u662f\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u53ef\u4ee5\u901a\u8fc7opcode\u7684\u503c\u6765\u5224\u65ad\n * @return string\n *\/\npublic function getData();\/**\n * \u83b7\u53d6\u683c\u5f0f\u5316\u540e\u7684\u6570\u636e\uff0c\u4e00\u822c\u662f\u6570\u7ec4\u6216\u5bf9\u8c61\n * @return mixed\n *\/\npublic function getFormatData();\/**\n * WebSocket\u7684OpCode\u7c7b\u578b\uff0c\u53ef\u4ee5\u53c2\u8003WebSocket\u534f\u8bae\u6807\u51c6\u6587\u6863\n * WEBSOCKET_OPCODE_TEXT = 0x1 \uff0c\u6587\u672c\u6570\u636e\n * WEBSOCKET_OPCODE_BINARY = 0x2 \uff0c\u4e8c\u8fdb\u5236\u6570\u636e\n * @return int\n *\/\npublic function getOpcode();\/**\n * \u8868\u793a\u6570\u636e\u5e27\u662f\u5426\u5b8c\u6574\n * @return boolean\n *\/\npublic function isFinish();\/**\n * \u83b7\u53d6 \\Swoole\\Websocket\\Frame \u5bf9\u8c61\n * @return \\Swoole\\Websocket\\Frame\n *\/\npublic function getSwooleWebSocketFrame(): \\Swoole\\Websocket\\Frame;"},{"id":28,"parent_id":23,"title":"\u4e2d\u95f4\u4ef6","mdFileName":"components\/websocketServer\/middleware.md","url":"components\/websocketServer\/middleware.html","level":1,"content":"\u4e2d\u95f4\u4ef6\u5f00\u53d1\u8005\u53ef\u4ee5\u5f00\u53d1\u4e2d\u95f4\u4ef6\u7c7b\uff0c\u5bf9\u6574\u4e2aWebSocket\u8bf7\u6c42\u548c\u54cd\u5e94\u8fc7\u7a0b\u8fdb\u884c\u81ea\u5b9a\u4e49\u5904\u7406\u3002\u6ce8\u610f\uff01\u6700\u597d\u4e0d\u8981\u5728\u4e2d\u95f4\u4ef6\u4e2d\u4f7f\u7528\u7c7b\u5c5e\u6027\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u51b2\u7a81\uff01\u5b9a\u4e49\u4e2d\u95f4\u4ef6&lt;?php\nnamespace Imi\\Server\\WebSocket\\Middleware;\n\nuse Imi\\RequestContext;\nuse Imi\\Bean\\Annotation\\Bean;\nuse Imi\\Server\\WebSocket\\Message\\IFrame;\nuse Imi\\Server\\WebSocket\\MessageHandler;\nuse Imi\\Server\\WebSocket\\IMessageHandler;\n\n\/**\n * @Bean\n *\/\nclass RouteMiddleware implements IMiddleware\n{\n    \/**\n     * \u5904\u7406\u65b9\u6cd5\n     *\n     * @param IFrame $frame\n     * @param IMessageHandler $handler\n     * @return void\n     *\/\n    public function process(IFrame $frame, IMessageHandler $handler)\n    {\n        \n    }\n\n}\u5168\u5c40\u4e2d\u95f4\u4ef6return [\n    'beans'    =&gt;    [\n        \/\/ \u4e2d\u95f4\u4ef6\n        'WebSocketDispatcher'    =&gt;    [\n            'middlewares'    =&gt;    [\n                \/\/ \u4e2d\u95f4\u4ef6\n                \\Imi\\Server\\WebSocket\\Middleware\\RouteMiddleware::class,\n            ],\n        ],\n    ],\n];\u5c40\u90e8\u4e2d\u95f4\u4ef6\u6ce8\u89e3\u4f7f\u7528&lt;?php\nnamespace ImiDemo\\WebSocketDemo\\MainServer\\WSController\\Index;\n\nuse Imi\\ConnectContext;\nuse Imi\\Controller\\WebSocketController;\nuse Imi\\Server\\Route\\Annotation\\WebSocket\\WSRoute;\nuse Imi\\Server\\Route\\Annotation\\WebSocket\\WSAction;\nuse Imi\\Server\\Route\\Annotation\\WebSocket\\WSController;\nuse Imi\\Server\\Route\\Annotation\\WebSocket\\WSMiddleware;\n\n\/**\n * \u6570\u636e\u6536\u53d1\u6d4b\u8bd5\n * @WSController\n *\/\nclass Test extends WebSocketController\n{\n    \/**\n     * test\n     * \n     * @WSAction\n     * @WSRoute({&quot;action&quot;=&quot;login&quot;})\n     * @WSMiddleware(XXX::class)\n     * @WSMiddleware({XXX::class,XXX2::class})\n     * @return void\n     *\/\n    public function test($data)\n    {\n    }\n}\u5982\u4e0a\u4ee3\u7801\uff0c\u540c\u65f6\u652f\u6301\u8bbe\u7f6e\u5355\u4e2a\u548c\u591a\u4e2a\u4e2d\u95f4\u4ef6"},{"id":29,"parent_id":23,"title":"\u8fde\u63a5\u4e0a\u4e0b\u6587","mdFileName":"components\/websocketServer\/session.md","url":"components\/websocketServer\/session.html","level":1,"content":"\u4f1a\u8bdd\u6570\u636eIMI \u4e2d WebSocket \u670d\u52a1\u4e2d\u4f7f\u7528 Imi\\ConnectContext \u7c7b\u5bf9\u8fde\u63a5\u7684\u4f1a\u8bdd\u6570\u636e\u8fdb\u884c\u7ba1\u7406\u3002\u5728\u6574\u4e2a\u8fde\u63a5\u7684\u751f\u547d\u5468\u671f\u4e2d\u90fd\u6709\u6548\u3002\u4f7f\u7528use Imi\\ConnectContext;\n\n\/\/ \u53d6\u503c\necho ConnectContext::get('name');\necho ConnectContext::get('name', 'default value');\n\n\/\/ \u8d4b\u503c\nConnectContext::set('name', 'value');\n\n\/\/ \u83b7\u53d6\u6240\u6709\u6570\u636e\n$array = ConnectContext::getContext();\n\n\/\/ \u4f7f\u7528\u56de\u8c03\u5e76\u4e14\u81ea\u52a8\u52a0\u9501\u8fdb\u884c\u64cd\u4f5c\uff0c\u56de\u8c03\u7528\u8fd4\u56de\u6570\u636e\u4f1a\u4fdd\u5b58\u8fdb\u8fde\u63a5\u4e0a\u4e0b\u6587\nConnectContext::use(function($data){\n    \/\/ \u672c\u65b9\u6cd5\u4f53\u4f1a\u5728\u9501\u4e2d\u6267\u884c\n    var_dump($data); \/\/ \u8bfb\u53d6\u6570\u636e\n    $data['aaa'] = 222;\n    return $data; \/\/ \u5199\u5165\u6570\u636e\uff0c\u4e0dreturn\u4e5f\u53ef\u4ee5\uff0c\u5c31\u662f\u4e0d\u4fee\u6539\n});\u914d\u7f6eConnectContext \u5b58\u50a8\u5668MemoryTable:'beans' =&gt;  [\n    'ConnectContextStore'   =&gt;  [\n        'handlerClass'  =&gt;  \\Imi\\Server\\ConnectContext\\StoreHandler\\MemoryTable::class,\n    ],\n    'ConnectContextMemoryTable' =&gt;  [\n        'tableName' =&gt;  'connectContext', \/\/ tableName \u4f60\u9700\u8981\u5b9e\u73b0\u5b9a\u4e49 MemoryTable\uff0c\u8bf7\u67e5\u770b\u76f8\u5173\u7ae0\u8282\n        'dataEncode'=&gt;  'serialize', \/\/ \u6570\u636e\u5199\u5165\u524d\u7f16\u7801\u56de\u8c03\n        'dataDecode'=&gt;  'unserialize', \/\/ \u6570\u636e\u8bfb\u51fa\u540e\u5904\u7406\u56de\u8c03\n        'lockId'    =&gt;  null, \/\/ \u975e\u5fc5\u8bbe\uff0c\u56e0\u4e3a\u5982\u679c\u7528 MemoryTable\uff0c\u9ed8\u8ba4\u662f\u7528 MemoryTable \u7684 Lock\n    ],\n],Redis:'beans' =&gt;  [\n    'ConnectContextStore'   =&gt;  [\n        'handlerClass'  =&gt;  \\Imi\\Server\\ConnectContext\\StoreHandler\\Redis::class,\n    ],\n    'ConnectContextRedis'    =&gt;    [\n        'redisPool'    =&gt; 'redis', \/\/ Redis \u8fde\u63a5\u6c60\u540d\u79f0\n        'redisDb'      =&gt; 0, \/\/ redis\u4e2d\u7b2c\u51e0\u4e2a\u5e93\n        'key'          =&gt; 'imi:connect_context', \/\/ \u952e\n        'heartbeatTimespan' =&gt; 5, \/\/ \u5fc3\u8df3\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n        'heartbeatTtl' =&gt; 8, \/\/ \u5fc3\u8df3\u6570\u636e\u8fc7\u671f\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n        'dataEncode'=&gt;  'serialize', \/\/ \u6570\u636e\u5199\u5165\u524d\u7f16\u7801\u56de\u8c03\n        'dataDecode'=&gt;  'unserialize', \/\/ \u6570\u636e\u8bfb\u51fa\u540e\u5904\u7406\u56de\u8c03\n        'lockId'    =&gt;  null, \/\/ \u5fc5\u8bbe\uff0c\u9700\u8981\u7528\u9501\u6765\u9632\u6b62\u6570\u636e\u9519\u4e71\u95ee\u9898\n    ],\n],"},{"id":30,"parent_id":23,"title":"\u8fde\u63a5\u5206\u7ec4","mdFileName":"components\/websocketServer\/group.md","url":"components\/websocketServer\/group.html","level":1,"content":"\u8fde\u63a5\u5206\u7ec4IMI \u652f\u6301\u5bf9 WebSocket \u7684\u8fde\u63a5\uff08fd\uff09\u8fdb\u884c\u903b\u8f91\u5206\u7ec4\uff0c\u4f60\u53ef\u4ee5\u65b9\u4fbf\u5730\u5bf9\u7528\u6237\u8fdb\u884c\u5206\u7ec4\u6d88\u606f\u63a8\u9001\u3002\u6240\u6709\u7684\u5206\u7ec4\u9488\u5bf9\u670d\u52a1\u5668\uff0c\u6240\u4ee5\u9700\u8981IMI\u7684\u670d\u52a1\u5668\u5bf9\u8c61\u624d\u53ef\u4ee5\u8c03\u7528\u4e0b\u9762\u8fd9\u4e9b\u65b9\u6cd5\uff0c\u6bd4\u5982\u5728WebSocketController\u4e2d\u53ef\u4ee5\u4f7f\u7528$this-&gt;server\u3002\u5206\u7ec4\u7684\u4f7f\u7528\u5206\u7ec4\u521b\u5efa\/\/ \u521b\u5efa\u4e00\u4e2a\u5206\u7ec4\n$this-&gt;server-&gt;createGroup('\u5206\u7ec4\u540d\u79f0');\n\n\/\/ \u521b\u5efa\u4e00\u4e2a\u5206\u7ec4\uff0c\u6700\u591a\u5141\u8bb8\u52a0\u516510\u4e2a\u8fde\u63a5\uff0c-1\u4e3a\u4e0d\u9650\u5236\n$this-&gt;server-&gt;createGroup('\u5206\u7ec4\u540d\u79f0', 10);\u52a0\u5165\u5206\u7ec4$this-&gt;server-&gt;joinGroup('\u5206\u7ec4\u540d\u79f0', $this-&gt;frame-&gt;getFd());\u79bb\u5f00\u5206\u7ec4$this-&gt;server-&gt;leaveGroup('\u5206\u7ec4\u540d\u79f0', $this-&gt;frame-&gt;getFd());\u83b7\u53d6\u5206\u7ec4\u5bf9\u8c61\/\/ \u4e0d\u5b58\u5728\u5219\u4e3anull\uff0c\u5426\u5219\u4e3a\\Imi\\Server\\Group\\Group\u5bf9\u8c61\n$this-&gt;server-&gt;getGroup('\u5206\u7ec4\u540d\u79f0');\u7ec4\u662f\u5426\u5b58\u5728$this-&gt;server-&gt;hasGroup('\u5206\u7ec4\u540d\u79f0');\u8c03\u7528\u7ec4\u65b9\u6cd5\/\/ \u904d\u5386g1\u5206\u7ec4\u4e2d\u6240\u6709fd\uff0c\u8c03\u7528\u670d\u52a1\u5668\u7684push\u65b9\u6cd5\uff0c\u53d1\u9001message\n$this-&gt;server-&gt;groupCall('g1', 'push', 'message');\u83b7\u53d6\u6240\u6709\u5206\u7ec4$this-&gt;server-&gt;getGroups();\u5206\u7ec4\u5bf9\u8c61\u8be6\u89e3\u7c7b\\Imi\\Server\\Group\\Group\u52a0\u5165\u7ec4$group-&gt;join($fd);\u79bb\u5f00\u7ec4$group-&gt;leave($fd);\u83b7\u53d6\u670d\u52a1\u5668\u5bf9\u8c61\u5f53\u524d\u5206\u7ec4\u5c5e\u4e8e\u54ea\u4e2a\u670d\u52a1\u5668\uff0c\u8fd9\u4e2a\u662fSwoole\u7684\u670d\u52a1\u5668\u5bf9\u8c61\u3002$group-&gt;getServer();\u83b7\u53d6\u6700\u5927\u5ba2\u6237\u7aef\u6570\u91cf$group-&gt;getMaxClients();\u8c03\u7528\u7ec4\u65b9\u6cd5\/\/ \u53d1\u9001\u7ed9\u7ec4\u91cc\u6240\u6709\u7684\u8fde\u63a5\uff0c\u5176\u5b83\u670d\u52a1\u5668\u65b9\u6cd5\u4e00\u6837\u8c03\u7528\uff0c\u7701\u53bbfd\u53c2\u6570\u5373\u53ef\n$group-&gt;push('message');"},{"id":31,"parent_id":23,"title":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6","mdFileName":"components\/websocketServer\/noMiddleware.md","url":"components\/websocketServer\/noMiddleware.html","level":1,"content":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6imi\u4e2d\u5185\u7f6e\u5b9e\u73b0\u4e86\u4e2d\u95f4\u4ef6+\u63a7\u5236\u5668\u65b9\u5f0f\u5f00\u53d1websocket\uff0c\u5728\u4e00\u4e9b\u573a\u666f\u4e5f\u53ef\u4ee5\u9009\u62e9\u4e0d\u4f7f\u7528\uff0c\u76f4\u63a5\u76d1\u542c\u670d\u52a1\u5668\u7684message\u4e8b\u4ef6\uff0c\u8fdb\u884c\u624b\u52a8\u5904\u7406\u3002\u76d1\u542c\u5199\u6cd5&lt;?php\nnamespace ImiDemo\\WebSocketDemo\\MainServer\\Listener;\n\nuse Imi\\Bean\\Annotation\\ClassEventListener;\nuse Imi\\Server\\Event\\Param\\MessageEventParam;\nuse Imi\\Server\\Event\\Listener\\IMessageEventListener;\n\n\/**\n * \u76d1\u542cmessage\u4e8b\u4ef6\uff0c\u53ef\u4ee5\u81ea\u5df1\u505a\u5904\u7406\n * \u5982\u679c\u4e0d\u9700\u8981\u9ed8\u8ba4\u7684\u5904\u7406\u65b9\u5f0f\uff0c\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u628aWebSocketDispatcher-middlewares\u4e0b\u7684\u4e2d\u95f4\u4ef6\u53bb\u9664\n * \n * @ClassEventListener(className=&quot;Imi\\Server\\WebSocket\\Server&quot;,eventName=&quot;message&quot;)\n *\/\nclass OnMessage implements IMessageEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5\n     * @param MessageEventParam $e\n     * @return void\n     *\/\n    public function handle(MessageEventParam $e)\n    {\n        \/\/ \u5982\u679c\u670d\u52a1\u5668\u540d\u4e0d\u662f\u4e3b\u670d\u52a1\u5668\u5c31\u8fd4\u56de\n        if('main' !== $e-&gt;getTarget()-&gt;getName())\n        {\n            return;\n        }\n        var_dump($e-&gt;frame-&gt;data);\n        \/\/ $e-&gt;server-&gt;getSwooleServer()-&gt;push($e-&gt;frame-&gt;fd, '\u8fd4\u56de\u4fe1\u606f');\n    }\n}"},{"id":33,"parent_id":32,"title":"\u8def\u7531","mdFileName":"components\/tcpServer\/route.md","url":"components\/tcpServer\/route.html","level":1,"content":"\u8def\u7531\u542f\u7528\u8def\u7531\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165\u4e2d\u95f4\u4ef6\uff1areturn [\n    'beans'    =&gt;    [\n        'TcpDispatcher'    =&gt;    [\n            'middlewares'    =&gt;    [\n                \\Imi\\Server\\TcpServer\\Middleware\\RouteMiddleware::class,\n            ],\n        ],\n    ],\n];\u901a\u8fc7\u914d\u7f6e\u6ce8\u5165\u5f62\u5f0f\uff0c\u5b9e\u73b0\u975e\u5e38\u7075\u6d3b\u7684\u914d\u7f6e\uff0c\u4f60\u751a\u81f3\u53ef\u4ee5\u81ea\u5df1\u53e6\u5916\u5b9e\u73b0\u8def\u7531\u4e2d\u95f4\u4ef6\uff0c\u800c\u4e0d\u7528\u88ab\u6846\u67b6\u81ea\u5e26\u7684\u4e2d\u95f4\u4ef6\u6240\u5f71\u54cd\uff0c\u7528\u54ea\u4e9b\u4e2d\u95f4\u4ef6\u90fd\u5728\u4f60\u7684\u638c\u63a7\u4e4b\u4e2d\uff01\u83b7\u53d6\u5f53\u524d\u8def\u7531\u89e3\u6790\u7ed3\u679c (routeResult)$routeResult = RequestContext::get('routeResult');$routeResult \u5b9a\u4e49\uff1a\/**\n * \u8def\u7531\u914d\u7f6e\u9879\n *\n * @var \\Imi\\Server\\TcpServer\\Route\\RouteItem\n *\/\npublic $routeItem;\n\n\/**\n * \u53c2\u6570\n *\n * @var array\n *\/\npublic $params;\n\n\/**\n * \u56de\u8c03\n *\n * @var callable\n *\/\npublic $callable;$routeResult-&gt;routeItem \u5b9a\u4e49\uff1a\/**\n * \u6ce8\u89e3\n *\n * @var \\Imi\\Server\\Route\\Annotation\\Tcp\\TcpRoute\n *\/\npublic $annotation;\n\n\/**\n * \u56de\u8c03\n *\n * @var callable|\\Imi\\Server\\Route\\RouteCallable\n *\/\npublic $callable;\n\n\/**\n * \u4e2d\u95f4\u4ef6\u5217\u8868\n *\n * @var array\n *\/\npublic $middlewares = [];\n\n\/**\n * \u5176\u5b83\u914d\u7f6e\u9879\n *\n * @var array\n *\/\npublic $options;"},{"id":34,"parent_id":32,"title":"TCP \u63a7\u5236\u5668","mdFileName":"components\/tcpServer\/controller.md","url":"components\/tcpServer\/controller.html","level":1,"content":"TCP \u63a7\u5236\u5668\u5b9a\u4e49&lt;?php\nnamespace ImiDemo\\TcpDemo\\MainServer\\Controller;\n\nuse Imi\\ConnectContext;\nuse Imi\\Server\\Route\\Annotation\\Tcp\\TcpRoute;\nuse Imi\\Server\\Route\\Annotation\\Tcp\\TcpAction;\nuse Imi\\Server\\Route\\Annotation\\Tcp\\TcpController;\n\n\/**\n * \u6570\u636e\u6536\u53d1\u6d4b\u8bd5\n * @TcpController\n *\/\nclass Test extends \\Imi\\Controller\\TcpController\n{\n    \/**\n     * \u767b\u5f55\n     * \n     * @TcpAction\n     * @TcpRoute({&quot;action&quot;=&quot;login&quot;})\n     * @return void\n     *\/\n    public function login($data)\n    {\n        ConnectContext::set('username', $data-&gt;username);\n        $this-&gt;server-&gt;joinGroup('g1', $this-&gt;data-&gt;getFd());\n        return ['action'=&gt;'login', 'success'=&gt;true];\n    }\n}\u9996\u5148\u63a7\u5236\u5668\u7c7b\u5fc5\u987b\u6709@TcpController\u6ce8\u89e3\uff0c\u5bf9\u5e94\u52a8\u4f5c\u5fc5\u987b\u6709@TcpAction\u548c@TcpRoute\u6ce8\u89e3\u3002\u6ce8\u89e3@TcpRoute\u6307\u5b9a Tcp \u8def\u7531\u89e3\u6790\u89c4\u5219\u3002\/\/ \u89e3\u6790 $data['action'] === 'login'\n@WSRoute({&quot;action&quot;=&quot;login&quot;})\n\/\/ \u89e3\u6790 $data['a']['b']['c'] === 'login'\n@WSRoute({&quot;a.b.c&quot;=&quot;login&quot;})\n\/\/ \u89e3\u6790 $data['a'] == '1' &amp;&amp; $data['b'] == '2'\n@WSRoute({&quot;a&quot;=&quot;1&quot;, &quot;b&quot;=&quot;2&quot;})\u5f53\u7136\u5bf9\u8c61\u4e5f\u662f\u652f\u6301\u7684\uff1a\/\/ \u89e3\u6790 $data-&gt;a-&gt;b-&gt;c === 'login'\n@WSRoute({&quot;a.b.c&quot;=&quot;login&quot;})\u8def\u7531\u5339\u914d\u6210\u529f\uff0c\u5c31\u4f1a\u6267\u884c\u8fd9\u4e2a\u52a8\u4f5c\u3002\u52a8\u4f5c\u54cd\u5e94\u6570\u636e\u54cd\u5e94\u5f53\u524d\u8fd9\u4e2a\u8bf7\u6c42\u76f4\u63a5\u5728\u65b9\u6cd5\u4e2d\u8fd4\u56de\u4e00\u4e2a\u6570\u7ec4\u6216\u5bf9\u8c61\uff0c\u5728\u670d\u52a1\u5668\u914d\u7f6e\u8bbe\u5b9a\u7684\u5904\u7406\u5668\uff0c\u5c31\u4f1a\u628a\u8fd9\u4e2a\u8f6c\u4e3a\u5bf9\u5e94\u6570\u636e\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\u3002\u914d\u7f6e\u6587\u4ef6return [\n    \/\/ \u4e3b\u670d\u52a1\u5668\u914d\u7f6e\uff0c\u63d0\u4f9bwebsocket\u670d\u52a1\n    'mainServer'    =&gt;    [\n        'namespace'    =&gt;    'ImiDemo\\TcpDemo\\MainServer',\n        'type'        =&gt;    Type::TCP_SERVER,\n        \/\/ 'host'        =&gt;    '0.0.0.0',\n        'port'        =&gt;    8085,\n        \/\/ 'mode'        =&gt;    SWOOLE_BASE,\n        \/\/ 'sockType'    =&gt;    SWOOLE_SOCK_TCP,\n        'configs'    =&gt;    [\n            'reactor_num'        =&gt;    2,\n            'worker_num'        =&gt;    2,\n            'task_worker_num'    =&gt;    8,\n            \/\/ EOF\u81ea\u52a8\u5206\u5305\n            'open_eof_split'    =&gt;    true, \/\/\u6253\u5f00EOF_SPLIT\u68c0\u6d4b\n            'package_eof'        =&gt;    &quot;\\r\\n&quot;, \/\/\u8bbe\u7f6eEOF\n        ],\n        \/\/ \u6570\u636e\u5904\u7406\u5668\n        'dataParser'    =&gt;    \\ImiDemo\\TcpDemo\\MainServer\\Parser\\JsonObjectParser::class,\n    ],\n}\u54cd\u5e94\u6570\u636ereturn ['success'=&gt;true];\u5206\u7ec4\u53d1\u9001$this-&gt;server-&gt;groupCall('\u7ec4\u540d', 'push', ['success'=&gt;true]);\u5f53\u7136\uff0c\u5e76\u4e0d\u662f\u6bcf\u4e2a\u8bf7\u6c42\u90fd\u9700\u8981\u6709\u54cd\u5e94\u6570\u636e\uff0c\u4ec0\u4e48\u90fd\u4e0dreturn\u6216\u8005return null\u5c31\u662f\u4e0d\u54cd\u5e94\u6570\u636e\u3002\u6307\u5b9a\u8fde\u63a5\u53d1\u9001\u6570\u636e\u4ee5\u4e0b\u4ee3\u7801\u5199\u5728\u63a7\u5236\u5668\u7684\u4ee3\u7801\u4e2d\uff0c\u603b\u800c\u8a00\u4e4b\uff0c\u5982\u679c\u4f60\u8981\u63a8\u9001\u6d88\u606f\uff0c\u4f60\u5f97\u62ff\u5230SwooleServer\u5bf9\u8c61\u3002\/\/ $server \u5bf9\u8c61\u662f \\Swoole\\Server\u7c7b\u578b\n$server = $this-&gt;server-&gt;getSwooleServer();\n\/\/ \u6307\u5b9a\u8fde\u63a5\n$fd = 19260817;\n$data = 'hello imi';\n\n\/\/ \u539f\u6837\u53d1\u9001\u6570\u636e\n$server-&gt;send($fd, $data);\n\n\/\/ \u4f7f\u7528\u9884\u5b9a\u4e49\u7684\u7f16\u7801\u5668\uff0c\u7f16\u7801\u540e\u53d1\u9001\u6570\u636e\n$server-&gt;send($fd, $this-&gt;encodeMessage($data));\u7c7b\u5c5e\u6027$server\u65b9\u6cd5getSwooleServer\u83b7\u53d6Swoole\u7684Server\u5bf9\u8c61\/**\n * \u7ec4\u662f\u5426\u5b58\u5728\n *\n * @param string $groupName\n * @return boolean\n *\/\npublic function hasGroup(string $groupName);\/**\n * \u521b\u5efa\u7ec4\uff0c\u8fd4\u56de\u7ec4\u5bf9\u8c61\n *\n * @param string $groupName\n * @param integer $maxClients\n * @return \\Imi\\Server\\Group\\Group\n *\/\npublic function createGroup(string $groupName, int $maxClients = -1);\/**\n * \u83b7\u53d6\u7ec4\u5bf9\u8c61\uff0c\u4e0d\u5b58\u5728\u8fd4\u56denull\n *\n * @param string $groupName\n * @return \\Imi\\Server\\Group\\Group|null\n *\/\npublic function getGroup(string $groupName);\/**\n * \u52a0\u5165\u7ec4\uff0c\u7ec4\u4e0d\u5b58\u5728\u5219\u81ea\u52a8\u521b\u5efa\n *\n * @param string $groupName\n * @param integer $fd\n * @return void\n *\/\npublic function joinGroup(string $groupName, int $fd);\/**\n * \u79bb\u5f00\u7ec4\uff0c\u7ec4\u4e0d\u5b58\u5728\u5219\u81ea\u52a8\u521b\u5efa\n *\n * @param string $groupName\n * @param integer $fd\n * @return void\n *\/\npublic function leaveGroup(string $groupName, int $fd);\/**\n * \u8c03\u7528\u7ec4\u65b9\u6cd5\n *\n * @param string $groupName\n * @param string $methodName\n * @param mixed ...$args\n * @return array\n *\/\npublic function groupCall(string $groupName, string $methodName, ...$args);\/**\n * \u83b7\u53d6\u6240\u6709\u7ec4\u5217\u8868\n *\n * @return \\Imi\\Server\\Group\\Group[]\n *\/\npublic function getGroups(): array;$data\u65b9\u6cd5\/**\n * \u83b7\u53d6\u5ba2\u6237\u7aef\u7684socket id\n * @return int\n *\/\npublic function getFd(): int;\/**\n * \u6570\u636e\u5185\u5bb9\uff0c\u53ef\u4ee5\u662f\u6587\u672c\u5185\u5bb9\u4e5f\u53ef\u4ee5\u662f\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u53ef\u4ee5\u901a\u8fc7opcode\u7684\u503c\u6765\u5224\u65ad\n * @return string\n *\/\npublic function getData();\/**\n * \u83b7\u53d6\u683c\u5f0f\u5316\u540e\u7684\u6570\u636e\uff0c\u4e00\u822c\u662f\u6570\u7ec4\u6216\u5bf9\u8c61\n * @return mixed\n *\/\npublic function getFormatData();\/**\n * \u83b7\u53d6Reactor\u7ebf\u7a0bID\n *\n * @return int\n *\/\npublic function getReactorID(): int;\u63a7\u5236\u5668\u7c7b\u65b9\u6cd5encodeMessage\/**\n * \u7f16\u7801\u6d88\u606f\uff0c\u628a\u6570\u636e\u7f16\u7801\u4e3a\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u7684\u683c\u5f0f\n *\n * @param mixed $data\n * @return mixed\n *\/\nprotected function encodeMessage($data)"},{"id":35,"parent_id":32,"title":"\u4e2d\u95f4\u4ef6","mdFileName":"components\/tcpServer\/middleware.md","url":"components\/tcpServer\/middleware.html","level":1,"content":"\u4e2d\u95f4\u4ef6\u5f00\u53d1\u8005\u53ef\u4ee5\u5f00\u53d1\u4e2d\u95f4\u4ef6\u7c7b\uff0c\u5bf9\u6574\u4e2aTCP\u8bf7\u6c42\u548c\u54cd\u5e94\u8fc7\u7a0b\u8fdb\u884c\u81ea\u5b9a\u4e49\u5904\u7406\u3002\u6ce8\u610f\uff01\u6700\u597d\u4e0d\u8981\u5728\u4e2d\u95f4\u4ef6\u4e2d\u4f7f\u7528\u7c7b\u5c5e\u6027\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u51b2\u7a81\uff01\u5b9a\u4e49\u4e2d\u95f4\u4ef6&lt;?php\nnamespace Imi\\Server\\TcpServer\\Middleware;\n\nuse Imi\\Bean\\Annotation\\Bean;\n\n\/**\n * @Bean\n *\/\nclass RouteMiddleware implements IMiddleware\n{\n    \/**\n     * \u5904\u7406\u65b9\u6cd5\n     *\n     * @param IReceiveData $data\n     * @param IReceiveHandler $handle\n     * @return void\n     *\/\n    public function process(IReceiveData $data, IReceiveHandler $handler)\n    {\n        \n    }\n\n}\u5168\u5c40\u4e2d\u95f4\u4ef6return [\n    'beans'    =&gt;    [\n        \/\/ \u4e2d\u95f4\u4ef6\n        'TcpDispatcher'    =&gt;    [\n            'middlewares'    =&gt;    [\n                \/\/ \u4e2d\u95f4\u4ef6\n                \\Imi\\Server\\Tcp\\Middleware\\RouteMiddleware::class,\n            ],\n        ],\n    ],\n];\u5c40\u90e8\u4e2d\u95f4\u4ef6\u6ce8\u89e3\u4f7f\u7528&lt;?php\nnamespace ImiDemo\\TcpDemo\\MainServer\\Controller;\n\nuse Imi\\ConnectContext;\nuse Imi\\Server\\Route\\Annotation\\Tcp\\TcpRoute;\nuse Imi\\Server\\Route\\Annotation\\Tcp\\TcpAction;\nuse Imi\\Server\\Route\\Annotation\\Tcp\\TcpController;\n\n\/**\n * \u6570\u636e\u6536\u53d1\u6d4b\u8bd5\n * @TcpController\n *\/\nclass Test extends \\Imi\\Controller\\TcpController\n{\n    \/**\n     * \u767b\u5f55\n     * \n     * @TcpAction\n     * @TcpRoute({&quot;action&quot;=&quot;login&quot;})\n     * @TcpMiddleware(XXX::class)\n     * @TcpMiddleware({XXX::class,XXX2::class})\n     * @return void\n     *\/\n    public function login($data)\n    {\n    }\n}\u5982\u4e0a\u4ee3\u7801\uff0c\u540c\u65f6\u652f\u6301\u8bbe\u7f6e\u5355\u4e2a\u548c\u591a\u4e2a\u4e2d\u95f4\u4ef6"},{"id":36,"parent_id":32,"title":"\u8fde\u63a5\u4e0a\u4e0b\u6587","mdFileName":"components\/tcpServer\/session.md","url":"components\/tcpServer\/session.html","level":1,"content":"\u4f1a\u8bdd\u6570\u636e\u7528\u6cd5\u540cWebSocket \u670d\u52a1\u5668 - \u4f1a\u8bdd\u6570\u636e"},{"id":37,"parent_id":32,"title":"\u8fde\u63a5\u5206\u7ec4","mdFileName":"components\/tcpServer\/group.md","url":"components\/tcpServer\/group.html","level":1,"content":"\u8fde\u63a5\u5206\u7ec4\u7528\u6cd5\u540cWebSocket \u670d\u52a1\u5668 - \u8fde\u63a5\u5206\u7ec4"},{"id":38,"parent_id":32,"title":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6","mdFileName":"components\/tcpServer\/noMiddleware.md","url":"components\/tcpServer\/noMiddleware.html","level":1,"content":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6imi\u4e2d\u5185\u7f6e\u5b9e\u73b0\u4e86\u4e2d\u95f4\u4ef6+\u63a7\u5236\u5668\u65b9\u5f0f\u5f00\u53d1tcp\uff0c\u5728\u4e00\u4e9b\u573a\u666f\u4e5f\u53ef\u4ee5\u9009\u62e9\u4e0d\u4f7f\u7528\uff0c\u76f4\u63a5\u76d1\u542c\u670d\u52a1\u5668\u7684receive\u4e8b\u4ef6\uff0c\u8fdb\u884c\u624b\u52a8\u5904\u7406\u3002\u76d1\u542c\u5199\u6cd5&lt;?php\nnamespace Imi\\Server\\TcpServer\\Listener;\n\nuse Imi\\App;\nuse Imi\\ConnectContext;\nuse Imi\\RequestContext;\nuse Imi\\Bean\\Annotation\\ClassEventListener;\nuse Imi\\Server\\Event\\Param\\ReceiveEventParam;\nuse Imi\\Server\\Event\\Listener\\IReceiveEventListener;\nuse Imi\\Server\\TcpServer\\Message\\ReceiveData;\n\n\/**\n * Receive\u4e8b\u4ef6\u524d\u7f6e\u5904\u7406\n * @ClassEventListener(className=&quot;Imi\\Server\\TcpServer\\Server&quot;,eventName=&quot;receive&quot;,priority=PHP_INT_MAX)\n *\/\nclass BeforeReceive implements IReceiveEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5\n     * @param ReceiveEventParam $e\n     * @return void\n     *\/\n    public function handle(ReceiveEventParam $e)\n    {\n        \/\/ \u5982\u679c\u670d\u52a1\u5668\u540d\u4e0d\u662f\u4e3b\u670d\u52a1\u5668\u5c31\u8fd4\u56de\n        if('main' === $e-&gt;server-&gt;getName())\n        {\n            return;\n        }\n        var_dump($e-&gt;data);\n    }\n}"},{"id":40,"parent_id":39,"title":"\u8def\u7531","mdFileName":"components\/udpServer\/route.md","url":"components\/udpServer\/route.html","level":1,"content":"\u8def\u7531\u542f\u7528\u8def\u7531\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165\u4e2d\u95f4\u4ef6\uff1areturn [\n    'beans'    =&gt;    [\n        'UdpDispatcher'    =&gt;    [\n            'middlewares'    =&gt;    [\n                \\Imi\\Server\\UdpServer\\Middleware\\RouteMiddleware::class,\n            ],\n        ],\n    ],\n];\u901a\u8fc7\u914d\u7f6e\u6ce8\u5165\u5f62\u5f0f\uff0c\u5b9e\u73b0\u975e\u5e38\u7075\u6d3b\u7684\u914d\u7f6e\uff0c\u4f60\u751a\u81f3\u53ef\u4ee5\u81ea\u5df1\u53e6\u5916\u5b9e\u73b0\u8def\u7531\u4e2d\u95f4\u4ef6\uff0c\u800c\u4e0d\u7528\u88ab\u6846\u67b6\u81ea\u5e26\u7684\u4e2d\u95f4\u4ef6\u6240\u5f71\u54cd\uff0c\u7528\u54ea\u4e9b\u4e2d\u95f4\u4ef6\u90fd\u5728\u4f60\u7684\u638c\u63a7\u4e4b\u4e2d\uff01\u83b7\u53d6\u5f53\u524d\u8def\u7531\u89e3\u6790\u7ed3\u679c (routeResult)$routeResult = RequestContext::get('routeResult');$routeResult \u5b9a\u4e49\uff1a\/**\n * \u8def\u7531\u914d\u7f6e\u9879\n *\n * @var \\Imi\\Server\\UdpServer\\Route\\RouteItem\n *\/\npublic $routeItem;\n\n\/**\n * \u53c2\u6570\n *\n * @var array\n *\/\npublic $params;\n\n\/**\n * \u56de\u8c03\n *\n * @var callable\n *\/\npublic $callable;$routeResult-&gt;routeItem \u5b9a\u4e49\uff1a\/**\n * \u6ce8\u89e3\n *\n * @var \\Imi\\Server\\Route\\Annotation\\Udp\\UdpRoute\n *\/\npublic $annotation;\n\n\/**\n * \u56de\u8c03\n *\n * @var callable|\\Imi\\Server\\Route\\RouteCallable\n *\/\npublic $callable;\n\n\/**\n * \u4e2d\u95f4\u4ef6\u5217\u8868\n *\n * @var array\n *\/\npublic $middlewares = [];\n\n\/**\n * \u5176\u5b83\u914d\u7f6e\u9879\n *\n * @var array\n *\/\npublic $options;"},{"id":41,"parent_id":39,"title":"UDP \u63a7\u5236\u5668","mdFileName":"components\/udpServer\/controller.md","url":"components\/udpServer\/controller.html","level":1,"content":"UDP \u63a7\u5236\u5668\u5b9a\u4e49&lt;?php\nnamespace ImiDemo\\UdpDemo\\MainServer\\Controller;\n\nuse Imi\\ConnectContext;\nuse Imi\\Server\\Route\\Annotation\\Udp\\UdpRoute;\nuse Imi\\Server\\Route\\Annotation\\Udp\\UdpAction;\nuse Imi\\Server\\Route\\Annotation\\Udp\\UdpController;\n\n\/**\n * \u6570\u636e\u6536\u53d1\u6d4b\u8bd5\n * @UdpController\n *\/\nclass Test extends \\Imi\\Controller\\UdpController\n{\n    \/**\n     * \u767b\u5f55\n     * \n     * @UdpAction\n     * @UdpRoute({&quot;action&quot;=&quot;hello&quot;})\n     * @return void\n     *\/\n    public function hello()\n    {\n        return [\n            'time'    =&gt;    date($this-&gt;data-&gt;getFormatData()-&gt;format),\n        ];\n    }\n\n}\u9996\u5148\u63a7\u5236\u5668\u7c7b\u5fc5\u987b\u6709@UdpController\u6ce8\u89e3\uff0c\u5bf9\u5e94\u52a8\u4f5c\u5fc5\u987b\u6709@UdpAction\u548c@UdpRoute\u6ce8\u89e3\u3002\u6ce8\u89e3@UdpRoute\u6307\u5b9a Udp \u8def\u7531\u89e3\u6790\u89c4\u5219\u3002\/\/ \u89e3\u6790 $data['action'] === 'login'\n@WSRoute({&quot;action&quot;=&quot;login&quot;})\n\/\/ \u89e3\u6790 $data['a']['b']['c'] === 'login'\n@WSRoute({&quot;a.b.c&quot;=&quot;login&quot;})\n\/\/ \u89e3\u6790 $data['a'] == '1' &amp;&amp; $data['b'] == '2'\n@WSRoute({&quot;a&quot;=&quot;1&quot;, &quot;b&quot;=&quot;2&quot;})\u5f53\u7136\u5bf9\u8c61\u4e5f\u662f\u652f\u6301\u7684\uff1a\/\/ \u89e3\u6790 $data-&gt;a-&gt;b-&gt;c === 'login'\n@WSRoute({&quot;a.b.c&quot;=&quot;login&quot;})\u8def\u7531\u5339\u914d\u6210\u529f\uff0c\u5c31\u4f1a\u6267\u884c\u8fd9\u4e2a\u52a8\u4f5c\u3002\u52a8\u4f5c\u54cd\u5e94\u6570\u636e\u54cd\u5e94\u5f53\u524d\u8fd9\u4e2a\u8bf7\u6c42\u76f4\u63a5\u5728\u65b9\u6cd5\u4e2d\u8fd4\u56de\u4e00\u4e2a\u6570\u7ec4\u6216\u5bf9\u8c61\uff0c\u5728\u670d\u52a1\u5668\u914d\u7f6e\u8bbe\u5b9a\u7684\u5904\u7406\u5668\uff0c\u5c31\u4f1a\u628a\u8fd9\u4e2a\u8f6c\u4e3a\u5bf9\u5e94\u6570\u636e\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\u3002\u914d\u7f6e\u6587\u4ef6return [\n    \/\/ \u9879\u76ee\u6839\u547d\u540d\u7a7a\u95f4\n    'namespace'    =&gt;    'ImiDemo\\UdpDemo',\n    \/\/ \u626b\u63cf\u76ee\u5f55\n    'beanScan'    =&gt;    [\n    ],\n    \/\/ \u4e3b\u670d\u52a1\u5668\u914d\u7f6e\uff0c\u63d0\u4f9bwebsocket\u670d\u52a1\n    'mainServer'    =&gt;    [\n        'namespace'    =&gt;    'ImiDemo\\UdpDemo\\MainServer',\n        'type'        =&gt;    Type::UDP_SERVER,\n        'host'        =&gt;    '0.0.0.0',\n        'port'        =&gt;    8087,\n        'configs'    =&gt;    [\n            'reactor_num'        =&gt;    2,\n            'worker_num'        =&gt;    2,\n            'task_worker_num'    =&gt;    8,\n        ],\n        \/\/ \u6570\u636e\u5904\u7406\u5668\n        'dataParser'    =&gt;    Imi\\Server\\DataParser\\JsonObjectParser::class,\n    ],\n}\u54cd\u5e94\u6570\u636ereturn ['success'=&gt;true];\u5206\u7ec4\u53d1\u9001\u7531\u4e8eUDP\u7684\u7279\u6027\uff0c\u6240\u4ee5\u4e0d\u652f\u6301\u5206\u7ec4\u53d1\u9001\u3002\u5982\u6709\u9700\u8981\uff0c\u53ef\u6839\u636e\u5b9e\u9645\u573a\u666f\u81ea\u884c\u5b9e\u73b0\u5206\u7ec4\u3002$data\u65b9\u6cd5\/**\n * \u83b7\u53d6\u5ba2\u6237\u7aef\u7684socket id\n * @return int\n *\/\npublic function getFd(): int;\/**\n * \u6570\u636e\u5185\u5bb9\uff0c\u53ef\u4ee5\u662f\u6587\u672c\u5185\u5bb9\u4e5f\u53ef\u4ee5\u662f\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u53ef\u4ee5\u901a\u8fc7opcode\u7684\u503c\u6765\u5224\u65ad\n * @return string\n *\/\npublic function getData();\/**\n * \u83b7\u53d6\u5ba2\u6237\u7aef\u4fe1\u606f\n * @return array\n *\/\npublic function getClientInfo();\n\n\/\/ \u683c\u5f0f\u540c\uff1ahttps:\/\/wiki.swoole.com\/wiki\/page\/477.html"},{"id":42,"parent_id":39,"title":"\u4e2d\u95f4\u4ef6","mdFileName":"components\/udpServer\/middleware.md","url":"components\/udpServer\/middleware.html","level":1,"content":"\u4e2d\u95f4\u4ef6\u5f00\u53d1\u8005\u53ef\u4ee5\u5f00\u53d1\u4e2d\u95f4\u4ef6\u7c7b\uff0c\u5bf9\u6574\u4e2aUDP\u8bf7\u6c42\u548c\u54cd\u5e94\u8fc7\u7a0b\u8fdb\u884c\u81ea\u5b9a\u4e49\u5904\u7406\u3002\u6ce8\u610f\uff01\u6700\u597d\u4e0d\u8981\u5728\u4e2d\u95f4\u4ef6\u4e2d\u4f7f\u7528\u7c7b\u5c5e\u6027\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u51b2\u7a81\uff01\u5b9a\u4e49\u4e2d\u95f4\u4ef6&lt;?php\nnamespace Imi\\Server\\UdpServer\\Middleware;\n\nuse Imi\\Bean\\Annotation\\Bean;\n\n\/**\n * @Bean\n *\/\nclass RouteMiddleware implements IMiddleware\n{\n    \/**\n     * \u5904\u7406\u65b9\u6cd5\n     *\n     * @param IReceiveData $data\n     * @param IReceiveHandler $handle\n     * @return void\n     *\/\n    public function process(IPacketData $data, IPacketHandler $handler)\n    {\n        \n    }\n\n}\u5168\u5c40\u4e2d\u95f4\u4ef6return [\n    'beans'    =&gt;    [\n        \/\/ \u4e2d\u95f4\u4ef6\n        'UdpDispatcher'    =&gt;    [\n            'middlewares'    =&gt;    [\n                \/\/ \u4e2d\u95f4\u4ef6\n                \\Imi\\Server\\Udp\\Middleware\\RouteMiddleware::class,\n            ],\n        ],\n    ],\n];\u5c40\u90e8\u4e2d\u95f4\u4ef6\u6ce8\u89e3\u4f7f\u7528&lt;?php\nnamespace ImiDemo\\UdpDemo\\MainServer\\Controller;\n\nuse Imi\\ConnectContext;\nuse Imi\\Server\\Route\\Annotation\\Udp\\UdpRoute;\nuse Imi\\Server\\Route\\Annotation\\Udp\\UdpAction;\nuse Imi\\Server\\Route\\Annotation\\Udp\\UdpController;\n\n\/**\n * \u6570\u636e\u6536\u53d1\u6d4b\u8bd5\n * @UdpController\n *\/\nclass Test extends \\Imi\\Controller\\UdpController\n{\n    \/**\n     * \u767b\u5f55\n     * \n     * @UdpAction\n     * @UdpRoute({&quot;action&quot;=&quot;hello&quot;})\n     * @UdpMiddleware(XXX::class)\n     * @UdpMiddleware({XXX::class,XXX2::class})\n     * @return void\n     *\/\n    public function hello()\n    {\n        return [\n            'time'    =&gt;    date($this-&gt;data-&gt;getFormatData()-&gt;format),\n        ];\n    }\n\n}\n\u5982\u4e0a\u4ee3\u7801\uff0c\u540c\u65f6\u652f\u6301\u8bbe\u7f6e\u5355\u4e2a\u548c\u591a\u4e2a\u4e2d\u95f4\u4ef6"},{"id":43,"parent_id":39,"title":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6","mdFileName":"components\/udpServer\/noMiddleware.md","url":"components\/udpServer\/noMiddleware.html","level":1,"content":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6imi\u4e2d\u5185\u7f6e\u5b9e\u73b0\u4e86\u4e2d\u95f4\u4ef6+\u63a7\u5236\u5668\u65b9\u5f0f\u5f00\u53d1tcp\uff0c\u5728\u4e00\u4e9b\u573a\u666f\u4e5f\u53ef\u4ee5\u9009\u62e9\u4e0d\u4f7f\u7528\uff0c\u76f4\u63a5\u76d1\u542c\u670d\u52a1\u5668\u7684packet\u4e8b\u4ef6\uff0c\u8fdb\u884c\u624b\u52a8\u5904\u7406\u3002\u76d1\u542c\u5199\u6cd5&lt;?php\nnamespace Imi\\Server\\UdpServer\\Listener;\n\nuse Imi\\ServerManage;\nuse Imi\\ConnectContext;\nuse Imi\\RequestContext;\nuse Imi\\Bean\\Annotation\\ClassEventListener;\nuse Imi\\Server\\Event\\Param\\PacketEventParam;\nuse Imi\\Server\\UdpServer\\Message\\PacketData;\nuse Imi\\Server\\Event\\Listener\\IPacketEventListener;\n\n\/**\n * Packet\u4e8b\u4ef6\u524d\u7f6e\u5904\u7406\n * @ClassEventListener(className=&quot;Imi\\Server\\UdpServer\\Server&quot;,eventName=&quot;packet&quot;,priority=PHP_INT_MAX)\n *\/\nclass BeforePacket implements IPacketEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5\n     * @param PacketEventParam $e\n     * @return void\n     *\/\n    public function handle(PacketEventParam $e)\n    {\n        \/\/ \u5982\u679c\u670d\u52a1\u5668\u540d\u4e0d\u662f\u4e3b\u670d\u52a1\u5668\u5c31\u8fd4\u56de\n        if('main' !== $e-&gt;getTarget()-&gt;getName())\n        {\n            return;\n        }\n        var_dump($e-&gt;data);\n\n    }\n}"},{"id":45,"parent_id":44,"title":"\u914d\u7f6e\u8bfb\u5199","mdFileName":"components\/config\/index.md","url":"components\/config\/index.html","level":1,"content":"\u914d\u7f6e(Config)\u5173\u4e8e\u914d\u7f6e\u6587\u4ef6\u7684\u5b9a\u4e49\uff0c\u8bf7\u770b\u57fa\u7840\u5165\u95e8-\u914d\u7f6e\u6587\u4ef6\u7ae0\u8282\u3002\u8bfb\u53d6\u914d\u7f6e\u7c7b\uff1aImi\\Config\u8bfb\u53d6\u9879\u76ee\u914d\u7f6eecho Config::get('@app.namespace'); \/\/ namespace \u53ef\u4ee5\u6362\u4e3a\u5176\u5b83\u7684\u8282\u8bfb\u53d6\u4e3b\u670d\u52a1\u5668\u914d\u7f6eecho Config::get('@server.main.namespace'); \/\/ namespace \u53ef\u4ee5\u6362\u4e3a\u5176\u5b83\u7684\u8282\u8bfb\u53d6\u5b50\u670d\u52a1\u5668\u914d\u7f6e\/\/ \u5982\u5b50\u670d\u52a1\u5668\u540d\u4e3aabc\uff0c\u8bfb\u53d6\u5b83\u4e0b\u9762\u7684\u914d\u7f6e\necho Config::get('@server.abc.namespace'); \/\/ namespace \u53ef\u4ee5\u6362\u4e3a\u5176\u5b83\u7684\u8282\u667a\u80fd\u8bfb\u53d6\u4f18\u5148\u8bfb\u53d6\u5f53\u524d\u670d\u52a1\u5668\u914d\u7f6e\uff0c\u5982\u679c\u6ca1\u6709\u914d\u7f6e\u5219\u53d6\u9879\u76ee\u914d\u7f6e\uff08@app\uff09echo Config::get('@currentServer.db.default');"},{"id":46,"parent_id":44,"title":"\u8fde\u63a5\u6c60","mdFileName":"components\/pool\/index.md","url":"components\/pool\/index.html","level":1,"content":"\u8fde\u63a5\u6c60\u7531\u4e8e Swoole \u7684\u5e38\u9a7b\u5185\u5b58\u7279\u6027\uff0c\u6240\u4ee5 IMI \u4e2d\u5b9e\u73b0\u4e86\u8fde\u63a5\u6c60\u3002\u6240\u6709\u7684\u6570\u636e\u5e93\u3001Redis\u8fde\u63a5\uff0c\u90fd\u901a\u8fc7\u8fde\u63a5\u6c60\u53bb\u83b7\u53d6\u3002\u5b9a\u4e49\u8fde\u63a5\u6c60\u8fde\u63a5\u6c60\u7684\u914d\u7f6e\uff0c\u53ef\u4ee5\u5199\u5728\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5199\u5728\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\u3002\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6709\u4e00\u4e2apools\u8282\u70b9\uff0c\u91cc\u9762\u914d\u7f6e\u7684\u662f\u8fde\u63a5\u6c60\u3002\u540c\u6b65\u6c60\u5b50\u4ec5\u5728task\u8fdb\u7a0b\u4f7f\u7528\uff0c\u5f02\u6b65\u6c60\u5b50\u5728worker\u8fdb\u7a0b\u4f7f\u7528\u3002\u4e00\u822c\u4f7f\u7528\u65f6\u65e0\u9700\u81ea\u884c\u5224\u65ad\u5728\u54ea\u4e2a\u8fdb\u7a0b\uff0c\u6846\u67b6\u4f1a\u81ea\u52a8\u5e2e\u4f60\u83b7\u53d6\u5bf9\u5e94\u7684\u8fde\u63a5\u3002\u83b7\u53d6\u8fde\u63a5\u83b7\u53d6\u6c60\u5b50\u4e2d\u7684\u8d44\u6e90\\Imi\\Pool\\PoolManager::getResource(string $name): IPoolResource$name \u4e3a\u6c60\u5b50\u540d\u79f0\u83b7\u53d6\u8bf7\u6c42\u4e0a\u4e0b\u6587\u8d44\u6e90\u4e00\u4e2a\u8bf7\u6c42\u4e0a\u4e0b\u6587\u901a\u8fc7\u6b64\u65b9\u6cd5\uff0c\u53ea\u80fd\u83b7\u53d6\u540c\u4e00\u4e2a\u8d44\u6e90\\Imi\\Pool\\PoolManager::getRequestContextResource(string $name): IPoolResource\u5c1d\u8bd5\u83b7\u53d6\u8d44\u6e90\\Imi\\Pool\\PoolManager::tryGetResource(string $name): IPoolResource|boolean\u56de\u8c03\u65b9\u5f0f\u4f7f\u7528\u8d44\u6e90\u4f7f\u7528\u56de\u8c03\u6765\u4f7f\u7528\u6c60\u5b50\u4e2d\u7684\u8d44\u6e90\uff0c\u65e0\u9700\u624b\u52a8\u91ca\u653e$result = \\Imi\\Pool\\PoolManager::use($poolName, function($resource, \\Swoole\\Coroutine\\Redis $redis) use($key){\n    return $redis-&gt;get($key);\n});$poolName-\u6c60\u5b50\u540d\u79f0\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u56de\u8c03\uff0c\u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u8d44\u6e90\u672c\u8eab\uff0c\u7b2c\u4e8c\u4e2a\u4e3a\u8d44\u6e90\u91cc\u9762\u7684\u5b9e\u4f8b\u3002\u6bd4\u5982\u4e0a\u9762\u7684\u662fRedis\u56de\u8c03\u7684\u8fd4\u56de\u503c\u4e5f\u4f1a\u6210\u4e3ause\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u624b\u52a8\u91ca\u653e\u8fde\u63a5\\Imi\\Pool\\PoolManager::releaseResource(IPoolResource $resource)\u81ea\u52a8\u91ca\u653e\u8fde\u63a5\u8c03\u7528\\Imi\\Pool\\PoolManager::getRequestContextResource()\u65b9\u6cd5\u83b7\u53d6\uff0c\u5f53\u4e0a\u4e0b\u6587\u88ab\u9500\u6bc1\u65f6\uff0c\u4f1a\u81ea\u52a8\u91ca\u653e\u8d44\u6e90\u3002"},{"id":47,"parent_id":44,"title":"\u6570\u636e\u5e93\u64cd\u4f5c","mdFileName":"components\/db\/index.md","url":"components\/db\/index.html","level":1,"content":"\u6570\u636e\u5e93\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u914d\u7f6e\u65b9\u5f0f\u5df2\u7ecf\u5728\u8fde\u63a5\u6c60\u91cc\u8bb2\u8fc7\uff0c\u8fd9\u91cc\u5c31\u4e0d\u91cd\u590d\u4e86\uff0c\u76f4\u63a5\u8bf4\u4f7f\u7528\u65b9\u6cd5\u3002\u8fde\u63a5\u6c60\u914d\u7f6e&lt;?php\nreturn [\n    'db'    =&gt;    [\n        'defaultPool'    =&gt;    'alias1', \/\/ \u9ed8\u8ba4\u8fde\u63a5\u6c60\n    ],\n    'pools' =&gt; [\n        \/\/ \u8fde\u63a5\u6c60\u540d\u79f0\n        'alias1' =&gt; [\n            \/\/ \u540c\u6b65\u6c60\u5b50\uff0ctask\u8fdb\u7a0b\u4f7f\u7528\n            'sync' =&gt; [\n                'pool' =&gt; [\n                    'class' =&gt; \\Imi\\Db\\Pool\\SyncDbPool::class,\n                    'config' =&gt; [\n                        \/\/ \u6c60\u5b50\u4e2d\u6700\u591a\u8d44\u6e90\u6570\n                        \/\/ 'maxResources' =&gt; 10,\n                        \/\/ \u6c60\u5b50\u4e2d\u6700\u5c11\u8d44\u6e90\u6570\n                        \/\/ 'minResources' =&gt; 2,\n                        \/\/ \u8d44\u6e90\u56de\u6536\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\n                        \/\/ 'gcInterval' =&gt; 60,\n                        \/\/ \u83b7\u53d6\u8d44\u6e90\u6700\u5927\u5b58\u6d3b\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n                        \/\/ 'maxActiveTime' =&gt; 3600,\n                        \/\/ \u7b49\u5f85\u8d44\u6e90\u6700\u5927\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n                        \/\/ 'waitTimeout' =&gt; 3000,\n                        \/\/ \u8d1f\u8f7d\u5747\u8861-\u8f6e\u6d41\n                        \/\/ 'resourceConfigMode' =&gt; ResourceConfigMode::TURN,\n                        \/\/ \u8d1f\u8f7d\u5747\u8861-\u968f\u673a\n                        \/\/ 'resourceConfigMode' =&gt; ResourceConfigMode::RANDOM,\n                    ],\n                ],\n                'resource' =&gt; [\n                    'host' =&gt; '127.0.0.1',\n                    'username' =&gt; 'root',\n                    'password' =&gt; 'root',\n                    'database' =&gt; 'database',\n                    \/\/ 'port'    =&gt; '3306',\n                    \/\/ 'timeout' =&gt; '\u5efa\u7acb\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4',\n                    \/\/ 'charset' =&gt; '',\n                    \/\/ 'strict_type' =&gt; false, \/\/\u5f00\u542f\u4e25\u683c\u6a21\u5f0f\uff0c\u8fd4\u56de\u7684\u5b57\u6bb5\u5c06\u81ea\u52a8\u8f6c\u4e3a\u6570\u5b57\u7c7b\u578b\n                ],\n            ],\n            \/\/ \u5f02\u6b65\u6c60\u5b50\uff0cworker\u8fdb\u7a0b\u4f7f\u7528\n            'async' =&gt; [\n                'pool'    =&gt;    [\n                    'class'        =&gt;    \\Imi\\Db\\Pool\\CoroutineDbPool::class,\n                    'config'    =&gt;    [\n                        \/\/ \u540c\u4e0a\n                    ],\n                ],\n                \/\/ resource\u4e5f\u53ef\u4ee5\u5b9a\u4e49\u591a\u4e2a\u8fde\u63a5\n                'resource'    =&gt;    [\n                    [\n                        'host'        =&gt; '127.0.0.1',\n                        'username'        =&gt; 'root',\n                        'password'    =&gt; 'root',\n                        'database'    =&gt; 'database',\n                        \/\/ 'timeout' =&gt; '\u5efa\u7acb\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4',\n                        \/\/ 'charset' =&gt; '',\n                        \/\/ 'options' =&gt; [], \/\/ PDO\u8fde\u63a5\u9009\u9879\n                    ],\n                    [\n                        'host'        =&gt; '127.0.0.2',\n                        'username'        =&gt; 'root',\n                        'password'    =&gt; 'root',\n                        'database'    =&gt; 'database',\n                        \/\/ 'timeout' =&gt; '\u5efa\u7acb\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4',\n                        \/\/ 'charset' =&gt; '',\n                        \/\/ 'options' =&gt; [], \/\/ PDO\u8fde\u63a5\u9009\u9879\n                    ]\n                ],\n            ],\n        ],\n        \/\/ \u4ece\u5e93\u914d\u7f6e\n        \/\/ \u539f\u8fde\u63a5\u6c60\u540d\u540e\u52a0.slave\u5373\u4e3a\u4ece\u5e93\u914d\u7f6e\uff0c\u975e\u5fc5\u8bbe\n        \/\/ \u5982\u679c\u914d\u7f6e\u4e86\uff0c\u9ed8\u8ba4\u67e5\u8be2\u8d70\u4ece\u5e93\uff0c\u589e\u5220\u6539\u8d70\u4e3b\u5e93\n        \/\/ \u5982\u679c\u5728\u4e8b\u52a1\u4e2d\uff0c\u9ed8\u8ba4\u90fd\u8d70\u4e3b\u5e93\n        'alias1.slave' =&gt; [\n            \/\/ \u540c\u6b65\u6c60\u5b50\uff0ctask\u8fdb\u7a0b\u4f7f\u7528\n            'sync' =&gt; [\n                'pool' =&gt; [\n                    'class' =&gt; \\Imi\\Db\\Pool\\SyncDbPool::class,\n                    'config' =&gt; [\n                        \/\/ \u6c60\u5b50\u4e2d\u6700\u591a\u8d44\u6e90\u6570\n                        \/\/ 'maxResources' =&gt; 10,\n                        \/\/ \u6c60\u5b50\u4e2d\u6700\u5c11\u8d44\u6e90\u6570\n                        \/\/ 'minResources' =&gt; 2,\n                        \/\/ \u8d44\u6e90\u56de\u6536\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\n                        \/\/ 'gcInterval' =&gt; 60,\n                        \/\/ \u83b7\u53d6\u8d44\u6e90\u6700\u5927\u5b58\u6d3b\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n                        \/\/ 'maxActiveTime' =&gt; 3600,\n                        \/\/ \u7b49\u5f85\u8d44\u6e90\u6700\u5927\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n                        \/\/ 'waitTimeout' =&gt; 3000,\n                    ],\n                ],\n                'resource' =&gt; [\n                    'host' =&gt; '127.0.0.1',\n                    'username' =&gt; 'root',\n                    'password' =&gt; 'root',\n                    'database' =&gt; 'database',\n                    \/\/ 'port'    =&gt; '3306',\n                    \/\/ 'timeout' =&gt; '\u5efa\u7acb\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4',\n                    \/\/ 'charset' =&gt; '',\n                    \/\/ 'strict_type' =&gt; false, \/\/\u5f00\u542f\u4e25\u683c\u6a21\u5f0f\uff0c\u8fd4\u56de\u7684\u5b57\u6bb5\u5c06\u81ea\u52a8\u8f6c\u4e3a\u6570\u5b57\u7c7b\u578b\n                ],\n            ],\n            \/\/ \u5f02\u6b65\u6c60\u5b50\uff0cworker\u8fdb\u7a0b\u4f7f\u7528\n            'async' =&gt; [\n                'pool'    =&gt;    [\n                    'class'        =&gt;    \\Imi\\Db\\Pool\\CoroutineDbPool::class,\n                    'config'    =&gt;    [\n                        \/\/ \u540c\u4e0a\n                    ],\n                ],\n                'resource'    =&gt;    [\n                    'host'        =&gt; '127.0.0.1',\n                    'username'        =&gt; 'root',\n                    'password'    =&gt; 'root',\n                    'database'    =&gt; 'database',\n                    \/\/ 'timeout' =&gt; '\u5efa\u7acb\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4',\n                    \/\/ 'charset' =&gt; '',\n                    \/\/ 'options' =&gt; [], \/\/ PDO\u8fde\u63a5\u9009\u9879\n                ],\n                \/\/ uri \u5199\u6cd5\n                \/\/ 'resource'  =&gt;  [\n                \/\/     'tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60',\n                \/\/     'tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60',\n                \/\/ ],\n                \/\/ 'resource'  =&gt;  'tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60;tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60',\n            ],\n        ]\n    ],\n];\u76f4\u63a5\u64cd\u4f5c Db \u5bf9\u8c61\/\/ \u83b7\u53d6\u65b0\u7684\u6570\u636e\u5e93\u8fde\u63a5\u5b9e\u4f8b\n$db = Db::getNewInstance();\n\/\/ \u8bfb\u5e93\n$db = Db::getNewInstance($poolName, QueryType::READ);\n\/\/ \u5199\u5e93\n$db = Db::getNewInstance($poolName, QueryType::WRITE);\n\n\/\/ \u83b7\u53d6\u6570\u636e\u5e93\u8fde\u63a5\u5b9e\u4f8b\uff0c\u6bcf\u4e2aRequestContext\u4e2d\u5171\u7528\u4e00\u4e2a\n$db = Db::getInstance();\n\/\/ \u8bfb\u5e93\n$db = Db::getInstance($poolName, QueryType::READ);\n\/\/ \u5199\u5e93\n$db = Db::getInstance($poolName, QueryType::WRITE);\n\n\/\/ \u91ca\u653e\u8fde\u63a5\uff0c\u56de\u5f52\u8fde\u63a5\u6c60\nDb::release($db);\n\n$returnValue = Db::use(function(IDb $db){\n    \/\/ \u64cd\u4f5c $db\n    return 'imi';\n}); \/\/ imi\u8fde\u8d2f\u64cd\u4f5cIMI \u4e2d\u6570\u636e\u5e93\u67e5\u8be2\u8fde\u8d2f\u64cd\u4f5c\u90fd\u6765\u81ea\u4e8e\u67e5\u8be2\u5668\uff0c\u67e5\u8be2\u5668\u7684\u521b\u5efa\u65b9\u5f0f\uff1ause Imi\\Db\\Db;\n$query = Db::query();\u4e8b\u52a1\u624b\u52a8\u63a7\u5236\u4e8b\u52a1\uff1a\/\/ \u5f00\u542f\u4e8b\u52a1\nDb::getInstance()-&gt;beginTransaction();\n\/\/ \u63d0\u4ea4\u4e8b\u52a1\nDb::getInstance()-&gt;commit();\n\/\/ \u56de\u6eda\u4e8b\u52a1\nDb::getInstance()-&gt;rollBack();\u83b7\u53d6\u8fde\u63a5\u987a\u5e26\u81ea\u52a8\u5f00\u542f\/\u63d0\u4ea4\/\u56de\u6eda\u4e8b\u52a1\uff1aDb::transUse(function(IDb $db){\n\n});\nDb::transUse(function(IDb $db){\n\n}, $poolName, QueryType::WRITE);\u83b7\u53d6\u8fde\u63a5\u540e\uff0c\u60f3\u8981\u4f7f\u7528\u67d0\u4e2a\u8fde\u63a5\uff0c\u6267\u884c\u4e8b\u52a1\u64cd\u4f5c\uff0c\u81ea\u52a8\u5f00\u542f\/\u63d0\u4ea4\/\u56de\u6eda\u4e8b\u52a1\uff1a$db = Db::getInstance();\nDb::trans($db, function(IDb $db){\n\n});\u81ea\u52a8\u4e8b\u52a1\u5904\u7406@Transaction \u6ce8\u89e3\uff0c\u7c7b\uff1aImi\\Db\\Annotation\\Transaction\u8fd9\u4e2a\u6ce8\u89e3\u53ef\u4ee5\u52a0\u5728\u4efb\u610f\u65b9\u6cd5\u4e0a\uff0c\u5728\u65b9\u6cd5\u8c03\u7528\u524d\u5f00\u542f\u4e8b\u52a1\uff0c\u5728\u65b9\u6cd5\u4e2d\u629b\u51fa\u5f02\u5e38\u65f6\u56de\u6eda\u4e8b\u52a1\uff0c\u65b9\u6cd5\u6210\u529f\u8fd4\u56de\u65f6\u63d0\u4ea4\u4e8b\u52a1\u3002@Transaction@Transaction(autoCommit=&quot;\u81ea\u52a8\u63d0\u4ea4\u4e8b\u52a1true\/false\uff0c\u9ed8\u8ba4\u4e3atrue&quot;)\u4e8b\u52a1\u7c7b\u578b\uff1a\u4e8b\u52a1\u5d4c\u5957\uff08\u9ed8\u8ba4\uff09@Transaction(type=TransactionType::NESTING)\u8be5\u65b9\u6cd5\u5fc5\u987b\u5728\u4e8b\u52a1\u4e2d\u88ab\u8c03\u7528@Transaction(type=TransactionType::REQUIREMENT)\u5982\u679c\u5f53\u524d\u4e0d\u5728\u4e8b\u52a1\u4e2d\u5219\u5f00\u542f\u4e8b\u52a1@Transaction(type=TransactionType::AUTO)\u90e8\u5206\u56de\u6eda\uff1a@Transaction(rollbackType=RollbackType::PART, rollbackLevels=&quot;\u56de\u6eda\u5c42\u6570\uff0c\u9ed8\u8ba4\u4e3a1&quot;)\u6307\u5b9a\u8868 (table\/from)\/\/ \u6307\u5b9a\u8868\u540d\nDb::query()-&gt;table('tb_test');\n\/\/ \u6307\u5b9a\u8868\u540d\u5e76\u4e14\u8bbe\u7f6e\u522b\u540d\nDb::query()-&gt;table('tb_test', 'test');\n\/\/ \u6307\u5b9a\u8868\u540d\u548c\u6570\u636e\u5e93\u540d\nDb::query()-&gt;table('tb_test', null, 'db1');\n\/\/ \u4f20\u5165\u53c2\u6570\u539f\u6837\u4ee3\u5165\u5230SQL\u4e2d\nDb::query()-&gt;tableRaw('tb_test');table() \u548c tableRaw() \u4e5f\u53ef\u4ee5\u4f7f\u7528 from() \u548c fromRaw() \u4ee3\u66ff\u3002distinct\/\/ \u7ed3\u679c\u552f\u4e00\nDb::query()-&gt;distinct();\n\/\/ \u7ed3\u679c\u4e0d\u552f\u4e00\nDb::query()-&gt;distinct(false);\u6307\u5b9a\u5b57\u6bb5 (field)\/\/ \u6307\u5b9a\u4e00\u4e2a\u5b57\u6bb5\nDb::query()-&gt;field('id');\n\n\/\/ \u6307\u5b9a\u591a\u4e2a\u5b57\u6bb5\uff0c\u4e5f\u652f\u6301\u8bbe\u7f6e\u522b\u540d\u3002\u7a7a\u683c\u548cas\u90fd\u652f\u6301\nDb::query()-&gt;field('id', 'name1 name', 'age1 as age');\n\n\/\/ \u548c\u4e0a\u9762\u7684\u7528\u6cd5\u7b49\u540c\nDb::query()-&gt;field(['id', 'name1 name', 'age1 as age']);\n\n\/\/ \u4f20\u5165\u53c2\u6570\u539f\u6837\u4ee3\u5165\u5230SQL\u4e2d\nDb::query()-&gt;fieldRaw('id, name1 name, age1 as age');\u6761\u4ef6 wherewhere\/\/ id = 1\nDb::query()-&gt;where('id', '=', 1);\n\n\/\/ id &gt; 1\nDb::query()-&gt;where('id', '&gt;', 1);\n\n\/\/ title like '%test%'\nDb::query()-&gt;where('title', 'like', '%test%');\n\n\/\/ id between 1 and 10\nDb::query()-&gt;where('id', 'between', [1, 10]);\n\n\/\/ id not between 1 and 10\nDb::query()-&gt;where('id', 'not between', [1, 10]);\n\n\/\/ or id = 1\nDb::query()-&gt;where('id', '=', 1, 'or');\nDb::query()-&gt;orWhere('id', '=', 1);TP \u98ce\u683c where\/\/ select * from `tb_test` where (`id` = 1 or (`id` = 2 ) and `title` like '%test%' and `age` &gt; 18 and (`id` = 2 or (`id` = 3 ) ) )\nDb::query()-&gt;from('tb_test')-&gt;whereEx([\n    'id'    =&gt;    1,\n    'or'    =&gt;    [\n        'id'    =&gt;    2,\n    ],\n    'title'    =&gt;    ['like', '%test%'],\n    'age'    =&gt;    ['&gt;', 18],\n    'and'   =&gt;  [\n        'id'    =&gt;  2,\n        'or'    =&gt;  [\n            'id'    =&gt;  3,\n        ]\n    ]\n]);whereRaw\/\/ \u4f20\u5165\u53c2\u6570\u539f\u6837\u4ee3\u5165\u5230SQL\u4e2d\nDb::query()-&gt;whereRaw('id &gt;= 1');\n\/\/ \u4f20\u5165\u53c2\u6570\u539f\u6837\u4ee3\u5165\u5230SQL\u4e2d\uff0c\u5e76\u4e14\u4e3aor\u6761\u4ef6\nDb::query()-&gt;whereRaw('id &gt;= 1', 'or');\nDb::query()-&gt;orWhereRaw('id &gt;= 1');whereBrackets\/\/ where id = 1 or (age &lt; 14)\nDb::query()-&gt;where('id', '=', 1)-&gt;whereBrackets(function(){\n    \/\/ \u76f4\u63a5\u8fd4\u56de\u5b57\u7b26\u4e32\n    return 'age &lt; 14';\n}, 'or');\n\n\/\/ where id = 1 or (age &lt; 14)\nDb::query()-&gt;where('id', '=', 1)-&gt;whereBrackets(function(){\n    \/\/ \u76f4\u63a5\u8fd4\u56de\u5b57\u7b26\u4e32\n    return new \\Imi\\Db\\Query\\Where\\Where('age', '&lt;', 14);\n}, 'or');\nDb::query()-&gt;where('id', '=', 1)-&gt;orWhereBrackets(function(){\n    \/\/ \u76f4\u63a5\u8fd4\u56de\u5b57\u7b26\u4e32\n    return new \\Imi\\Db\\Query\\Where\\Where('age', '&lt;', 14);\n});whereStruct\/\/ or age &lt; 14\nDb::query()-&gt;whereStruct(new \\Imi\\Db\\Query\\Where\\Where('age', '&lt;', 14), 'or');\nDb::query()-&gt;orWhereStruct(new \\Imi\\Db\\Query\\Where\\Where('age', '&lt;', 14));\u5176\u5b83\/\/ or age between 1 and 14\nDb::query()-&gt;whereBetween('age', 1, 14, 'or');\nDb::query()-&gt;orWhereBetween('age', 1, 14);\n\n\/\/ or age not between 1 and 14\nDb::query()-&gt;whereNotBetween('age', 1, 14, 'or');\nDb::query()-&gt;orWhereNotBetween('age', 1, 14);\n\n\/\/ or age in (1,2,3)\nDb::query()-&gt;whereIn('age', [1, 2, 3], 'or');\nDb::query()-&gt;orWhereIn('age', [1, 2, 3]);\n\n\/\/ or age not in (1,2,3)\nDb::query()-&gt;whereNotIn('age', [1, 2, 3], 'or');\nDb::query()-&gt;orWhereNotIn('age', [1, 2, 3]);\n\n\/\/ or age is null\nDb::query()-&gt;whereIsNull('age', 'or');\nDb::query()-&gt;orWhereIsNull('age');\n\n\/\/ or age is not null\nDb::query()-&gt;whereIsNotNull('age', 'or');\nDb::query()-&gt;orWhereIsNotNull('age');JSON \u5b57\u6bb5\u652f\u6301\u770b\u5982\u4e0b\u4ee3\u7801\uff0cdata\u4e3ajson\u7c7b\u578b\u5b57\u6bb5\uff0c\u67e5\u8be2json\u5bf9\u8c61\u4e2d\u7684member.age\u4e3a11\u7684\u8bb0\u5f55Db::query()-&gt;where('data-&gt;member.age', '=', 11)-&gt;select();join\/\/ select * from tb_test1 left join tb_test2 on tb_test1.aid = tb_test2.bid\nDb::query()-&gt;table('tb_test1')-&gt;join('tb_test2', 'tb_test1.aid', '=', 'tb_test2.bid');\n\/\/ select * from tb_test1 left join tb_test2 as test2 on tb_test1.aid = test2.bid\nDb::query()-&gt;table('tb_test1')-&gt;join('tb_test2', 'tb_test1.aid', '=', 'test2.bid', 'test');\n\/\/ select * from tb_test1 right join tb_test2 on tb_test1.aid = tb_test2.bid and tb_test1.age &gt; 14\nDb::query()-&gt;table('tb_test1')-&gt;join('tb_test2', 'tb_test1.aid', '=', 'tb_test2.bid', null, new \\Imi\\Db\\Query\\Where\\Where('tb_test1.age', '&gt;', '14'), 'right');\n\n\/\/ select * from tb_test1 left join tb_test2 on tb_test1.aid = tb_test2.bid\nDb::query()-&gt;table('tb_test1')-&gt;joinRaw('left join tb_test2 on tb_test1.aid = tb_test2.bid');\n\n\/\/ \u4e0b\u9762\u4e09\u79cd\u7528\u6cd5\uff0c\u7b2c5\u4e2a\u53c2\u6570\u90fd\u652f\u6301\u4f20Where\n\/\/ left join\nDb::query()-&gt;table('tb_test1')-&gt;leftJoin('tb_test2', 'tb_test1.aid', '=', 'tb_test2.bid');\n\/\/ right join\nDb::query()-&gt;table('tb_test1')-&gt;rightJoin('tb_test2', 'tb_test1.aid', '=', 'tb_test2.bid');\n\/\/ cross join\nDb::query()-&gt;table('tb_test1')-&gt;crossJoin('tb_test2', 'tb_test1.aid', '=', 'tb_test2.bid');order\/\/ order by id asc, age desc\nDb::query()-&gt;order('id')-&gt;order('age', 'desc');\n\n\/\/ order by id desc\nDb::query()-&gt;orderRaw('id desc');group by\/\/ group by id, name\nDb::query()-&gt;group('id', 'name');\n\n\/\/ group by sum(id)\nDb::query()-&gt;groupRaw('sum(id)');havinghaving()\u7528\u6cd5\u540cwhere()havingRaw()\u7528\u6cd5\u540cwhereRaw()havingBrackets()\u7528\u6cd5\u540cwhereBrackets()havingStruct()\u7528\u6cd5\u540cwhereStruct()\u5206\u9875\u67e5\u8be2\/\/ limit 900, 100\nDb::query()-&gt;page(10, 100);\n\n\/\/ limit 10, 1\nDb::query()-&gt;offset(10)-&gt;limit(1);\n\n\/\/ limit 1\nDb::query()-&gt;limit(1);\u67e5\u8be2\u6267\u884c\u67e5\u8be2\u8bb0\u5f55\u67e5\u8be2\u5355\u884c$result = Db::query()-&gt;table('tb_test')-&gt;select();\n$result-&gt;get(); \/\/ \u6570\u7ec4\n$result-&gt;get($className); \/\/ $className\u5bf9\u5e94\u7684\u7c7b\u5bf9\u8c61\u67e5\u8be2\u591a\u884c$result = Db::query()-&gt;table('tb_test')-&gt;select();\n$result-&gt;getArray(); \/\/ \u6570\u7ec4\u5185\u5d4c\u5957\u6570\u7ec4\n$result-&gt;getArray($className); \/\/ \u6570\u7ec4\u5185\u5d4c\u5957$className\u5bf9\u5e94\u7684\u7c7b\u5bf9\u8c61\n$result-&gt;getRowCount(); \/\/ \u83b7\u53d6\u67e5\u8be2\u51fa\u7684\u8bb0\u5f55\u884c\u6570\u805a\u5408\u51fd\u6570\/\/ count(*)\nDb::query()-&gt;table('tb_test')-&gt;count();\n\n\/\/ count(id)\nDb::query()-&gt;table('tb_test')-&gt;count('id');\n\n\/\/ sum(id)\nDb::query()-&gt;table('tb_test')-&gt;sum('id');\n\n\/\/ avg(id)\nDb::query()-&gt;table('tb_test')-&gt;avg('id');\n\n\/\/ max(id)\nDb::query()-&gt;table('tb_test')-&gt;max('id');\n\n\/\/ min(id)\nDb::query()-&gt;table('tb_test')-&gt;min('id');\n\n\/\/ \u5176\u5b83\u81ea\u5b9a\u4e49\uff1atest(id)\nDb::query()-&gt;table('tb_test')-&gt;aggregate('test', 'id');\u63d2\u5165\u8bb0\u5f55\/\/ insert into tb_test(name, age) values('yurun', 666)\n$result = Db::query()-&gt;table('tb_test')-&gt;insert([\n    'name'    =&gt;    'yurun',\n    'age'    =&gt;    666,\n]);\n\n\/\/ insert into tb_test values('yurun', 666)\n$result = Db::query()-&gt;table('tb_test')-&gt;insert([\n    'yurun',666,\n]);\n\n$result-&gt;isSuccess(); \/\/ SQL\u662f\u5426\u6267\u884c\u6210\u529f\n$result-&gt;getLastInsertId(); \/\/ \u83b7\u53d6\u6700\u540e\u63d2\u5165\u7684ID\n$result-&gt;getAffectedRows(); \/\/ \u83b7\u53d6\u5f71\u54cd\u884c\u6570\u6279\u91cf\u63d2\u5165$result = Db::query()-&gt;from('test')-&gt;batchInsert([\n    ['name'=&gt;'a'],\n    ['name'=&gt;'b'],\n    ['name'=&gt;'c'],\n]);\n$result-&gt;isSuccess(); \/\/ SQL\u662f\u5426\u6267\u884c\u6210\u529f\n$result-&gt;getAffectedRows(); \/\/ \u83b7\u53d6\u5f71\u54cd\u884c\u6570\u66f4\u65b0\u8bb0\u5f55\/\/ update tb_test set name = 'yurun', age = 666 where id = 1\n$result = Db::query()-&gt;table('tb_test')-&gt;where('id', '=', 1)-&gt;update([\n    'name'    =&gt;    'yurun',\n    'age'    =&gt;    666,\n]);\n\n\/\/ $result\u4f7f\u7528\u65b9\u6cd5\u540c\u4e0a\u66ff\u6362\u6570\u636e\/\/ replace into tb_test set id = 1, name = 'yurun', age = 666\n$result = Db::query()-&gt;table('tb_test')-&gt;replace([\n    'id'    =&gt;    1,\n    'name'    =&gt;    'yurun',\n    'age'    =&gt;    666,\n]);\u9012\u589e\/\u9012\u51cf\/\/ score \u9012\u589e 1\n$result = Db::query()-&gt;table('tb_test')\n                     -&gt;where('id', '=', 1)\n                     -&gt;setFieldInc('score')\n                     -&gt;update();\n\n\/\/ score \u9012\u589e 10\n$result = Db::query()-&gt;table('tb_test')\n                     -&gt;where('id', '=', 1)\n                     -&gt;setFieldInc('score', 10)\n                     -&gt;update();\n\n\/\/ score \u9012\u51cf 1\n$result = Db::query()-&gt;table('tb_test')\n                     -&gt;where('id', '=', 1)\n                     -&gt;setFieldDec('score')\n                     -&gt;update();\n\n\/\/ score \u9012\u51cf 10\n$result = Db::query()-&gt;table('tb_test')\n                     -&gt;where('id', '=', 1)\n                     -&gt;setFieldDec('score', 10)\n                     -&gt;update();update\/insert\/replace\u65f6\u4f7f\u7528\u8868\u8fbe\u5f0f\/\/ update tb_test set score = score + 1 where id = 1\n$result = Db::query()-&gt;table('tb_test')\n                     -&gt;where('id', '=', 1)\n                     -&gt;setFieldExp('score', 'score + 1')\n                     -&gt;update();\u5220\u9664\u8bb0\u5f55\/\/ delete from tb_test where id = 1\n$result = Db::query()-&gt;table('tb_test')-&gt;where('id', '=', 1)-&gt;delete();\n\n\/\/ $result\u4f7f\u7528\u65b9\u6cd5\u540c\u4e0a\u76f4\u63a5\u6267\u884cSQL$result = Db::query()-&gt;execute('select * from tb_test'));\n\n\/\/ $result\u4f7f\u7528\u65b9\u6cd5\u540c\u4e0a\u53c2\u6570\u7ed1\u5b9a\u590d\u6742\u7684\u67e5\u8be2\u65f6\uff0c\u96be\u514d\u9700\u8981\u62fc\u63a5 SQL\uff0c\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u53c2\u6570\u7ed1\u5b9a\u6765\u9632\u6b62\u6ce8\u5165\u4e86\uff01\/\/ where id = 123\n$result = Db::query()-&gt;whereRaw('id = ?')-&gt;bindValue(1, 123);\n$result = Db::query()-&gt;whereRaw('id = :val')-&gt;bindValue(':val', 123);\n\n\/\/ \u6279\u91cf\u7ed1\u5b9a\n$result = Db::query()-&gt;bindValues([\n    ':name'    =&gt;    'yurun',\n    ':age'    =&gt;    666,\n])-&gt;execute('select * from tb_test where name = :name and age = :age');Result \u7528\u6cd5$result = Db::query()-&gt;table('tb_test')-&gt;select();\u662f\u5426\u6267\u884c\u6210\u529f$success = $result-&gt;isSuccess(); \/\/ true\/false\u83b7\u53d6\u6700\u540e\u63d2\u5165\u7684ID\u7528\u4e8e\u83b7\u53d6\u65b0\u589e\u8bb0\u5f55\u7684\u81ea\u589e\u5b57\u6bb5\u503c$lastInsertId = $result-&gt;getLastInsertId(); \/\/ int\u83b7\u53d6\u5f71\u54cd\u884c\u6570$rows = $result-&gt;getAffectedRows();update \u65f6\uff0c\u5982\u679c\u6ca1\u6709\u503c\u88ab\u6539\u53d8\uff0c\u53ef\u80fd\u4f1a\u8fd4\u56de0\u8fd4\u56de\u4e00\u884c\u6570\u636e\u8fd4\u56de\u6570\u7ec4$dataArray = $result-&gt;get();\u8fd4\u56de\u5bf9\u8c61\u5b9e\u4f8b\u5316\u8fd9\u4e2a\u7c7b\u65f6\uff0c\u628a\u6570\u7ec4\u4f20\u5165\u6784\u9020\u65b9\u6cd5$dataArray = $result-&gt;get(XXXModel::class);\u8fd4\u56de\u6570\u7ec4\u5217\u8868\u6210\u5458\u4e3a\u6570\u7ec4$list = $result-&gt;getArray();\u6210\u5458\u4e3a\u5bf9\u8c61$list = $result-&gt;getArray(XXXModel::class);\u83b7\u53d6\u4e00\u5217$ids = Db::query()-&gt;field('id')-&gt;select()-&gt;getColumn();\n\/\/ \u7ed3\u679c\u683c\u5f0f\uff1a[1, 2, 3]\u83b7\u53d6\u6807\u91cf\u7ed3\u679c$name = Db::query()-&gt;field('name')-&gt;where('id', '=', 1)-&gt;select()-&gt;getScalar();\u83b7\u53d6\u8bb0\u5f55\u884c\u6570\u5f97\u5230\u53d6\u56de\u591a\u5c11\u6761\u8bb0\u5f55$rowCount = $result-&gt;getRowCount();\u83b7\u53d6\u6267\u884c\u7684SQL$sql = $result-&gt;getSql();\u83b7\u53d6\u7ed3\u679c\u96c6$statement = $result-&gt;getStatement(); \/\/ \\Imi\\Db\\Interfaces\\IStatement"},{"id":48,"parent_id":44,"title":"ORM","mdFileName":"components\/orm\/index.md","url":"components\/orm\/index.html","level":1,"content":"ORM\u4ecb\u7ecdIMI \u4e2d\u76ee\u524d\u652f\u6301\u4e24\u4e2a\u6a21\u578b\uff1a\u6570\u636e\u5e93\u6a21\u578b\u3001\u5185\u5b58\u8868\u6a21\u578b\u6a21\u578b\u5b57\u6bb5\u548c\u5e8f\u5217\u5316\u6a21\u578b\u5b9e\u4f8b\u5bf9\u8c61\u53ef\u4ee5\u540c\u65f6\u4f5c\u4e3a\u6570\u7ec4\u548c\u5bf9\u8c61\u4f7f\u7528\u3002\u5982\u6570\u636e\u5e93\u4e2d\u5b57\u6bb5\u4e3auser_age\uff0c\u540c\u65f6\u652f\u6301\u539f\u5b57\u6bb5\u540d\u548c\u9a7c\u5cf0\u547d\u540d\uff0c\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a\/\/ \u4e0b\u9762\u4e09\u53e5\u662f\u7b49\u540c\u7684\n$model['user_age'] = 1;\n$model['userAge'] = 1;\n$model-&gt;setUserAge(1);\u8c03\u7528$model-&gt;toArray()\u53ef\u4ee5\u8f6c\u4e3a\u6570\u7ec4\u3002\u53ef\u4ee5\u76f4\u63a5\u5bf9\u6a21\u578b\u8fdb\u884cjson_encode()\u5904\u7406\u3002\u6a21\u578b\u5e8f\u5217\u5316\u540e\u7684\u5b57\u6bb5\u9ed8\u8ba4\u4e3a\u9a7c\u5cf0\u683c\u5f0f\uff0c\u5982\uff1a\u6570\u636e\u5e93\u5b57\u6bb5\u4e3auser_age\uff0c\u5e8f\u5217\u5316\u540e\u4e3auserAge\u3002\u53ef\u4ee5\u4f7f\u7528\u6ce8\u89e3\uff0c\u8bbe\u7f6e\u4e3a\u4f7f\u7528\u539f\u6570\u636e\u5e93\u5b57\u6bb5\u540d\uff1a@Entity(camel=false)"},{"id":49,"parent_id":48,"title":"\u4f7f\u7528\u8bf4\u660e","mdFileName":"components\/orm\/index.md","url":"components\/orm\/index.html","level":2,"content":"ORM\u4ecb\u7ecdIMI \u4e2d\u76ee\u524d\u652f\u6301\u4e24\u4e2a\u6a21\u578b\uff1a\u6570\u636e\u5e93\u6a21\u578b\u3001\u5185\u5b58\u8868\u6a21\u578b\u6a21\u578b\u5b57\u6bb5\u548c\u5e8f\u5217\u5316\u6a21\u578b\u5b9e\u4f8b\u5bf9\u8c61\u53ef\u4ee5\u540c\u65f6\u4f5c\u4e3a\u6570\u7ec4\u548c\u5bf9\u8c61\u4f7f\u7528\u3002\u5982\u6570\u636e\u5e93\u4e2d\u5b57\u6bb5\u4e3auser_age\uff0c\u540c\u65f6\u652f\u6301\u539f\u5b57\u6bb5\u540d\u548c\u9a7c\u5cf0\u547d\u540d\uff0c\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a\/\/ \u4e0b\u9762\u4e09\u53e5\u662f\u7b49\u540c\u7684\n$model['user_age'] = 1;\n$model['userAge'] = 1;\n$model-&gt;setUserAge(1);\u8c03\u7528$model-&gt;toArray()\u53ef\u4ee5\u8f6c\u4e3a\u6570\u7ec4\u3002\u53ef\u4ee5\u76f4\u63a5\u5bf9\u6a21\u578b\u8fdb\u884cjson_encode()\u5904\u7406\u3002\u6a21\u578b\u5e8f\u5217\u5316\u540e\u7684\u5b57\u6bb5\u9ed8\u8ba4\u4e3a\u9a7c\u5cf0\u683c\u5f0f\uff0c\u5982\uff1a\u6570\u636e\u5e93\u5b57\u6bb5\u4e3auser_age\uff0c\u5e8f\u5217\u5316\u540e\u4e3auserAge\u3002\u53ef\u4ee5\u4f7f\u7528\u6ce8\u89e3\uff0c\u8bbe\u7f6e\u4e3a\u4f7f\u7528\u539f\u6570\u636e\u5e93\u5b57\u6bb5\u540d\uff1a@Entity(camel=false)"},{"id":50,"parent_id":48,"title":"\u6570\u636e\u8868\u6a21\u578b","mdFileName":"components\/orm\/RDModel.md","url":"components\/orm\/RDModel.html","level":2,"content":"\u6570\u636e\u5e93\u6a21\u578b\u4ecb\u7ecd\u4f20\u7edf\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u6a21\u578b\uff0c\u65e5\u5e38\u589e\u5220\u6539\u67e5\u5b8c\u5168\u591f\u7528\uff0c\u652f\u6301\u590d\u5408\u4e3b\u952e\u3001\u8054\u5408\u4e3b\u952e\u3002\u6a21\u578b\u5b9a\u4e49\u559c\u95fb\u4e50\u89c1\u7684\u5bf9\u547d\u540d\u7a7a\u95f4\u3001\u7c7b\u540d\u65e0\u8981\u6c42\uff0c\u53ea\u8981\u6309\u7167\u89c4\u5b9a\u5199\u6ce8\u89e3\u5373\u53ef\uff01@Entity \u6ce8\u89e3\u4e3a\u5b9a\u4e49\u5b9e\u4f53\u7c7b@Table \u6ce8\u89e3\u4e3a\u5b9a\u4e49\u6570\u636e\u8868@Column \u6ce8\u89e3\u4e3a\u5b9a\u4e49\u5b57\u6bb5\u5177\u4f53\u5b9a\u4e49\u770b\u4e0b\u9762\u4ee3\u7801\uff1anamespace Test;\n\nuse Imi\\Model\\Model;\nuse Imi\\Model\\Annotation\\Table;\nuse Imi\\Model\\Annotation\\Column;\nuse Imi\\Model\\Annotation\\Entity;\n\n\/**\n * \u5b9a\u4e49\u4e3a\u5b9e\u4f53\n * @Entity\n * \u6307\u5b9a\u5b9e\u4f53\u4e3atest\uff0c\u590d\u5408\u4e3b\u952eid\u548ca\n * @Table(name=&quot;test&quot;, id={&quot;id&quot;, &quot;a&quot;})\n *\/\nclass Test extends Model\n{\n    \/**\n     * ID\n     * \u5b57\u6bb5id\uff0c\u7c7b\u578bint\uff0c\u957f\u5ea610\uff0c\u662f\u4e3b\u952e\uff0c\u7b2c0\u4e2a\u4e3b\u952e\uff0c\u662f\u81ea\u589e\u5b57\u6bb5\n     * @Column(name=&quot;id&quot;, type=&quot;int&quot;, length=10, isPrimaryKey=true, primaryKeyIndex=0, isAutoIncrement=true)\n     * @var int\n     *\/\n    protected $id;\n\n    \/**\n     * aaa\n     * @Column(name=&quot;a&quot;, type=&quot;string&quot;, length=255, isPrimaryKey=true, primaryKeyIndex=1)\n     * @var string\n     *\/\n    protected $a;\n\n    \/**\n     * bbb\n     * @Column(name=&quot;b&quot;, type=&quot;string&quot;, length=255)\n     * @var string\n     *\/\n    protected $b;\n\n    \/**\n     * ccc\n     * @Column(name=&quot;c&quot;, type=&quot;string&quot;, length=255)\n     * @var string\n     *\/\n    protected $c;\n\n    \/**\n     * Get iD\n     *\n     * @return  int\n     *\/ \n    public function getId()\n    {\n        return $this-&gt;id;\n    }\n\n    \/**\n     * Set iD\n     *\n     * @param  int  $id  ID\n     *\n     * @return  self\n     *\/ \n    public function setId(int $id)\n    {\n        $this-&gt;id = $id;\n\n        return $this;\n    }\n\n    \/**\n     * Get aaa\n     *\n     * @return  string\n     *\/ \n    public function getA()\n    {\n        return $this-&gt;a;\n    }\n\n    \/**\n     * Set aaa\n     *\n     * @param  string  $a  aaa\n     *\n     * @return  self\n     *\/ \n    public function setA(string $a)\n    {\n        $this-&gt;a = $a;\n\n        return $this;\n    }\n\n    \/**\n     * Get bbb\n     *\n     * @return  string\n     *\/ \n    public function getB()\n    {\n        return $this-&gt;b;\n    }\n\n    \/**\n     * Set bbb\n     *\n     * @param  string  $b  bbb\n     *\n     * @return  self\n     *\/ \n    public function setB(string $b)\n    {\n        $this-&gt;b = $b;\n\n        return $this;\n    }\n\n    \/**\n     * Get ccc\n     *\n     * @return  string\n     *\/ \n    public function getC()\n    {\n        return $this-&gt;c;\n    }\n\n    \/**\n     * Set ccc\n     *\n     * @param  string  $c  ccc\n     *\n     * @return  self\n     *\/ \n    public function setC(string $c)\n    {\n        $this-&gt;c = $c;\n\n        return $this;\n    }\n}\u9700\u8981\u4f7f\u7528\u6ce8\u89e3\u5c06\u8868\u3001\u5b57\u6bb5\u5c5e\u6027\u5168\u90e8\u6807\u6ce8\u3002\u5e76\u4e14\u5199\u4e0aget\u548cset\u65b9\u6cd5\uff0c\u53ef\u4ee5\u4f7f\u7528\u6a21\u578b\u751f\u6210\u5de5\u5177\u751f\u6210\u3002\u6a21\u578b\u4e2d\u53ef\u4ee5\u52a0\u5165\u865a\u62df\u5b57\u6bb5\uff0c\u901a\u8fc7\u6ce8\u89e3@Column(virtual=true)\uff0c\u865a\u62df\u5b57\u6bb5\u4e0d\u53c2\u4e0e\u6570\u636e\u5e93\u64cd\u4f5c\u3002\u6a21\u578b\u6ce8\u89e3@Entity\u5199\u5728\u7c7b\u4e0a\uff0c\u5b9a\u4e49\u7c7b\u4e3a\u5b9e\u4f53\u6a21\u578b\u7c7b\u7528\u6cd5\uff1a@Entity\u5e8f\u5217\u5316\u65f6\u4e0d\u4f7f\u7528\u9a7c\u5cf0\u547d\u540d\uff0c\u4f7f\u7528\u539f\u672c\u7684\u5b57\u6bb5\u540d\uff1a@Entity(false)@Table\u5199\u5728\u7c7b\u4e0a\uff0c\u5b9a\u4e49\u6570\u636e\u8868\u7528\u6cd5\uff1a@Table('tb_user')\u6307\u5b9a\u6570\u636e\u5e93\u8fde\u63a5\u6c60\uff1a@Table(name='tb_user', dbPoolName='\u6307\u5b9a\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u540d')\u6307\u5b9a\u4e3b\u952e\uff1a@Table(name='tb_user', id='id')\u6307\u5b9a\u591a\u4e2a\u4e3b\u952e@Table(name='tb_user', id={'id1', 'id2'})@Column\u5199\u5728\u5c5e\u6027\u4e0a\uff0c\u5b9a\u4e49\u5b57\u6bb5\u5217@Column(name=&quot;\u5b57\u6bb5\u540d&quot;, type=&quot;\u5b57\u6bb5\u7c7b\u578b&quot;, length=&quot;\u957f\u5ea6&quot;, nullable=&quot;\u662f\u5426\u5141\u8bb8\u4e3a\u7a7atrue\/false&quot;, accuracy=&quot;\u7cbe\u5ea6\uff0c\u5c0f\u6570\u4f4d\u540e\u51e0\u4f4d&quot;, default=&quot;\u9ed8\u8ba4\u503c&quot;, isPrimaryKey=&quot;\u662f\u5426\u4e3a\u4e3b\u952etrue\/false&quot;, primaryKeyIndex=&quot;\u8054\u5408\u4e3b\u952e\u4e2d\u7684\u7b2c\u51e0\u4e2a\uff0c\u4ece0\u5f00\u59cb&quot;, isAutoIncrement=&quot;\u662f\u5426\u4e3a\u81ea\u589e\u5b57\u6bb5true\/false&quot;, virtual=&quot;\u865a\u62df\u5b57\u6bb5\uff0c\u4e0d\u53c2\u4e0e\u6570\u636e\u5e93\u64cd\u4f5ctrue\/false&quot;)\u5f53\u4f60\u6307\u5b9atype=json\u65f6\uff0c\u5199\u5165\u6570\u636e\u5e93\u65f6\u81ea\u52a8json_encode\uff0c\u4ece\u6570\u636e\u5b9e\u4f8b\u5316\u5230\u5bf9\u8c61\u65f6\u81ea\u52a8json_decode@Serializable\u5199\u5728\u5c5e\u6027\u4e0a\uff0c\u5e8f\u5217\u5316\u6ce8\u89e3\u7528\u6cd5\uff1a\u7981\u6b62\u53c2\u4e0e\u5e8f\u5217\u5316\uff08toArray()\u6216json_encode()\u4e0d\u5305\u542b\u8be5\u5b57\u6bb5\uff09\uff1a@Serializable(false)@Serializables\u5199\u5728\u7c7b\u4e0a\uff0c\u6279\u91cf\u8bbe\u7f6e\u5e8f\u5217\u5316\u6ce8\u89e3\uff0c\u4f18\u5148\u7ea7\u4f4e\u4e8e\u9488\u5bf9\u5c5e\u6027\u5355\u72ec\u8bbe\u7f6e\u7684@Serializable\u6ce8\u89e3\u7528\u6cd5\uff1a\u767d\u540d\u5355\uff08\u5e8f\u5217\u5316\u540e\u53ea\u663e\u793aid\u3001name\u5b57\u6bb5\uff09\uff1a@Serializables(mode=&quot;allow&quot;, fields={&quot;id&quot;, &quot;name&quot;})\u9ed1\u540d\u5355\uff08\u5e8f\u5217\u5316\u540e\uff0c\u6392\u9664id\u3001name\u5b57\u6bb5\uff09@Serializables(mode=&quot;deny&quot;, fields={&quot;id&quot;, &quot;name&quot;})@ExtractProperty\u5199\u5728\u5c5e\u6027\u4e0a\uff0c\u63d0\u53d6\u5b57\u6bb5\u4e2d\u7684\u5c5e\u6027\u5230\u5f53\u524d\u6a21\u578b\u7528\u6cd5\uff1a\u63d0\u53d6\u8be5\u5c5e\u6027\u4e2d\u7684userId\u503c\u5230\u5f53\u524d\u6a21\u578b\u4e2d\u7684userId\uff1a@ExtractProperty(&quot;userId&quot;)\u63d0\u53d6\u8be5\u5c5e\u6027\u4e2d\u7684userId\u503c\u5230\u5f53\u524d\u6a21\u578b\u4e2d\u7684userId2\uff1a@ExtractProperty(fieldName=&quot;userId&quot;, alias=&quot;userId2&quot;)\u652f\u6301\u591a\u7ea7\u63d0\u53d6\u5230\u5f53\u524d\u6a21\u578b\u4e2d\u7684userId2\uff1a\/**\n * @ExtractProperty(fieldName=&quot;ex.userId&quot;, alias=&quot;userId2&quot;)\n *\/\nprotected $xxx = [\n    'ex'    =&gt;    [\n        'userId'    =&gt;    123,\n    ],\n];\u6a21\u578b\u64cd\u4f5c\u67e5\u8be2\u8bb0\u5f55\u67e5\u8be2\u8bb0\u5f55\u5e76\u8fd4\u56de\u4e00\u4e2a\u6a21\u578b\u5b9e\u4f8b\u3002\/\/ where id = 1\n$testModel = TestModel::find(1);\n\/\/ \u590d\u5408\u4e3b\u952e where a = 1 and a = 'abc'\n$testModel = TestModel::find(1, 'abc');\necho $testModel-&gt;getId();\u6279\u91cf\u67e5\u8be2\u8bb0\u5f55\/\/ \u67e5\u8be2\u6240\u6709\u8bb0\u5f55\n$list = TestModel::select();\n\n\/\/ \u5e26 where \u6761\u4ef6\u7684\u67e5\u8be2\uff0cid = 1\n$list = TestModel::select([\n    'id'    =&gt;    1\n]);\n\n\/\/ where \u56de\u8c03\u6761\u4ef6\n$list = TestModel::select(function(IQuery $query){\n    $query-&gt;where('id', '=', 1);\n});\n\n\/\/ \u67e5\u8be2\u5668\u67e5\u8be2\n$list = TestModel::query()-&gt;where('id', '=', 1)-&gt;select()-&gt;getArray();\n\n\/\/ \u4ee5\u4e0a\u6240\u6709 $list \u90fd\u662f TestModel[] \u7c7b\u578b\u805a\u5408\u51fd\u6570TestModel::count();\nTestModel::sum('id');\u63d2\u5165$testModel = TestModel::newInstance();\n$testModel-&gt;setA('1');\n$testModel-&gt;setB('1');\n$testModel-&gt;setC('1');\n$result = $testModel-&gt;insert();\n\/\/ $result \u7528\u6cd5\u540c\u6570\u636e\u5e93\u4e2d\u7684 insert() \u8fd4\u56de\u503c\u7528\u6cd5\necho '\u63d2\u5165\u7684\u81ea\u589eID\uff1a', $testModel-&gt;getId();\u66f4\u65b0$testModel = TestModel::find(1, 'abc');\n$result = $testModel-&gt;update();\n\/\/ $result \u7528\u6cd5\u540c\u6570\u636e\u5e93\u4e2d\u7684 update() \u8fd4\u56de\u503c\u7528\u6cd5\u6279\u91cf\u66f4\u65b0\/\/ update tb_test set a = 'abc' where id &gt; 5\nTestModel::updateBatch([\n    'a'    =&gt;    'abc',\n], 'id &gt; 5');\u4fdd\u5b58\/\/ \u81ea\u52a8\u5224\u65ad\u662f\u63d2\u5165\u8fd8\u662f\u66f4\u65b0\n$testModel-&gt;save();\u5220\u9664$testModel = TestModel::find(1, 'abc');\n$result = $testModel-&gt;delete();\n\/\/ $result \u7528\u6cd5\u540c\u6570\u636e\u5e93\u4e2d\u7684 delete() \u8fd4\u56de\u503c\u7528\u6cd5\u6279\u91cf\u5220\u9664\/\/ delete tb_test set a = 'abc' where id &gt; 5\nTestModel::deleteBatch([\n    'a'    =&gt;    'abc',\n], 'id &gt; 5');\u67e5\u8be2\u5668$testModel = TestModel::query()-&gt;where()-&gt;join()-&gt;select()-&gt;get();\n\/\/ $testModel \u4f9d\u7136\u662f TestModel \u7c7b\u578b\u521d\u59cb\u5316\u6a21\u578b$testModel = TestModel::newInstance([\n    'a'    =&gt;    'abc',\n    'b'    =&gt;    'def',\n]);\u7b2c\u4e8c\u79cd\u65b9\u6cd5\uff1a$testModel = TestModel::newInstance();\n$testModel-&gt;set([\n    'a'    =&gt;    'abc',\n    'b'    =&gt;    'def',\n]);"},{"id":51,"parent_id":50,"title":"\u4f7f\u7528\u65b9\u6cd5","mdFileName":"components\/orm\/RDModel.md","url":"components\/orm\/RDModel.html","level":3,"content":"\u6570\u636e\u5e93\u6a21\u578b\u4ecb\u7ecd\u4f20\u7edf\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u6a21\u578b\uff0c\u65e5\u5e38\u589e\u5220\u6539\u67e5\u5b8c\u5168\u591f\u7528\uff0c\u652f\u6301\u590d\u5408\u4e3b\u952e\u3001\u8054\u5408\u4e3b\u952e\u3002\u6a21\u578b\u5b9a\u4e49\u559c\u95fb\u4e50\u89c1\u7684\u5bf9\u547d\u540d\u7a7a\u95f4\u3001\u7c7b\u540d\u65e0\u8981\u6c42\uff0c\u53ea\u8981\u6309\u7167\u89c4\u5b9a\u5199\u6ce8\u89e3\u5373\u53ef\uff01@Entity \u6ce8\u89e3\u4e3a\u5b9a\u4e49\u5b9e\u4f53\u7c7b@Table \u6ce8\u89e3\u4e3a\u5b9a\u4e49\u6570\u636e\u8868@Column \u6ce8\u89e3\u4e3a\u5b9a\u4e49\u5b57\u6bb5\u5177\u4f53\u5b9a\u4e49\u770b\u4e0b\u9762\u4ee3\u7801\uff1anamespace Test;\n\nuse Imi\\Model\\Model;\nuse Imi\\Model\\Annotation\\Table;\nuse Imi\\Model\\Annotation\\Column;\nuse Imi\\Model\\Annotation\\Entity;\n\n\/**\n * \u5b9a\u4e49\u4e3a\u5b9e\u4f53\n * @Entity\n * \u6307\u5b9a\u5b9e\u4f53\u4e3atest\uff0c\u590d\u5408\u4e3b\u952eid\u548ca\n * @Table(name=&quot;test&quot;, id={&quot;id&quot;, &quot;a&quot;})\n *\/\nclass Test extends Model\n{\n    \/**\n     * ID\n     * \u5b57\u6bb5id\uff0c\u7c7b\u578bint\uff0c\u957f\u5ea610\uff0c\u662f\u4e3b\u952e\uff0c\u7b2c0\u4e2a\u4e3b\u952e\uff0c\u662f\u81ea\u589e\u5b57\u6bb5\n     * @Column(name=&quot;id&quot;, type=&quot;int&quot;, length=10, isPrimaryKey=true, primaryKeyIndex=0, isAutoIncrement=true)\n     * @var int\n     *\/\n    protected $id;\n\n    \/**\n     * aaa\n     * @Column(name=&quot;a&quot;, type=&quot;string&quot;, length=255, isPrimaryKey=true, primaryKeyIndex=1)\n     * @var string\n     *\/\n    protected $a;\n\n    \/**\n     * bbb\n     * @Column(name=&quot;b&quot;, type=&quot;string&quot;, length=255)\n     * @var string\n     *\/\n    protected $b;\n\n    \/**\n     * ccc\n     * @Column(name=&quot;c&quot;, type=&quot;string&quot;, length=255)\n     * @var string\n     *\/\n    protected $c;\n\n    \/**\n     * Get iD\n     *\n     * @return  int\n     *\/ \n    public function getId()\n    {\n        return $this-&gt;id;\n    }\n\n    \/**\n     * Set iD\n     *\n     * @param  int  $id  ID\n     *\n     * @return  self\n     *\/ \n    public function setId(int $id)\n    {\n        $this-&gt;id = $id;\n\n        return $this;\n    }\n\n    \/**\n     * Get aaa\n     *\n     * @return  string\n     *\/ \n    public function getA()\n    {\n        return $this-&gt;a;\n    }\n\n    \/**\n     * Set aaa\n     *\n     * @param  string  $a  aaa\n     *\n     * @return  self\n     *\/ \n    public function setA(string $a)\n    {\n        $this-&gt;a = $a;\n\n        return $this;\n    }\n\n    \/**\n     * Get bbb\n     *\n     * @return  string\n     *\/ \n    public function getB()\n    {\n        return $this-&gt;b;\n    }\n\n    \/**\n     * Set bbb\n     *\n     * @param  string  $b  bbb\n     *\n     * @return  self\n     *\/ \n    public function setB(string $b)\n    {\n        $this-&gt;b = $b;\n\n        return $this;\n    }\n\n    \/**\n     * Get ccc\n     *\n     * @return  string\n     *\/ \n    public function getC()\n    {\n        return $this-&gt;c;\n    }\n\n    \/**\n     * Set ccc\n     *\n     * @param  string  $c  ccc\n     *\n     * @return  self\n     *\/ \n    public function setC(string $c)\n    {\n        $this-&gt;c = $c;\n\n        return $this;\n    }\n}\u9700\u8981\u4f7f\u7528\u6ce8\u89e3\u5c06\u8868\u3001\u5b57\u6bb5\u5c5e\u6027\u5168\u90e8\u6807\u6ce8\u3002\u5e76\u4e14\u5199\u4e0aget\u548cset\u65b9\u6cd5\uff0c\u53ef\u4ee5\u4f7f\u7528\u6a21\u578b\u751f\u6210\u5de5\u5177\u751f\u6210\u3002\u6a21\u578b\u4e2d\u53ef\u4ee5\u52a0\u5165\u865a\u62df\u5b57\u6bb5\uff0c\u901a\u8fc7\u6ce8\u89e3@Column(virtual=true)\uff0c\u865a\u62df\u5b57\u6bb5\u4e0d\u53c2\u4e0e\u6570\u636e\u5e93\u64cd\u4f5c\u3002\u6a21\u578b\u6ce8\u89e3@Entity\u5199\u5728\u7c7b\u4e0a\uff0c\u5b9a\u4e49\u7c7b\u4e3a\u5b9e\u4f53\u6a21\u578b\u7c7b\u7528\u6cd5\uff1a@Entity\u5e8f\u5217\u5316\u65f6\u4e0d\u4f7f\u7528\u9a7c\u5cf0\u547d\u540d\uff0c\u4f7f\u7528\u539f\u672c\u7684\u5b57\u6bb5\u540d\uff1a@Entity(false)@Table\u5199\u5728\u7c7b\u4e0a\uff0c\u5b9a\u4e49\u6570\u636e\u8868\u7528\u6cd5\uff1a@Table('tb_user')\u6307\u5b9a\u6570\u636e\u5e93\u8fde\u63a5\u6c60\uff1a@Table(name='tb_user', dbPoolName='\u6307\u5b9a\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u540d')\u6307\u5b9a\u4e3b\u952e\uff1a@Table(name='tb_user', id='id')\u6307\u5b9a\u591a\u4e2a\u4e3b\u952e@Table(name='tb_user', id={'id1', 'id2'})@Column\u5199\u5728\u5c5e\u6027\u4e0a\uff0c\u5b9a\u4e49\u5b57\u6bb5\u5217@Column(name=&quot;\u5b57\u6bb5\u540d&quot;, type=&quot;\u5b57\u6bb5\u7c7b\u578b&quot;, length=&quot;\u957f\u5ea6&quot;, nullable=&quot;\u662f\u5426\u5141\u8bb8\u4e3a\u7a7atrue\/false&quot;, accuracy=&quot;\u7cbe\u5ea6\uff0c\u5c0f\u6570\u4f4d\u540e\u51e0\u4f4d&quot;, default=&quot;\u9ed8\u8ba4\u503c&quot;, isPrimaryKey=&quot;\u662f\u5426\u4e3a\u4e3b\u952etrue\/false&quot;, primaryKeyIndex=&quot;\u8054\u5408\u4e3b\u952e\u4e2d\u7684\u7b2c\u51e0\u4e2a\uff0c\u4ece0\u5f00\u59cb&quot;, isAutoIncrement=&quot;\u662f\u5426\u4e3a\u81ea\u589e\u5b57\u6bb5true\/false&quot;, virtual=&quot;\u865a\u62df\u5b57\u6bb5\uff0c\u4e0d\u53c2\u4e0e\u6570\u636e\u5e93\u64cd\u4f5ctrue\/false&quot;)\u5f53\u4f60\u6307\u5b9atype=json\u65f6\uff0c\u5199\u5165\u6570\u636e\u5e93\u65f6\u81ea\u52a8json_encode\uff0c\u4ece\u6570\u636e\u5b9e\u4f8b\u5316\u5230\u5bf9\u8c61\u65f6\u81ea\u52a8json_decode@Serializable\u5199\u5728\u5c5e\u6027\u4e0a\uff0c\u5e8f\u5217\u5316\u6ce8\u89e3\u7528\u6cd5\uff1a\u7981\u6b62\u53c2\u4e0e\u5e8f\u5217\u5316\uff08toArray()\u6216json_encode()\u4e0d\u5305\u542b\u8be5\u5b57\u6bb5\uff09\uff1a@Serializable(false)@Serializables\u5199\u5728\u7c7b\u4e0a\uff0c\u6279\u91cf\u8bbe\u7f6e\u5e8f\u5217\u5316\u6ce8\u89e3\uff0c\u4f18\u5148\u7ea7\u4f4e\u4e8e\u9488\u5bf9\u5c5e\u6027\u5355\u72ec\u8bbe\u7f6e\u7684@Serializable\u6ce8\u89e3\u7528\u6cd5\uff1a\u767d\u540d\u5355\uff08\u5e8f\u5217\u5316\u540e\u53ea\u663e\u793aid\u3001name\u5b57\u6bb5\uff09\uff1a@Serializables(mode=&quot;allow&quot;, fields={&quot;id&quot;, &quot;name&quot;})\u9ed1\u540d\u5355\uff08\u5e8f\u5217\u5316\u540e\uff0c\u6392\u9664id\u3001name\u5b57\u6bb5\uff09@Serializables(mode=&quot;deny&quot;, fields={&quot;id&quot;, &quot;name&quot;})@ExtractProperty\u5199\u5728\u5c5e\u6027\u4e0a\uff0c\u63d0\u53d6\u5b57\u6bb5\u4e2d\u7684\u5c5e\u6027\u5230\u5f53\u524d\u6a21\u578b\u7528\u6cd5\uff1a\u63d0\u53d6\u8be5\u5c5e\u6027\u4e2d\u7684userId\u503c\u5230\u5f53\u524d\u6a21\u578b\u4e2d\u7684userId\uff1a@ExtractProperty(&quot;userId&quot;)\u63d0\u53d6\u8be5\u5c5e\u6027\u4e2d\u7684userId\u503c\u5230\u5f53\u524d\u6a21\u578b\u4e2d\u7684userId2\uff1a@ExtractProperty(fieldName=&quot;userId&quot;, alias=&quot;userId2&quot;)\u652f\u6301\u591a\u7ea7\u63d0\u53d6\u5230\u5f53\u524d\u6a21\u578b\u4e2d\u7684userId2\uff1a\/**\n * @ExtractProperty(fieldName=&quot;ex.userId&quot;, alias=&quot;userId2&quot;)\n *\/\nprotected $xxx = [\n    'ex'    =&gt;    [\n        'userId'    =&gt;    123,\n    ],\n];\u6a21\u578b\u64cd\u4f5c\u67e5\u8be2\u8bb0\u5f55\u67e5\u8be2\u8bb0\u5f55\u5e76\u8fd4\u56de\u4e00\u4e2a\u6a21\u578b\u5b9e\u4f8b\u3002\/\/ where id = 1\n$testModel = TestModel::find(1);\n\/\/ \u590d\u5408\u4e3b\u952e where a = 1 and a = 'abc'\n$testModel = TestModel::find(1, 'abc');\necho $testModel-&gt;getId();\u6279\u91cf\u67e5\u8be2\u8bb0\u5f55\/\/ \u67e5\u8be2\u6240\u6709\u8bb0\u5f55\n$list = TestModel::select();\n\n\/\/ \u5e26 where \u6761\u4ef6\u7684\u67e5\u8be2\uff0cid = 1\n$list = TestModel::select([\n    'id'    =&gt;    1\n]);\n\n\/\/ where \u56de\u8c03\u6761\u4ef6\n$list = TestModel::select(function(IQuery $query){\n    $query-&gt;where('id', '=', 1);\n});\n\n\/\/ \u67e5\u8be2\u5668\u67e5\u8be2\n$list = TestModel::query()-&gt;where('id', '=', 1)-&gt;select()-&gt;getArray();\n\n\/\/ \u4ee5\u4e0a\u6240\u6709 $list \u90fd\u662f TestModel[] \u7c7b\u578b\u805a\u5408\u51fd\u6570TestModel::count();\nTestModel::sum('id');\u63d2\u5165$testModel = TestModel::newInstance();\n$testModel-&gt;setA('1');\n$testModel-&gt;setB('1');\n$testModel-&gt;setC('1');\n$result = $testModel-&gt;insert();\n\/\/ $result \u7528\u6cd5\u540c\u6570\u636e\u5e93\u4e2d\u7684 insert() \u8fd4\u56de\u503c\u7528\u6cd5\necho '\u63d2\u5165\u7684\u81ea\u589eID\uff1a', $testModel-&gt;getId();\u66f4\u65b0$testModel = TestModel::find(1, 'abc');\n$result = $testModel-&gt;update();\n\/\/ $result \u7528\u6cd5\u540c\u6570\u636e\u5e93\u4e2d\u7684 update() \u8fd4\u56de\u503c\u7528\u6cd5\u6279\u91cf\u66f4\u65b0\/\/ update tb_test set a = 'abc' where id &gt; 5\nTestModel::updateBatch([\n    'a'    =&gt;    'abc',\n], 'id &gt; 5');\u4fdd\u5b58\/\/ \u81ea\u52a8\u5224\u65ad\u662f\u63d2\u5165\u8fd8\u662f\u66f4\u65b0\n$testModel-&gt;save();\u5220\u9664$testModel = TestModel::find(1, 'abc');\n$result = $testModel-&gt;delete();\n\/\/ $result \u7528\u6cd5\u540c\u6570\u636e\u5e93\u4e2d\u7684 delete() \u8fd4\u56de\u503c\u7528\u6cd5\u6279\u91cf\u5220\u9664\/\/ delete tb_test set a = 'abc' where id &gt; 5\nTestModel::deleteBatch([\n    'a'    =&gt;    'abc',\n], 'id &gt; 5');\u67e5\u8be2\u5668$testModel = TestModel::query()-&gt;where()-&gt;join()-&gt;select()-&gt;get();\n\/\/ $testModel \u4f9d\u7136\u662f TestModel \u7c7b\u578b\u521d\u59cb\u5316\u6a21\u578b$testModel = TestModel::newInstance([\n    'a'    =&gt;    'abc',\n    'b'    =&gt;    'def',\n]);\u7b2c\u4e8c\u79cd\u65b9\u6cd5\uff1a$testModel = TestModel::newInstance();\n$testModel-&gt;set([\n    'a'    =&gt;    'abc',\n    'b'    =&gt;    'def',\n]);"},{"id":52,"parent_id":50,"title":"\u6a21\u578b\u4e8b\u4ef6","mdFileName":"components\/orm\/RDModel\/event.md","url":"components\/orm\/RDModel\/event.html","level":3,"content":"\u6a21\u578b\u4e8b\u4ef6\u4e8b\u4ef6\u5217\u8868\u4e8b\u4ef6\u540d\u5e38\u91cf\u63cf\u8ff0BeforeFindModelEvents::BEFORE_FIND\u67e5\u627e\u524d\uff0cModel::find()\u89e6\u53d1AfterFindModelEvents::AFTER_FIND\u67e5\u627e\u540e\uff0cModel::find()\u89e6\u53d1BeforeSelectModelEvents::BEFORE_SELECT\u67e5\u8be2\u524d\uff0cModel::select()\u89e6\u53d1AfterSelectModelEvents::AFTER_SELECT\u67e5\u8be2\u540e\uff0cModel::select()\u89e6\u53d1BeforeInitModelEvents::BEFORE_INIT\u521d\u59cb\u5316\u503c\u524d\uff0cnewInstance()\u89e6\u53d1AfterInitModelEvents::AFTER_INIT\u521d\u59cb\u5316\u503c\u540e\uff0cnewInstance()\u89e6\u53d1BeforeInsertModelEvents::BEFORE_INSERT\u63d2\u5165\u524d\uff0cinsert()\/save()\u89e6\u53d1AfterInsertModelEvents::AFTER_INSERT\u63d2\u5165\u540e\uff0cinsert()\/save()\u89e6\u53d1BeforeUpdateModelEvents::BEFORE_UPDATE\u66f4\u65b0\u524d\uff0cupdate()\/save()\u89e6\u53d1AfterUpdateModelEvents::AFTER_UPDATE\u66f4\u65b0\u540e\uff0cupdate()\/save()\u89e6\u53d1BeforeDeleteModelEvents::BEFORE_DELETE\u5220\u9664\u524d\uff0cdelete()\u89e6\u53d1AfterDeleteModelEvents::AFTER_DELETE\u5220\u9664\u540e\uff0cdelete()\u89e6\u53d1BeforeSaveModelEvents::BEFORE_SAVE\u4fdd\u5b58\u524d\uff0c\u5148\u4e8e\u63d2\u5165\u524d\u548c\u66f4\u65b0\u524d\u89e6\u53d1AfterSaveModelEvents::AFTER_SAVE\u4fdd\u5b58\u540e\uff0c\u540e\u4e8e\u63d2\u5165\u540e\u548c\u66f4\u65b0\u540e\u89e6\u53d1BeforeBatchUpdateModelEvents::BEFORE_BATCH_UPDATE\u6279\u91cf\u66f4\u65b0\u524dAfterBatchUpdateModelEvents::AFTER_BATCH_UPDATE\u6279\u91cf\u66f4\u65b0\u540eBeforeBatchDeleteModelEvents::BEFORE_BATCH_DELETE\u6279\u91cf\u5220\u9664\u524dAfterBatchDeleteModelEvents::AFTER_BATCH_DELETE\u6279\u91cf\u5220\u9664\u540eAfterQueryModelEvents::AFTER_QUERY\u53ea\u8981\u6700\u7ec8\u67e5\u8be2\u51fa\u8be5\u6a21\u578b\u5c31\u4f1a\u89e6\u53d1BeforeParseDataModelEvents::BEFORE_PARSE_DATA\u5904\u7406 save\u3001insert\u3001update \u6570\u636e\u524dAfterParseDataModelEvents::AFTER_PARSE_DATA\u5904\u7406 save\u3001insert\u3001update \u6570\u636e\u540e\u4e8b\u4ef6\u4f20\u9012\u8fc7\u6765\u7684\u53c2\u6570\u7c7b\u578b\u4e3aImi\\Model\\Event\\Param\\\u4e8b\u4ef6\u540dEventParamBeforeInit\u548cAfterInit\u662f\u4f8b\u5916\uff0c\u5171\u7528Imi\\Model\\Event\\Param\\InitEventParam\u7c7b\u4e8b\u4ef6\u76d1\u542c\u4e8b\u4ef6\u76d1\u542c\u5206\u4e24\u79cd\uff0c\u4e00\u79cd\u662f\u4ec5\u9650\u4e8e\u5bf9\u8c61\u7684\u4e8b\u4ef6\uff0c\u53e6\u4e00\u79cd\u662f\u9759\u6001\u65b9\u6cd5\u89e6\u53d1\u7684\u4e8b\u4ef6\uff08\u6279\u91cf\u64cd\u4f5c\uff09\u3002\u76d1\u542c\u65b9\u5f0f\u5206\u4e24\u79cd\uff1a1\u3001\u5728\u7c7b\u91cc\u5199\u76d1\u542c\u4ee3\u7801\uff1b2\u3001\u5b9a\u4e49\u76d1\u542c\u7c7b\u6279\u91cf\u64cd\u4f5c\u7684\u4e8b\u4ef6\u76d1\u542c\uff0c\u4e00\u822c\u5efa\u8bae\u7528\u76d1\u542c\u7c7b\u65b9\u5f0f\u3002\u5bf9\u8c61\u7684\u4e8b\u4ef6\u76d1\u542c\u6839\u636e\u4e60\u60ef\u9009\u62e9\u5373\u53ef\u3002\u5bf9\u8c61\u4e8b\u4ef6\u76d1\u542c\u65b9\u6cd51-\u76d1\u542c\u4ee3\u7801\/**\n * Test\n * @Entity\n * @Table(name=&quot;tb_test&quot;, id={&quot;id&quot;, &quot;a&quot;})\n *\/\nclass Test extends Model\n{\n    public function __init($data = [])\n    {\n        $this-&gt;on(ModelEvents::AFTER_INIT, [$this, 'onAfterInit']);\n        parent::__init($data);\n    }\n\n    public function onAfterInit(\\Imi\\Model\\Event\\Param\\InitEventParam $data)\n    {\n        var_dump($data-&gt;data);\n    }\n}\u5bf9\u8c61\u4e8b\u4ef6\u76d1\u542c\u65b9\u6cd52-\u5b9a\u4e49\u76d1\u542c\u7c7b&lt;?php\nnamespace XXX\\ModelEvent\\Logs;\n\nuse Imi\\Bean\\Annotation\\ClassEventListener;\nuse Imi\\Model\\Event\\Param\\BeforeInsertEventParam;\nuse Imi\\Model\\Event\\Listener\\IBeforeInsertEventListener;\n\n\/**\n * \u63d2\u5165\u524d\u5904\u7406\n * @ClassEventListener(className=&quot;\\XXX\\Model\\Test&quot;,eventName=\\Imi\\Model\\Event\\ModelEvents::BEFORE_INSERT)\n *\/\nclass BeforeInsert implements IBeforeInsertEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5\n     * @param BeforeInsertEventParam $e\n     * @return void\n     *\/\n    public function handle(BeforeInsertEventParam $e)\n    {\n        $e-&gt;data-&gt;data = json_encode($e-&gt;data-&gt;data);\n        $e-&gt;data-&gt;ip = inet_pton($e-&gt;data-&gt;ip);\n    }\n}\u6279\u91cf\u64cd\u4f5c\u4e8b\u4ef6\u76d1\u542c\u4e8b\u4ef6\u540d\u79f0\u4e3a\u6a21\u578b\u7c7b\u540d:\u4e8b\u4ef6\u540d\uff0c\u5982\uff1aXXX\\Model\\TestBefore+BatchUpdate=XXX\\Model\\Test:BeforeBatchUpdate&lt;?php\nnamespace XXX\\Listener;\n\nuse Imi\\Model\\Event\\Param\\BeforeBatchUpdateEventParam;\nuse Imi\\Model\\Event\\Listener\\IBeforeBatchUpdateEventListener;\n\n\/**\n * @Listener(&quot;XXX\\Model\\TestBeforeBatchUpdate&quot;)\n *\/\nclass BeforeBatchUpdate implements IBeforeBatchUpdateEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5\n     * @param BeforeBatchUpdateEventParam $e\n     * @return void\n     *\/\n    public function handle(BeforeBatchUpdateEventParam $e)\n    {\n        \/\/ $e-&gt;data-&gt;name = '123'; \/\/ \u5728\u66f4\u65b0\u524d\u53ef\u4ee5\u5bf9\u6570\u636e\u8d4b\u503c\n    }\n}\n"},{"id":53,"parent_id":48,"title":"\u6a21\u578b\u5173\u8054","mdFileName":"components\/orm\/relation\/index.md","url":"components\/orm\/relation\/index.html","level":2,"content":"\u4ecb\u7ecd\u901a\u8fc7\u9884\u5148\u786e\u5b9a\u597d\u6a21\u578b\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u5728\u4e1a\u52a1\u5f00\u53d1\u4e2d\uff0c\u4f7f\u7528\u975e\u5e38\u7b80\u4fbf\u7684\u5199\u6cd5\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u590d\u6742\u7684\u6d89\u53ca\u591a\u8868\u6570\u636e\u589e\u5220\u6539\u67e5\u3002\u8fd9\u4e00\u5207\u90fd\u662f\u6a21\u578b\u5e95\u5c42\u5b9e\u73b0\u5e2e\u4f60\u5728\u5904\u7406\uff0c\u5728 imi \u4e2d\uff0c\u6a21\u578b\u7684\u5173\u8054\u5173\u7cfb\u90fd\u4f7f\u7528\u6ce8\u89e3\u6765\u5b9a\u4e49\u3002\u6ce8\u89e3\u8fd9\u91cc\u5217\u51fa\u5b9a\u4e49\u6a21\u578b\u5173\u8054\u5173\u7cfb\u6240\u9700\u7684\u6ce8\u89e3\uff0c\u6240\u6709\u5173\u8054\u6a21\u578b\u7684\u6ce8\u89e3\uff0c\u547d\u540d\u7a7a\u95f4\u4e3aImi\\Model\\Annotation\\Relation@OneToOne\u4e00\u5bf9\u4e00\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@OneToOne(&quot;\u6a21\u578b\u7c7b\u540d&quot;)@OneToOne(model=&quot;\u6a21\u578b\u7c7b\u540d&quot;)@OneToMany\u4e00\u5bf9\u591a\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@OneToMany(&quot;\u6a21\u578b\u7c7b\u540d&quot;)@OneToMany(model=&quot;\u6a21\u578b\u7c7b\u540d&quot;)@ManyToMany\u591a\u5bf9\u591a\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@ManyToMany(model=&quot;\u5173\u8054\u6a21\u578b&quot;, middle=&quot;\u4e2d\u95f4\u6a21\u578b\u7c7b\u540d&quot;, rightMany=&quot;\u5c5e\u6027\u540d\uff0c\u8d4b\u503c\u4e3a\u5173\u8054\u7684\u6a21\u578b\u5bf9\u8c61\u5217\u8868&quot;)@PolymorphicOneToOne\u591a\u6001\u4e00\u5bf9\u4e00\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@PolymorphicOneToOne(model=&quot;\u5173\u8054\u6a21\u578b&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;)@PolymorphicOneToMany\u591a\u6001\u4e00\u5bf9\u591a\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@PolymorphicOneToMany(model=&quot;\u5173\u8054\u6a21\u578b&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;)@PolymorphicManyToMany\u591a\u6001\u591a\u5bf9\u591a\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@PolymorphicManyToMany(model=&quot;\u5173\u8054\u6a21\u578b&quot;, middle=&quot;\u4e2d\u95f4\u6a21\u578b\u7c7b\u540d&quot;, rightMany=&quot;\u5c5e\u6027\u540d\uff0c\u8d4b\u503c\u4e3a\u5173\u8054\u7684\u6a21\u578b\u5bf9\u8c61\u5217\u8868&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;)@PolymorphicToOne\u7528\u4e8e\u591a\u6001\u4e00\u5bf9\u4e00\u3001\u4e00\u5bf9\u591a\u5173\u8054\u88ab\u5173\u8054\u7684\u6a21\u578b\u4e2d\u4f7f\u7528\uff0c\u67e5\u8be2\u5bf9\u5e94\u7684\u5de6\u4fa7\u6a21\u578b\u5141\u8bb8\u51fa\u73b0\u591a\u4e2a\uff0c\u4f1a\u6839\u636etype\u548ctypeValue\u5224\u65ad\uff0c\u9009\u62e9\u5408\u9002\u7684\u6ce8\u89e3\u914d\u7f6e\u67e5\u8be2\u6a21\u578b\u3002\u7528\u6cd5\uff1a@PolymorphicToOne(model=&quot;\u5173\u8054\u6a21\u578b&quot;, modelField=&quot;\u5173\u8054\u7684\u6a21\u578b\u7528\u4e8e\u5173\u8054\u7684\u5b57\u6bb5&quot;, field=&quot;\u5f53\u524d\u6a21\u578b\u7528\u4e8e\u5173\u8054\u7684\u5b57\u6bb5&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;)@PolymorphicToMany\u7528\u4e8e\u591a\u6001\u591a\u5bf9\u591a\u5173\u8054\u88ab\u5173\u8054\u7684\u6a21\u578b\u4e2d\u4f7f\u7528\uff0c\u67e5\u8be2\u5bf9\u5e94\u7684\u5de6\u4fa7\u6a21\u578b\u5217\u8868\u9700\u8981\u548c@JoinToMiddle\u3001@JoinFromMiddle\u914d\u5408\u4f7f\u7528\u4e0d\u5141\u8bb8\u51fa\u73b0\u591a\u4e2a\uff01\u7528\u6cd5\uff1a@PolymorphicToMany(model=&quot;\u5173\u8054\u6a21\u578b&quot;, modelField=&quot;\u5173\u8054\u7684\u6a21\u578b\u7528\u4e8e\u5173\u8054\u7684\u5b57\u6bb5&quot;, field=&quot;\u5f53\u524d\u6a21\u578b\u7528\u4e8e\u5173\u8054\u7684\u5b57\u6bb5&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;)@JoinFrom\u4e00\u5bf9\u4e00\u3001\u4e00\u5bf9\u591a\u58f0\u660e\u4e2d\uff0c\u6307\u5b9a\u5de6\u8868\u4e0e\u53f3\u8868\u5173\u8054\u7528\u7684\u5b57\u6bb5\u540d\u7528\u6cd5\uff1a@JoinFrom(&quot;\u5b57\u6bb5\u540d&quot;)@JoinFrom(field=&quot;\u5b57\u6bb5\u540d&quot;)@JoinTo\u4e00\u5bf9\u4e00\u3001\u4e00\u5bf9\u591a\u58f0\u660e\u4e2d\uff0c\u6307\u5b9a\u53f3\u8868\u4e0e\u5de6\u8868\u5173\u8054\u7528\u7684\u5b57\u6bb5\u540d\u7528\u6cd5\uff1a@JoinTo(&quot;\u5b57\u6bb5\u540d&quot;)@JoinTo(field=&quot;\u5b57\u6bb5\u540d&quot;)@JoinToMiddle\u591a\u5bf9\u591a\u58f0\u660e\u4e2d\uff0c\u6307\u5b9a\u5de6\u4fa7\u6a21\u578b\u5173\u8054\u5230\u4e2d\u95f4\u8868\u6a21\u578b\u7528\u6cd5\uff1a@JoinToMiddle(field=&quot;\u5de6\u4fa7\u5173\u8054\u5b57\u6bb5&quot;, middleField=&quot;\u4e2d\u95f4\u8868\u5173\u8054\u5b57\u6bb5&quot;)@JoinFromMiddle\u591a\u5bf9\u591a\u58f0\u660e\u4e2d\uff0c\u6307\u5b9a\u4e2d\u95f4\u8868\u6a21\u578b\u5173\u8054\u5230\u53f3\u4fa7\u6a21\u578b\u7528\u6cd5\uff1a@JoinFromMiddle(field=&quot;\u53f3\u4fa7\u5173\u8054\u5b57\u6bb5&quot;, middleField=&quot;\u4e2d\u95f4\u8868\u5173\u8054\u5b57\u6bb5&quot;)@AutoSelect\u6307\u5b9a\u6a21\u578b\u67e5\u8be2\uff08find\u3001select\uff09\u65f6\uff0c\u8be5\u5173\u8054\u5c5e\u6027\u662f\u5426\u81ea\u52a8\u67e5\u8be2\u51fa\u5173\u8054\u6570\u636e\u3002\u4e0d\u5199\u8be5\u6ce8\u89e3\uff0c\u6216\u4e0d\u6307\u5b9a\u503c\u9ed8\u8ba4\u4e3atrue\u7528\u6cd5\uff1a@AutoSelect@AutoSelect(true)\u662f\u5426\u603b\u662f\u663e\u793a\u8be5\u5c5e\u6027\uff0c\u5982\u679c\u4e3afalse\uff0c\u5728\u4e3anull\u65f6\u5e8f\u5217\u5316\u4e3a\u6570\u7ec4\u6216json\u4e0d\u663e\u793a\u8be5\u5c5e\u6027\u3002\u9ed8\u8ba4\u4e3atrue@AutoSelect(alwaysShow=false)@AutoInsert\u6307\u5b9a\u6a21\u578b\u63d2\u5165\uff08insert\u3001save\uff09\u65f6\uff0c\u8be5\u5173\u8054\u5c5e\u6027\u662f\u5426\u81ea\u52a8\u63d2\u5165\u5173\u8054\u6570\u636e\u3002\u4e0d\u6307\u5b9a\u503c\u9ed8\u8ba4\u4e3atrue\u7528\u6cd5\uff1a@AutoInsert@AutoInsert(true)@AutoInsert(false)@AutoUpdate\u6307\u5b9a\u6a21\u578b\u66f4\u65b0\uff08update\u3001save\uff09\u65f6\uff0c\u8be5\u5173\u8054\u5c5e\u6027\u662f\u5426\u81ea\u52a8\u66f4\u65b0\u5173\u8054\u6570\u636e\u3002\u4e0d\u6307\u5b9a\u503c\u9ed8\u8ba4\u4e3atrue\u5f53orphanRemoval\u4e3atrue\u65f6\uff0c\u4f1a\u628a\u4e0d\u5305\u542b\u5728\u6a21\u578b\u91cc\u7684\u5173\u8054\u6570\u636e\u5220\u9664\u540e\u518d\u66f4\u65b0\u3001\u63d2\u5165\u5173\u8054\u6570\u636e\u3002\u7528\u6cd5\uff1a@AutoUpdate@AutoUpdate(true)@AutoUpdate(false)@AutoUpdate(orphanRemoval=true)@AutoSave\u6307\u5b9a\u6a21\u578b\u4fdd\u5b58\uff08save\uff09\u65f6\uff0c\u8be5\u5173\u8054\u5c5e\u6027\u662f\u5426\u81ea\u52a8\u4fdd\u5b58\u5173\u8054\u6570\u636e\u3002\u4e0d\u6307\u5b9a\u503c\u9ed8\u8ba4\u4e3atrue\u5f53orphanRemoval\u4e3atrue\u65f6\uff0c\u4f1a\u628a\u4e0d\u5305\u542b\u5728\u6a21\u578b\u91cc\u7684\u5173\u8054\u6570\u636e\u5220\u9664\u540e\u518d\u66f4\u65b0\u3001\u63d2\u5165\u5173\u8054\u6570\u636e\u3002\u7528\u6cd5\uff1a@AutoSave@AutoSave(true)@AutoSave(false)@AutoSave(orphanRemoval=true)@AutoDelete\u6307\u5b9a\u6a21\u578b\u5220\u9664\uff08delete\uff09\u65f6\uff0c\u8be5\u5173\u8054\u5c5e\u6027\u662f\u5426\u81ea\u52a8\u5220\u9664\u5173\u8054\u6570\u636e\u3002\u4e0d\u6307\u5b9a\u503c\u9ed8\u8ba4\u4e3atrue\u7528\u6cd5\uff1a@AutoDelete@AutoDelete(true)@AutoDelete(false)\u65b9\u6cd5\u67e5\u8be2\u6307\u5b9a\u5173\u8054\u4f7f\u7528\u5173\u8054\u6a21\u578b\u65f6\uff0c\u4f60\u53ef\u4ee5\u8bbe\u7f6e\u6ce8\u89e3@AutoSelect(false)\uff0c\u8ba9\u5b83\u4e0d\u81ea\u52a8\u67e5\u8be2\u3002\u5728\u4e4b\u540e\u60f3\u8981\u7528\u5230\u7684\u65f6\u5019\uff0c\u518d\u624b\u52a8\u67e5\u8be2\u3002$model-&gt;queryRelations('\u5c5e\u6027\u540d');\n\n\/\/ \u4e5f\u53ef\u4ee5\u652f\u6301\u591a\u4e2a\n$model-&gt;queryRelations('\u5c5e\u6027\u540d1', '\u5c5e\u6027\u540d2');\n\n\/\/ \u67e5\u8be2\u540e\u53ef\u4ee5\u8fd9\u4e48\u83b7\u53d6\u7ed3\u679c\n$data = $model-&gt;\u5c5e\u6027\u540d;"},{"id":54,"parent_id":53,"title":"\u4f7f\u7528\u8bf4\u660e","mdFileName":"components\/orm\/relation\/index.md","url":"components\/orm\/relation\/index.html","level":3,"content":"\u4ecb\u7ecd\u901a\u8fc7\u9884\u5148\u786e\u5b9a\u597d\u6a21\u578b\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u5728\u4e1a\u52a1\u5f00\u53d1\u4e2d\uff0c\u4f7f\u7528\u975e\u5e38\u7b80\u4fbf\u7684\u5199\u6cd5\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u590d\u6742\u7684\u6d89\u53ca\u591a\u8868\u6570\u636e\u589e\u5220\u6539\u67e5\u3002\u8fd9\u4e00\u5207\u90fd\u662f\u6a21\u578b\u5e95\u5c42\u5b9e\u73b0\u5e2e\u4f60\u5728\u5904\u7406\uff0c\u5728 imi \u4e2d\uff0c\u6a21\u578b\u7684\u5173\u8054\u5173\u7cfb\u90fd\u4f7f\u7528\u6ce8\u89e3\u6765\u5b9a\u4e49\u3002\u6ce8\u89e3\u8fd9\u91cc\u5217\u51fa\u5b9a\u4e49\u6a21\u578b\u5173\u8054\u5173\u7cfb\u6240\u9700\u7684\u6ce8\u89e3\uff0c\u6240\u6709\u5173\u8054\u6a21\u578b\u7684\u6ce8\u89e3\uff0c\u547d\u540d\u7a7a\u95f4\u4e3aImi\\Model\\Annotation\\Relation@OneToOne\u4e00\u5bf9\u4e00\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@OneToOne(&quot;\u6a21\u578b\u7c7b\u540d&quot;)@OneToOne(model=&quot;\u6a21\u578b\u7c7b\u540d&quot;)@OneToMany\u4e00\u5bf9\u591a\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@OneToMany(&quot;\u6a21\u578b\u7c7b\u540d&quot;)@OneToMany(model=&quot;\u6a21\u578b\u7c7b\u540d&quot;)@ManyToMany\u591a\u5bf9\u591a\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@ManyToMany(model=&quot;\u5173\u8054\u6a21\u578b&quot;, middle=&quot;\u4e2d\u95f4\u6a21\u578b\u7c7b\u540d&quot;, rightMany=&quot;\u5c5e\u6027\u540d\uff0c\u8d4b\u503c\u4e3a\u5173\u8054\u7684\u6a21\u578b\u5bf9\u8c61\u5217\u8868&quot;)@PolymorphicOneToOne\u591a\u6001\u4e00\u5bf9\u4e00\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@PolymorphicOneToOne(model=&quot;\u5173\u8054\u6a21\u578b&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;)@PolymorphicOneToMany\u591a\u6001\u4e00\u5bf9\u591a\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@PolymorphicOneToMany(model=&quot;\u5173\u8054\u6a21\u578b&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;)@PolymorphicManyToMany\u591a\u6001\u591a\u5bf9\u591a\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@PolymorphicManyToMany(model=&quot;\u5173\u8054\u6a21\u578b&quot;, middle=&quot;\u4e2d\u95f4\u6a21\u578b\u7c7b\u540d&quot;, rightMany=&quot;\u5c5e\u6027\u540d\uff0c\u8d4b\u503c\u4e3a\u5173\u8054\u7684\u6a21\u578b\u5bf9\u8c61\u5217\u8868&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;)@PolymorphicToOne\u7528\u4e8e\u591a\u6001\u4e00\u5bf9\u4e00\u3001\u4e00\u5bf9\u591a\u5173\u8054\u88ab\u5173\u8054\u7684\u6a21\u578b\u4e2d\u4f7f\u7528\uff0c\u67e5\u8be2\u5bf9\u5e94\u7684\u5de6\u4fa7\u6a21\u578b\u5141\u8bb8\u51fa\u73b0\u591a\u4e2a\uff0c\u4f1a\u6839\u636etype\u548ctypeValue\u5224\u65ad\uff0c\u9009\u62e9\u5408\u9002\u7684\u6ce8\u89e3\u914d\u7f6e\u67e5\u8be2\u6a21\u578b\u3002\u7528\u6cd5\uff1a@PolymorphicToOne(model=&quot;\u5173\u8054\u6a21\u578b&quot;, modelField=&quot;\u5173\u8054\u7684\u6a21\u578b\u7528\u4e8e\u5173\u8054\u7684\u5b57\u6bb5&quot;, field=&quot;\u5f53\u524d\u6a21\u578b\u7528\u4e8e\u5173\u8054\u7684\u5b57\u6bb5&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;)@PolymorphicToMany\u7528\u4e8e\u591a\u6001\u591a\u5bf9\u591a\u5173\u8054\u88ab\u5173\u8054\u7684\u6a21\u578b\u4e2d\u4f7f\u7528\uff0c\u67e5\u8be2\u5bf9\u5e94\u7684\u5de6\u4fa7\u6a21\u578b\u5217\u8868\u9700\u8981\u548c@JoinToMiddle\u3001@JoinFromMiddle\u914d\u5408\u4f7f\u7528\u4e0d\u5141\u8bb8\u51fa\u73b0\u591a\u4e2a\uff01\u7528\u6cd5\uff1a@PolymorphicToMany(model=&quot;\u5173\u8054\u6a21\u578b&quot;, modelField=&quot;\u5173\u8054\u7684\u6a21\u578b\u7528\u4e8e\u5173\u8054\u7684\u5b57\u6bb5&quot;, field=&quot;\u5f53\u524d\u6a21\u578b\u7528\u4e8e\u5173\u8054\u7684\u5b57\u6bb5&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;)@JoinFrom\u4e00\u5bf9\u4e00\u3001\u4e00\u5bf9\u591a\u58f0\u660e\u4e2d\uff0c\u6307\u5b9a\u5de6\u8868\u4e0e\u53f3\u8868\u5173\u8054\u7528\u7684\u5b57\u6bb5\u540d\u7528\u6cd5\uff1a@JoinFrom(&quot;\u5b57\u6bb5\u540d&quot;)@JoinFrom(field=&quot;\u5b57\u6bb5\u540d&quot;)@JoinTo\u4e00\u5bf9\u4e00\u3001\u4e00\u5bf9\u591a\u58f0\u660e\u4e2d\uff0c\u6307\u5b9a\u53f3\u8868\u4e0e\u5de6\u8868\u5173\u8054\u7528\u7684\u5b57\u6bb5\u540d\u7528\u6cd5\uff1a@JoinTo(&quot;\u5b57\u6bb5\u540d&quot;)@JoinTo(field=&quot;\u5b57\u6bb5\u540d&quot;)@JoinToMiddle\u591a\u5bf9\u591a\u58f0\u660e\u4e2d\uff0c\u6307\u5b9a\u5de6\u4fa7\u6a21\u578b\u5173\u8054\u5230\u4e2d\u95f4\u8868\u6a21\u578b\u7528\u6cd5\uff1a@JoinToMiddle(field=&quot;\u5de6\u4fa7\u5173\u8054\u5b57\u6bb5&quot;, middleField=&quot;\u4e2d\u95f4\u8868\u5173\u8054\u5b57\u6bb5&quot;)@JoinFromMiddle\u591a\u5bf9\u591a\u58f0\u660e\u4e2d\uff0c\u6307\u5b9a\u4e2d\u95f4\u8868\u6a21\u578b\u5173\u8054\u5230\u53f3\u4fa7\u6a21\u578b\u7528\u6cd5\uff1a@JoinFromMiddle(field=&quot;\u53f3\u4fa7\u5173\u8054\u5b57\u6bb5&quot;, middleField=&quot;\u4e2d\u95f4\u8868\u5173\u8054\u5b57\u6bb5&quot;)@AutoSelect\u6307\u5b9a\u6a21\u578b\u67e5\u8be2\uff08find\u3001select\uff09\u65f6\uff0c\u8be5\u5173\u8054\u5c5e\u6027\u662f\u5426\u81ea\u52a8\u67e5\u8be2\u51fa\u5173\u8054\u6570\u636e\u3002\u4e0d\u5199\u8be5\u6ce8\u89e3\uff0c\u6216\u4e0d\u6307\u5b9a\u503c\u9ed8\u8ba4\u4e3atrue\u7528\u6cd5\uff1a@AutoSelect@AutoSelect(true)\u662f\u5426\u603b\u662f\u663e\u793a\u8be5\u5c5e\u6027\uff0c\u5982\u679c\u4e3afalse\uff0c\u5728\u4e3anull\u65f6\u5e8f\u5217\u5316\u4e3a\u6570\u7ec4\u6216json\u4e0d\u663e\u793a\u8be5\u5c5e\u6027\u3002\u9ed8\u8ba4\u4e3atrue@AutoSelect(alwaysShow=false)@AutoInsert\u6307\u5b9a\u6a21\u578b\u63d2\u5165\uff08insert\u3001save\uff09\u65f6\uff0c\u8be5\u5173\u8054\u5c5e\u6027\u662f\u5426\u81ea\u52a8\u63d2\u5165\u5173\u8054\u6570\u636e\u3002\u4e0d\u6307\u5b9a\u503c\u9ed8\u8ba4\u4e3atrue\u7528\u6cd5\uff1a@AutoInsert@AutoInsert(true)@AutoInsert(false)@AutoUpdate\u6307\u5b9a\u6a21\u578b\u66f4\u65b0\uff08update\u3001save\uff09\u65f6\uff0c\u8be5\u5173\u8054\u5c5e\u6027\u662f\u5426\u81ea\u52a8\u66f4\u65b0\u5173\u8054\u6570\u636e\u3002\u4e0d\u6307\u5b9a\u503c\u9ed8\u8ba4\u4e3atrue\u5f53orphanRemoval\u4e3atrue\u65f6\uff0c\u4f1a\u628a\u4e0d\u5305\u542b\u5728\u6a21\u578b\u91cc\u7684\u5173\u8054\u6570\u636e\u5220\u9664\u540e\u518d\u66f4\u65b0\u3001\u63d2\u5165\u5173\u8054\u6570\u636e\u3002\u7528\u6cd5\uff1a@AutoUpdate@AutoUpdate(true)@AutoUpdate(false)@AutoUpdate(orphanRemoval=true)@AutoSave\u6307\u5b9a\u6a21\u578b\u4fdd\u5b58\uff08save\uff09\u65f6\uff0c\u8be5\u5173\u8054\u5c5e\u6027\u662f\u5426\u81ea\u52a8\u4fdd\u5b58\u5173\u8054\u6570\u636e\u3002\u4e0d\u6307\u5b9a\u503c\u9ed8\u8ba4\u4e3atrue\u5f53orphanRemoval\u4e3atrue\u65f6\uff0c\u4f1a\u628a\u4e0d\u5305\u542b\u5728\u6a21\u578b\u91cc\u7684\u5173\u8054\u6570\u636e\u5220\u9664\u540e\u518d\u66f4\u65b0\u3001\u63d2\u5165\u5173\u8054\u6570\u636e\u3002\u7528\u6cd5\uff1a@AutoSave@AutoSave(true)@AutoSave(false)@AutoSave(orphanRemoval=true)@AutoDelete\u6307\u5b9a\u6a21\u578b\u5220\u9664\uff08delete\uff09\u65f6\uff0c\u8be5\u5173\u8054\u5c5e\u6027\u662f\u5426\u81ea\u52a8\u5220\u9664\u5173\u8054\u6570\u636e\u3002\u4e0d\u6307\u5b9a\u503c\u9ed8\u8ba4\u4e3atrue\u7528\u6cd5\uff1a@AutoDelete@AutoDelete(true)@AutoDelete(false)\u65b9\u6cd5\u67e5\u8be2\u6307\u5b9a\u5173\u8054\u4f7f\u7528\u5173\u8054\u6a21\u578b\u65f6\uff0c\u4f60\u53ef\u4ee5\u8bbe\u7f6e\u6ce8\u89e3@AutoSelect(false)\uff0c\u8ba9\u5b83\u4e0d\u81ea\u52a8\u67e5\u8be2\u3002\u5728\u4e4b\u540e\u60f3\u8981\u7528\u5230\u7684\u65f6\u5019\uff0c\u518d\u624b\u52a8\u67e5\u8be2\u3002$model-&gt;queryRelations('\u5c5e\u6027\u540d');\n\n\/\/ \u4e5f\u53ef\u4ee5\u652f\u6301\u591a\u4e2a\n$model-&gt;queryRelations('\u5c5e\u6027\u540d1', '\u5c5e\u6027\u540d2');\n\n\/\/ \u67e5\u8be2\u540e\u53ef\u4ee5\u8fd9\u4e48\u83b7\u53d6\u7ed3\u679c\n$data = $model-&gt;\u5c5e\u6027\u540d;"},{"id":55,"parent_id":53,"title":"\u4e00\u5bf9\u4e00\u5173\u8054","mdFileName":"components\/orm\/relation\/oneToOne.md","url":"components\/orm\/relation\/oneToOne.html","level":3,"content":"\u4e00\u5bf9\u4e00\u5173\u8054\u6bd4\u5982\u6211\u4eec\u6709\u4e00\u4e2a\u7528\u6237\u8868\uff0c\u53e6\u5916\u6709\u4e00\u4e2a\u4e2a\u4eba\u8d44\u6599\u8868\uff0c\u4ed6\u4eec\u4e4b\u95f4\u7684\u5173\u8054\u5c31\u662f\u4e00\u5bf9\u4e00\u7684\u5173\u7cfb\u3002\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5b9a\u4e49\u4e00\u5bf9\u4e00\u5173\u8054\u4f1a\u7528\u5230\u7684\u6ce8\u89e3\uff1a@OneToOne\u3001@JoinFrom\u3001@JoinTo\u3001@AutoSelect\u3001@AutoInsert\u3001@AutoUpdate\u3001@AutoSave\u3001@AutoDelete\u5982 imi-demo \u4e2d\u4ee3\u7801\u6240\u793a\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2a$ex\u5c5e\u6027\uff0c\u8fd9\u4e2a\u5c5e\u6027\u5173\u8054UserEx\u6a21\u578b\u3002User\u4e2did\u4e0eUserEx\u4e2duser_id\u5173\u8054\u3002\u5141\u8bb8\u81ea\u52a8\u67e5\u8be2\u3001\u4fdd\u5b58\u3001\u5220\u9664\u65f6\uff0c\u81ea\u52a8\u5904\u7406UserEx\u6a21\u578b\u6570\u636e\u3002\/**\n * User\n * @Entity\n * @Table(name=&quot;tb_user&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property string $username\n * @property \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserEx $ex\n * @property \\Imi\\Util\\ArrayList $userRole\n * @property \\Imi\\Util\\ArrayList $role\n *\/\nclass User extends Model\n{\n    \/**\n     * @OneToOne(&quot;UserEx&quot;)\n     * @JoinFrom(&quot;id&quot;)\n     * @JoinTo(&quot;user_id&quot;)\n     * @AutoSave(true)\n     * @AutoDelete\n     *\n     * @var \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserEx\n     *\/\n    protected $ex;\n\n    \/**\n     * Get the value of ex\n     *\n     * @return  \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserEx\n     *\/ \n    public function getEx()\n    {\n        return $this-&gt;ex;\n    }\n\n    \/**\n     * Set the value of ex\n     *\n     * @param  \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserEx  $ex\n     *\n     * @return  self\n     *\/ \n    public function setEx(\\ImiDemo\\HttpDemo\\MainServer\\Model\\UserEx $ex)\n    {\n        $this-&gt;ex = $ex;\n\n        return $this;\n    }\n\n    \/\/ \u5176\u5b83\u8fd9\u8fb9\u7701\u7565\u2026\u2026\u67e5\u8be2find$model = User::find(1);\nvar_dump($model-&gt;ex); \/\/ ex\u6570\u636e\u53ef\u4ee5\u76f4\u63a5\u53d6\u5230\uff0c\u662fUserEx\u5b9e\u4f8bselect$list = User::select();\nforeach($list as $item)\n{\n    var_dump($item-&gt;ex); \/\/ ex\u6570\u636e\u53ef\u4ee5\u76f4\u63a5\u53d6\u5230\uff0c\u662fUserEx\u5b9e\u4f8b\n}\u63d2\u5165$user = User::newInstance();\n$user-&gt;username = 'User123';\n\n\/\/ \u5bf9UserEx\u5b9e\u4f8b\u8d4b\u503c\n$user-&gt;ex-&gt;intro = '\u8fd9\u4e2a\u4eba\u5f88\u61d2\uff0c\u4ec0\u4e48\u4e5f\u6ca1\u7559\u4e0b';\n\n\/\/ \u4e00\u53e5\u8bdd\uff0c\u6570\u636e\u63d2\u5165\u4e24\u5f20\u8868\n$result = $user-&gt;insert();\n\nvar_dump($result-&gt;getLastInsertId());\u66f4\u65b0$user = User::find(1);\n$user-&gt;ex-&gt;intro = '\u8fd9\u4e2a\u4eba\u5f88\u61d2\uff0c\u4ec0\u4e48\u4e5f\u6ca1\u7559\u4e0b-' . date('Y-m-d H:i:s');\n\n\/\/ \u66f4\u65b0ID\u4e3a1\u7684\u8bb0\u5f55\n\/\/ \u5bf9User\u5bf9\u8c61\u6267\u884cupdate\uff0c\u540c\u65f6\u4e5f\u4f1a\u8ba9UserEx\u505aupdate\n$result = $user-&gt;update();\u4fdd\u5b58\u548cinsert\u3001update\u540c\u7406\uff0c\u5c31\u4e0d\u4f5c\u6f14\u793a\u4e86\u3002\u5220\u9664$user = User::find(1);\n\/\/ \u5220\u9664ID\u4e3a1\u7684\u8bb0\u5f55\uff0cUserEx\u5bf9\u5e94\u8868\u4e5f\u4f1a\u5220\u9664\u8fd9\u6761\u5173\u8054\u8bb0\u5f55\n$result = $user-&gt;delete();\nif($result-&gt;isSuccess())\n{\n    echo 'success';\n}"},{"id":56,"parent_id":53,"title":"\u4e00\u5bf9\u591a\u5173\u8054","mdFileName":"components\/orm\/relation\/oneToMany.md","url":"components\/orm\/relation\/oneToMany.html","level":3,"content":"\u4e00\u5bf9\u591a\u5173\u8054\u6bd4\u5982\u6211\u4eec\u6709\u4e00\u4e2a\u7528\u6237\u8868\uff0c\u6bcf\u4e2a\u7528\u6237\u90fd\u53ef\u4ee5\u53d1\u5e03\u6587\u7ae0\uff0c\u7528\u6237\u548c\u6587\u7ae0\u5c31\u662f\u4e00\u5bf9\u591a\u7684\u5173\u7cfb\u3002\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5f53\u7136imi-demo\u91cc\u4e00\u5bf9\u591a\u7684\u4f8b\u5b50\u9009\u7684\u4e0d\u597d\uff0c\u4e0d\u8fc7\u4e0d\u91cd\u8981\uff0c\u7406\u89e3\u610f\u601d\u5c31\u884c\u3002\u5b9a\u4e49\u4e00\u5bf9\u591a\u5173\u8054\u4f1a\u7528\u5230\u7684\u6ce8\u89e3\uff1a@OneToMany\u3001@JoinFrom\u3001@JoinTo\u3001@AutoSelect\u3001@AutoInsert\u3001@AutoUpdate\u3001@AutoSave\u3001@AutoDelete\u5982 imi-demo \u4e2d\u4ee3\u7801\u6240\u793a\uff0cUserWithFriend\u7ee7\u627fUser\u3002\u7c7b\u5b9a\u4e49\u4e86\u4e00\u4e2a$friends\u5c5e\u6027\uff0c\u8fd9\u4e2a\u5c5e\u6027\u5173\u8054UserFriend\u6a21\u578b\u3002User\u4e2did\u4e0eUserFriend\u4e2duser_id\u5173\u8054\uff0c\u4f60\u53ef\u80fd\u4f1a\u53d1\u73b0\u6ca1\u6709@JoinFrom\u6ce8\u89e3\uff0c\u6ca1\u6709\u7684\u8bdd\u9ed8\u8ba4\u53d6\u5de6\u4fa7\u6a21\u578b\u7684\u4e3b\u952e\u3002\u5141\u8bb8\u81ea\u52a8\u67e5\u8be2\u3001\u63d2\u5165\u3001\u66f4\u65b0\u3001\u5220\u9664\u65f6\uff0c\u81ea\u52a8\u5904\u7406UserFriend\u6a21\u578b\u6570\u636e\uff0c\u5f53\u66f4\u65b0\u65f6\uff0c\u4f1a\u5220\u9664\u4e0d\u5b58\u5728\u7684\u6570\u636e\u3002\/**\n * User\n * @Entity\n * @Table(name=&quot;tb_user&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property string $username\n * @property \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserEx $ex\n * @property \\Imi\\Util\\ArrayList $friends\n *\/\nclass UserWithFriend extends User\n{\n    \/**\n     * @OneToMany(&quot;UserFriend&quot;)\n     * @JoinTo(&quot;user_id&quot;)\n     * @AutoInsert(true)\n     * @AutoUpdate(orphanRemoval=true)\n     * @AutoDelete(true)\n     *\n     * @var \\Imi\\Util\\ArrayList\n     *\/\n    protected $friends;\n\n    \/**\n     * Get the value of friends\n     *\n     * @return  \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserFriend[]\n     *\/ \n    public function getFriends()\n    {\n        return $this-&gt;friends;\n    }\n\n    \/**\n     * Set the value of friends\n     *\n     * @param  \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserFriend[]  $friends\n     *\n     * @return  self\n     *\/ \n    public function setFriends($friends)\n    {\n        $this-&gt;friends = $friends;\n\n        return $this;\n    }\n\n}\u67e5\u8be2find$model = UserWithFriend::find(1);\nvar_dump($model-&gt;friends); \/\/ friends\u6570\u636e\u53ef\u4ee5\u76f4\u63a5\u53d6\u5230\uff0c\u662fUserFriend\u5b9e\u4f8bselect$list = UserWithFriend::select();\nforeach($list as $item)\n{\n    var_dump($item-&gt;friends); \/\/ friends\u6570\u636e\u53ef\u4ee5\u76f4\u63a5\u53d6\u5230\uff0c\u662fUserFriend\u5b9e\u4f8b\n}\u63d2\u5165$user = UserWithFriend::newInstance();\n$user-&gt;username = 'Yurun';\n\/\/ \u7531\u4e8e\u7ee7\u627f\u4e86User\u7c7b\uff0c\u6240\u4ee5\u4e00\u5bf9\u4e00\u5173\u7cfb\u8fd8\u662f\u5b58\u5728\uff0c\u4f9d\u65e7\u53ef\u4ee5\u4f7f\u7528\n$user-&gt;ex-&gt;intro = '\u8fd9\u4e2a\u4eba\u5f88\u61d2\uff0c\u4ec0\u4e48\u4e5f\u6ca1\u7559\u4e0b';\n\/\/ \u5728\u670b\u53cb\u5173\u7cfb\u5217\u8868\u4e2d\u589e\u52a02\u9879\n$user-&gt;friends-&gt;append(\n    UserFriend::newInstance(['friend_user_id'=&gt;1]), \n    UserFriend::newInstance(['friend_user_id'=&gt;2])\n);\n$result = $user-&gt;insert();\u66f4\u65b0$user = UserWithFriend::find(1);\n$user-&gt;ex-&gt;intro = '\u8fd9\u4e2a\u4eba\u5f88\u61d2\uff0c\u4ec0\u4e48\u4e5f\u6ca1\u7559\u4e0b-' . date('Y-m-d H:i:s');\n\n\/\/ \u4e0b\u9762\u6ce8\u91ca\u7684\u4ee3\u7801\uff0c\u662f\u628a\u591a\u4f59\u7684\u8bb0\u5f55\u5220\u9664\uff0c\u53ea\u4fdd\u7559id\u4e3a4\u8fd9\u4e2a\n\/\/ $friendIds = [4];\n\/\/ $user-&gt;friends-&gt;clear();\n\/\/ $updateItems = UserFriend::query()-&gt;where('user_id', '=', $user-&gt;id)-&gt;whereIn('friend_user_id', $friendIds)-&gt;select()-&gt;getArray();\n\/\/ $user-&gt;friends-&gt;append(...$updateItems);\n\/\/ $ids = ObjectArrayHelper::column($updateItems, 'friend_user_id');\n\/\/ foreach(array_diff($friendIds, $ids) as $id)\n\/\/ {\n\/\/     $user-&gt;friends-&gt;append(UserFriend::newInstance([\n\/\/         'friend_user_id'    =&gt;    $id,\n\/\/     ]));\n\/\/ }\n\n\/\/ \u4e0b\u9762\u7684\u662f\u7b80\u5355\u7684\u589e\u52a0\u4e24\u9879\u5173\u8054\n$user-&gt;friends-&gt;append(\n    UserFriend::newInstance(['friend_user_id'=&gt;1]), \n    UserFriend::newInstance(['friend_user_id'=&gt;2])\n);\n\n$result = $user-&gt;update();\u4fdd\u5b58\u548cinsert\u3001update\u540c\u7406\uff0c\u5c31\u4e0d\u4f5c\u6f14\u793a\u4e86\u3002\u5220\u9664$user = UserWithFriend::find(1);\n\/\/ \u5220\u9664ID\u4e3a1\u7684\u8bb0\u5f55\uff0cUserEx\u5bf9\u5e94\u8868\u4e5f\u4f1a\u5220\u9664\u8fd9\u6761\u5173\u8054\u8bb0\u5f55\n$result = $user-&gt;delete();\nif($result-&gt;isSuccess())\n{\n    echo 'success';\n}"},{"id":57,"parent_id":53,"title":"\u591a\u5bf9\u591a\u5173\u8054","mdFileName":"components\/orm\/relation\/manyToMany.md","url":"components\/orm\/relation\/manyToMany.html","level":3,"content":"\u591a\u5bf9\u591a\u5173\u8054\u6bd4\u5982\u6211\u4eec\u8981\u5173\u8054\u7528\u6237\u548c\u89d2\u8272\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u5c31\u8981\u7528\u5230\u591a\u5bf9\u591a\u3002\u591a\u5bf9\u591a\u9700\u8981\u4e00\u5f20\u4e2d\u95f4\u8868\u6765\u505a\u5173\u8054\u3002\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5b9a\u4e49\u591a\u5bf9\u591a\u5173\u8054\u4f1a\u7528\u5230\u7684\u6ce8\u89e3\uff1a@ManyToMany\u3001@JoinFromMiddle\u3001@JoinToMiddle\u3001@AutoSelect\u3001@AutoInsert\u3001@AutoUpdate\u3001@AutoSave\u3001@AutoDelete\u5982 imi-demo \u4e2d\u4ee3\u7801\u6240\u793a\uff0c\u7c7b\u5b9a\u4e49\u4e86\u4e00\u4e2a$userRole\u5c5e\u6027\u548c$role\u5c5e\u6027\u3002$userRole\u5c5e\u6027\u5b9a\u4e49\u7684\u662f\u4e2d\u95f4\u6a21\u578b\uff0c\u6307\u5b9a\u4e2d\u95f4\u6a21\u578b\u4e3aUserRole\uff0c\u53f3\u4fa7\u8868\u6a21\u578bRole\uff0c\u53f3\u4fa7\u8868\u6a21\u578b\u6570\u636e\u5230\u65f6\u4f1a\u8d4b\u503c\u5230$role\u5c5e\u6027\u4e2d\u3002User\u6a21\u578b\u4f7f\u7528id\u4e0e\u4e2d\u95f4\u6a21\u578b\u7684user_id\u5173\u8054\uff0c\u4e2d\u95f4\u6a21\u578b\u4f7f\u7528role_id\u4e0e\u53f3\u4fa7\u6a21\u578bid\u5173\u8054\u3002\u5141\u8bb8\u81ea\u52a8\u67e5\u8be2\u3001\u63d2\u5165\u3001\u66f4\u65b0\u3001\u4fdd\u5b58\u3001\u5220\u9664\u65f6\uff0c\u81ea\u52a8\u5904\u7406\u5173\u8054\u6a21\u578b\u6570\u636e\u3002\/**\n * User\n * @Entity\n * @Table(name=&quot;tb_user&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property string $username\n * @property \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserEx $ex\n * @property \\Imi\\Util\\ArrayList $userRole\n * @property \\Imi\\Util\\ArrayList $role\n *\/\nclass User extends Model\n{\n    \/**\n     * @ManyToMany(model=&quot;Role&quot;, middle=&quot;UserRole&quot;, rightMany=&quot;role&quot;)\n     * @JoinToMiddle(field=&quot;id&quot;, middleField=&quot;user_id&quot;)\n     * @JoinFromMiddle(middleField=&quot;role_id&quot;, field=&quot;id&quot;)\n     * \n     * @AutoInsert\n     * @AutoUpdate\n     * @AutoSave\n     * @AutoDelete\n     *\n     * @var \\Imi\\Util\\ArrayList\n     *\/\n    protected $userRole;\n    \n    \/**\n     * Get the value of userRole\n     *\n     * @return  \\Imi\\Util\\ArrayList\n     *\/ \n    public function getUserRole()\n    {\n        return $this-&gt;userRole;\n    }\n\n    \/**\n     * Set the value of userRole\n     *\n     * @param  \\Imi\\Util\\ArrayList  $userRole\n     *\n     * @return  self\n     *\/ \n    public function setUserRole($userRole)\n    {\n        $this-&gt;userRole = $userRole;\n\n        return $this;\n    }\n\n    \/**\n     * \n     *\n     * @var \\Imi\\Util\\ArrayList\n     *\/\n    protected $role;\n\n    \/**\n     * Get the value of role\n     *\n     * @return  \\ImiDemo\\HttpDemo\\MainServer\\Model\\ArrayList[]\n     *\/ \n    public function getRole()\n    {\n        return $this-&gt;role;\n    }\n\n    \/**\n     * Set the value of role\n     *\n     * @param  \\ImiDemo\\HttpDemo\\MainServer\\Model\\ArrayList[]  $role\n     *\n     * @return  self\n     *\/ \n    public function setRole($role)\n    {\n        $this-&gt;role = $role;\n\n        return $this;\n    }\n\n    \/\/ \u5176\u5b83\u8fd9\u8fb9\u7701\u7565\u2026\u2026\n}\u67e5\u8be2find$model = UserWithFriend::find(1);\n\/\/ \u53ef\u4ee5\u53d6\u5230\u5173\u8054\u5173\u7cfb\u53ca\u53f3\u4fa7\u6a21\u578b\u6570\u636e\nvar_dump($model-&gt;userRole);\nvar_dump($model-&gt;role);select$list = UserWithFriend::select();\nforeach($list as $item)\n{\n    \/\/ \u53ef\u4ee5\u53d6\u5230\u5173\u8054\u5173\u7cfb\u53ca\u53f3\u4fa7\u6a21\u578b\u6570\u636e\n    var_dump($item-&gt;userRole);\n    var_dump($item-&gt;role);\n}\u63d2\u5165$user = UserWithFriend::newInstance();\n$user-&gt;username = Random::letterAndNumber(6, 16);\n$user-&gt;ex-&gt;intro = '\u8fd9\u4e2a\u4eba\u5f88\u61d2\uff0c\u4ec0\u4e48\u4e5f\u6ca1\u7559\u4e0b';\n\/\/ \u63d2\u5165\u5173\u8054\u5173\u7cfb\n$user-&gt;userRole-&gt;append(\n    UserRole::newInstance(['role_id'=&gt;1]), \n    UserRole::newInstance(['role_id'=&gt;2])\n);\n$result = $user-&gt;insert();\u66f4\u65b0$user = UserWithFriend::find(1);\n$user-&gt;ex-&gt;intro = '\u8fd9\u4e2a\u4eba\u5f88\u61d2\uff0c\u4ec0\u4e48\u4e5f\u6ca1\u7559\u4e0b-' . date('Y-m-d H:i:s');\n$user-&gt;userRole-&gt;clear();\n\/\/ \u66f4\u65b0\u5173\u8054\u5173\u7cfb\n$user-&gt;userRole-&gt;append(\n    UserRole::newInstance(['role_id'=&gt;998])\n);\n$result = $user-&gt;update();\u4fdd\u5b58\u548cinsert\u3001update\u540c\u7406\uff0c\u5c31\u4e0d\u4f5c\u6f14\u793a\u4e86\u3002\u5220\u9664$user = UserWithFriend::find(1);\n\/\/ \u5220\u9664\u6570\u636e\u548c\u5173\u8054\u5173\u7cfb\n$result = $user-&gt;delete();\nif($result-&gt;isSuccess())\n{\n    echo 'success';\n}"},{"id":58,"parent_id":53,"title":"\u591a\u6001\u4e00\u5bf9\u4e00\u5173\u8054","mdFileName":"components\/orm\/relation\/polymorphicOneToOne.md","url":"components\/orm\/relation\/polymorphicOneToOne.html","level":3,"content":"\u591a\u6001\u4e00\u5bf9\u4e00\u5173\u8054\u6bd4\u5982\u6211\u4eec\u6709\u4e00\u4e2a\u7528\u6237\u8868\uff0c\u4e00\u4e2a\u56e2\u961f\u8868\uff0c\u4ed6\u4eec\u548c\u5934\u50cf\u8868\u76f8\u5173\u8054\u3002mysql&gt; desc tb_user;\n+----------+------------------+------+-----+---------+----------------+\n| Field    | Type             | Null | Key | Default | Extra          |\n+----------+------------------+------+-----+---------+----------------+\n| id       | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| username | varchar(32)      | NO   |     | NULL    |                |\n| age      | tinyint(3)       | NO   |     | NULL    |                |\n+----------+------------------+------+-----+---------+----------------+\n\nmysql&gt; desc tb_team;\n+-------+------------------+------+-----+---------+----------------+\n| Field | Type             | Null | Key | Default | Extra          |\n+-------+------------------+------+-----+---------+----------------+\n| id    | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| name  | varchar(32)      | NO   |     | NULL    |                |\n+-------+------------------+------+-----+---------+----------------+\n\nmysql&gt; desc tb_avatar;\n+-------------+------------------+------+-----+---------+----------------+\n| Field       | Type             | Null | Key | Default | Extra          |\n+-------------+------------------+------+-----+---------+----------------+\n| id          | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| type        | tinyint(4)       | NO   | MUL | NULL    |                |\n| relation_id | int(10) unsigned | NO   |     | NULL    |                |\n| url         | varchar(255)     | NO   |     | NULL    |                |\n+-------------+------------------+------+-----+---------+----------------+\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5b9a\u4e49\u591a\u6001\u4e00\u5bf9\u4e00\u5173\u8054\u4f1a\u7528\u5230\u7684\u6ce8\u89e3\uff1a@PolymorphicOneToOne\u3001@PolymorphicToOne\u3001@JoinFrom\u3001@JoinTo\u3001@AutoSelect\u3001@AutoInsert\u3001@AutoUpdate\u3001@AutoSave\u3001@AutoDelete\u5982 imi-demo \u4e2d\u4ee3\u7801\u6240\u793a\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2a$avatar\u5c5e\u6027\uff0c\u8fd9\u4e2a\u5c5e\u6027\u5173\u8054Avatar\u6a21\u578b\u3002User\u4e2did\u4e0eAvatar\u4e2drelation_id\u5173\u8054\uff0c\u5e76\u4e14type\u4e3a1\u7684\u624d\u5173\u8054\u3002User \u6a21\u578b\/**\n * User\n * @Entity\n * @Table(name=&quot;tb_user&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property string $username\n * @property \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserEx $ex\n * @property \\Imi\\Util\\ArrayList $userRole\n * @property \\Imi\\Util\\ArrayList $role\n * @property \\ImiDemo\\HttpDemo\\MainServer\\Model\\Avatar $avatar\n *\/\nclass User extends Model\n{\n    \/**\n     * \u5934\u50cf\n     * \n     * @PolymorphicOneToOne(model=ImiDemo\\HttpDemo\\MainServer\\Model\\Avatar::class, type=&quot;type&quot;, typeValue=1)\n     * @JoinTo(&quot;relation_id&quot;)\n     * @AutoSave\n     * @AutoDelete\n     *\n     * @var \\ImiDemo\\HttpDemo\\MainServer\\Model\\Avatar\n     *\/\n    protected $avatar;\n\n    \/**\n     * Get \u5934\u50cf\n     *\n     * @return  \\ImiDemo\\HttpDemo\\MainServer\\Model\\Avatar\n     *\/ \n    public function getAvatar()\n    {\n        return $this-&gt;avatar;\n    }\n\n    \/**\n     * Set \u5934\u50cf\n     *\n     * @param  \\ImiDemo\\HttpDemo\\MainServer\\Model\\Avatar  $avatar  \u5934\u50cf\n     *\n     * @return  self\n     *\/ \n    public function setAvatar(\\ImiDemo\\HttpDemo\\MainServer\\Model\\Avatar $avatar)\n    {\n        $this-&gt;avatar = $avatar;\n\n        return $this;\n    }\n\n}@PolymorphicOneToOne\u6ce8\u89e3\u4e2d\uff0ctype\u4ee3\u8868\u5728Avatar\u6a21\u578b\u4e2d\u7684\u5b57\u6bb5\u540d\uff0ctypeValue\u4ee3\u8868\u5339\u914d\u7684\u503c\u3002Avatar \u6a21\u578b\/**\n * Avatar\n * @Entity\n * @Table(name=&quot;tb_avatar&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property int $type\n * @property int $relationId\n * @property string $url\n *\/\nclass Avatar extends Model\n{\n    \/**\n     * id\n     * @Column(name=&quot;id&quot;, type=&quot;int&quot;, length=10, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=true, primaryKeyIndex=0, isAutoIncrement=true)\n     * @var int\n     *\/\n    protected $id;\n\n    \/**\n     * \u83b7\u53d6 id\n     *\n     * @return int\n     *\/ \n    public function getId()\n    {\n        return $this-&gt;id;\n    }\n\n    \/**\n     * \u8d4b\u503c id\n     * @param int $id id\n     * @return static\n     *\/ \n    public function setId($id)\n    {\n        $this-&gt;id = $id;\n        return $this;\n    }\n\n    \/**\n     * type\n     * @Column(name=&quot;type&quot;, type=&quot;tinyint&quot;, length=4, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var int\n     *\/\n    protected $type;\n\n    \/**\n     * \u83b7\u53d6 type\n     *\n     * @return int\n     *\/ \n    public function getType()\n    {\n        return $this-&gt;type;\n    }\n\n    \/**\n     * \u8d4b\u503c type\n     * @param int $type type\n     * @return static\n     *\/ \n    public function setType($type)\n    {\n        $this-&gt;type = $type;\n        return $this;\n    }\n\n    \/**\n     * relation_id\n     * @Column(name=&quot;relation_id&quot;, type=&quot;int&quot;, length=10, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var int\n     *\/\n    protected $relationId;\n\n    \/**\n     * \u83b7\u53d6 relationId\n     *\n     * @return int\n     *\/ \n    public function getRelationId()\n    {\n        return $this-&gt;relationId;\n    }\n\n    \/**\n     * \u8d4b\u503c relationId\n     * @param int $relationId relation_id\n     * @return static\n     *\/ \n    public function setRelationId($relationId)\n    {\n        $this-&gt;relationId = $relationId;\n        return $this;\n    }\n\n    \/**\n     * url\n     * @Column(name=&quot;url&quot;, type=&quot;varchar&quot;, length=255, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var string\n     *\/\n    protected $url;\n\n    \/**\n     * \u83b7\u53d6 url\n     *\n     * @return string\n     *\/ \n    public function getUrl()\n    {\n        return $this-&gt;url;\n    }\n\n    \/**\n     * \u8d4b\u503c url\n     * @param string $url url\n     * @return static\n     *\/ \n    public function setUrl($url)\n    {\n        $this-&gt;url = $url;\n        return $this;\n    }\n\n    \/**\n     * \u5bf9\u5e94\u7528\u6237\n     * \n     * @PolymorphicToOne(model=ImiDemo\\HttpDemo\\MainServer\\Model\\User::class, modelField=&quot;id&quot;, type=&quot;type&quot;, typeValue=1, field=&quot;relation_id&quot;)\n     * @AutoSelect(false)\n     *\n     * @var \\ImiDemo\\HttpDemo\\MainServer\\Model\\User\n     *\/\n    protected $user;\n\n    \/**\n     * Get \u5bf9\u5e94\u7528\u6237\n     *\n     * @return  \\ImiDemo\\HttpDemo\\MainServer\\Model\\User\n     *\/ \n    public function getUser()\n    {\n        return $this-&gt;user;\n    }\n\n    \/**\n     * Set \u5bf9\u5e94\u7528\u6237\n     *\n     * @param  \\ImiDemo\\HttpDemo\\MainServer\\Model\\User  $user  \u5bf9\u5e94\u7528\u6237\n     *\n     * @return  self\n     *\/ \n    public function setUser(\\ImiDemo\\HttpDemo\\MainServer\\Model\\User $user)\n    {\n        $this-&gt;user = $user;\n\n        return $this;\n    }\n\n    \/**\n     * \u5bf9\u5e94\u7528\u6237\n     * \n     * @PolymorphicToOne(model=ImiDemo\\HttpDemo\\MainServer\\Model\\Team::class, modelField=&quot;id&quot;, type=&quot;type&quot;, typeValue=2, field=&quot;relation_id&quot;)\n     * @AutoSelect(false)\n     *\n     * @var \\ImiDemo\\HttpDemo\\MainServer\\Model\\Team\n     *\/\n    protected $team;\n\n    \/**\n     * Get \u5bf9\u5e94\u7528\u6237\n     *\n     * @return  \\ImiDemo\\HttpDemo\\MainServer\\Model\\Team\n     *\/ \n    public function getTeam()\n    {\n        return $this-&gt;team;\n    }\n\n    \/**\n     * Set \u5bf9\u5e94\u7528\u6237\n     *\n     * @param  \\ImiDemo\\HttpDemo\\MainServer\\Model\\Team  $team  \u5bf9\u5e94\u7528\u6237\n     *\n     * @return  self\n     *\/ \n    public function setTeam(\\ImiDemo\\HttpDemo\\MainServer\\Model\\Team $team)\n    {\n        $this-&gt;team = $team;\n\n        return $this;\n    }\n\n    \/**\n     * \u5bf9\u5e94\u7528\u6237\n     * \n     * @PolymorphicToOne(model=ImiDemo\\HttpDemo\\MainServer\\Model\\User::class, modelField=&quot;id&quot;, type=&quot;type&quot;, typeValue=1, field=&quot;relation_id&quot;)\n     * @PolymorphicToOne(model=ImiDemo\\HttpDemo\\MainServer\\Model\\Team::class, modelField=&quot;id&quot;, type=&quot;type&quot;, typeValue=2, field=&quot;relation_id&quot;)\n     * @AutoSelect(false)\n     *\n     * @var \\ImiDemo\\HttpDemo\\MainServer\\Model\\User|\\ImiDemo\\HttpDemo\\MainServer\\Model\\Team\n     *\/\n    protected $relationModel;\n\n    \/**\n     * Get \u5bf9\u5e94\u7528\u6237\n     *\n     * @return  \\ImiDemo\\HttpDemo\\MainServer\\Model\\User|\\ImiDemo\\HttpDemo\\MainServer\\Model\\Team\n     *\/ \n    public function getRelationModel()\n    {\n        return $this-&gt;relationModel;\n    }\n\n    \/**\n     * Set \u5bf9\u5e94\u7528\u6237\n     *\n     * @param  \\ImiDemo\\HttpDemo\\MainServer\\Model\\User|\\ImiDemo\\HttpDemo\\MainServer\\Model\\Team  $relationModel  \u5bf9\u5e94\u7528\u6237\n     *\n     * @return  self\n     *\/ \n    public function setRelationModel($relationModel)\n    {\n        $this-&gt;relationModel = $relationModel;\n\n        return $this;\n    }\n}Avatar \u6a21\u578b\u4e2d\uff0c$user\u548c$team\u662f\u6307\u5b9a\u7c7b\u578b\u7684\u5173\u8054\uff0c\u53ea\u80fd\u53d6\u5230\u5bf9\u5e94\u6a21\u578b\u7684\u6570\u636e\u3002$relationModel\u4f1a\u6839\u636e\u5f53\u524d\u6a21\u578b\u7684type\u503c\uff0c\u67e5\u8be2\u51fa\u5bf9\u5e94\u6a21\u578b\u7684\u6570\u636e\uff0c\u7c7b\u578b\u4e0d\u56fa\u5b9a\u3002\u67e5\u8be2\u5e38\u89c1\u7684\u589e\u5220\u6539\u67e5\u5c31\u4e0d\u5199\u4e86\uff0c\u548c\u4e00\u5bf9\u4e00\u5173\u8054\u4e00\u6837\u7528\u6cd5\u5934\u50cf\u6a21\u578b\u53cd\u67e5\u7528\u6237\u6a21\u578b\u667a\u80fd\u7c7b\u578b\u67e5\u8be2$avatar = Avatar::find(1);\n$avatar-&gt;queryRelations('relationModel');\n$user = $avatar-&gt;relationModel;\u6307\u5b9a\u7c7b\u578b\u67e5\u8be2$avatar = Avatar::find(1);\n$avatar-&gt;queryRelations('user');\n$user = $avatar-&gt;user;\u540c\u65f6\u67e5\u8be2\u591a\u4e2a$avatar = Avatar::find(1);\n$avatar-&gt;queryRelations('user', 'relationModel');\n$user1 = $avatar-&gt;user;\n$user2 = $avatar-&gt;relationModel;"},{"id":59,"parent_id":53,"title":"\u591a\u6001\u4e00\u5bf9\u591a\u5173\u8054","mdFileName":"components\/orm\/relation\/polymorphicOneToMany.md","url":"components\/orm\/relation\/polymorphicOneToMany.html","level":3,"content":"\u591a\u6001\u4e00\u5bf9\u591a\u5173\u8054\u6bd4\u5982\u6211\u4eec\u6709\u4e00\u5f20\u6587\u7ae0\u8868\uff0c\u4e00\u5f20\u4e66\u7c4d\u8868\uff0c\u4e00\u5f20\u8bc4\u8bba\u8868\u3002\u6587\u7ae0\u548c\u4e66\u7c4d\u7684\u8bc4\u8bba\u8bb0\u5f55\u90fd\u5728\u540c\u4e00\u5f20\u8bc4\u8bba\u8868\u4e2d\u3002mysql&gt; desc tb_article;\n+---------+------------------+------+-----+---------+----------------+\n| Field   | Type             | Null | Key | Default | Extra          |\n+---------+------------------+------+-----+---------+----------------+\n| id      | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| title   | varchar(32)      | NO   |     | NULL    |                |\n| content | text             | NO   |     | NULL    |                |\n+---------+------------------+------+-----+---------+----------------+\n\nmysql&gt; desc tb_book;\n+-------+------------------+------+-----+---------+----------------+\n| Field | Type             | Null | Key | Default | Extra          |\n+-------+------------------+------+-----+---------+----------------+\n| id    | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| title | varchar(32)      | NO   |     | NULL    |                |\n+-------+------------------+------+-----+---------+----------------+\n\nmysql&gt; desc tb_comment;\n+-------------+------------------+------+-----+---------+----------------+\n| Field       | Type             | Null | Key | Default | Extra          |\n+-------------+------------------+------+-----+---------+----------------+\n| id          | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| content     | text             | NO   |     | NULL    |                |\n| type        | tinyint(4)       | NO   |     | NULL    |                |\n| relation_id | int(10) unsigned | NO   |     | NULL    |                |\n+-------------+------------------+------+-----+---------+----------------+\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5b9a\u4e49\u4e00\u5bf9\u591a\u5173\u8054\u4f1a\u7528\u5230\u7684\u6ce8\u89e3\uff1a@PolymorphicOneToMany\u3001@PolymorphicToOne\u3001@JoinFrom\u3001@JoinTo\u3001@AutoSelect\u3001@AutoInsert\u3001@AutoUpdate\u3001@AutoSave\u3001@AutoDelete\u5982 imi-demo \u4e2d\u4ee3\u7801\u6240\u793a\uff0cArticle\u5b9a\u4e49\u4e86\u4e00\u4e2a$comments\u5c5e\u6027\uff0c\u8fd9\u4e2a\u5c5e\u6027\u5173\u8054Comment\u6a21\u578b\u3002Article\u4e2did\u4e0eComment\u4e2drelation_id\u5173\u8054\uff0c\u5e76\u4e14type\u4e3a1\u7684\u624d\u5173\u8054\u3002Article \u6a21\u578b\/**\n * Article\n * @Entity\n * @Table(name=&quot;tb_article&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property string $title\n * @property string $content\n * @property \\Imi\\Util\\ArrayList $comments\n * @property \\Imi\\Util\\ArrayList $taggables\n * @property \\Imi\\Util\\ArrayList $tags\n *\/\nclass Article extends Model\n{\n    \/**\n     * id\n     * @Column(name=&quot;id&quot;, type=&quot;int&quot;, length=10, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=true, primaryKeyIndex=0, isAutoIncrement=true)\n     * @var int\n     *\/\n    protected $id;\n\n    \/**\n     * \u83b7\u53d6 id\n     *\n     * @return int\n     *\/ \n    public function getId()\n    {\n        return $this-&gt;id;\n    }\n\n    \/**\n     * \u8d4b\u503c id\n     * @param int $id id\n     * @return static\n     *\/ \n    public function setId($id)\n    {\n        $this-&gt;id = $id;\n        return $this;\n    }\n\n    \/**\n     * title\n     * @Column(name=&quot;title&quot;, type=&quot;varchar&quot;, length=32, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var string\n     *\/\n    protected $title;\n\n    \/**\n     * \u83b7\u53d6 title\n     *\n     * @return string\n     *\/ \n    public function getTitle()\n    {\n        return $this-&gt;title;\n    }\n\n    \/**\n     * \u8d4b\u503c title\n     * @param string $title title\n     * @return static\n     *\/ \n    public function setTitle($title)\n    {\n        $this-&gt;title = $title;\n        return $this;\n    }\n\n    \/**\n     * content\n     * @Column(name=&quot;content&quot;, type=&quot;text&quot;, length=0, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var string\n     *\/\n    protected $content;\n\n    \/**\n     * \u83b7\u53d6 content\n     *\n     * @return string\n     *\/ \n    public function getContent()\n    {\n        return $this-&gt;content;\n    }\n\n    \/**\n     * \u8d4b\u503c content\n     * @param string $content content\n     * @return static\n     *\/ \n    public function setContent($content)\n    {\n        $this-&gt;content = $content;\n        return $this;\n    }\n\n    \/**\n     * \u8bc4\u8bba\n     * \n     * @PolymorphicOneToMany(model=ImiDemo\\HttpDemo\\MainServer\\Model\\Comment::class, type=&quot;type&quot;, typeValue=1)\n     * @JoinTo(&quot;relation_id&quot;)\n     * @AutoSave(orphanRemoval=true)\n     * @AutoDelete\n     *\n     * @var \\Imi\\Util\\ArrayList\n     *\/\n    protected $comments;\n\n    \/**\n     * Get \u8bc4\u8bba\n     *\n     * @return  \\ImiDemo\\HttpDemo\\MainServer\\Model\\Comment[]\n     *\/ \n    public function getComments()\n    {\n        return $this-&gt;comments;\n    }\n\n    \/**\n     * Set \u8bc4\u8bba\n     *\n     * @param  \\ImiDemo\\HttpDemo\\MainServer\\Model\\Comment[]  $comments  \u8bc4\u8bba\n     *\n     * @return  self\n     *\/ \n    public function setComments($comments)\n    {\n        $this-&gt;comments = $comments;\n\n        return $this;\n    }\n    \n}\u4e3b\u8981\u53c2\u8003$comments\u4e0a\u7684\u6ce8\u89e3\uff0c\u4e0e\u591a\u6001\u4e00\u5bf9\u591a\u4e00\u6837\u3002Comment \u6a21\u578b\/**\n * Comment\n * @Entity\n * @Table(name=&quot;tb_comment&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property string $content\n * @property int $type\n * @property int $relationId\n *\/\nclass Comment extends Model\n{\n    \/**\n     * id\n     * @Column(name=&quot;id&quot;, type=&quot;int&quot;, length=10, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=true, primaryKeyIndex=0, isAutoIncrement=true)\n     * @var int\n     *\/\n    protected $id;\n\n    \/**\n     * \u83b7\u53d6 id\n     *\n     * @return int\n     *\/ \n    public function getId()\n    {\n        return $this-&gt;id;\n    }\n\n    \/**\n     * \u8d4b\u503c id\n     * @param int $id id\n     * @return static\n     *\/ \n    public function setId($id)\n    {\n        $this-&gt;id = $id;\n        return $this;\n    }\n\n    \/**\n     * content\n     * @Column(name=&quot;content&quot;, type=&quot;text&quot;, length=0, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var string\n     *\/\n    protected $content;\n\n    \/**\n     * \u83b7\u53d6 content\n     *\n     * @return string\n     *\/ \n    public function getContent()\n    {\n        return $this-&gt;content;\n    }\n\n    \/**\n     * \u8d4b\u503c content\n     * @param string $content content\n     * @return static\n     *\/ \n    public function setContent($content)\n    {\n        $this-&gt;content = $content;\n        return $this;\n    }\n\n    \/**\n     * type\n     * @Column(name=&quot;type&quot;, type=&quot;tinyint&quot;, length=4, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var int\n     *\/\n    protected $type;\n\n    \/**\n     * \u83b7\u53d6 type\n     *\n     * @return int\n     *\/ \n    public function getType()\n    {\n        return $this-&gt;type;\n    }\n\n    \/**\n     * \u8d4b\u503c type\n     * @param int $type type\n     * @return static\n     *\/ \n    public function setType($type)\n    {\n        $this-&gt;type = $type;\n        return $this;\n    }\n\n    \/**\n     * relation_id\n     * @Column(name=&quot;relation_id&quot;, type=&quot;int&quot;, length=10, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var int\n     *\/\n    protected $relationId;\n\n    \/**\n     * \u83b7\u53d6 relationId\n     *\n     * @return int\n     *\/ \n    public function getRelationId()\n    {\n        return $this-&gt;relationId;\n    }\n\n    \/**\n     * \u8d4b\u503c relationId\n     * @param int $relationId relation_id\n     * @return static\n     *\/ \n    public function setRelationId($relationId)\n    {\n        $this-&gt;relationId = $relationId;\n        return $this;\n    }\n\n}\u67e5\u8be2\u5e38\u89c1\u7684\u589e\u5220\u6539\u67e5\u5c31\u4e0d\u5199\u4e86\uff0c\u548c\u4e00\u5bf9\u591a\u5173\u8054\u4e00\u6837\u7528\u6cd5\u8bc4\u8bba\u6a21\u578b\u53cd\u67e5\u6587\u7ae0\u6a21\u578b\u6ce8\u89e3\u53ca\u7528\u6cd5\u4e0e\u4e00\u5bf9\u4e00\u76f8\u540c"},{"id":60,"parent_id":53,"title":"\u591a\u6001\u591a\u5bf9\u591a\u5173\u8054","mdFileName":"components\/orm\/relation\/polymorphicManyToMany.md","url":"components\/orm\/relation\/polymorphicManyToMany.html","level":3,"content":"\u591a\u6001\u591a\u5bf9\u591a\u5173\u8054\u6bd4\u5982\u6211\u4eec\u6709\u4e00\u5f20\u6587\u7ae0\u8868\uff0c\u4e00\u5f20\u4e66\u7c4d\u8868\uff0c\u4e00\u5f20\u6807\u7b7e\u8868\uff0c\u4e00\u5f20\u6807\u7b7e\u5173\u8054\u8868\u3002\u6587\u7ae0\u548c\u4e66\u7c4d\u5171\u7528\u6807\u7b7e\u5e93\u3002mysql&gt; desc tb_article;\n+---------+------------------+------+-----+---------+----------------+\n| Field   | Type             | Null | Key | Default | Extra          |\n+---------+------------------+------+-----+---------+----------------+\n| id      | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| title   | varchar(32)      | NO   |     | NULL    |                |\n| content | text             | NO   |     | NULL    |                |\n+---------+------------------+------+-----+---------+----------------+\n\nmysql&gt; desc tb_book;\n+-------+------------------+------+-----+---------+----------------+\n| Field | Type             | Null | Key | Default | Extra          |\n+-------+------------------+------+-----+---------+----------------+\n| id    | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| title | varchar(32)      | NO   |     | NULL    |                |\n+-------+------------------+------+-----+---------+----------------+\n\nmysql&gt; desc tb_tags;\n+-------+------------------+------+-----+---------+----------------+\n| Field | Type             | Null | Key | Default | Extra          |\n+-------+------------------+------+-----+---------+----------------+\n| id    | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| name  | varchar(32)      | NO   |     | NULL    |                |\n+-------+------------------+------+-----+---------+----------------+\n\nmysql&gt; desc tb_taggables;\n+---------------+------------------+------+-----+---------+-------+\n| Field         | Type             | Null | Key | Default | Extra |\n+---------------+------------------+------+-----+---------+-------+\n| tag_id        | int(10) unsigned | NO   | PRI | NULL    |       |\n| taggable_id   | int(10) unsigned | NO   | PRI | NULL    |       |\n| taggable_type | tinyint(4)       | NO   | PRI | NULL    |       |\n+---------------+------------------+------+-----+---------+-------+\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u770bimi-demo\u9879\u76ee\uff0c\u4e0b\u9762\u4ec5\u4e3a\u7b80\u5355\u5c55\u793a\u3002\u5b9a\u4e49\u591a\u5bf9\u591a\u5173\u8054\u4f1a\u7528\u5230\u7684\u6ce8\u89e3\uff1a@PolymorphicManyToMany\u3001@PolymorphicToMany\u3001@JoinFromMiddle\u3001@JoinToMiddle\u3001@AutoSelect\u3001@AutoInsert\u3001@AutoUpdate\u3001@AutoSave\u3001@AutoDeleteArticle \u6a21\u578b\/**\n * Article\n * @Entity\n * @Table(name=&quot;tb_article&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property string $title\n * @property string $content\n * @property \\Imi\\Util\\ArrayList $comments\n * @property \\Imi\\Util\\ArrayList $taggables\n * @property \\Imi\\Util\\ArrayList $tags\n *\/\nclass Article extends Model\n{\n    \/\/ \u7701\u7565\u5176\u5b83\u2026\u2026\n    \n    \/**\n     * \u6807\u7b7e\u5173\u8054\n     * \n     * @PolymorphicManyToMany(model=&quot;Tags&quot;, middle=&quot;Taggables&quot;, rightMany=&quot;tags&quot;, type=&quot;taggable_type&quot;, typeValue=1)\n     * @JoinToMiddle(field=&quot;id&quot;, middleField=&quot;taggable_id&quot;)\n     * @JoinFromMiddle(middleField=&quot;tag_id&quot;, field=&quot;id&quot;)\n     * \n     * @AutoInsert\n     * @AutoUpdate(orphanRemoval=true)\n     * @AutoSave\n     * @AutoDelete\n     *\n     * @var \\Imi\\Util\\ArrayList\n     *\/\n    protected $taggables;\n\n    \/**\n     * Get \u6807\u7b7e\u5173\u8054\n     *\n     * @return  \\Imi\\Util\\ArrayList\n     *\/ \n    public function getTaggables()\n    {\n        return $this-&gt;taggables;\n    }\n\n    \/**\n     * Set \u6807\u7b7e\u5173\u8054\n     *\n     * @param  \\Imi\\Util\\ArrayList  $taggables  \u6807\u7b7e\u5173\u8054\n     *\n     * @return  self\n     *\/ \n    public function setTaggables(\\Imi\\Util\\ArrayList $taggables)\n    {\n        $this-&gt;taggables = $taggables;\n\n        return $this;\n    }\n\n    \/**\n     * \u5173\u8054\u6807\u7b7e\n     *\n     * @var \\Imi\\Util\\ArrayList\n     *\/\n    protected $tags;\n\n    \/**\n     * Get \u5173\u8054\u6807\u7b7e\n     *\n     * @return  \\Imi\\Util\\ArrayList\n     *\/ \n    public function getTags()\n    {\n        return $this-&gt;tags;\n    }\n\n    \/**\n     * Set \u5173\u8054\u6807\u7b7e\n     *\n     * @param  \\Imi\\Util\\ArrayList  $tags  \u5173\u8054\u6807\u7b7e\n     *\n     * @return  self\n     *\/ \n    public function setTags($tags)\n    {\n        $this-&gt;tags = $tags;\n\n        return $this;\n    }\n}Tags \u6a21\u578b\/**\n * Tags\n * @Entity\n * @Table(name=&quot;tb_tags&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property string $name\n *\/\nclass Tags extends Model\n{\n    \/\/ \u7701\u7565\u5176\u5b83\u2026\u2026\n\n    \/**\n     * \u62e5\u6709\u672c\u6807\u7b7e\u7684\u6587\u7ae0\u5217\u8868\n     * \n     * @PolymorphicToMany(model=ImiDemo\\HttpDemo\\MainServer\\Model\\Article::class, modelField=&quot;id&quot;, type=&quot;taggable_type&quot;, typeValue=1, field=&quot;taggable_id&quot;, middle=&quot;Taggables&quot;)\n     * @JoinToMiddle(field=&quot;id&quot;, middleField=&quot;taggable_id&quot;)\n     * @JoinFromMiddle(middleField=&quot;tag_id&quot;, field=&quot;id&quot;)\n     * \n     * @AutoSelect(false)\n     *\n     * @var \\Imi\\Util\\ArrayList\n     *\/\n    protected $articles;\n\n    \/**\n     * Get \u62e5\u6709\u672c\u6807\u7b7e\u7684\u6a21\u578b\u5217\u8868\n     *\n     * @return  \\Imi\\Util\\ArrayList\n     *\/ \n    public function getArticles()\n    {\n        return $this-&gt;articles;\n    }\n\n    \/**\n     * Set \u62e5\u6709\u672c\u6807\u7b7e\u7684\u6a21\u578b\u5217\u8868\n     *\n     * @param  \\Imi\\Util\\ArrayList  $articles  \u62e5\u6709\u672c\u6807\u7b7e\u7684\u6a21\u578b\u5217\u8868\n     *\n     * @return  self\n     *\/ \n    public function setArticles(\\Imi\\Util\\ArrayList $articles)\n    {\n        $this-&gt;articles = $articles;\n\n        return $this;\n    }\n    \n    \/**\n     * \u62e5\u6709\u672c\u6807\u7b7e\u7684\u4e66\u7c4d\u5217\u8868\n     * \n     * @PolymorphicToMany(model=ImiDemo\\HttpDemo\\MainServer\\Model\\Book::class, modelField=&quot;id&quot;, type=&quot;taggable_type&quot;, typeValue=2, field=&quot;taggable_id&quot;, middle=&quot;Taggables&quot;)\n     * @JoinToMiddle(field=&quot;id&quot;, middleField=&quot;taggable_id&quot;)\n     * @JoinFromMiddle(middleField=&quot;tag_id&quot;, field=&quot;id&quot;)\n     * \n     * @AutoSelect(false)\n     *\n     * @var \\Imi\\Util\\ArrayList\n     *\/\n    protected $books;\n\n    \/**\n     * Get \u62e5\u6709\u672c\u6807\u7b7e\u7684\u4e66\u7c4d\u5217\u8868\n     *\n     * @return  \\Imi\\Util\\ArrayList\n     *\/ \n    public function getBooks()\n    {\n        return $this-&gt;books;\n    }\n\n    \/**\n     * Set \u62e5\u6709\u672c\u6807\u7b7e\u7684\u4e66\u7c4d\u5217\u8868\n     *\n     * @param  \\Imi\\Util\\ArrayList  $books  \u62e5\u6709\u672c\u6807\u7b7e\u7684\u4e66\u7c4d\u5217\u8868\n     *\n     * @return  self\n     *\/ \n    public function setBooks(\\Imi\\Util\\ArrayList $books)\n    {\n        $this-&gt;books = $books;\n\n        return $this;\n    }\n    \n}Taggables \u6a21\u578b\u6ca1\u6709\u8981\u8bbe\u7f6e\u7684\u6ce8\u89e3\uff0c\u4e0d\u5c55\u793a\u4e86\u67e5\u8be2\u5e38\u89c1\u7684\u589e\u5220\u6539\u67e5\u5c31\u4e0d\u5199\u4e86\uff0c\u548c\u4e00\u5bf9\u591a\u5173\u8054\u4e00\u6837\u7528\u6cd5\u6807\u7b7e\u53cd\u67e5\u6587\u7ae0\u548c\u4e66\u7c4d$tag = Tags::find(1);\n$tag-&gt;queryRelations('articles', 'books');\n$articles = $tag-&gt;articles;\n$books = $tag-&gt;books;"},{"id":61,"parent_id":44,"title":"Redis","mdFileName":"components\/redis\/index.md","url":"components\/redis\/index.html","level":1,"content":"RedisRedis \u8fde\u63a5\u6c60\u914d\u7f6e\u65b9\u5f0f\u5df2\u7ecf\u5728\u8fde\u63a5\u6c60\u91cc\u8bb2\u8fc7\uff0c\u8fd9\u91cc\u5c31\u4e0d\u91cd\u590d\u4e86\uff0c\u76f4\u63a5\u8bf4\u4f7f\u7528\u65b9\u6cd5\u3002\u8fde\u63a5\u6c60\u914d\u7f6e&lt;?php\nreturn [\n    'redis'    =&gt;    [\n        'defaultPool'    =&gt;    'alias1', \/\/ \u9ed8\u8ba4\u8fde\u63a5\u6c60\n        'quickFromRequestContext'    =&gt;    true, \/\/ \u4ece\u5f53\u524d\u4e0a\u4e0b\u6587\u4e2d\u83b7\u53d6\u516c\u7528\u8fde\u63a5\n    ],\n    'pools' =&gt; [\n        \/\/ \u8fde\u63a5\u6c60\u540d\u79f0\n        'alias1' =&gt; [\n            \/\/ \u540c\u6b65\u6c60\u5b50\uff0ctask\u8fdb\u7a0b\u4f7f\u7528\n            'sync' =&gt; [\n                'pool' =&gt; [\n                    'class'        =&gt;    \\Imi\\Redis\\SyncRedisPool::class,\n                    'config' =&gt; [\n                        \/\/ \u540c\u4e0a\n                    ],\n                ],\n                'resource' =&gt; [\n                    \/\/ 'host'    =&gt;    '127.0.0.1',\n                    \/\/ 'port'    =&gt;    6379,\n                    \/\/ \u662f\u5426\u81ea\u52a8\u5e8f\u5217\u5316\u53d8\u91cf\n                    \/\/ 'serialize'    =&gt;    true,\n                    \/\/ \u5bc6\u7801\n                    \/\/ 'password'    =&gt;    null,\n                    \/\/ \u7b2c\u51e0\u4e2a\u5e93\n                    \/\/ 'db'    =&gt;    0,\n                ],\n            ],\n            \/\/ \u5f02\u6b65\u6c60\u5b50\uff0cworker\u8fdb\u7a0b\u4f7f\u7528\n            'async' =&gt; [\n                'pool'    =&gt;    [\n                    'class'        =&gt;    \\Imi\\Redis\\CoroutineRedisPool::class,\n                    'config'    =&gt;    [\n                        \/\/ \u540c\u4e0a\n                    ],\n                ],\n                \/\/ uri\u65b9\u5f0f\uff0c\u4ee5\u5206\u53f7;\u5206\u9694\u591a\u4e2a\uff0c\u53c2\u6570\u4f7f\u7528query\u53c2\u6570\u683c\u5f0f\uff0c\u7279\u6b8a\u5b57\u7b26\u9700\u8981\u8f6c\u7801\n                'resource'  =&gt;  'tcp:\/\/192.168.0.222&amp;timeout=60;tcp:\/\/192.168.0.222',\n            ],\n        ]\n    ],\n];\u57fa\u672c\u64cd\u4f5c\u4e0e\u539f\u751f Redis \u7c7b\u64cd\u4f5c\u65b9\u5f0f\u57fa\u672c\u4e00\u81f4\uff0c\u8fd9\u91cc\u65e0\u9700\u591a\u8bf4\u3002\u83b7\u53d6\u5bf9\u8c61use \\Imi\\Redis\\RedisManager;\n$redis = RedisManager::getInstance();\n$redis-&gt;set('imi:redis:test', date('Y-m-d H:i:s'));\n$datetime = $redis-&gt;get('imi:redis:test');\u83b7\u53d6\u65b0\u5bf9\u8c61\u6bcf\u6b21\u8c03\u7528\u90fd\u5c1d\u8bd5\u4ece\u8fde\u63a5\u6c60\u4e2d\u83b7\u53d6\u65b0\u7684\u5bf9\u8c61\uff0c\u8981\u6ce8\u610f\u6bcf\u6b21\u7528\u5b8c\u9700\u8981\u624b\u52a8\u91ca\u653e\uff01use \\Imi\\Redis\\RedisManager;\n$redis = RedisManager::getNewInstance();\n\/\/ $redis = RedisManager::getNewInstance($poolName);\nRedisManager::release($redis);\u83b7\u53d6\u9ed8\u8ba4\u8fde\u63a5\u6c60\u540d\u79f0use \\Imi\\Redis\\RedisManager;\necho RedisManager::getDefaultPoolName();\u4fbf\u6377\u64cd\u4f5cuse \\Imi\\Redis\\Redis;\nRedis::set('imi:redis:test', date('Y-m-d H:i:s'));\n$datetime = Redis::get('imi:redis:test');\u56de\u8c03\u65b9\u5f0f\u4f7f\u7528Redis$result = Redis::use(function($resource, $redis){\n    redis-&gt;set('a', 1);\n    return true;\n}); \/\/ true"},{"id":62,"parent_id":44,"title":"Redis \u6a21\u578b","mdFileName":"components\/orm\/RedisModel.md","url":"components\/orm\/RedisModel.html","level":1,"content":"Redis \u6a21\u578b\u4ecb\u7ecdRedis \u6a21\u578b\u9002\u5408\u56fa\u5b9a\u7ed3\u6784\u7684\u6570\u636e\u7ed3\u6784\uff0c\u53ef\u4ee5\u8ddf\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u6a21\u578b\u4e00\u6837\uff0c\u65e0\u9700\u5173\u5fc3\u76f4\u63a5\u7684\u64cd\u4f5c\uff0c\u589e\u5220\u6539\u67e5\u4e00\u628a\u68ad\u3002\u6a21\u578b\u5b9a\u4e49\u559c\u95fb\u4e50\u89c1\u7684\u5bf9\u547d\u540d\u7a7a\u95f4\u3001\u7c7b\u540d\u65e0\u8981\u6c42\uff0c\u53ea\u8981\u6309\u7167\u89c4\u5b9a\u5199\u6ce8\u89e3\u5373\u53ef\uff01\u5177\u4f53\u5b9a\u4e49\u770b\u4e0b\u9762\u4ee3\u7801\uff1a&lt;?php\nnamespace ImiDemo\\HttpDemo\\MainServer\\Model;\n\nuse Imi\\Model\\RedisModel;\nuse Imi\\Model\\Annotation\\Table;\nuse Imi\\Model\\Annotation\\Column;\nuse Imi\\Model\\Annotation\\Entity;\nuse Imi\\Model\\Annotation\\RedisEntity;\n\n\/**\n * Test\n * @Entity\n * @RedisEntity(poolName=&quot;redis&quot;, key=&quot;{id}-{name}&quot;)\n *\/\nclass TestRedisModel extends RedisModel\n{\n    \/**\n     * id\n     * @Column(name=&quot;id&quot;)\n     * @var int\n     *\/\n    protected $id;\n\n    \/**\n     * \u83b7\u53d6 id\n     *\n     * @return int\n     *\/ \n    public function getId()\n    {\n        return $this-&gt;id;\n    }\n\n    \/**\n     * \u8d4b\u503c id\n     * @param int $id id\n     * @return static\n     *\/ \n    public function setId($id)\n    {\n        $this-&gt;id = $id;\n        return $this;\n    }\n\n    \/**\n     * name\n     * @Column(name=&quot;name&quot;)\n     * @var string\n     *\/\n    protected $name;\n\n    \/**\n     * \u83b7\u53d6 name\n     *\n     * @return string\n     *\/ \n    public function getName()\n    {\n        return $this-&gt;name;\n    }\n\n    \/**\n     * \u8d4b\u503c name\n     * @param string $name name\n     * @return static\n     *\/ \n    public function setName($name)\n    {\n        $this-&gt;name = $name;\n        return $this;\n    }\n\n    \/**\n     * age\n     * @Column(name=&quot;age&quot;)\n     * @var string\n     *\/\n    protected $age;\n\n    \/**\n     * \u83b7\u53d6 age\n     *\n     * @return string\n     *\/ \n    public function getAge()\n    {\n        return $this-&gt;age;\n    }\n\n    \/**\n     * \u8d4b\u503c age\n     * @param string $age age\n     * @return static\n     *\/ \n    public function setAge($age)\n    {\n        $this-&gt;age = $age;\n        return $this;\n    }\n}\u9700\u8981\u4f7f\u7528\u6ce8\u89e3\u5c06\u8868\u3001\u5b57\u6bb5\u5c5e\u6027\u5168\u90e8\u6807\u6ce8\u3002\u5e76\u4e14\u5199\u4e0aget\u548cset\u65b9\u6cd5\u3002@RedisEntity\u6307\u5b9a\u5f53\u524d\u7c7b\u4e3aRedis\u5b9e\u4f53\u7c7b\u53ef\u9009\u5c5e\u6027\uff1apoolNameredis\u8fde\u63a5\u6c60\u540d\u79f0db\u7b2c\u51e0\u4e2a\u5e93\uff0c\u4e0d\u4f20\u4e3anull\u65f6\u4f7f\u7528\u8fde\u63a5\u6c60\u9ed8\u8ba4\u914d\u7f6ekey\u952e\uff0c\u652f\u6301\u5b9a\u4e49\u591a\u4e2a\u53c2\u6570\uff0c\u9ed8\u8ba4\u4e3a{key}\uff0c\u5728RedisModel\u4e2d\u5df2\u7ecf\u9884\u5148\u5b9a\u4e49\u4e86setKey()\u548cgetKey()\u65b9\u6cd5ttl\u6570\u636e\u9ed8\u8ba4\u7684\u8fc7\u671f\u65f6\u95f4\uff0cnull\u4e3a\u6c38\u4e0d\u8fc7\u671f@ColumnRedis\u6a21\u578b\u4e2d\u53ea\u6709name\u751f\u6548\u6a21\u578b\u64cd\u4f5c\u6240\u6709\u64cd\u4f5c\u90fd\u662f\u4f9d\u636e\u4e0a\u9762\u5b9a\u4e49\u7684TestRedisModel\u67e5\u627e\u4e00\u6761\u8bb0\u5f55\/\/ \u8bfb\u53d6-\u76f4\u63a5\u4f20key\n$model2 = TestRedisModel::find('123-imi');\n\n\/\/ \u8bfb\u53d6-\u4f20\u53c2\u6570\u7ec4\u6210\n$model3 = TestRedisModel::find([\n    'id'    =&gt;    '123',\n    'name'    =&gt;    'imi'\n]);\u67e5\u8be2\u591a\u6761\u8bb0\u5f55$list = TestRedisModel::select('kkk', '123-imi', [\n    'id'    =&gt;    '123',\n    'name'    =&gt;    'imi'\n]);\nforeach($list as $item)\n{\n    var_dump($item-&gt;toArray());\n}\u4fdd\u5b58\u8bb0\u5f55$model = TestRedisModel::newInstance();\n$model-&gt;setId(123);\n$model-&gt;setName('imi');\n$model-&gt;setAge(100);\n$model-&gt;save();\n\u5220\u9664\u8bb0\u5f55$model2 = TestRedisModel::find('123-imi');\n$model2-&gt;delete();\u6279\u91cf\u5220\u9664\/\/ \u5220\u9664\u952e\u4e3akey\u548c123-imi\u7684\u6570\u636e\n\/\/ 123-imi\u662f\u4ee5RedisEntity\u4e2d\u5b9a\u4e49\u4e3a\u51c6\nTestRedisModel::deleteBatch('kkk', [\n    'id'    =&gt;    '123',\n    'name'    =&gt;    'imi'\n]);"},{"id":63,"parent_id":44,"title":"\u5185\u5b58\u8868\u6a21\u578b","mdFileName":"components\/orm\/MemoryTableModel.md","url":"components\/orm\/MemoryTableModel.html","level":1,"content":"\u5185\u5b58\u8868\u6a21\u578b\u4ecb\u7ecd\u57fa\u4e8e Swoole Table \u8de8\u8fdb\u7a0b\u5171\u4eab\u5185\u5b58\u8868\u7684\u6a21\u578b\u3002\u901a\u8fc7\u6ce8\u89e3\u5b9a\u4e49\uff0c\u6846\u67b6\u5e95\u5c42\u81ea\u52a8\u521b\u5efaSwooleTable\uff0c\u76f4\u63a5\u4f7f\u7528\u6a21\u578b\u64cd\u4f5c\uff0c\u65b9\u4fbf\u5feb\u6377\uff01\u6a21\u578b\u5b9a\u4e49\u559c\u95fb\u4e50\u89c1\u7684\u5bf9\u547d\u540d\u7a7a\u95f4\u3001\u7c7b\u540d\u65e0\u8981\u6c42\uff0c\u53ea\u8981\u6309\u7167\u89c4\u5b9a\u5199\u6ce8\u89e3\u5373\u53ef\uff01\u5177\u4f53\u5b9a\u4e49\u770b\u4e0b\u9762\u4ee3\u7801\uff1anamespace Test;\n\nuse Imi\\Model\\MemoryTableModel;\nuse Imi\\Model\\Annotation\\Column;\nuse Imi\\Model\\Annotation\\MemoryTable;\n\n\/**\n * @MemoryTable(name=&quot;test&quot;)\n *\/\nclass MTest extends MemoryTableModel\n{\n    \/**\n     * @Column(name=&quot;str&quot;,type=&quot;string&quot;,length=128)\n     * @var string\n     *\/\n    protected $str;\n\n    \/**\n     * @Column(name=&quot;int&quot;,type=&quot;int&quot;)\n     * @var int\n     *\/\n    protected $int;\n\n    \/**\n     * @Column(name=&quot;float&quot;,type=&quot;float&quot;)\n     * @var float\n     *\/\n    protected $float;\n\n    \/**\n     * Get the value of str\n     *\n     * @return  string\n     *\/ \n    public function getStr()\n    {\n        return $this-&gt;str;\n    }\n\n    \/**\n     * Set the value of str\n     *\n     * @param  string  $str\n     *\n     * @return  self\n     *\/ \n    public function setStr(string $str)\n    {\n        $this-&gt;str = $str;\n\n        return $this;\n    }\n\n    \/**\n     * Get the value of int\n     *\n     * @return  int\n     *\/ \n    public function getInt()\n    {\n        return $this-&gt;int;\n    }\n\n    \/**\n     * Set the value of int\n     *\n     * @param  int  $int\n     *\n     * @return  self\n     *\/ \n    public function setInt(int $int)\n    {\n        $this-&gt;int = $int;\n\n        return $this;\n    }\n\n    \/**\n     * Get the value of float\n     *\n     * @return  float\n     *\/ \n    public function getFloat()\n    {\n        return $this-&gt;float;\n    }\n\n    \/**\n     * Set the value of float\n     *\n     * @param  float  $float\n     *\n     * @return  self\n     *\/ \n    public function setFloat(float $float)\n    {\n        $this-&gt;float = $float;\n\n        return $this;\n    }\n}\u9700\u8981\u4f7f\u7528\u6ce8\u89e3\u5c06\u8868\u3001\u5b57\u6bb5\u5c5e\u6027\u5168\u90e8\u6807\u6ce8\u3002\u5e76\u4e14\u5199\u4e0aget\u548cset\u65b9\u6cd5\u3002@MemoryTable(name=&quot;test&quot;) \u662f\u6307\u5b9aSwooleTable\u7684\u540d\u79f0@Column(name=&quot;str&quot;,type=&quot;string&quot;,length=128)\u4e2d\u7684name\u4ee3\u8868\u5b57\u6bb5\u540d\uff0ctype\u652f\u6301string\/int\/float\uff0cstring\u7c7b\u578b\u5fc5\u987b\u8bbe\u7f6elength\u6a21\u578b\u64cd\u4f5c\u67e5\u627e\u4e00\u6761\u8bb0\u5f55$key = 'abc';\n$model = MTest::find($key);\u67e5\u8be2\u591a\u6761\u8bb0\u5f55$list = MTest::select();\n\/\/ $list \u4e3a MTest[] \u7c7b\u578b\u4fdd\u5b58\u8bb0\u5f55$model = MTest::newInstance();\n$model-&gt;__setKey('abc');\n$model-&gt;setStr('aaa');\n$model-&gt;setInt(123);\n$model-&gt;setFloat(4.56);\n$model-&gt;save();\u5220\u9664\u8bb0\u5f55$model = MTest::find('abc');\n$model-&gt;delete();\u6279\u91cf\u5220\u9664\/\/ \u4e24\u79cd\u65b9\u5f0f\nMTest::deleteBatch('k1', 'k2');\nMTest::deleteBatch(['k1', 'k2']);\u7edf\u8ba1\u6570\u91cfMTest::count();\u83b7\u53d6\u952e$model = MTest::find('abc');\n$model-&gt;getKey();\u8bbe\u7f6e\u952e$model = MTest::find('abc');\n$model-&gt;__setKey('def');"},{"id":64,"parent_id":44,"title":"\u7f13\u5b58","mdFileName":"components\/cache\/index.md","url":"components\/cache\/index.html","level":1,"content":"\u7f13\u5b58IMI \u4e2d\u7684\u7f13\u5b58\uff0c\u7b26\u5408PSR-16\u89c4\u8303\u3002\u4f7f\u7528\u65f6\u9700\u8981\u5148\u914d\u7f6e\u9a71\u52a8\u548c\u5b9e\u4f8b\u3002\u914d\u7f6e\u9ed8\u8ba4\u7f13\u5b58\u8bbe\u7f6e&lt;?php\nreturn [\n    'cache'    =&gt;    [\n        'default'    =&gt;    'alias1',\n    ],\n];\u624b\u52a8\u4f7f\u7528\u5199\u5165\u7f13\u5b58\/\/ \u6c38\u4e45\u6709\u6548\nImi\\Cache\\CacheManager::set('\u7f13\u5b58\u540d\u79f0', 'key', 'value');\n\n$ttl = 3600; \/\/ \u7f13\u5b58\u6709\u6548\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\nImi\\Cache\\CacheManager::set('\u7f13\u5b58\u540d\u79f0', 'key', 'value', $ttl);\u6279\u91cf\u5199\u5165\u7f13\u5b58$values = [\n    'k1'    =&gt;    'v1',\n    'k2'    =&gt;    'v2',\n];\nImi\\Cache\\CacheManager::setMultiple('\u7f13\u5b58\u540d\u79f0', $values);\n\n$ttl = 3600; \/\/ \u7f13\u5b58\u6709\u6548\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\nImi\\Cache\\CacheManager::setMultiple('\u7f13\u5b58\u540d\u79f0', $values, $ttl);\u8bfb\u53d6\u7f13\u5b58Imi\\Cache\\CacheManager::get('\u7f13\u5b58\u540d\u79f0', 'key');\n\nImi\\Cache\\CacheManager::get('\u7f13\u5b58\u540d\u79f0', 'key', 'default');\u6279\u91cf\u8bfb\u53d6\u7f13\u5b58$keys = ['k1', 'k2'];\n\nImi\\Cache\\CacheManager::getMultiple('\u7f13\u5b58\u540d\u79f0', $keys);\n\nImi\\Cache\\CacheManager::getMultiple('\u7f13\u5b58\u540d\u79f0', $keys, 'default');\u5220\u9664\u7f13\u5b58Imi\\Cache\\CacheManager::delete('\u7f13\u5b58\u540d\u79f0', 'key');\u6279\u91cf\u5220\u9664\u7f13\u5b58$keys = ['k1', 'k2'];\n\nImi\\Cache\\CacheManager::deleteMultiple('\u7f13\u5b58\u540d\u79f0', $keys);\u7f13\u5b58\u662f\u5426\u5b58\u5728Imi\\Cache\\CacheManager::has('\u7f13\u5b58\u540d\u79f0', 'key');\u6e05\u7a7a\u7f13\u5b58Imi\\Cache\\CacheManager::clear('\u7f13\u5b58\u540d\u79f0');\u6ce8\u89e3\u4f7f\u7528\u9664\u4e86\u624b\u52a8\u63a7\u5236\u7f13\u5b58\u8bfb\u5199\uff0c\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528\u6ce8\u89e3\u6765\u505a\uff0c\u771f\u7684\u7092\u9e21\u65b9\u4fbf\u54e6\uff01\u9996\u5148\u6765\u8ba4\u8bc6\u4e00\u4e0b imi \u4e2d\u7684\u7f13\u5b58\u6ce8\u89e3\u5427\uff01@Cacheable\u8c03\u7528\u65b9\u6cd5\u524d\u68c0\u6d4b\u662f\u5426\u5b58\u5728\u7f13\u5b58\uff0c\u5982\u679c\u5b58\u5728\u76f4\u63a5\u8fd4\u56de\uff1b\u4e0d\u5b58\u5728\u5219\u6267\u884c\u65b9\u6cd5\u4f53\uff0c\u7136\u540e\u5c06\u8fd4\u56de\u503c\u5b58\u5165\u7f13\u5b58\u7528\u6cd5\uff1a\u57fa\u672c\u7528\u6cd5\uff1a@Cacheable(name=&quot;\u7f13\u5b58\u5668\u540d\uff0c\u4e3anull\u5219\u53d6cache.default\u914d\u7f6e&quot;, key=&quot;\u7f13\u5b58\u952e\u540d\uff0c\u652f\u6301{id}\u3001{data.name}\u3001{:args}(\u6240\u6709\u53c2\u6570\u7684hash\u503c)\u5f62\u5f0f\uff0c\u4ee3\u5165\u53c2\u6570\uff0c\u5982\u679c\u4e3anull\uff0c\u5219\u4f7f\u7528\u7c7b\u540d+\u65b9\u6cd5\u540d+\u5168\u90e8\u53c2\u6570\uff0c\u5e8f\u5217\u5316\u540ehash&quot;, ttl=&quot;\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u79d2&quot;, lockable=&quot;Lock \u6ce8\u89e3\uff0c\u5728\u8c03\u7528\u65b9\u6cd5\u4f53\u524d\u540e\u52a0\u9501&quot;, hashMethod=&quot;md5&quot;)\u9632\u6b62\u7f13\u5b58\u51fb\u7a7f\uff1a\/*\n * @Cacheable(\n *   key=&quot;index:{page}&quot;,\n *   ttl=10,\n *   lockable=@Lockable(\n *     id=&quot;index:{page}&quot;,\n *     waitTimeout=999999,\n *   ),\n *   preventBreakdown=true,\n * )\n *\/lockable \u7528\u6cd5\u8bf7\u53c2\u8003 LockpreventBreakdown \u5982\u679c\u8bbe\u4e3a true\uff0c\u4f1a\u5728\u83b7\u5f97\u9501\u540e\uff0c\u5c1d\u8bd5\u83b7\u53d6\u7f13\u5b58\uff0c\u5982\u679c\u7f13\u5b58\u5b58\u5728\u5219\u4e0d\u518d\u6267\u884c\u65b9\u6cd5\u4f53\u5982\u679c preventBreakdown \u8bbe\u4e3a true\uff0c\u5e76\u4e14lockable\u4e2d\u4e5f\u8bbe\u5b9a\u4e86afterLock\uff0c\u4f18\u5148\u7ea7\u4e3a\uff1aafterLock &gt; \u7f13\u5b58\u68c0\u6d4b@CacheEvict\u7f13\u5b58\u9a71\u9010\u6ce8\u89e3\uff0c\u65b9\u6cd5\u4f53\u6267\u884c\u65f6\uff0c\u5c06\u6307\u5b9a\u7f13\u5b58\u6e05\u9664\u7528\u6cd5\uff1a\u5728\u65b9\u6cd5\u6267\u884c\u524d\u5220\u9664\u7f13\u5b58\uff1a@CacheEvict(name=&quot;\u540c\u4e0a&quot;, key=&quot;\u540c\u4e0a&quot;, beforeInvocation=true, hashMethod=&quot;md5&quot;)\u5728\u65b9\u6cd5\u6267\u884c\u540e\u5220\u9664\u7f13\u5b58\uff1a@CacheEvict(name=&quot;\u540c\u4e0a&quot;, key=&quot;\u540c\u4e0a&quot;, hashMethod=&quot;md5&quot;)@CachePut\u65b9\u6cd5\u4f53\u6267\u884c\u540e\uff0c\u5c06\u8fd4\u56de\u503c\u5b58\u5165\u7f13\u5b58\u7528\u6cd5\uff1a\u5c06\u65b9\u6cd5\u8fd4\u56de\u503c\u5168\u90e8\u5199\u5165\u7f13\u5b58\uff1a@CachePut(name=&quot;\u540c\u4e0a&quot;, key=&quot;\u540c\u4e0a&quot;, ttl=&quot;\u540c\u4e0a&quot;, hashMethod=&quot;md5&quot;)\u5c06\u65b9\u6cd5\u8fd4\u56de\u503c\u7684\u4e00\u90e8\u5206\u5199\u5165\u7f13\u5b58\uff1a@CachePut(name=&quot;\u540c\u4e0a&quot;, key=&quot;\u540c\u4e0a&quot;, ttl=&quot;\u540c\u4e0a&quot;, value=&quot;a.b&quot;, hashMethod=&quot;md5&quot;)\u4e0a\u9762\u7684\u6ce8\u89e3\uff0c\u5982\u679c\u65b9\u6cd5\u8fd4\u56de\u503c\u4e3a\uff1a[\n    'a' =&gt;  [\n        'b' =&gt;  123,\n    ],\n]\u5219\u4f1a\u5c06123\u5199\u5165\u7f13\u5b58\u3002"},{"id":65,"parent_id":64,"title":"\u4f7f\u7528\u8bf4\u660e","mdFileName":"components\/cache\/index.md","url":"components\/cache\/index.html","level":2,"content":"\u7f13\u5b58IMI \u4e2d\u7684\u7f13\u5b58\uff0c\u7b26\u5408PSR-16\u89c4\u8303\u3002\u4f7f\u7528\u65f6\u9700\u8981\u5148\u914d\u7f6e\u9a71\u52a8\u548c\u5b9e\u4f8b\u3002\u914d\u7f6e\u9ed8\u8ba4\u7f13\u5b58\u8bbe\u7f6e&lt;?php\nreturn [\n    'cache'    =&gt;    [\n        'default'    =&gt;    'alias1',\n    ],\n];\u624b\u52a8\u4f7f\u7528\u5199\u5165\u7f13\u5b58\/\/ \u6c38\u4e45\u6709\u6548\nImi\\Cache\\CacheManager::set('\u7f13\u5b58\u540d\u79f0', 'key', 'value');\n\n$ttl = 3600; \/\/ \u7f13\u5b58\u6709\u6548\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\nImi\\Cache\\CacheManager::set('\u7f13\u5b58\u540d\u79f0', 'key', 'value', $ttl);\u6279\u91cf\u5199\u5165\u7f13\u5b58$values = [\n    'k1'    =&gt;    'v1',\n    'k2'    =&gt;    'v2',\n];\nImi\\Cache\\CacheManager::setMultiple('\u7f13\u5b58\u540d\u79f0', $values);\n\n$ttl = 3600; \/\/ \u7f13\u5b58\u6709\u6548\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\nImi\\Cache\\CacheManager::setMultiple('\u7f13\u5b58\u540d\u79f0', $values, $ttl);\u8bfb\u53d6\u7f13\u5b58Imi\\Cache\\CacheManager::get('\u7f13\u5b58\u540d\u79f0', 'key');\n\nImi\\Cache\\CacheManager::get('\u7f13\u5b58\u540d\u79f0', 'key', 'default');\u6279\u91cf\u8bfb\u53d6\u7f13\u5b58$keys = ['k1', 'k2'];\n\nImi\\Cache\\CacheManager::getMultiple('\u7f13\u5b58\u540d\u79f0', $keys);\n\nImi\\Cache\\CacheManager::getMultiple('\u7f13\u5b58\u540d\u79f0', $keys, 'default');\u5220\u9664\u7f13\u5b58Imi\\Cache\\CacheManager::delete('\u7f13\u5b58\u540d\u79f0', 'key');\u6279\u91cf\u5220\u9664\u7f13\u5b58$keys = ['k1', 'k2'];\n\nImi\\Cache\\CacheManager::deleteMultiple('\u7f13\u5b58\u540d\u79f0', $keys);\u7f13\u5b58\u662f\u5426\u5b58\u5728Imi\\Cache\\CacheManager::has('\u7f13\u5b58\u540d\u79f0', 'key');\u6e05\u7a7a\u7f13\u5b58Imi\\Cache\\CacheManager::clear('\u7f13\u5b58\u540d\u79f0');\u6ce8\u89e3\u4f7f\u7528\u9664\u4e86\u624b\u52a8\u63a7\u5236\u7f13\u5b58\u8bfb\u5199\uff0c\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528\u6ce8\u89e3\u6765\u505a\uff0c\u771f\u7684\u7092\u9e21\u65b9\u4fbf\u54e6\uff01\u9996\u5148\u6765\u8ba4\u8bc6\u4e00\u4e0b imi \u4e2d\u7684\u7f13\u5b58\u6ce8\u89e3\u5427\uff01@Cacheable\u8c03\u7528\u65b9\u6cd5\u524d\u68c0\u6d4b\u662f\u5426\u5b58\u5728\u7f13\u5b58\uff0c\u5982\u679c\u5b58\u5728\u76f4\u63a5\u8fd4\u56de\uff1b\u4e0d\u5b58\u5728\u5219\u6267\u884c\u65b9\u6cd5\u4f53\uff0c\u7136\u540e\u5c06\u8fd4\u56de\u503c\u5b58\u5165\u7f13\u5b58\u7528\u6cd5\uff1a\u57fa\u672c\u7528\u6cd5\uff1a@Cacheable(name=&quot;\u7f13\u5b58\u5668\u540d\uff0c\u4e3anull\u5219\u53d6cache.default\u914d\u7f6e&quot;, key=&quot;\u7f13\u5b58\u952e\u540d\uff0c\u652f\u6301{id}\u3001{data.name}\u3001{:args}(\u6240\u6709\u53c2\u6570\u7684hash\u503c)\u5f62\u5f0f\uff0c\u4ee3\u5165\u53c2\u6570\uff0c\u5982\u679c\u4e3anull\uff0c\u5219\u4f7f\u7528\u7c7b\u540d+\u65b9\u6cd5\u540d+\u5168\u90e8\u53c2\u6570\uff0c\u5e8f\u5217\u5316\u540ehash&quot;, ttl=&quot;\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u79d2&quot;, lockable=&quot;Lock \u6ce8\u89e3\uff0c\u5728\u8c03\u7528\u65b9\u6cd5\u4f53\u524d\u540e\u52a0\u9501&quot;, hashMethod=&quot;md5&quot;)\u9632\u6b62\u7f13\u5b58\u51fb\u7a7f\uff1a\/*\n * @Cacheable(\n *   key=&quot;index:{page}&quot;,\n *   ttl=10,\n *   lockable=@Lockable(\n *     id=&quot;index:{page}&quot;,\n *     waitTimeout=999999,\n *   ),\n *   preventBreakdown=true,\n * )\n *\/lockable \u7528\u6cd5\u8bf7\u53c2\u8003 LockpreventBreakdown \u5982\u679c\u8bbe\u4e3a true\uff0c\u4f1a\u5728\u83b7\u5f97\u9501\u540e\uff0c\u5c1d\u8bd5\u83b7\u53d6\u7f13\u5b58\uff0c\u5982\u679c\u7f13\u5b58\u5b58\u5728\u5219\u4e0d\u518d\u6267\u884c\u65b9\u6cd5\u4f53\u5982\u679c preventBreakdown \u8bbe\u4e3a true\uff0c\u5e76\u4e14lockable\u4e2d\u4e5f\u8bbe\u5b9a\u4e86afterLock\uff0c\u4f18\u5148\u7ea7\u4e3a\uff1aafterLock &gt; \u7f13\u5b58\u68c0\u6d4b@CacheEvict\u7f13\u5b58\u9a71\u9010\u6ce8\u89e3\uff0c\u65b9\u6cd5\u4f53\u6267\u884c\u65f6\uff0c\u5c06\u6307\u5b9a\u7f13\u5b58\u6e05\u9664\u7528\u6cd5\uff1a\u5728\u65b9\u6cd5\u6267\u884c\u524d\u5220\u9664\u7f13\u5b58\uff1a@CacheEvict(name=&quot;\u540c\u4e0a&quot;, key=&quot;\u540c\u4e0a&quot;, beforeInvocation=true, hashMethod=&quot;md5&quot;)\u5728\u65b9\u6cd5\u6267\u884c\u540e\u5220\u9664\u7f13\u5b58\uff1a@CacheEvict(name=&quot;\u540c\u4e0a&quot;, key=&quot;\u540c\u4e0a&quot;, hashMethod=&quot;md5&quot;)@CachePut\u65b9\u6cd5\u4f53\u6267\u884c\u540e\uff0c\u5c06\u8fd4\u56de\u503c\u5b58\u5165\u7f13\u5b58\u7528\u6cd5\uff1a\u5c06\u65b9\u6cd5\u8fd4\u56de\u503c\u5168\u90e8\u5199\u5165\u7f13\u5b58\uff1a@CachePut(name=&quot;\u540c\u4e0a&quot;, key=&quot;\u540c\u4e0a&quot;, ttl=&quot;\u540c\u4e0a&quot;, hashMethod=&quot;md5&quot;)\u5c06\u65b9\u6cd5\u8fd4\u56de\u503c\u7684\u4e00\u90e8\u5206\u5199\u5165\u7f13\u5b58\uff1a@CachePut(name=&quot;\u540c\u4e0a&quot;, key=&quot;\u540c\u4e0a&quot;, ttl=&quot;\u540c\u4e0a&quot;, value=&quot;a.b&quot;, hashMethod=&quot;md5&quot;)\u4e0a\u9762\u7684\u6ce8\u89e3\uff0c\u5982\u679c\u65b9\u6cd5\u8fd4\u56de\u503c\u4e3a\uff1a[\n    'a' =&gt;  [\n        'b' =&gt;  123,\n    ],\n]\u5219\u4f1a\u5c06123\u5199\u5165\u7f13\u5b58\u3002"},{"id":66,"parent_id":64,"title":"File","mdFileName":"components\/cache\/file.md","url":"components\/cache\/file.html","level":2,"content":"\u6587\u4ef6\u7f13\u5b58\u914d\u7f6e&lt;?php\nreturn [\n    'caches'    =&gt;    [\n        \/\/ \u7f13\u5b58\u540d\u79f0\n        'alias1'    =&gt;    [\n            \/\/ \u7f13\u5b58\u9a71\u52a8\u7c7b\n            'handlerClass'    =&gt;    \\Imi\\Cache\\Handler\\File::class,\n            \/\/ \u9a71\u52a8\u5b9e\u4f8b\u914d\u7f6e\n            'option'        =&gt;    [\n                'savePath'    =&gt;    '\u6587\u4ef6\u7f13\u5b58\u4fdd\u5b58\u8def\u5f84',\n                'formatHandlerClass'    =&gt;    '', \/\/ \u6570\u636e\u8bfb\u5199\u4fee\u6539\u5668\n                \/\/ \u4fdd\u5b58\u6587\u4ef6\u540d\u5904\u7406\u56de\u8c03\uff0c\u4e00\u822c\u53ef\u4ee5\u4e0d\u5199\n                \/\/ 'saveFileNameCallback'    =&gt;    function($savePath, $key){\n                \/\/     return '';\n                \/\/ },\n            ],\n        ],\n    ],\n];formatHandlerClass \u53ef\u9009\uff1aImi\\Util\\Format\\Json\u3001Imi\\Util\\Format\\PhpSerialize\uff0c\u6216\u8005\u53ef\u4ee5\u81ea\u884c\u5b9e\u73b0Imi\\Util\\Format\\IFormat\u63a5\u53e3\u6587\u4ef6\u7f13\u5b58\u9664\u975e\u6302\u8f7d samba \u7b49\u7f51\u7edc\u78c1\u76d8\uff0c\u5426\u5219\u4e0d\u652f\u6301\u5206\u5e03\u5f0f\u5b58\u50a8\uff0c\u8bf7\u614e\u91cd\u9009\u62e9\uff01"},{"id":67,"parent_id":64,"title":"Redis","mdFileName":"components\/cache\/redis.md","url":"components\/cache\/redis.html","level":2,"content":"Redis Cache\u4f7f\u7528 redis \u7684 set \u548c get \u65b9\u6cd5\u5b9e\u73b0\uff0c\u652f\u6301 ttl\u914d\u7f6ereturn [\n    'caches'    =&gt;    [\n        \/\/ \u7f13\u5b58\u540d\u79f0\n        'alias1'    =&gt;    [\n            \/\/ \u7f13\u5b58\u9a71\u52a8\u7c7b\n            'handlerClass'    =&gt;    \\Imi\\Cache\\Handler\\Redis::class,\n            \/\/ \u9a71\u52a8\u5b9e\u4f8b\u914d\u7f6e\n            'option'        =&gt;    [\n                'poolName'    =&gt;    '\u8fde\u63a5\u6c60\u540d\u79f0',\n                'formatHandlerClass'    =&gt;    '', \/\/ \u6570\u636e\u8bfb\u5199\u4fee\u6539\u5668\n            ],\n        ],\n    ],\n];formatHandlerClass \u53ef\u9009\uff1aImi\\Util\\Format\\Json\u3001Imi\\Util\\Format\\PhpSerialize\uff0c\u6216\u8005\u53ef\u4ee5\u81ea\u884c\u5b9e\u73b0Imi\\Util\\Format\\IFormat\u63a5\u53e3"},{"id":68,"parent_id":64,"title":"RedisHash","mdFileName":"components\/cache\/redisHash.md","url":"components\/cache\/redisHash.html","level":2,"content":"Redis Cache\u4f7f\u7528 redis \u7684 hash\uff0c\u5373 hset \u548c hget \u65b9\u6cd5\u5b9e\u73b0\uff0c\u4e0d\u652f\u6301ttl\u4f7f\u7528\u65f6\u9700\u8981\u6ce8\u610f\uff0ckey\u683c\u5f0f\u4e3ahashkey-&gt;member\uff0c\u5373\u4e3a$redis-&gt;hget('hashkey', 'member')\u914d\u7f6ereturn [\n    'caches'    =&gt;    [\n        \/\/ \u7f13\u5b58\u540d\u79f0\n        'alias1'    =&gt;    [\n            \/\/ \u7f13\u5b58\u9a71\u52a8\u7c7b\n            'handlerClass'    =&gt;    \\Imi\\Cache\\Handler\\RedisHash::class,\n            \/\/ \u9a71\u52a8\u5b9e\u4f8b\u914d\u7f6e\n            'option'        =&gt;    [\n                'poolName'    =&gt;    '\u8fde\u63a5\u6c60\u540d\u79f0',\n                'separator' =&gt;    '\u5206\u9694\u7b26\uff0c\u5206\u9694 hash key\u548c member\uff0c\u9ed8\u8ba4\u4e3a-&gt;',\n                'defaultHashKey'    =&gt;    'imi:RedisHashCache', \/\/ \u9ed8\u8ba4\u7f3a\u7701\u7684 hash key\n                'formatHandlerClass'    =&gt;    '', \/\/ \u6570\u636e\u8bfb\u5199\u4fee\u6539\u5668\n            ],\n        ],\n    ],\n];formatHandlerClass \u53ef\u9009\uff1aImi\\Util\\Format\\Json\u3001Imi\\Util\\Format\\PhpSerialize\uff0c\u6216\u8005\u53ef\u4ee5\u81ea\u884c\u5b9e\u73b0Imi\\Util\\Format\\IFormat\u63a5\u53e3"},{"id":69,"parent_id":44,"title":"\u65e5\u5fd7","mdFileName":"components\/log\/index.md","url":"components\/log\/index.html","level":1,"content":"\u65e5\u5fd7IMI \u4e2d\u7684\u7f13\u5b58\uff0c\u7b26\u5408PSR-3\u89c4\u8303\u3002\u4f7f\u7528\u65f6\u9700\u8981\u5148\u914d\u7f6e\u9a71\u52a8\u548c\u5b9e\u4f8b\u3002\u5141\u8bb8\u6709\u591a\u4e2a\u540c\u7c7b\u578b\u5904\u7406\u5668\u5b9e\u4f8b\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u5355\u72ec\u8bbe\u7f6e\u8981\u5904\u7406\u7684\u65e5\u5fd7\u7b49\u7ea7\uff0c\u975e\u5e38\u7075\u6d3b\u3002\u914d\u7f6e\u63a7\u5236\u53f0\u65e5\u5fd7return [\n    'beans'    =&gt;    [\n        'Logger'    =&gt;    [\n            'exHandlers'    =&gt;    [\n                [\n                    'class'        =&gt;    \\Imi\\Log\\Handler\\File::class,\n                    'options'    =&gt;    [\n                        \/* \u65e5\u5fd7\u516c\u5171\u914d\u7f6e-\u5f00\u59cb *\/\n                        \/\/ \u5141\u8bb8\u8bb0\u5f55\u7684\u65e5\u5fd7\u7b49\u7ea7\u4eec\n                        'levels'    =&gt;    \\Imi\\Log\\LogLevel::ALL,\n                        \/\/ \u65e5\u5fd7\u7f13\u5b58\u6570\u91cf\uff0c\u5f53\u65e5\u5fd7\u8fbe\u5230\u6307\u5b9a\u6761\u6570\u65f6\uff0c\u6267\u884c\u6279\u91cf\u5199\u5165\u64cd\u4f5c\uff0c\u51cf\u5c11\u5bf9\u6027\u80fd\u7684\u5f71\u54cd\uff0c\u9ed8\u8ba40\uff0c\u6bcf\u6b21\u90fd\u5199\u5165\n                        \/\/ 'logCacheNumber'    =&gt;    0,\n                        \/\/ \u65e5\u5fd7\u683c\u5f0f\n                        \/\/ 'format'    =&gt;    '{Y}-{m}-{d} {H}:{i}:{s} [{level}] {message}',\n                        \/\/ \u8c03\u7528\u8ddf\u8e2a\u683c\u5f0f\n                        \/\/ 'traceFormat'    =&gt;    '#{index}  {call} called at [{file}:{line}]',\n                        \/* \u65e5\u5fd7\u516c\u5171\u914d\u7f6e-\u7ed3\u675f *\/\n\n                        \/**\n                         * \u8981\u4fdd\u5b58\u7684\u6587\u4ef6\u540d\n                         * \u652f\u6301\u4f7f\u7528date()\u51fd\u6570\u4e2d\u6240\u6709\u7684\u683c\u5f0f\uff0c\u5982\u7ecf\u5178\u5e74\u6708\u65e5\uff1alogs\/{y}-{m}-{d}.log\n                         * \u5982\u679c\u6587\u4ef6\u4f53\u79ef\u8d85\u51fa\u9650\u5236\uff0c\u4f1a\u81ea\u52a8\u521b\u5efa\u7f16\u53f7\u6587\u4ef6\uff0c\u5982\uff1a\u7b2c\u4e00\u4e2a\u6587\u4ef62018-01-01.log\uff0c\u7b2c\u4e8c\u4e2a\u6587\u4ef62018-01-01(1).log\uff0c\u7b2c\u4e09\u4e2a\u6587\u4ef62018-01-01(2).log\n                         *\/\n                        'fileName'    =&gt;    dirname(__DIR__, 3) . '\/log.log',\n                        \/\/ \u5355\u6587\u4ef6\u6700\u5927\u4f53\u79ef\uff0c\u5355\u4f4d\u5b57\u8282\uff0c\u9ed8\u8ba41G\n                        \/\/ 'maxSize'    =&gt;    1073741824,\n                        \/\/ trace\u65e5\u5fd7\u7cbe\u7b80\uff08\u5b9e\u9a8c\u6027\u529f\u80fd\uff09\n                        'traceMinimum' =&gt; true,\n                    ],\n                ]\n            ],\n        ],\n    ]\n];\u6587\u4ef6\u65e5\u5fd7return [\n    'beans'    =&gt;    [\n        'Logger'    =&gt;    [\n            'exHandlers'    =&gt;    [\n                [\n                    'class'        =&gt;    \\Imi\\Log\\Handler\\File::class,\n                    'options'    =&gt;    [\n                        \/\/ \u652f\u6301\u540c\u4e0a\u7684\u516c\u5171\u914d\u7f6e\n\n                        \/**\n                         * \u8981\u4fdd\u5b58\u7684\u6587\u4ef6\u540d\n                         * \u652f\u6301\u4f7f\u7528date()\u51fd\u6570\u4e2d\u6240\u6709\u7684\u683c\u5f0f\uff0c\u5982\u7ecf\u5178\u5e74\u6708\u65e5\uff1alogs\/{y}-{m}-{d}.log\n                         * \u5982\u679c\u6587\u4ef6\u4f53\u79ef\u8d85\u51fa\u9650\u5236\uff0c\u4f1a\u81ea\u52a8\u521b\u5efa\u7f16\u53f7\u6587\u4ef6\uff0c\u5982\uff1a\u7b2c\u4e00\u4e2a\u6587\u4ef62018-01-01.log\uff0c\u7b2c\u4e8c\u4e2a\u6587\u4ef62018-01-01(1).log\uff0c\u7b2c\u4e09\u4e2a\u6587\u4ef62018-01-01(2).log\n                         *\/\n                        'fileName'    =&gt;    dirname(__DIR__, 3) . '\/log.log',\n                        \/\/ \u5355\u6587\u4ef6\u6700\u5927\u4f53\u79ef\uff0c\u5355\u4f4d\u5b57\u8282\uff0c\u9ed8\u8ba41G\n                        \/\/ 'maxSize'    =&gt;    1073741824,\n                        \n                    ],\n                ]\n            ],\n        ],\n    ]\n];\u6846\u67b6\u9ed8\u8ba4\u65e5\u5fd7\u5904\u7406return [\n    'beans'    =&gt;    [\n        'Logger'    =&gt;    [\n            'coreHandlers'    =&gt;    [\n                \/\/ \u8fd9\u91cc\u914d\u7f6e\uff0c\u6216\u8005\u6e05\u7a7a\n            ],\n        ],\n    ]\n];\u914d\u7f6e\u4e2d\u53ef\u9009\u53d8\u91cf\u8bf4\u660e\u9996\u5148\uff0c\u6240\u6709\u652f\u6301\u4f20\u5165{xxx}\u5f62\u5f0f\u7684\u683c\u5f0f\u4e2d\uff0c\u90fd\u652f\u6301date()\u51fd\u6570\u652f\u6301\u7684\u683c\u5f0f\uff0c\u5982Y-m-d\u7b49\u3002formatmessage \u65e5\u5fd7\u6d88\u606flevel \u65e5\u5fd7\u7b49\u7ea7timestamp \u65e5\u5fd7\u65f6\u95f4\u6233\uff0c\u7cbe\u5ea6\uff1a\u79d2trace \u4ee3\u7801\u8c03\u7528\u8ddf\u8e2alastTraceFormat\u53c2\u8003debug_backtrace()\u51fd\u6570\u8fd4\u56de\u5b57\u6bb5\u3002call \u8c03\u7528\u8ddf\u8e2atraceFormatcall \u8c03\u7528\u8ddf\u8e2aindex \u987a\u5e8f\u4f7f\u7528use Imi\\Log\\Log;\nuse Imi\\Log\\LogLevel;\n\nLog::log(LogLevel::INFO, '\u65e5\u5fd7\u5185\u5bb9');\n\/\/ \u7b2c\u4e09\u4e2a\u53c2\u6570\u53ef\u9009\u4f20\u5165\u6570\u636e\uff0c\u4e5f\u53ef\u4ee3\u5165\u4e0a\u9762\u7684\u53d8\u91cf\nLog::log(LogLevel::INFO, '\u65e5\u5fd7\u5185\u5bb9', []);\n\n\/\/ \u7b2c\u4e09\u4e2a\u53c2\u6570\u53ef\u9009\u4f20\u5165\u6570\u636e\uff0c\u4e5f\u53ef\u4ee3\u5165\u4e0a\u9762\u7684\u53d8\u91cf\nLog::emergency('\u65e5\u5fd7\u5185\u5bb9', []);\n\nLog::alert('\u65e5\u5fd7\u5185\u5bb9');\nLog::critical('\u65e5\u5fd7\u5185\u5bb9');\nLog::error('\u65e5\u5fd7\u5185\u5bb9');\nLog::warning('\u65e5\u5fd7\u5185\u5bb9');\nLog::notice('\u65e5\u5fd7\u5185\u5bb9');\nLog::info('\u65e5\u5fd7\u5185\u5bb9');\nLog::debug('\u65e5\u5fd7\u5185\u5bb9');\u76f4\u63a5\u8bb0\u5f55\u5f02\u5e38\u65e5\u5fd7\uff1atry {\n    throw new \\RuntimeException('test');\n} catch(\\Throwable $th) {\n    App::getBean('ErrorLog')-&gt;onException($th);\n}"},{"id":70,"parent_id":44,"title":"\u9a8c\u8bc1\u5668","mdFileName":"components\/validation\/index.md","url":"components\/validation\/index.html","level":1,"content":"\u9a8c\u8bc1\u5668imi \u63d0\u4f9b\u4e86\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u9a8c\u8bc1\uff0c\u4ee5\u53ca\u53ef\u6269\u5c55\u7684\u9a8c\u8bc1\u65b9\u6cd5\uff0c\u8fd9\u4e00\u5207\u90fd\u53ef\u4ee5\u901a\u8fc7\u6ce8\u89e3\u6765\u4f7f\u7528\u3002\u6ce8\u89e3@Condition\u901a\u7528\u9a8c\u8bc1\u6761\u4ef6\uff0c\u4f20\u5165\u56de\u8c03\u8fdb\u884c\u9a8c\u8bc1\u8be5\u6ce8\u89e3\u53ef\u4ee5\u5199\u5728\u7c7b\u3001\u5c5e\u6027\u3001\u65b9\u6cd5\u4e0a\u3002\u53c2\u6570\uff1a\/**\n * \u53c2\u6570\u540d\u79f0\n * \u5c5e\u6027\u6ce8\u89e3\u53ef\u7701\u7565\n *\n * @var string\n *\/\npublic $name;\n\n\/**\n * \u5f53\u503c\u4e0d\u7b26\u5408\u6761\u4ef6\u65f6\u7684\u9ed8\u8ba4\u503c\n *\n * @var mixed\n *\/\npublic $default;\n\n\/**\n * \u5bf9\u7ed3\u679c\u53d6\u53cd\n *\n * @var boolean\n *\/\npublic $inverseResult = false;\n\n\/**\n * \u5f53\u9a8c\u8bc1\u6761\u4ef6\u4e0d\u7b26\u5408\u65f6\u7684\u4fe1\u606f\n * \n * \u652f\u6301\u4ee3\u5165{:value}\u539f\u59cb\u503c\n * \u652f\u6301\u4ee3\u5165{:data.xxx}\u6240\u6709\u6570\u636e\u4e2d\u7684\u67d0\u9879\n * \u652f\u6301\u4ee5{name}\u8fd9\u6837\u7684\u5f62\u5f0f\uff0c\u4ee3\u5165\u6ce8\u89e3\u53c2\u6570\u503c\n *\n * @var string\n *\/\npublic $message = '{name} validate failed';\n\n\/**\n * \u9a8c\u8bc1\u56de\u8c03\n *\n * @var callable\n *\/\npublic $callable;\n\n\/**\n * \u53c2\u6570\u540d\u6570\u7ec4\n * \n * \u652f\u6301\u4ee3\u5165{:value}\u539f\u59cb\u503c\n * \u652f\u6301\u4ee3\u5165{:data}\u6240\u6709\u6570\u636e\n * \u652f\u6301\u4ee3\u5165{:data.xxx}\u6240\u6709\u6570\u636e\u4e2d\u7684\u67d0\u9879\n * \u652f\u6301\u4ee5{name}\u8fd9\u6837\u7684\u5f62\u5f0f\uff0c\u4ee3\u5165\u6ce8\u89e3\u53c2\u6570\u503c\n * \u5982\u679c\u6ca1\u6709{}\uff0c\u5219\u539f\u6837\u4f20\u503c\n *\n * @var array\n *\/\npublic $args = ['{:value}'];\n\n\/**\n * \u5f02\u5e38\u7c7b\n *\n * @var string\n *\/\npublic $exception = null;\n\n\/**\n * \u5f02\u5e38\u7f16\u7801\n *\n * @var integer\n *\/\npublic $exCode = null;callable \u662f\u9a8c\u8bc1\u56de\u8c03\uff0c\u652f\u6301\uff1a&quot;is_int&quot;\u3001&quot;XXX::check&quot;\u3001{@Inject(&quot;BeanName&quot;), &quot;methodName&quot;}{&quot;$this&quot;, &quot;methodName&quot;}\u6307\u5b9a\u5f53\u524d\u5bf9\u8c61\u4e2d\u7684\u65b9\u6cd5\uff0c\u4f46Http\u9a8c\u8bc1\u5668\u4e2d\u65e0\u6cd5\u4f7f\u7528\u3002\u65b9\u6cd5\u5fc5\u987b\u662fpublic\u6216protected\u3002args \u662f\u56de\u8c03\u65b9\u6cd5\u53c2\u6570\uff0c\u4f8b\u5b50\uff1aclass TestValidate\n{\n    public $abc = 'imi niubi!';\n\n    \/**\n     * @AutoValidation\n     * @Condition(name=&quot;argName&quot;, @callable({&quot;$this&quot;, &quot;validate&quot;}), args={&quot;{:value}&quot;, &quot;{:data}&quot;, &quot;{name}&quot;, &quot;{:data.a}&quot;, {&quot;:data.$this.abc&quot;}})\n     *\/\n    public function test($a, $b)\n    {\n\n    }\n\n    \/**\n     * \u672c\u65b9\u6cd5\u53c2\u6570\uff0c\u7531 @Condition \u7684 args \u51b3\u5b9a\n     * $value \u662f\u5f53\u524d\u9a8c\u8bc1\u53c2\u6570\u5bf9\u5e94\u7684\u503c\uff0c\u4e5f\u5c31\u662f test() \u65b9\u6cd5\u4e2d\uff0c$a \u53c2\u6570\u503c\n     * $data \u662f\u96c6\u5408\u4e86 test() \u65b9\u6cd5\u4e2d\u6240\u6709\u53c2\u6570\u7684\u6570\u7ec4\n     * \u4f60\u53ef\u4ee5\u7528 $data['b'] \u83b7\u53d6 $b \u53c2\u6570\u503c\n     * $name \u4ee3\u8868\u662f @Condition \u4e2d\u7684 name \u53c2\u6570\uff0c\u540c\u7406\u53ef\u4ee5\u53d6\u5230\u6ce8\u89e3\u4e2d\u7684\u5176\u5b83\u53c2\u6570\u503c\n     * $a \u5c31\u662f\u6307\u5b9a\u4f20\u5165 test() \u65b9\u6cd5\u4e2d $a \u53c2\u6570\u503c\n     * $vvv \u5c31\u662f\u6307\u5b9a test() \u65b9\u6cd5\u6240\u5728\u7c7b\u5bf9\u8c61\u4e2d\u7684 $abc \u5c5e\u6027\u503c\n     *\/\n    public function validate($value, $data, $name, $a, $vvv)\n    {\n        var_dump($value, $data, $name, $a, $vvv);\n        return true;\n    }\n}inverseResult \u53c2\u6570\u4e3atrue\u65f6\uff0c\u4f1a\u5bf9\u9a8c\u8bc1\u56de\u8c03\u65b9\u6cd5\u7ed3\u679c\u53d6\u53cd\u540e\uff0c\u5224\u65ad\u662f\u5426\u4e3atruemessage \u662f\u9a8c\u8bc1\u5931\u8d25\u7684\u6d88\u606f\uff0c\u53ef\u4ee5\u5c06{name}\u5f62\u5f0f\u7684\u6ce8\u89e3\u53c2\u6570\u503c\u4ee3\u5165\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528{:value}\u4ee3\u5165\u9a8c\u8bc1\u503c\u3002exception\u548cexCode\u53ef\u4ee5\u8bbe\u5b9a\u9a8c\u8bc1\u5931\u8d25\u65f6\u629b\u51fa\u7684\u5f02\u5e38\u7c7b\u53ca\u5f02\u5e38\u7f16\u7801\uff0c\u9ed8\u8ba4\u4e3a\\InvalidArgumentException\u7c7b\u3002\u9664\u4e86callable\u548cargs\u4ee5\u5916\uff0c\u5176\u5b83\u53c2\u6570\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u5176\u5b83\u9a8c\u8bc1\u6761\u4ef6\u6ce8\u89e3\uff08\u5982\uff1a@Required \u7b49\uff09\u7684\u53c2\u6570@Required\u5224\u65ad\u503c\u662f\u5426\u5b58\u5728@Text\u6587\u672c\u9a8c\u8bc1\u5fc5\u987b&gt;=6\u4f4d\u957f\u5ea6\uff0c\u6700\u957f\u4e0d\u9650\u5236\uff1a@Text(min=6)\u957f\u5ea6\u5fc5\u987b&gt;=6 && &lt;=12\uff1a@Text(min=6, max=12)@Integer\u6574\u6570\u9a8c\u8bc1\u9a8c\u8bc1\u5fc5\u987b\u4e3a\u6574\u6570\uff1a@Integer\u9a8c\u8bc1\u5fc5\u987b\u4e3a&gt;=1024\u7684\u6574\u6570\uff1a@Integer(min=1024)\u9a8c\u8bc1\u5fc5\u987b\u4e3a&lt;=1024\u7684\u6574\u6570\uff1a@Integer(max=1024)\u9a8c\u8bc1\u5fc5\u987b\u4e3a&gt;=1 && &lt;=10\u7684\u6574\u6570\uff1a@Integer(min=1, max=10)@Decimal\u5c0f\u6570\u9a8c\u8bc1\u9a8c\u8bc1\u5fc5\u987b\u4e3a\u5c0f\u6570\uff1a@Decimal\u9a8c\u8bc1\u5fc5\u987b\u4e3a&gt;=10.24\u7684\u5c0f\u6570\uff1a@Decimal(min=10.24)\u9a8c\u8bc1\u5fc5\u987b\u4e3a&lt;=10.24\u7684\u5c0f\u6570\uff1a@Decimal(max=10.24)\u9a8c\u8bc1\u5fc5\u987b\u4e3a&gt;=1 && &lt;=10.24\u7684\u5c0f\u6570\uff1a@Decimal(min=1, max=10.24)\u4f20\u51651\uff0c\u7ed3\u679c\u4e3afalse\u4f20\u51651.0\uff0c\u7ed3\u679c\u4e3atrue@Number\u6570\u503c\u9a8c\u8bc1\uff0c\u5141\u8bb8\u662f\u6574\u6570\u6216\u8005\u5c0f\u6570\u9a8c\u8bc1\u5fc5\u987b\u4e3a\u6570\u503c\uff1a@Decimal\u9a8c\u8bc1\u5fc5\u987b\u4e3a&gt;=10.24\u7684\u6570\u503c\uff1a@Decimal(min=10.24)\u9a8c\u8bc1\u5fc5\u987b\u4e3a&lt;=10.24\u7684\u6570\u503c\uff1a@Decimal(max=10.24)\u9a8c\u8bc1\u5fc5\u987b\u4e3a&gt;=1 && &lt;=10.24\u7684\u6570\u503c\uff1a@Decimal(min=1, max=10.24)\u4f20\u51651\uff0c\u7ed3\u679c\u4e3atrue\u4f20\u51651.0\uff0c\u7ed3\u679c\u4e3atrue@InList\u5217\u8868\u9a8c\u8bc1\uff0c\u5224\u65ad\u503c\u662f\u5426\u5b58\u5728\u4e8e\u5217\u8868\u4e2d@InList(list={1, 2, 3})\u76f8\u5f53\u4e8e\uff1a$result = in_array($value, [1, 2, 3]);@Compare\u6bd4\u8f83\u9a8c\u8bc1\u6ce8\u89e3@Compare(name=&quot;\u53c2\u6570\u540d&quot;, value=&quot;\u88ab\u6bd4\u8f83\u503c&quot;, operation=&quot;\u6bd4\u8f83\u7b26\uff0c\u5982\uff1a==&quot;)value \u53ef\u4ee5\u76f4\u63a5\u4f20\u503c\uff0c\u4e5f\u53ef\u4ee5\u914d\u5408 @ValidateValue \u6ce8\u89e3\u4f7f\u7528\u3002operation \u5141\u8bb8\u4f7f\u7528\uff1a==\u3001!=\u3001===\u3001!==\u3001&lt;\u3001&lt;=\u3001&gt;\u3001&gt;=@ValidateValue\u6307\u5b9a\u9a8c\u8bc1\u65f6\u7684\u503c\u6ce8\u89e3@Compare(name=&quot;id&quot;, value=@ValidateValue(&quot;{:data.id}&quot;), operation=&quot;==&quot;\u81ea\u52a8\u9a8c\u8bc1\u6ce8\u89e3\uff1a@AutoValidation\u9a8c\u8bc1\u7c7b\u5c5e\u6027imi \u652f\u6301\u5728\u7c7b\u3001\u5c5e\u6027\u4e0a\u4f7f\u7528 @AutoValidation \u6ce8\u89e3\uff0c\u5f53\u6784\u9020\u65b9\u6cd5\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u89e6\u53d1\u9a8c\u8bc1\u3002\u9a8c\u8bc1\u5931\u8d25\u629b\u51fa\u5f02\u5e38\u3002\u5982\u4e0b\u4ee3\u7801\uff0c\u5199\u5728\u7c7b\u4e0a\u7684\u6ce8\u89e3\u4ee5\u53ca\u5c5e\u6027\u4e0a\u7684\u6ce8\u89e3\uff0c\u90fd\u56e0\u4e3a\u52a0\u4e86@AutoValidation \u6ce8\u89e3\uff0c\u6240\u4ee5\u5728\u6784\u9020\u65b9\u6cd5\u6267\u884c\u5b8c\u6210\u540e\uff0c\u4f1a\u81ea\u52a8\u8fdb\u884c\u9a8c\u8bc1\uff0c\u9a8c\u8bc1\u5931\u8d25\u5219\u629b\u51fa\u5f02\u5e38\u3002\/**\n * @Bean(&quot;ValidatorTest&quot;)\n * \n * @AutoValidation\n * \n * \n * @InList(name=&quot;in&quot;, list={1, 2, 3}, message=&quot;{:value} \u4e0d\u5728\u5217\u8868\u5185&quot;)\n * @Integer(name=&quot;int&quot;, min=0, max=100, message=&quot;{:value} \u4e0d\u7b26\u5408\u5927\u4e8e\u7b49\u4e8e{min}\u4e14\u5c0f\u4e8e\u7b49\u4e8e{max}&quot;)\n * @Required(name=&quot;required&quot;, message=&quot;{name}\u4e3a\u5fc5\u987b\u53c2\u6570&quot;)\n * @Number(name=&quot;number&quot;, min=0.01, max=999.99, accuracy=2, message=&quot;\u6570\u503c\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e{min}\uff0c\u5c0f\u4e8e\u7b49\u4e8e{max}\uff0c\u5c0f\u6570\u70b9\u6700\u591a\u4fdd\u7559{accuracy}\u4f4d\u5c0f\u6570\uff0c\u5f53\u524d\u503c\u4e3a{:value}&quot;)\n * @Text(name=&quot;text&quot;, min=6, max=12, message=&quot;{name}\u53c2\u6570\u957f\u5ea6\u5fc5\u987b&gt;={min} &amp;&amp; &lt;={max}&quot;)\n * @Condition(name=&quot;my&quot;, callable=&quot;\\ImiDemo\\HttpDemo\\MainServer\\Validator\\Test::myValidate&quot;, args={&quot;{:value}&quot;}, message=&quot;{name}\u503c\u5fc5\u987b\u4e3a1&quot;)\n *\/\nclass Test\n{\n    \/**\n     * @Decimal(min=-0.01, max=999.99, accuracy=2, message=&quot;\u5c0f\u6570\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e{min}\uff0c\u5c0f\u4e8e\u7b49\u4e8e{max}\uff0c\u5c0f\u6570\u70b9\u6700\u591a\u4fdd\u7559{accuracy}\u4f4d\u5c0f\u6570\uff0c\u5f53\u524d\u503c\u4e3a{:value}&quot;)\n     *\n     * @var float\n     *\/\n    public $decimal;\n\n    public function __construct($data = [], $rules = null)\n    {\n        foreach($data as $name =&gt; $value)\n        {\n            $this-&gt;$name = $value;\n        }\n    }\n\n    public static function myValidate($value)\n    {\n        return 1 == $value;\n    }\n}\n\u9a8c\u8bc1\u65b9\u6cd5\u53c2\u6570\u5728 imi \u4e2d\uff0c\u5982\u679c\u4f60\u5728\u65b9\u6cd5\u4e0a\u4f7f\u7528 @AutoValidation \u6ce8\u89e3\uff0c\u5f53\u65b9\u6cd5\u88ab\u8c03\u7528\u524d\uff0c\u4f1a\u89e6\u53d1\u9a8c\u8bc1\u64cd\u4f5c\uff0c\u9a8c\u8bc1\u5931\u8d25\u5219\u629b\u51fa\u5f02\u5e38\u3002\u9a8c\u8bc1\u7684\u53c2\u6570\u662f\u4f20\u5165\u65b9\u6cd5\u7684\u53c2\u6570\uff0c\u5982\u4e0b\u4ee3\u7801\uff0c\u9a8c\u8bc1\u901a\u8fc7\u5219\u8fdb\u5165\u65b9\u6cd5\u4f53\u4e2d\uff0c\u9a8c\u8bc1\u5931\u8d25\u4f1a\u629b\u51fa\u5f02\u5e38\u3002\/**\n * @AutoValidation\n * \n * @Required(name=&quot;id&quot;, message=&quot;\u7528\u6237ID\u4e3a\u5fc5\u4f20\u53c2\u6570&quot;)\n * @Integer(name=&quot;id&quot;, min=&quot;1&quot;, message=&quot;\u7528\u6237ID\u4e0d\u7b26\u5408\u89c4\u5219&quot;)\n * @Required(name=&quot;name&quot;, message=&quot;\u7528\u6237\u59d3\u540d\u4e3a\u5fc5\u4f20\u53c2\u6570&quot;)\n * @Text(name=&quot;name&quot;, min=&quot;2&quot;, message=&quot;\u7528\u6237\u59d3\u540d\u957f\u5ea6\u4e0d\u5f97\u5c11\u4e8e2\u4f4d&quot;)\n *\n * @param int $id\n * @param string $name\n * @return void\n *\/\npublic function test222($id, $name)\n{\n    var_dump($id, $name);\n}\u624b\u52a8\u9a8c\u8bc1\u4f60\u4e5f\u53ef\u4ee5\u81ea\u5df1\u5b9a\u4e49\u4e00\u4e2a\u4e13\u95e8\u7528\u4e8e\u9a8c\u8bc1\u7684\u7c7b\uff0c\u5c06\u6570\u636e\u4f20\u5165\u8be5\u7c7b\uff0c\u624b\u52a8\u8c03\u7528\u9a8c\u8bc1\u65b9\u6cd5\u3002\/**\n * @Bean(&quot;ValidatorTest&quot;)\n * \n * @InList(name=&quot;in&quot;, list={1, 2, 3}, message=&quot;{:value} \u4e0d\u5728\u5217\u8868\u5185&quot;)\n * @Integer(name=&quot;int&quot;, min=0, max=100, message=&quot;{:value} \u4e0d\u7b26\u5408\u5927\u4e8e\u7b49\u4e8e{min}\u4e14\u5c0f\u4e8e\u7b49\u4e8e{max}&quot;)\n * @Required(name=&quot;required&quot;, message=&quot;{name}\u4e3a\u5fc5\u987b\u53c2\u6570&quot;)\n * @Number(name=&quot;number&quot;, min=0.01, max=999.99, accuracy=2, message=&quot;\u6570\u503c\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e{min}\uff0c\u5c0f\u4e8e\u7b49\u4e8e{max}\uff0c\u5c0f\u6570\u70b9\u6700\u591a\u4fdd\u7559{accuracy}\u4f4d\u5c0f\u6570\uff0c\u5f53\u524d\u503c\u4e3a{:value}&quot;)\n * @Text(name=&quot;text&quot;, min=6, max=12, message=&quot;{name}\u53c2\u6570\u957f\u5ea6\u5fc5\u987b&gt;={min} &amp;&amp; &lt;={max}&quot;)\n * @Condition(name=&quot;my&quot;, callable=&quot;\\ImiDemo\\HttpDemo\\MainServer\\Validator\\Test::myValidate&quot;, args={&quot;{:value}&quot;}, message=&quot;{name}\u503c\u5fc5\u987b\u4e3a1&quot;)\n *\/\nclass Test extends Validator\n{\n    \/**\n     * @Decimal(min=-0.01, max=999.99, accuracy=2, message=&quot;\u5c0f\u6570\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e{min}\uff0c\u5c0f\u4e8e\u7b49\u4e8e{max}\uff0c\u5c0f\u6570\u70b9\u6700\u591a\u4fdd\u7559{accuracy}\u4f4d\u5c0f\u6570\uff0c\u5f53\u524d\u503c\u4e3a{:value}&quot;)\n     *\n     * @var float\n     *\/\n    public $decimal;\n\n    public function __construct($data = [], $rules = null)\n    {\n        parent::__construct($data, $rules);\n        foreach($data as $name =&gt; $value)\n        {\n            $this-&gt;$name = $value;\n        }\n    }\n\n    public static function myValidate($value)\n    {\n        return 1 == $value;\n    }\n}\n\u5f53\u4f60\u4f7f\u7528\u624b\u52a8\u9a8c\u8bc1\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5new\u51fa\u6765\u4f7f\u7528\uff0c\u4e0d\u662f\u5f88\u6709\u5fc5\u8981\u4f7f\u7528\u5bb9\u5668\u3002\u4f7f\u7528\u4ee3\u7801\u793a\u4f8b\uff1a$v = new Test([\n    \/\/ 'decimal'   =&gt;  1.1,\n    \/\/ 'in'        =&gt;  1,\n    'int'       =&gt;  1,\n    'required'  =&gt;  1,\n    'number'    =&gt;  1,\n    'my'        =&gt;  1,\n]);\n\n\/\/ \u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u6570\u636e\n\/\/ $v-&gt;setData([]);\n\n\/\/ \u9a8c\u8bc1\uff0c\u5f53\u9047\u5230\u4e0d\u901a\u8fc7\u65f6\u7ed3\u675f\u9a8c\u8bc1\u6d41\u7a0b\n$result = $v-&gt;validate();\nif(!$result)\n{\n    echo 'error: ', $v-&gt;getMessage(), PHP_EOL;\n    \/\/ \u5f53\u524d\u9519\u8bef\u7684\u6ce8\u89e3\u89c4\u5219\n    var_dump($v-&gt;getFailRule());\n}\n\n\/\/ \u9a8c\u8bc1\u6240\u6709\n$result = $v-&gt;validateAll();\nif(!$result)\n{\n    var_dump(\n        \/\/ \u6240\u6709\u9519\u8bef\u6570\u7ec4\uff0c\u6ce8\u610f\u6bcf\u4e2a\u6210\u5458\u4e5f\u662f\u4e2a\u6570\u7ec4\uff0c\u91cc\u9762\u53ef\u80fd\u6709\u591a\u4e2a\n        $v-&gt;getResults()\n        \/\/ \u6240\u6709\u9519\u8bef\u7684\u6ce8\u89e3\u89c4\u5219\n        , $v-&gt;getFailRules()\n    );\n}\n\n\/\/ \u83b7\u5f97\u6570\u636e\uff0c\u5982\u679c\u4f60\u914d\u7f6e\u6709default\u5c5e\u6027\uff0c\u5e76\u4e14\u9a8c\u8bc1\u5931\u8d25\uff0c\u53ef\u4ee5\u83b7\u5f97\u9ed8\u8ba4\u503c\n$data = $v-&gt;getData();"},{"id":71,"parent_id":44,"title":"Lock \u9501","mdFileName":"components\/lock\/index.md","url":"components\/lock\/index.html","level":1,"content":"\u9501\u9501\uff08Lock\uff09\uff0c\u5728\u5e76\u53d1\u5904\u7406\uff0c\u9632\u6b62\u51b2\u7a81\u7684\u573a\u666f\u975e\u5e38\u5e38\u7528\u3002\u5728 imi \u4e2d\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u6ce8\u89e3\uff0c\u6216\u8005\u81ea\u5df1\u5b9e\u4f8b\u5316Lock\u7c7b\u6765\u5b9e\u73b0\u52a0\u9501\u5904\u7406\u3002\u9664\u4e86\u5185\u7f6e\u7684\u9501\u9a71\u52a8\u5916\uff0c\u4f60\u53ef\u4ee5\u5b9e\u73b0Imi\\Lock\\Handler\\ILockHandler\u63a5\u53e3\uff0c\u6765\u5b9e\u73b0\u5176\u4ed6\u65b9\u5f0f\u7684\u9501\u3002\u914d\u7f6e\u7528\u6cd5\u9700\u8981\u5728\u914d\u7f6e\u4e2d\u9884\u5b9a\u4e49\u914d\u7f6e\u8bf4\u660e\/\/ \u9501\n'lock'  =&gt;[\n    'list'  =&gt;  [\n        \/\/ \u9501 ID =&gt; \u914d\u7f6e\n        'redis' =&gt;  [\n            'class' =&gt;  'RedisLock', \/\/ Handler \u7c7b Bean \u540d\u6216\u5b8c\u6574\u7c7b\u540d\n            'options'   =&gt;  [\n                \/\/ Handler \u7c7b\u6240\u9700\u914d\u7f6e\n                'poolName'  =&gt;  'redis_test',\n            ],\n        ],\n    ],\n],\u4f7f\u7528\u8bf4\u660e\u987a\u5e8f\u7528\u6cd5\uff1ause Imi\\Lock\\Lock;\n$lockId = ''; \/\/ \u4f60\u5b9a\u4e49\u7684ID\nif(Lock::lock($lockId))\n{\n    try {\n        \/\/ \u5e72\u4e00\u4e9b\u4e8b\u60c5\n    } catch(\\Throwable $th) {\n        throw $th;\n    } finally {\n        Lock::unlock($lockId);\n    }\n}\u56de\u8c03\u7528\u6cd5\uff08\u65e0\u9700\u624b\u52a8\u91ca\u653e\u9501\uff09\uff1a$result = Lock::lock($lockId, function(){\n    \/\/ \u6267\u884c\u4efb\u52a1\n}, function(){\n    \/\/ return \u975enull\u5219\u4e0d\u6267\u884c\u4efb\u52a1\n    \/\/ \u4e00\u822c\u7528\u4e8e\u9632\u6b62\u7f13\u5b58\u51fb\u7a7f\n    \/\/ \u8fd9\u4e2a\u56de\u8c03\u53ef\u4ee5\u4e0d\u4f20\n});\nif($result)\n{\n    \/\/ \u52a0\u9501\u5e76\u6267\u884c\u6210\u529f\n}\nelse\n{\n    \/\/ \u52a0\u9501\u5931\u8d25\n}\u83b7\u53d6 Handler \u5bf9\u8c61\uff1a$lock = Lock::getInstance($lockId);\n$lock-&gt;lock(); \/\/ \u4f7f\u7528\u65b9\u6cd5\u53c2\u8003\u4e0b\u9762\u7684\u201c\u5b9e\u4f8b\u5316\u4f7f\u7528\u65b9\u6cd5\u201d\u6ce8\u89e3\u4f7f\u7528@Lockable\u65e0\u9700\u5728\u914d\u7f6e\u4e2d\u9884\u5b9a\u4e49\u652f\u6301\u53c2\u6570\uff1a\/**\n * \u9501ID\n * \u652f\u6301{id}\u3001{data.name}\u5f62\u5f0f\uff0c\u4ee3\u5165\u53c2\u6570\n * \u5982\u679c\u4e3anull\uff0c\u5219\u4f7f\u7528\u7c7b\u540d+\u65b9\u6cd5\u540d+\u5168\u90e8\u53c2\u6570\uff0c\u5e8f\u5217\u5316\u540ehash\n *\n * @var string|null\n *\/\npublic $id;\n\n\/**\n * \u9501\u7c7b\u578b\uff0c\u5982\uff1aRedisLock\n * \u4e3anull\u5219\u4f7f\u7528\u9ed8\u8ba4\u9501\u7c7b\u578b\uff08@currentServer.lock.defaultType\uff09\n *\n * @var string|null\n *\/\npublic $type;\n\n\/**\n * \u7b49\u5f85\u9501\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\uff0c0\u4e3a\u4e0d\u9650\u5236\n * \n * @var int\n *\/\npublic $waitTimeout = 3000;\n\n\/**\n * \u9501\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n * \n * @var int\n *\/\npublic $lockExpire = 3000;\n\n\/**\n * \u9501\u521d\u59cb\u5316\u53c2\u6570\n *\n * @var array\n *\/\npublic $options = [];\n\n\/**\n * \u5f53\u83b7\u5f97\u9501\u540e\u6267\u884c\u7684\u56de\u8c03\u3002\u8be5\u56de\u8c03\u8fd4\u56de\u975e null \u5219\u4e0d\u6267\u884c\u52a0\u9501\u540e\u7684\u65b9\u6cd5\uff0c\u672c\u56de\u8c03\u7684\u8fd4\u56de\u503c\u5c06\u4f5c\u4e3a\u8fd4\u56de\u503c\n * \u4e00\u822c\u7528\u4e8e\u9632\u6b62\u7f13\u5b58\u51fb\u7a7f\uff0c\u83b7\u5f97\u9501\u540e\u518d\u505a\u4e00\u6b21\u68c0\u6d4b\n * \u5982\u679c\u4e3a{&quot;$this&quot;, &quot;methodName&quot;}\u683c\u5f0f\uff0c$this\u5c06\u4f1a\u88ab\u66ff\u6362\u4e3a\u5f53\u524d\u7c7b\uff0c\u65b9\u6cd5\u5fc5\u987b\u4e3a public \u6216 protected\n * \n * @var callable\n *\/\npublic $afterLock;\u7528\u6cd5\u793a\u4f8b\u6700\u7b80\u5355\u7684\u9501\uff1a\u53ea\u6307\u5b9aid\uff0c\u5176\u5b83\u5168\u90e8\u9ed8\u8ba4\u503c@Lockable(id=&quot;\u9501ID&quot;)\u5b9a\u4e49\u6267\u884c\u4efb\u52a1\u524d\u7684\u64cd\u4f5c\uff1aclass Test\n{\n    \/**\n     * @Lockable(id=&quot;\u9501ID&quot;, afterLock={&quot;$this&quot;, &quot;check&quot;})\n     *\/\n    public function index()\n    {\n        return 1;\n    }\n\n    protected function check()\n    {\n        return 2;\n    }\n\n    \/**\n     * @Lockable(id=&quot;\u9501ID&quot;, afterLock={&quot;$this&quot;, &quot;check2&quot;})\n     *\/\n    public function index2()\n    {\n        return 3;\n    }\n\n    protected function check2()\n    {\n        \n    }\n}\n\n$result = App::getBean('Test')-&gt;index();\necho $result, PHP_EOL; \/\/ 2\n\n$result = App::getBean('Test')-&gt;index2();\necho $result, PHP_EOL; \/\/ 3\u5b9e\u4f8b\u5316\u4f7f\u7528\u65b9\u6cd5\u65e0\u9700\u5728\u914d\u7f6e\u4e2d\u9884\u5b9a\u4e49\u987a\u5e8f\u7528\u6cd5$redisLock = new \\Imi\\Lock\\Handler\\Redis('\u9501ID', [\n    'poolName'  =&gt; 'redis', \/\/ Redis \u8fde\u63a5\u6c60\u540d\u79f0\uff0c\u9ed8\u8ba4\u53d6redis.default\u914d\u7f6e\n    'db'        =&gt;  1, \/\/ Redis \u51e0\u53f7\u5e93\uff0c\u9ed8\u8ba40\n    'waitSleepTime' =&gt;  20, \/\/ \u83b7\u5f97\u9501\u6bcf\u6b21\u5c1d\u8bd5\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n    'keyPrefix' =&gt;  'imi:lock:', \/\/ Redis key \u524d\u7f6e\n]);\n\nif($redisLock-&gt;lock())\n{\n    \/\/ \u52a0\u9501\u540e\u7684\u5904\u7406\n\n    \/\/ \u89e3\u9501\n    $redisLock-&gt;unlock();\n}\nelse\n{\n    \/\/ \u52a0\u9501\u5931\u8d25\u7684\u5904\u7406\n}\u56de\u8c03\u7528\u6cd5$redisLock = new \\Imi\\Lock\\Handler\\Redis('\u9501ID', [\n    'poolName'  =&gt; 'redis', \/\/ Redis \u8fde\u63a5\u6c60\u540d\u79f0\uff0c\u9ed8\u8ba4\u53d6redis.default\u914d\u7f6e\n    'db'        =&gt;  1, \/\/ Redis \u51e0\u53f7\u5e93\uff0c\u9ed8\u8ba40\n    'waitSleepTime' =&gt;  20, \/\/ \u83b7\u5f97\u9501\u6bcf\u6b21\u5c1d\u8bd5\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n    'keyPrefix' =&gt;  'imi:lock:', \/\/ Redis key \u524d\u7f6e\n]);\n\n\/\/ \u6267\u884c\u540e\u81ea\u52a8\u89e3\u9501\n$result = $redisLock-&gt;lock(function(){\n    \/\/ \u6267\u884c\u4efb\u52a1\n}, function(){\n    \/\/ return \u975enull\u5219\u4e0d\u6267\u884c\u4efb\u52a1\n    \/\/ \u4e00\u822c\u7528\u4e8e\u9632\u6b62\u7f13\u5b58\u51fb\u7a7f\n});\n\nif($result)\n{\n    \/\/ \u52a0\u9501\u5e76\u6267\u884c\u6210\u529f\n}\nelse\n{\n    \/\/ \u52a0\u9501\u5931\u8d25\n}"},{"id":72,"parent_id":71,"title":"\u4f7f\u7528\u65b9\u6cd5","mdFileName":"components\/lock\/index.md","url":"components\/lock\/index.html","level":2,"content":"\u9501\u9501\uff08Lock\uff09\uff0c\u5728\u5e76\u53d1\u5904\u7406\uff0c\u9632\u6b62\u51b2\u7a81\u7684\u573a\u666f\u975e\u5e38\u5e38\u7528\u3002\u5728 imi \u4e2d\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u6ce8\u89e3\uff0c\u6216\u8005\u81ea\u5df1\u5b9e\u4f8b\u5316Lock\u7c7b\u6765\u5b9e\u73b0\u52a0\u9501\u5904\u7406\u3002\u9664\u4e86\u5185\u7f6e\u7684\u9501\u9a71\u52a8\u5916\uff0c\u4f60\u53ef\u4ee5\u5b9e\u73b0Imi\\Lock\\Handler\\ILockHandler\u63a5\u53e3\uff0c\u6765\u5b9e\u73b0\u5176\u4ed6\u65b9\u5f0f\u7684\u9501\u3002\u914d\u7f6e\u7528\u6cd5\u9700\u8981\u5728\u914d\u7f6e\u4e2d\u9884\u5b9a\u4e49\u914d\u7f6e\u8bf4\u660e\/\/ \u9501\n'lock'  =&gt;[\n    'list'  =&gt;  [\n        \/\/ \u9501 ID =&gt; \u914d\u7f6e\n        'redis' =&gt;  [\n            'class' =&gt;  'RedisLock', \/\/ Handler \u7c7b Bean \u540d\u6216\u5b8c\u6574\u7c7b\u540d\n            'options'   =&gt;  [\n                \/\/ Handler \u7c7b\u6240\u9700\u914d\u7f6e\n                'poolName'  =&gt;  'redis_test',\n            ],\n        ],\n    ],\n],\u4f7f\u7528\u8bf4\u660e\u987a\u5e8f\u7528\u6cd5\uff1ause Imi\\Lock\\Lock;\n$lockId = ''; \/\/ \u4f60\u5b9a\u4e49\u7684ID\nif(Lock::lock($lockId))\n{\n    try {\n        \/\/ \u5e72\u4e00\u4e9b\u4e8b\u60c5\n    } catch(\\Throwable $th) {\n        throw $th;\n    } finally {\n        Lock::unlock($lockId);\n    }\n}\u56de\u8c03\u7528\u6cd5\uff08\u65e0\u9700\u624b\u52a8\u91ca\u653e\u9501\uff09\uff1a$result = Lock::lock($lockId, function(){\n    \/\/ \u6267\u884c\u4efb\u52a1\n}, function(){\n    \/\/ return \u975enull\u5219\u4e0d\u6267\u884c\u4efb\u52a1\n    \/\/ \u4e00\u822c\u7528\u4e8e\u9632\u6b62\u7f13\u5b58\u51fb\u7a7f\n    \/\/ \u8fd9\u4e2a\u56de\u8c03\u53ef\u4ee5\u4e0d\u4f20\n});\nif($result)\n{\n    \/\/ \u52a0\u9501\u5e76\u6267\u884c\u6210\u529f\n}\nelse\n{\n    \/\/ \u52a0\u9501\u5931\u8d25\n}\u83b7\u53d6 Handler \u5bf9\u8c61\uff1a$lock = Lock::getInstance($lockId);\n$lock-&gt;lock(); \/\/ \u4f7f\u7528\u65b9\u6cd5\u53c2\u8003\u4e0b\u9762\u7684\u201c\u5b9e\u4f8b\u5316\u4f7f\u7528\u65b9\u6cd5\u201d\u6ce8\u89e3\u4f7f\u7528@Lockable\u65e0\u9700\u5728\u914d\u7f6e\u4e2d\u9884\u5b9a\u4e49\u652f\u6301\u53c2\u6570\uff1a\/**\n * \u9501ID\n * \u652f\u6301{id}\u3001{data.name}\u5f62\u5f0f\uff0c\u4ee3\u5165\u53c2\u6570\n * \u5982\u679c\u4e3anull\uff0c\u5219\u4f7f\u7528\u7c7b\u540d+\u65b9\u6cd5\u540d+\u5168\u90e8\u53c2\u6570\uff0c\u5e8f\u5217\u5316\u540ehash\n *\n * @var string|null\n *\/\npublic $id;\n\n\/**\n * \u9501\u7c7b\u578b\uff0c\u5982\uff1aRedisLock\n * \u4e3anull\u5219\u4f7f\u7528\u9ed8\u8ba4\u9501\u7c7b\u578b\uff08@currentServer.lock.defaultType\uff09\n *\n * @var string|null\n *\/\npublic $type;\n\n\/**\n * \u7b49\u5f85\u9501\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\uff0c0\u4e3a\u4e0d\u9650\u5236\n * \n * @var int\n *\/\npublic $waitTimeout = 3000;\n\n\/**\n * \u9501\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n * \n * @var int\n *\/\npublic $lockExpire = 3000;\n\n\/**\n * \u9501\u521d\u59cb\u5316\u53c2\u6570\n *\n * @var array\n *\/\npublic $options = [];\n\n\/**\n * \u5f53\u83b7\u5f97\u9501\u540e\u6267\u884c\u7684\u56de\u8c03\u3002\u8be5\u56de\u8c03\u8fd4\u56de\u975e null \u5219\u4e0d\u6267\u884c\u52a0\u9501\u540e\u7684\u65b9\u6cd5\uff0c\u672c\u56de\u8c03\u7684\u8fd4\u56de\u503c\u5c06\u4f5c\u4e3a\u8fd4\u56de\u503c\n * \u4e00\u822c\u7528\u4e8e\u9632\u6b62\u7f13\u5b58\u51fb\u7a7f\uff0c\u83b7\u5f97\u9501\u540e\u518d\u505a\u4e00\u6b21\u68c0\u6d4b\n * \u5982\u679c\u4e3a{&quot;$this&quot;, &quot;methodName&quot;}\u683c\u5f0f\uff0c$this\u5c06\u4f1a\u88ab\u66ff\u6362\u4e3a\u5f53\u524d\u7c7b\uff0c\u65b9\u6cd5\u5fc5\u987b\u4e3a public \u6216 protected\n * \n * @var callable\n *\/\npublic $afterLock;\u7528\u6cd5\u793a\u4f8b\u6700\u7b80\u5355\u7684\u9501\uff1a\u53ea\u6307\u5b9aid\uff0c\u5176\u5b83\u5168\u90e8\u9ed8\u8ba4\u503c@Lockable(id=&quot;\u9501ID&quot;)\u5b9a\u4e49\u6267\u884c\u4efb\u52a1\u524d\u7684\u64cd\u4f5c\uff1aclass Test\n{\n    \/**\n     * @Lockable(id=&quot;\u9501ID&quot;, afterLock={&quot;$this&quot;, &quot;check&quot;})\n     *\/\n    public function index()\n    {\n        return 1;\n    }\n\n    protected function check()\n    {\n        return 2;\n    }\n\n    \/**\n     * @Lockable(id=&quot;\u9501ID&quot;, afterLock={&quot;$this&quot;, &quot;check2&quot;})\n     *\/\n    public function index2()\n    {\n        return 3;\n    }\n\n    protected function check2()\n    {\n        \n    }\n}\n\n$result = App::getBean('Test')-&gt;index();\necho $result, PHP_EOL; \/\/ 2\n\n$result = App::getBean('Test')-&gt;index2();\necho $result, PHP_EOL; \/\/ 3\u5b9e\u4f8b\u5316\u4f7f\u7528\u65b9\u6cd5\u65e0\u9700\u5728\u914d\u7f6e\u4e2d\u9884\u5b9a\u4e49\u987a\u5e8f\u7528\u6cd5$redisLock = new \\Imi\\Lock\\Handler\\Redis('\u9501ID', [\n    'poolName'  =&gt; 'redis', \/\/ Redis \u8fde\u63a5\u6c60\u540d\u79f0\uff0c\u9ed8\u8ba4\u53d6redis.default\u914d\u7f6e\n    'db'        =&gt;  1, \/\/ Redis \u51e0\u53f7\u5e93\uff0c\u9ed8\u8ba40\n    'waitSleepTime' =&gt;  20, \/\/ \u83b7\u5f97\u9501\u6bcf\u6b21\u5c1d\u8bd5\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n    'keyPrefix' =&gt;  'imi:lock:', \/\/ Redis key \u524d\u7f6e\n]);\n\nif($redisLock-&gt;lock())\n{\n    \/\/ \u52a0\u9501\u540e\u7684\u5904\u7406\n\n    \/\/ \u89e3\u9501\n    $redisLock-&gt;unlock();\n}\nelse\n{\n    \/\/ \u52a0\u9501\u5931\u8d25\u7684\u5904\u7406\n}\u56de\u8c03\u7528\u6cd5$redisLock = new \\Imi\\Lock\\Handler\\Redis('\u9501ID', [\n    'poolName'  =&gt; 'redis', \/\/ Redis \u8fde\u63a5\u6c60\u540d\u79f0\uff0c\u9ed8\u8ba4\u53d6redis.default\u914d\u7f6e\n    'db'        =&gt;  1, \/\/ Redis \u51e0\u53f7\u5e93\uff0c\u9ed8\u8ba40\n    'waitSleepTime' =&gt;  20, \/\/ \u83b7\u5f97\u9501\u6bcf\u6b21\u5c1d\u8bd5\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n    'keyPrefix' =&gt;  'imi:lock:', \/\/ Redis key \u524d\u7f6e\n]);\n\n\/\/ \u6267\u884c\u540e\u81ea\u52a8\u89e3\u9501\n$result = $redisLock-&gt;lock(function(){\n    \/\/ \u6267\u884c\u4efb\u52a1\n}, function(){\n    \/\/ return \u975enull\u5219\u4e0d\u6267\u884c\u4efb\u52a1\n    \/\/ \u4e00\u822c\u7528\u4e8e\u9632\u6b62\u7f13\u5b58\u51fb\u7a7f\n});\n\nif($result)\n{\n    \/\/ \u52a0\u9501\u5e76\u6267\u884c\u6210\u529f\n}\nelse\n{\n    \/\/ \u52a0\u9501\u5931\u8d25\n}"},{"id":73,"parent_id":71,"title":"RedisLock","mdFileName":"components\/lock\/redis.md","url":"components\/lock\/redis.html","level":2,"content":"RedisLockRedisLock \u662f\u652f\u6301\u5206\u5e03\u5f0f\u7684\u9501\u3002\u4f7f\u7528\u524d\u9700\u8981\u914d\u7f6e Redis \u8fdb\u7a0b\u6c60\u3002\u7c7b\uff1aImi\\Lock\\Handler\\RedisBean \u540d\uff1aRedisLock\u53ef\u914d\u7f6e\u53c2\u6570\/**\n * \u9501\u7684\u552f\u4e00 ID\n *\n * @var string\n *\/\nprotected $id;\n\n\/**\n * \u7b49\u5f85\u9501\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\uff0c0\u4e3a\u4e0d\u9650\u5236\n * \n * @var int\n *\/\nprotected $waitTimeout = 3000;\n\n\/**\n * \u9501\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n * \n * @var int\n *\/\nprotected $lockExpire = 3000;\n\n\/**\n * Redis \u8fde\u63a5\u6c60\u540d\u79f0\n *\n * @var string\n *\/\npublic $poolName;\n\n\/**\n * Redis \u51e0\u53f7\u5e93\n *\n * @var integer\n *\/\npublic $db = 0;\n\n\/**\n * \u83b7\u5f97\u9501\u6bcf\u6b21\u5c1d\u8bd5\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n * \n * @var int\n *\/\npublic $waitSleepTime = 20;\n\n\/**\n * Redis key\n *\n * @var string\n *\/\npublic $key;\n\n\/**\n * Redis key \u524d\u7f6e\n *\n * @var string\n *\/\npublic $keyPrefix = 'imi:lock:';\n\u914d\u7f6e\u793a\u4f8b\/\/ \u9501\n'lock'  =&gt;[\n    'list'  =&gt;  [\n        'redis' =&gt;  [\n            'class' =&gt;  'RedisLock',\n            'options'   =&gt;  [\n                'poolName'  =&gt;  'redis_test',\n            ],\n        ],\n    ],\n],"},{"id":74,"parent_id":71,"title":"AtomicLock","mdFileName":"components\/lock\/atomic.md","url":"components\/lock\/atomic.html","level":2,"content":"AtomicLockAtomicLock \u662f\u5355\u673a\u8fdb\u7a0b\u9501\uff0c\u4f1a\u963b\u585e\u3002\u4f7f\u7528\u524d\u9700\u8981\u914d\u7f6e Atomic\u3002\u6ce8\u610f\uff01\u4f1a\u963b\u585e\u5f53\u524d\u8fdb\u7a0b\uff0c\u4e0d\u5efa\u8bae\u5728 worker \u8fdb\u7a0b\u4e2d\u4f7f\u7528\uff01\u7c7b\uff1aImi\\Lock\\Handler\\AtomicBean \u540d\uff1aAtomicLock\u53ef\u914d\u7f6e\u53c2\u6570\/**\n * \u9501\u7684\u552f\u4e00 ID\n *\n * @var string\n *\/\nprotected $id;\n\n\/**\n * \u7b49\u5f85\u9501\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\uff0c0\u4e3a\u4e0d\u9650\u5236\n * \n * @var int\n *\/\nprotected $waitTimeout = 3000;\n\n\/**\n * \u9501\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n * \n * @var int\n *\/\nprotected $lockExpire = 3000;\n\n\/**\n * \u914d\u7f6e\u7684 Atomic \u540d\u79f0\n *\n * @var string\n *\/\npublic $atomicName;\n\n\/**\n * \u540c\u65f6\u83b7\u5f97\u9501\u7684\u6570\u91cf\n * \n * @var int\n *\/\npublic $quantity = 1;\n\u914d\u7f6e\u793a\u4f8b\/\/ \u9501\n'lock'  =&gt;[\n    'list'  =&gt;  [\n        'atomic' =&gt;  [\n            'class' =&gt;  'AtomicLock',\n            'options'   =&gt;  [\n                'atomicName'    =&gt;  'atomicLock',\n            ],\n        ],\n    ],\n],"},{"id":75,"parent_id":44,"title":"\u4e8b\u4ef6\u76d1\u542c","mdFileName":"components\/event\/index.md","url":"components\/event\/index.html","level":1,"content":"\u4e8b\u4ef6\u76d1\u542c\u5168\u5c40\u4e8b\u4ef6\u4e8b\u4ef6\u76d1\u542c\u6ce8\u89e3\u76d1\u542c\u4ee5imi\/src\/Listener\/Init.php\u4e3a\u4f8b&lt;?php\nnamespace Imi\\Listener;\n\nuse Imi\\Event\\EventParam;\nuse Imi\\Event\\IEventListener;\nuse Imi\\Bean\\Annotation\\Listener;\n\n\/**\n * @Listener(eventName=&quot;IMI.INITED&quot;,priority=PHP_INT_MAX)\n *\/\nclass Init implements IEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5\n     * @param EventParam $e\n     * @return void\n     *\/\n    public function handle(EventParam $e)\n    {\n        \/\/ ...\n    }\n}\u9996\u5148\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u7c7b\uff0c\u7c7b\u540d\u548c\u4f4d\u7f6e\u65e0\u6240\u8c13\uff0c\u53ea\u8981\u914d\u7f6e\u4e86beanScan\u80fd\u88ab\u626b\u63cf\u5230\u5373\u53ef\u3002\u7c7b\u5fc5\u987b\u5b9e\u73b0IEventListener\u63a5\u53e3\u548cpublic function handle(EventParam $e)\u65b9\u6cd5\u3002\u7136\u540e\u5728\u7c7b\u4e0a\u5199@Listener\u6ce8\u89e3\u3002\u6ce8\u89e3\u6709\u4e24\u4e2a\u53c2\u6570\uff1aeventName\u8981\u76d1\u542c\u7684\u4e8b\u4ef6\u540d\u79f0priority\u4e8b\u4ef6\u89e6\u53d1\u540e\u6267\u884c\u7684\u4f18\u5148\u7ea7\uff0c\u6570\u5b57\u8d8a\u5927\u8d8a\u5148\u6267\u884c\uff0c\u540c\u6837\u5927\u6267\u884c\u987a\u5e8f\u4e0d\u4e00\u5b9a\u4ee3\u7801\u76d1\u542c\u9664\u4e86\u4f7f\u7528\u6ce8\u89e3\uff0c\u4f60\u8fd8\u53ef\u4ee5\u5199\u4ee3\u7801\u624b\u52a8\u76d1\u542cuse Imi\\Event\\Event;\n\nEvent::on('\u4e8b\u4ef6\u540d', function(){\n    \/\/ \u4e8b\u4ef6\u56de\u8c03\n});\n\n$priority = 0;\nEvent::on('\u4e8b\u4ef6\u540d', function(){\n    \/\/ \u4e8b\u4ef6\u56de\u8c03\n}, $priority);\n\n\/\/ \u76d1\u542c\u53ea\u89e6\u53d1\u4e00\u6b21\nEvent::one('\u4e8b\u4ef6\u540d', function(){});\n\n\/\/ \u53d6\u6d88\u4e8b\u4ef6\nEvent::off('\u4e8b\u4ef6\u540d', $callable);\u81ea\u5b9a\u4e49\u4e8b\u4ef6use Imi\\Event\\Event;\n\nEvent::trigger('\u4e8b\u4ef6\u540d\u79f0', '\u4f20\u5165\u4e8b\u4ef6\u56de\u8c03\u7684\u6570\u636e', '\u76ee\u6807\u5bf9\u8c61', '\u53c2\u6570\u7c7b\uff0c\u9ed8\u8ba4\u4e3aEventParam::class');\u5c40\u90e8\u4e8b\u4ef6\u5c40\u90e8\u4e8b\u4ef6\u5c31\u662f\u5728\u67d0\u4e2a\u7c7b\u5b9e\u4f8b\u7684\u4e8b\u4ef6\u3002\u4e8b\u4ef6\u76d1\u542c\u6ce8\u89e3\u76d1\u542c\u4ee5imi\/src\/Server\/Http\/Listener\/BeforeRequest.php\u4e3a\u4f8b&lt;?php\nnamespace Imi\\Server\\Http\\Listener;\n\nuse Imi\\Bean\\Annotation\\ClassEventListener;\nuse Imi\\Server\\Event\\Param\\RequestEventParam;\nuse Imi\\Server\\Event\\Listener\\IRequestEventListener;\n\n\/**\n * request\u4e8b\u4ef6\u524d\u7f6e\u5904\u7406\n * @ClassEventListener(className=&quot;Imi\\Server\\Http\\Server&quot;,eventName=&quot;request&quot;,priority=PHP_INT_MAX)\n *\/\nclass BeforeRequest implements IRequestEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5\n     * @param RequestEventParam $e\n     * @return void\n     *\/\n    public function handle(RequestEventParam $e)\n    {\n        \/\/ ...\n    }\n}\u9996\u5148\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u7c7b\uff0c\u7c7b\u540d\u548c\u4f4d\u7f6e\u65e0\u6240\u8c13\uff0c\u53ea\u8981\u914d\u7f6e\u4e86beanScan\u80fd\u88ab\u626b\u63cf\u5230\u5373\u53ef\u3002\u7c7b\u5fc5\u987b\u5b9e\u73b0\u5bf9\u5e94\u63a5\u53e3\u548chandle()\u65b9\u6cd5\uff0c\u6bcf\u4e2a\u7c7b\u7684\u4e8b\u4ef6\u5b9a\u4e49\u4e0d\u540c\u3002\u7136\u540e\u5728\u7c7b\u4e0a\u5199@ClassEventListener\u6ce8\u89e3\u3002\u6ce8\u89e3\u53c2\u6570\u5982\u4e0b\uff1aclassName\u7c7b\u540deventName\u8981\u76d1\u542c\u7684\u4e8b\u4ef6\u540d\u79f0priority\u4e8b\u4ef6\u89e6\u53d1\u540e\u6267\u884c\u7684\u4f18\u5148\u7ea7\uff0c\u6570\u5b57\u8d8a\u5927\u8d8a\u5148\u6267\u884c\uff0c\u540c\u6837\u5927\u6267\u884c\u987a\u5e8f\u4e0d\u4e00\u5b9a\u4ee3\u7801\u76d1\u542c$object-&gt;on('\u4e8b\u4ef6\u540d', function(){\n    \/\/ \u4e8b\u4ef6\u56de\u8c03\n});\n\n$priority = 0;\n$object-&gt;on('\u4e8b\u4ef6\u540d', function(){\n    \/\/ \u4e8b\u4ef6\u56de\u8c03\n}, $priority);\n\n\/\/ \u76d1\u542c\u53ea\u89e6\u53d1\u4e00\u6b21\n$object-&gt;one('\u4e8b\u4ef6\u540d', function(){});\n\n\/\/ \u53d6\u6d88\u4e8b\u4ef6\n$object-&gt;off('\u4e8b\u4ef6\u540d', $callable);\n\u81ea\u5b9a\u4e49\u4e8b\u4ef6$object-&gt;trigger('\u4e8b\u4ef6\u540d\u79f0', '\u4f20\u5165\u4e8b\u4ef6\u56de\u8c03\u7684\u6570\u636e', '\u76ee\u6807\u5bf9\u8c61', '\u53c2\u6570\u7c7b\uff0c\u9ed8\u8ba4\u4e3aEventParam::class');"},{"id":76,"parent_id":44,"title":"\u540e\u53f0\u4efb\u52a1","mdFileName":"components\/task\/index.md","url":"components\/task\/index.html","level":1,"content":"\u540e\u53f0\u4efb\u52a1\u8bf4\u660e\u5728\u540e\u53f0\u4efb\u52a1\u4e2d\uff0c\u56e0\u4e3a\u662f\u8fd0\u884c\u5728task\u8fdb\u7a0b\uff0c\u6240\u4ee5\u65e0\u6cd5\u4f7f\u7528\u534f\u7a0b\u548c\u534f\u7a0b\u5ba2\u6237\u7aef\u3002\u5982\u679c\u4f60\u8981\u64cd\u4f5c\u6570\u636e\u5e93\u6216Redis\uff0c\u4e00\u5b9a\u8981\u914d\u7f6e\u540c\u6b65\u7684\u8fde\u63a5\u6c60\u3002\u914d\u7f6e\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\u4e2dmainServer.configs.task_worker_num\u4e00\u5b9a\u8981\u914d\u7f6e\u4e3a\u5927\u4e8e0\uff0c\u5426\u5219\u65e0\u6cd5\u4f7f\u7528\u540e\u53f0\u4efb\u52a1\u3002\u5b9a\u4e49\u4efb\u52a1\u6267\u884c\u7c7b&lt;?php\nnamespace Test;\n\nuse Imi\\Task\\TaskParam;\nuse Imi\\Task\\Interfaces\\ITaskHandler;\n\nclass Test implements ITaskHandler\n{\n    \/**\n     * \u4efb\u52a1\u5904\u7406\u65b9\u6cd5\n     * @param TaskParam $param\n     * @param \\Swoole\\Server $server\n     * @param integer $taskID\n     * @param integer $WorkerID\n     * @return void\n     *\/\n    public function handle(TaskParam $param, \\Swoole\\Server $server, int $taskID, int $WorkerID)\n    {\n        \/\/ \u6295\u9012\u4efb\u52a1\u65f6\u7684\u6570\u636e\n        $data = $param-&gt;getData();\n    }\n\n    \/**\n     * \u4efb\u52a1\u7ed3\u675f\u65f6\u89e6\u53d1\n     * @param \\swoole_server $server\n     * @param int $taskId\n     * @param mixed $data\n     * @return void\n     *\/\n    public function finish(\\Swoole\\Server $server, int $taskID, $data)\n    {\n        \n    }\n}\u7c7b\u540d\u65e0\u6240\u8c13\uff0c\u5b9e\u73b0ITaskHandler\u63a5\u53e3\u548c\u4e24\u4e2a\u65b9\u6cd5\u5373\u53ef\u3002\u6295\u9012\u4efb\u52a1\u6295\u9012\u5f02\u6b65\u4efb\u52a1TaskManager::post(new TaskInfo(\n    \/\/ \u4e0a\u9762\u5b9a\u4e49\u7684\u7c7b\u7684\u5b9e\u4f8b\n    new TestTask,\n    \/\/ \u6267\u884c\u4efb\u52a1\u7684\u53c2\u6570\uff0c\u6784\u9020\u65b9\u6cd5\u53ef\u4ee5\u63a5\u6536\u4e00\u4e2a\u6570\u7ec4\n    new TaskParam([\n        'time'    =&gt;    time(),\n    ])\n));\u8c03\u7528\u540e\u7acb\u5373\u8fd4\u56de\uff0c\u4e0d\u5f71\u54cd\u4e0b\u9762\u4ee3\u7801\u7684\u6267\u884c\u540c\u6b65\u6295\u9012\u4efb\u52a1TaskManager::postWait(new TaskInfo(\n    \/\/ \u4e0a\u9762\u5b9a\u4e49\u7684\u7c7b\u7684\u5b9e\u4f8b\n    new TestTask,\n    \/\/ \u6267\u884c\u4efb\u52a1\u7684\u53c2\u6570\uff0c\u6784\u9020\u65b9\u6cd5\u53ef\u4ee5\u63a5\u6536\u4e00\u4e2a\u6570\u7ec4\n    new TaskParam([\n        'time'    =&gt;    time(),\n    ]),\n    \/\/ \u6700\u957f\u7b49\u5f85\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n    0.5\n));\u6295\u9012\u4efb\u52a1\u540e\u963b\u585e\u7b49\u5f85\u6267\u884c\u5b8c\u6bd5\u6216\u8d85\u65f6\uff0c\u8fd4\u56de\u503c\u4e3a\u4efb\u52a1\u6267\u884c\u7ed3\u679c\u6216false\u534f\u7a0b\u6279\u91cf\u6295\u9012\u4efb\u52a1TaskManager::postCo([new TaskInfo(\n    \/\/ \u4e0a\u9762\u5b9a\u4e49\u7684\u7c7b\u7684\u5b9e\u4f8b\n    new TestTask,\n    \/\/ \u6267\u884c\u4efb\u52a1\u7684\u53c2\u6570\uff0c\u6784\u9020\u65b9\u6cd5\u53ef\u4ee5\u63a5\u6536\u4e00\u4e2a\u6570\u7ec4\n    new TaskParam([\n        'time'    =&gt;    time(),\n    ])\n)],\n\/\/ \u6700\u957f\u7b49\u5f85\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n0.5);\u4f20\u5165\u6570\u7ec4\u548c\u8d85\u65f6\u65f6\u95f4\uff0c\u6295\u9012\u540e\u6302\u8d77\u534f\u7a0b\uff0c\u5f53\u5168\u90e8\u6267\u884c\u5b8c\u6bd5\u6216\u8d85\u65f6\u540e\u8fd4\u56de\u7ed3\u679c\u3002\u8fd4\u56de\u503c\u4e3a\u6570\u7ec4\uff0c\u5bf9\u5e94\u6bcf\u4e2a\u4efb\u52a1\u7684\u6267\u884c\u7ed3\u679c\u3002\u6ce8\u89e3\u5b9a\u4e49\u4efb\u52a1\u6267\u884c\u7c7b&lt;?php\nnamespace Test;\n\nuse Imi\\Task\\TaskParam;\nuse Imi\\Task\\Interfaces\\ITaskHandler;\n\n\/**\n * @Task(&quot;testTask&quot;)\n *\/\nclass Test implements ITaskHandler\n{\n    \/**\n     * \u4efb\u52a1\u5904\u7406\u65b9\u6cd5\n     * @param TaskParam $param\n     * @param \\Swoole\\Server $server\n     * @param integer $taskID\n     * @param integer $WorkerID\n     * @return void\n     *\/\n    public function handle(TaskParam $param, \\Swoole\\Server $server, int $taskID, int $WorkerID)\n    {\n        \/\/ \u6295\u9012\u4efb\u52a1\u65f6\u7684\u6570\u636e\n        $data = $param-&gt;getData();\n    }\n\n    \/**\n     * \u4efb\u52a1\u7ed3\u675f\u65f6\u89e6\u53d1\n     * @param \\swoole_server $server\n     * @param int $taskId\n     * @param mixed $data\n     * @return void\n     *\/\n    public function finish(\\Swoole\\Server $server, int $taskID, $data)\n    {\n        \n    }\n}\u7c7b\u540d\u65e0\u6240\u8c13\uff0c\u5b9e\u73b0ITaskHandler\u63a5\u53e3\u548c\u4e24\u4e2a\u65b9\u6cd5\u5373\u53ef\u3002\u6295\u9012\u4efb\u52a1\u6295\u9012\u5f02\u6b65\u4efb\u52a1TaskManager::nPost(\n\/\/ \u4efb\u52a1\u540d\u79f0\n'testTask'\n\/\/ \u4efb\u52a1\u53c2\u6570\n, [\n    'time'    =&gt;    time(),\n]\n);\u8c03\u7528\u540e\u7acb\u5373\u8fd4\u56de\uff0c\u4e0d\u5f71\u54cd\u4e0b\u9762\u4ee3\u7801\u7684\u6267\u884c\u540c\u6b65\u6295\u9012\u4efb\u52a1TaskManager::nPostWait(new TaskInfo(\n    \/\/ \u4efb\u52a1\u540d\u79f0\n    'testTask'\n    \/\/ \u4efb\u52a1\u53c2\u6570\n    , [\n        'time'    =&gt;    time(),\n    ]\n    \/\/ \u6700\u957f\u7b49\u5f85\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n    0.5\n));\u6295\u9012\u4efb\u52a1\u540e\u963b\u585e\u7b49\u5f85\u6267\u884c\u5b8c\u6bd5\u6216\u8d85\u65f6\uff0c\u8fd4\u56de\u503c\u4e3a\u4efb\u52a1\u6267\u884c\u7ed3\u679c\u6216false\u534f\u7a0b\u6279\u91cf\u6295\u9012\u4efb\u52a1TaskManager::postWait([\n['testTask', ['time'=&gt;time()]],\n['testTask', ['time'=&gt;time()]],\n],\n\/\/ \u6700\u957f\u7b49\u5f85\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n0.5);"},{"id":77,"parent_id":44,"title":"AOP","mdFileName":"components\/aop\/index.md","url":"components\/aop\/index.html","level":1,"content":"AOP\u4ecb\u7ecd\u9996\u5148\uff0c\u4f60\u4e0d\u8981\u770b\u5230 AOP \u5c31\u611f\u89c9\u597d\u96be\u597d\u590d\u6742\uff0c\u770b\u4e0b\u53bb\u5176\u5b9e\u4e5f\u5c31\u90a3\u6837\u3002\u800c\u4e14\u5728 IMI \u4e2d\u4f60\u4e5f\u4e0d\u4e00\u5b9a\u9700\u8981\u7528\u5230AOP\uff0c\u8fd9\u662f\u975e\u5fc5\u987b\u7684\u3002AOP \u7684\u6982\u5ff5\u901a\u8fc7\u641c\u7d22\u5f15\u64ce\u4e00\u5b9a\u662f\u770b\u70e6\u4e86\uff0c\u800c\u4e14\u770b\u4e86\u4e5f\u6ca1\u4ec0\u4e48\u5927\u5375\u7528\uff0c\u4e0d\u8d34\u8fd1\u5b9e\u9645\u3002\u6211\u5148\u4e3e\u4e2a AOP \u5b9e\u9645\u5e94\u7528\u7684\u7b80\u5355\u4f8b\u5b50\uff0c\u6bd4\u5982\u5728\u5199\u4e00\u4e2a\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u8981\u9488\u5bf9\u67d0\u4e2a\u65b9\u6cd5\u5199\u524d\u7f6e\u548c\u540e\u7f6e\u64cd\u4f5c\uff0c\u4f20\u7edf\u5199\u6cd5\u5982\u4e0b\uff1aabstract class ParentClass\n{\n    public function test()\n    {\n        $this-&gt;__beforeTest();\n        \/\/ \u505a\u4e00\u4e9b\u4e8b\u60c5...\n        echo 'Parent-&gt;test()', PHP_EOL;\n        $this-&gt;__afterTest();\n    }\n\n    public abstract function __beforeTest();\n\n    public abstract function __afterTest();\n}\n\nclass Child extends ParentClass\n{\n    public function __beforeTest()\n    {\n        echo 'Child-&gt;__beforeTest()', PHP_EOL;\n    }\n\n    public function __afterTest()\n    {\n        echo 'Child-&gt;__afterTest()', PHP_EOL;\n    }\n}\n\n$child = new Child;\n$child-&gt;test();\u8fd0\u884c\u7ed3\u679c\uff1aChild-&gt;__beforeTest()\nParent-&gt;test()\nChild-&gt;__afterTest()\u8fd9\u79cd\u5199\u6cd5\u4f60\u9700\u8981\u4e8b\u5148\u5b9a\u4e49\u597d\u524d\u7f6e\u548c\u540e\u7f6e\u65b9\u6cd5\uff0c\u5982\u679c\u9700\u8981\u524d\u540e\u7f6e\u7684\u65b9\u6cd5\u4e00\u591a\uff0c\u5199\u8d77\u6765\u4f1a\u975e\u5e38\u7e41\u7410\u3002AOP \u53ef\u4ee5\u5f88\u597d\u5730\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u5728\u7f16\u5199\u4e0a\u4e0d\u7528\u4e8b\u5148\u5b9a\u4e49\u8fd9\u4e48\u591a\u65b9\u6cd5\uff0c\u8fd8\u975e\u5e38\u6709\u52a9\u4e8e\u89e3\u8026\u3002AOP \u540d\u8bcd\u5207\u9762 Aspect\u666e\u901a\u7684\u7c7b\uff0c\u4f60\u8981\u5207\u5165\u7684\u7c7b\u3002\u5207\u5165\u70b9 Pointcut\u666e\u901a\u7c7b\u4e2d\u7684\u65b9\u6cd5\uff0c\u4f60\u8981\u5207\u5165\u7684\u65b9\u6cd5\u3002\u8fde\u63a5\u70b9 Joinpoint\u5728\u8fd9\u4e2a\u65b9\u6cd5\u76f8\u5173\u7684\u4ec0\u4e48\u65f6\u673a\u89e6\u53d1\u901a\u77e5\uff0c\u6bd4\u5982\uff1a\u8c03\u7528\u7684\u524d\u7f6e\u540e\u7f6e\u3001\u629b\u51fa\u5f02\u5e38\u7b49\u3002\u901a\u77e5 Advice\u5728\u8fde\u63a5\u70b9\u89e6\u53d1\u7684\u901a\u77e5\uff0c\u6bd4\u5982\u5728\u524d\u7f6e\u64cd\u4f5c\u89e6\u53d1\uff0c\u901a\u77e5\u91cc\u5199\u524d\u7f6e\u7684\u5177\u4f53\u5b9e\u73b0\u3002IMI \u652f\u6301\u7684\u901a\u77e5\u70b9\u6709\uff1a@Before\u524d\u7f6e\u64cd\u4f5c@After\u540e\u7f6e\u64cd\u4f5c@Around\u73af\u7ed5\u64cd\u4f5c\u3002\u5148\u89e6\u53d1\u73af\u7ed5\u64cd\u4f5c\uff0c\u5728\u524d\u7f6e\u64cd\u4f5c\u524d\u548c\u540e\u7f6e\u64cd\u4f5c\u540e\uff0c\u90fd\u53ef\u4ee5\u505a\u4e00\u4e9b\u4e8b\u60c5\u3002\u751a\u81f3\u53ef\u4ee5\u5b8c\u5168\u4e0d\u8ba9\u539f\u65b9\u6cd5\u8fd0\u884c\uff0c\u5728\u73af\u7ed5\u4e2d\u5b9e\u73b0\u8be5\u65b9\u6cd5\u529f\u80fd\u3002@AfterReturning\u5728\u539f\u65b9\u6cd5\u8fd4\u56de\u540e\u89e6\u53d1\uff0c\u53ef\u4ee5\u4fee\u6539\u8fd4\u56de\u503c@AfterThrowing\u5728\u629b\u51fa\u5f02\u5e38\u540e\u89e6\u53d1\uff0c\u5141\u8bb8\u8bbe\u7f6eallow\u548cdeny\uff0c\u8bbe\u7f6e\u5141\u8bb8\u548c\u62d2\u7edd\u6355\u83b7\u7684\u5f02\u5e38\u7c7b\u4f7f\u7528\u65b9\u6cd5\u4f7f\u7528\u6ce8\u89e3\u6ce8\u5165\u65b9\u6cd5\u76d1\u542c\u6c60\u5b50\u7684\u8d44\u6e90\u83b7\u53d6\u548c\u91ca\u653e\uff1a&lt;?php\nnamespace Test;\n\nuse Imi\\Aop\\JoinPoint;\nuse Imi\\Aop\\Annotation\\After;\nuse Imi\\Aop\\Annotation\\Aspect;\nuse Imi\\Aop\\Annotation\\PointCut;\n\n\/**\n * @Aspect\n *\/\nclass Pool\n{\n    \/**\n     * @PointCut(\n     *         allow={\n     *             &quot;Imi\\*Pool*::getResource&quot;,\n     *             &quot;Imi\\*Pool*::release&quot;,\n     *         }\n     * )\n     * @After\n     * @param JoinPoint $a\n     * @return void\n     *\/\n    public function test(JoinPoint $joinPoint)\n    {\n        echo $joinPoint-&gt;getType() . ' ' . get_parent_class($joinPoint-&gt;getTarget()) . '::' . $joinPoint-&gt;getMethod() . '(): ' . $joinPoint-&gt;getTarget()-&gt;getFree() . '\/' . $joinPoint-&gt;getTarget()-&gt;getCount() . PHP_EOL;\n    }\n}\u8fd0\u884c\u6548\u679c\uff1aafter Imi\\Redis\\CoroutineRedisPool::getResource(): 0\/1\nafter Imi\\Redis\\CoroutineRedisPool::release(): 1\/1\u7c7b\u540d\u3001\u65b9\u6cd5\u540d\u548c\u547d\u540d\u7a7a\u95f4\u6ca1\u6709\u8981\u6c42\uff0c\u53ea\u8981beanScan\u91cc\u80fd\u626b\u63cf\u5230\u5373\u53ef\u3002\u7c7b\u6ce8\u91ca\u4e2d\u5fc5\u987b\u5199@Aspect\u8868\u540d\u662f\u4e00\u4e2a\u5207\u9762\u7c7b\u65b9\u6cd5\u4e2d\u5199@PointCut\u8868\u793a\u6307\u5b9a\u5207\u5165\u70b9\uff0c\u652f\u6301\u901a\u914d\u7b26@After\u4ee3\u8868\u5728\u8be5\u65b9\u6cd5\u8c03\u7528\u540e\u89e6\u53d1\u6ce8\u5165\u5e26\u6709\u6ce8\u89e3\u7684\u65b9\u6cd5\u53ef\u53c2\u8003imi\\src\\Db\\Aop\\TransactionAop.php\u6587\u4ef6\uff1a\/**\n * @Aspect\n *\/\nclass TransactionAop\n{\n    \/**\n     * \u81ea\u52a8\u4e8b\u52a1\u652f\u6301\n     * @PointCut(\n     *         type=PointCutType::ANNOTATION,\n     *         allow={\n     *             Transaction::class\n     *         }\n     * )\n     * @Around\n     * @return mixed\n     *\/\n    public function parseTransaction(AroundJoinPoint $joinPoint)\n    {\n    }\n}\u65e0\u8bba\u8fd9\u4e2a\u6ce8\u89e3\u5728\u65b9\u6cd5\u4e0a\u51fa\u73b0\u4e86\u51e0\u6b21\uff0c\u90fd\u53ea\u4f1a\u89e6\u53d1\u4e00\u6b21\u6ce8\u5165\u5904\u7406\u914d\u7f6e\u6ce8\u5165\u5b9e\u73b0\u4ee3\u7801namespace Test;\n\nuse Imi\\Aop\\JoinPoint;\n\nclass Test\n{\n    \/**\n     * @param JoinPoint $a\n     * @return void\n     *\/\n    public function test(JoinPoint $joinPoint)\n    {\n        echo $joinPoint-&gt;getType() . ' ' . get_parent_class($joinPoint-&gt;getTarget()) . '::' . $joinPoint-&gt;getMethod() . '(): ' . $joinPoint-&gt;getTarget()-&gt;getFree() . '\/' . $joinPoint-&gt;getTarget()-&gt;getCount() . PHP_EOL;\n    }\n}\u5bf9\u7c7b\u6ca1\u6709\u4efb\u4f55\u8981\u6c42\uff0c\u65b9\u6cd5\u53ea\u9700\u8981\u53c2\u6570\u5bf9\u5373\u53ef\u3002\u914d\u7f6e&lt;?php\nreturn [\n    \/\/ \u7c7b\u540d\n    \\Test\\Test::class    =&gt;    [\n        \/\/ \u56fa\u5b9a\u5199\u6cd5methods\n        'methods'    =&gt;    [\n            \/\/ \u65b9\u6cd5\u540d\n            'test'    =&gt;    [\n                \/\/ \u6307\u5b9a\u5207\u5165\u70b9\n                'pointCut'    =&gt;    [\n                    'allow'    =&gt;    [\n                        &quot;Imi\\*Pool*::getResource&quot;,\n                        &quot;Imi\\*Pool*::release&quot;,\n                    ]\n                ],\n                'after'    =&gt;    [\n                    \n                ]\n            ]\n        ]\n    ],\n];\u6240\u6709\u6ce8\u5165\u6f14\u793a&lt;?php\nnamespace Test;\n\nuse Imi\\Aop\\JoinPoint;\nuse Imi\\Aop\\AroundJoinPoint;\nuse Imi\\Aop\\Annotation\\After;\nuse Imi\\Aop\\Annotation\\Around;\nuse Imi\\Aop\\Annotation\\Aspect;\nuse Imi\\Aop\\Annotation\\Before;\nuse Imi\\Aop\\Annotation\\PointCut;\nuse Imi\\Aop\\AfterThrowingJoinPoint;\nuse Imi\\Aop\\AfterReturningJoinPoint;\nuse Imi\\Aop\\Annotation\\AfterThrowing;\nuse Imi\\Aop\\Annotation\\AfterReturning;\n\n\/**\n * @Aspect\n *\/\nclass Test\n{\n    \/**\n     * \u524d\u7f6e\u64cd\u4f5c\n     * @PointCut(\n     *         allow={\n     *             &quot;ImiDemo\\HttpDemo\\MainServer\\Model\\Goods::getScore&quot;,\n     *         }\n     * )\n     * @Before\n     * @param JoinPoint $a\n     * @return void\n     *\/\n    public function before(JoinPoint $joinPoint)\n    {\n        \/\/ \u4fee\u6539\u53c2\u6570\n        \/\/ $joinPoint-&gt;setArgs(\/*\u53c2\u6570\u6570\u7ec4*\/);\n        echo 'getScore()-before', PHP_EOL;\n    }\n\n    \/**\n     * \u540e\u7f6e\u64cd\u4f5c\n     * @PointCut(\n     *         allow={\n     *             &quot;ImiDemo\\HttpDemo\\MainServer\\Model\\Goods::getScore&quot;,\n     *         }\n     * )\n     * @After\n     * @param JoinPoint $a\n     * @return void\n     *\/\n    public function after(JoinPoint $joinPoint)\n    {\n        echo 'getScore()-after', PHP_EOL;\n    }\n\n    \/**\n     * \u73af\u7ed5\n     * @PointCut(\n     *         allow={\n     *             &quot;ImiDemo\\HttpDemo\\MainServer\\Model\\Goods::getScore1&quot;,\n     *         }\n     * )\n     * @Around\n     * @return mixed\n     *\/\n    public function around(AroundJoinPoint $joinPoint)\n    {\n        var_dump('\u8c03\u7528\u524d');\n        \/\/ \u8c03\u7528\u539f\u65b9\u6cd5\uff0c\u83b7\u53d6\u8fd4\u56de\u503c\n        $result = $joinPoint-&gt;proceed();\n        var_dump('\u8c03\u7528\u540e');\n        return 'value'; \/\/ \u65e0\u89c6\u539f\u65b9\u6cd5\u8c03\u7528\u540e\u7684\u8fd4\u56de\u503c\uff0c\u5f3a\u5236\u8fd4\u56de\u4e00\u4e2a\u5176\u5b83\u503c\n        return $result; \/\/ \u8fd4\u56de\u539f\u65b9\u6cd5\u8fd4\u56de\u503c\n    }\n\n    \/**\n     * \u8fd4\u56de\u503c\n     * @PointCut(\n     *         allow={\n     *             &quot;ImiDemo\\HttpDemo\\MainServer\\Model\\Goods::getScore&quot;,\n     *         }\n     * )\n     * @AfterReturning\n     * @param AfterReturningJoinPoint $joinPoint\n     * @return void\n     *\/\n    public function afterReturning(AfterReturningJoinPoint $joinPoint)\n    {\n        $joinPoint-&gt;setReturnValue('\u4fee\u6539\u8fd4\u56de\u503c');\n    }\n\n    \/**\n     * \u5f02\u5e38\u6355\u83b7\n     * @PointCut(\n     *         allow={\n     *             &quot;ImiDemo\\HttpDemo\\MainServer\\Model\\Goods::getScore&quot;,\n     *         }\n     * )\n     * @AfterThrowing\n     * @param AfterThrowingJoinPoint $joinPoint\n     * @return void\n     *\/\n    public function afterThrowing(AfterThrowingJoinPoint $joinPoint)\n    {\n        \/\/ \u5f02\u5e38\u4e0d\u4f1a\u88ab\u7ee7\u7eed\u629b\u51fa\n        $joinPoint-&gt;cancelThrow();\n        var_dump('\u5f02\u5e38\u6355\u83b7:' . $joinPoint-&gt;getThrowable()-&gt;getMessage());\n    }\n}\n\u5c5e\u6027\u6ce8\u5165\u5982\u4e0b\u4ee3\u7801\u4f8b\u5b50\uff0c\u5b9a\u4e49\u4e00\u4e2a\u7c7b\uff0c\u4f7f\u7528@Inject\u6ce8\u89e3\u6765\u6ce8\u91ca\u5c5e\u6027\uff0c\u5728\u901a\u8fc7getBean()\u5b9e\u4f8b\u5316\u65f6\uff0c\u4f1a\u81ea\u52a8\u7ed9\u88ab\u6ce8\u91ca\u7684\u5c5e\u6027\u8d4b\u503c\u76f8\u5e94\u7684\u5b9e\u4f8b\u5bf9\u8c61\u3002namespace Test;\n\nclass TestClass\n{\n    \/**\n     * \u67d0Model\u5bf9\u8c61\n     * @Inject(&quot;XXX\\Model\\User&quot;)\n     *\/\n    protected $model;\n    \n    public function test()\n    {\n        var_dump($model-&gt;toArray());\n    }\n}\n\n$testClass = App::getBean('Test\\TestClass');\n$testClass-&gt;test();\u975e Bean \u7c7b\u4f7f\u7528\u5c5e\u6027\u6ce8\u5165imi \u63d0\u4f9b\u4e86\u4e00\u4e2a Imi\\Bean\\Traits\\TAutoInject \u6765\u8ba9\u975e Bean \u7c7b\u4e5f\u80fd\u591f\u4f7f\u7528\u5c5e\u6027\u6ce8\u5165\u3002\u4e5f\u5c31\u662f\u76f4\u63a5new\u5bf9\u8c61\uff0c\u4e5f\u53ef\u4ee5\u81ea\u52a8\u6ce8\u5165\u5c5e\u6027\u3002\u5f53\u7136\uff0c\u8fd9\u4e2a\u7c7b\u7684\u547d\u540d\u7a7a\u95f4\u5fc5\u987b\u5728beanScan\u4e2d\u914d\u7f6e\uff0c\u80fd\u88ab\u626b\u63cf\u5230\u624d\u53ef\u4ee5\u6b63\u5e38\u6ce8\u5165\u3002\u65e0\u6784\u9020\u65b9\u6cd5\u7684\u7c7b\uff1anamespace Test;\n\nuse Imi\\Aop\\Annotation\\Inject;\n\nclass Test\n{\n    use Imi\\Bean\\Traits\\TAutoInject;\n\n    \/**\n     * @Inject(&quot;XXX&quot;)\n     *\/\n    public $xxx;\n}\n\n$test = new Test;\n$test-&gt;xxx; \/\/ \u4f1a\u88ab\u81ea\u52a8\u6ce8\u5165\uff0c\u4e0d\u7528\u624b\u52a8\u521d\u59cb\u5316\u6709\u6784\u9020\u65b9\u6cd5\u7684\u7c7b\uff1anamespace Test;\n\nuse Imi\\Aop\\Annotation\\Inject;\n\nclass Test\n{\n    use Imi\\Bean\\Traits\\TAutoInject;\n\n    \/**\n     * @Inject(&quot;XXX&quot;)\n     *\/\n    public $xxx;\n\n    private $value;\n\n    public function __construct()\n    {\n        $this-&gt;__autoInject(); \/\/ \u624b\u52a8\u8c03\u7528 __autoInject() \u65b9\u6cd5\n        $this-&gt;value = 123;\n    }\n}\n\n$test = new Test;\n$test-&gt;xxx; \/\/ \u4f1a\u88ab\u81ea\u52a8\u6ce8\u5165\uff0c\u4e0d\u7528\u624b\u52a8\u521d\u59cb\u5316\u65b9\u6cd5\u53c2\u6570\u6ce8\u5165\/**\n * @InjectArg(name=&quot;a&quot;, value=&quot;123&quot;)\n * @InjectArg(name=&quot;b&quot;, value=@Inject(&quot;\\ImiDemo\\HttpDemo\\MainServer\\Model\\User&quot;))\n *\n * @return void\n *\/\npublic function test($a, $b)\n{\n    var_dump($a, $b);\n}\u53ef\u4ee5\u76f4\u63a5\u6ce8\u5165\u503c\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u503c\u6ce8\u5165\u6ce8\u89e3\u3002"},{"id":78,"parent_id":44,"title":"\u8fdb\u7a0b","mdFileName":"components\/process\/index.md","url":"components\/process\/index.html","level":1,"content":"\u8fdb\u7a0bIMI \u4e2d\u5bf9\u8fdb\u7a0b\u7684\u521b\u5efa\u548c\u8fd0\u884c\u505a\u4e86\u7b80\u5355\u5c01\u88c5\u3002\u5b9a\u4e49\u8fdb\u7a0b&lt;?php\nnamespace ImiDemo\\HttpDemo\\MainServer\\Process;\n\nuse Imi\\Process\\BaseProcess;\nuse Imi\\Process\\Annotation\\Process;\n\n\/**\n * @Process(&quot;tp1&quot;)\n *\/\nclass TestProcess extends BaseProcess\n{\n    public function run(\\Swoole\\Process $process)\n    {\n        var_dump($this-&gt;data);\n        sleep(3);\n        var_dump('testProcess');\n    }\n}\u6ce8\u89e3@Process\/**\n * \u8fdb\u7a0b\u540d\u79f0\n * @var string\n *\/\npublic $name;\n\n\/**\n * \u91cd\u5b9a\u5411\u5b50\u8fdb\u7a0b\u7684\u6807\u51c6\u8f93\u5165\u548c\u8f93\u51fa\u3002\u542f\u7528\u6b64\u9009\u9879\u540e\uff0c\u5728\u5b50\u8fdb\u7a0b\u5185\u8f93\u51fa\u5185\u5bb9\u5c06\u4e0d\u662f\u6253\u5370\u5c4f\u5e55\uff0c\u800c\u662f\u5199\u5165\u5230\u4e3b\u8fdb\u7a0b\u7ba1\u9053\u3002\u8bfb\u53d6\u952e\u76d8\u8f93\u5165\u5c06\u53d8\u4e3a\u4ece\u7ba1\u9053\u4e2d\u8bfb\u53d6\u6570\u636e\u3002\u9ed8\u8ba4\u4e3a\u963b\u585e\u8bfb\u53d6\u3002\n * @var boolean\n *\/\npublic $redirectStdinStdout = false;\n\n\/**\n * \u7ba1\u9053\u7c7b\u578b\uff0c\u542f\u7528$redirectStdinStdout\u540e\uff0c\u6b64\u9009\u9879\u5c06\u5ffd\u7565\u7528\u6237\u53c2\u6570\uff0c\u5f3a\u5236\u4e3a1\u3002\u5982\u679c\u5b50\u8fdb\u7a0b\u5185\u6ca1\u6709\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e3a 0\n * @var int\n *\/\npublic $pipeType = 2;\u521b\u5efa\u8fdb\u7a0b\u901a\u8fc7\u6ce8\u89e3\u4e2d\u7684\u8fdb\u7a0b\u540d\u79f0\u521b\u5efa\u8fdb\u7a0b\uff0c\u8fd4\u56de\\Swoole\\Process\u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u9700\u8981\u624b\u52a8\u8c03\u7528start()\u65b9\u6cd5\u6765\u8fd0\u884c\u8fdb\u7a0b\u3002\/**\n * \u521b\u5efa\u8fdb\u7a0b\n * \u672c\u65b9\u6cd5\u65e0\u6cd5\u5728\u63a7\u5236\u5668\u4e2d\u4f7f\u7528\n * \u8fd4\u56de\\Swoole\\Process\u5bf9\u8c61\u5b9e\u4f8b\n * \n * @param string $name\n * @param array $args\n * @param boolean $redirectStdinStdout\n * @param int $pipeType\n * @return \\Swoole\\Process\n *\/\nProcessManager::create($name, $args = [], $redirectStdinStdout = null, $pipeType = null): \\Swoole\\Process\u8fd0\u884c\u8fdb\u7a0b\uff0c\u540c\u6b65\u963b\u585e\u7b49\u5f85\u8fdb\u7a0b\u6267\u884c\u8fd4\u56de\/**\n * \u8fd0\u884c\u8fdb\u7a0b\uff0c\u540c\u6b65\u963b\u585e\u7b49\u5f85\u8fdb\u7a0b\u6267\u884c\u8fd4\u56de\n * \u4e0d\u8fd4\u56de\\Swoole\\Process\u5bf9\u8c61\u5b9e\u4f8b\n * \u6267\u884c\u5931\u8d25\u8fd4\u56defalse\uff0c\u6267\u884c\u6210\u529f\u8fd4\u56de\u6570\u7ec4\uff0c\u5305\u542b\u4e86\u8fdb\u7a0b\u9000\u51fa\u7684\u72b6\u6001\u7801\u3001\u4fe1\u53f7\u3001\u8f93\u51fa\u5185\u5bb9\u3002\n * array(\n *     'code' =&gt; 0,\n *     'signal' =&gt; 0,\n *     'output' =&gt; '',\n * );\n *\n * @param string $name\n * @param array $args\n * @param boolean $redirectStdinStdout\n * @param int $pipeType\n * @return array\n *\/\nProcessManager::run($name, $args = [], $redirectStdinStdout = null, $pipeType = null)\u8fd0\u884c\u8fdb\u7a0b\uff0c\u521b\u5efa\u4e00\u4e2a\u534f\u7a0b\u6267\u884c\u8fdb\u7a0b\uff0c\u65e0\u6cd5\u83b7\u53d6\u8fdb\u7a0b\u6267\u884c\u7ed3\u679c\/**\n * \u8fd0\u884c\u8fdb\u7a0b\uff0c\u521b\u5efa\u4e00\u4e2a\u534f\u7a0b\u6267\u884c\u8fdb\u7a0b\uff0c\u65e0\u6cd5\u83b7\u53d6\u8fdb\u7a0b\u6267\u884c\u7ed3\u679c\n * \u6267\u884c\u5931\u8d25\u8fd4\u56defalse\uff0c\u6267\u884c\u6210\u529f\u8fd4\u56de\u6570\u7ec4\uff0c\u5305\u542b\u4e86\u8fdb\u7a0b\u9000\u51fa\u7684\u72b6\u6001\u7801\u3001\u4fe1\u53f7\u3001\u8f93\u51fa\u5185\u5bb9\u3002\n * array(\n *     'code' =&gt; 0,\n *     'signal' =&gt; 0,\n *     'output' =&gt; '',\n * );\n *\n * @param string $name\n * @param array $args\n * @param boolean $redirectStdinStdout\n * @param int $pipeType\n * @return void\n *\/\nProcessManager::coRun($name, $args = [], $redirectStdinStdout = null, $pipeType = null)\u8fd0\u884c\u8fdb\u7a0b\uff0c\u6258\u7ba1\u5230 Manager \u8fdb\u7a0b\u8fd9\u4e2a\u7528\u6cd5\u53ea\u80fd\u5728IMI.SERVERS.CREATE.AFTER\u4e8b\u4ef6\u4e2d\u4f7f\u7528\uff01\/**\n * \u6302\u9760Manager\u8fdb\u7a0b\u8fd0\u884c\u8fdb\u7a0b\n *\n * @param string $name\n * @param array $args\n * @param boolean $redirectStdinStdout\n * @param int $pipeType\n * @return void\n *\/\npublic static function runWithManager($name, $args = [], $redirectStdinStdout = null, $pipeType = null)"},{"id":79,"parent_id":44,"title":"\u8fdb\u7a0b\u6c60","mdFileName":"components\/process-pool\/index.md","url":"components\/process-pool\/index.html","level":1,"content":"\u8fdb\u7a0b\u6c60IMI \u4e2d\u5bf9\u8fdb\u7a0b\u6c60\u7684\u521b\u5efa\u548c\u8fd0\u884c\u505a\u4e86\u7b80\u5355\u5c01\u88c5\uff0c\u57fa\u4e8eSwoole\\Process\\Pool\u5b9e\u73b0\u3002\u5b9a\u4e49\u8fdb\u7a0b\u6c60&lt;?php\nnamespace XinchengApi\\api\\ProcessPool;\n\nuse Imi\\Process\\Annotation\\ProcessPool;\n\n\/**\n * @ProcessPool(name=&quot;\u8fdb\u7a0b\u540d\u79f0&quot;)\n *\/\nclass Sms extends \\Imi\\Process\\BasePoolProcess\n{\n    public function run(\\Swoole\\Process\\Pool $pool, int $workerId, $name, $workerNum, $args, $ipcType, $msgQueueKey)\n    {\n        \/\/ \u505a\u4e00\u4e9b\u4e8b\u60c5\n    }\n}\u6ce8\u89e3@ProcessPool\/**\n * \u8fdb\u7a0b\u6c60\u540d\u79f0\n * @var string\n *\/\npublic $name;\n\n\/**\n * \u8fdb\u7a0b\u6570\u91cf\n *\n * @var int\n *\/\npublic $workerNum = 1;\n\n\/**\n * \u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u4e3a0\u8868\u793a\u4e0d\u4f7f\u7528\u4efb\u4f55\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7279\u6027\n *\n * @var integer\n *\/\npublic $ipcType = 0;\n\n\/**\n * \u6d88\u606f\u961f\u5217key\n *\n * @var string\n *\/\npublic $msgQueueKey = null;\u521b\u5efa\u8fdb\u7a0b\u6c60\u901a\u8fc7\u6ce8\u89e3\u4e2d\u7684\u8fdb\u7a0b\u540d\u79f0\u521b\u5efa\u8fdb\u7a0b\uff0c\u8fd4\u56de\\Swoole\\Process\u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u9700\u8981\u624b\u52a8\u8c03\u7528start()\u65b9\u6cd5\u6765\u8fd0\u884c\u8fdb\u7a0b\u3002\/**\n * \u521b\u5efa\u8fdb\u7a0b\u6c60\n * \u672c\u65b9\u6cd5\u65e0\u6cd5\u5728\u63a7\u5236\u5668\u4e2d\u4f7f\u7528\n * \u8fd4\u56de\\Swoole\\Process\\Pool\u5bf9\u8c61\u5b9e\u4f8b\n * \n * @param string $name\n * @param int $workerNum \u6307\u5b9a\u5de5\u4f5c\u8fdb\u7a0b\u7684\u6570\u91cf\n * @param array $args\n * @param int $ipcType \u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u4e3a0\u8868\u793a\u4e0d\u4f7f\u7528\u4efb\u4f55\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7279\u6027\n * @param string $msgQueueKey\n * @return \\Swoole\\Process\\Pool\n *\/\npublic static function create($name, $workerNum = null, $args = [], $ipcType = 0, $msgQueueKey = null): \\Swoole\\Process\\Pool"},{"id":80,"parent_id":44,"title":"\u70ed\u66f4\u65b0","mdFileName":"components\/hotupdate\/index.md","url":"components\/hotupdate\/index.html","level":1,"content":"\u70ed\u66f4\u65b0\u7531\u4e8e IMI \u57fa\u4e8e Swoole \u5e38\u9a7b\u5185\u5b58\uff0c\u6240\u4ee5 PHP \u7684\u4e00\u5927\u7279\u70b9\u70ed\u66f4\u65b0\u5c31\u6ca1\u6709\u4e86\u3002\u4e3a\u6b64\uff0cIMI \u4e2d\u5b9e\u73b0\u4e86\u4e1a\u52a1\u4ee3\u7801\u7684\u70ed\u66f4\u65b0\uff0c\u65b9\u4fbf\u5f00\u53d1\u8c03\u8bd5\u3001\u52a8\u6001\u90e8\u7f72\uff0c\u652f\u6301\u5e73\u6ed1\u91cd\u8f7d\u3002\u6709\u4e86\u70ed\u66f4\u65b0\uff0c\u5f00\u53d1\u65f6\u53ea\u9700\u8981\u4fdd\u5b58\u4ee3\u7801\uff0c\u77ed\u77ed\u51e0\u79d2\u751a\u81f3\u4e00\u77ac\u95f4\uff0c\u5237\u65b0\u9875\u9762\uff0c\u5c31\u53ef\u4ee5\u7acb\u5373\u770b\u5230\u6548\u679c\uff01\u914d\u7f6eIMI \u9ed8\u8ba4\u5f00\u542f\u4e86\u70ed\u66f4\u65b0\uff0c\u5982\u679c\u9700\u8981\u5173\u95ed\u6216\u8005\u4e2a\u6027\u5316\u8bbe\u7f6e\u8bf7\u770b\u4e0b\u6587\uff1a\u70ed\u66f4\u65b0\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684beans\u8282\u914d\u7f6e\u3002\u8be6\u89c1\u4e0b\u9762\u7684\u6ce8\u91ca\uff1a'hotUpdate'    =&gt;    [\n    \/\/ 'status'    =&gt;    false, \/\/ \u5173\u95ed\u70ed\u66f4\u65b0\u53bb\u9664\u6ce8\u91ca\uff0c\u4e0d\u8bbe\u7f6e\u5373\u4e3a\u5f00\u542f\uff0c\u5efa\u8bae\u751f\u4ea7\u73af\u5883\u5173\u95ed\n\n    \/\/ --- \u6587\u4ef6\u4fee\u6539\u65f6\u95f4\u76d1\u63a7 ---\n    \/\/ 'monitorClass'    =&gt;    \\Imi\\HotUpdate\\Monitor\\FileMTime::class,\n    \/\/ 'timespan'    =&gt;    1, \/\/ \u68c0\u6d4b\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\n\n    \/\/ --- Inotify \u6269\u5c55\u76d1\u63a7 ---\n    \/\/ 'monitorClass'    =&gt;    \\Imi\\HotUpdate\\Monitor\\Inotify::class,\n    \/\/ 'timespan'    =&gt;    0, \/\/ \u68c0\u6d4b\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\uff0c\u4f7f\u7528\u6269\u5c55\u5efa\u8bae\u8bbe\u4e3a0\u6027\u80fd\u66f4\u4f73\n\n    \/\/ 'includePaths'    =&gt;    [], \/\/ \u8981\u5305\u542b\u7684\u8def\u5f84\u6570\u7ec4\n    \/\/ 'excludePaths'    =&gt;    [], \/\/ \u8981\u6392\u9664\u7684\u8def\u5f84\u6570\u7ec4\uff0c\u652f\u6301\u901a\u914d\u7b26*\n    \/\/ 'defaultPath'    =&gt;    [], \/\/ \u8bbe\u4e3a\u6570\u7ec4\u5219\u8986\u76d6\u9ed8\u8ba4\u7684\u76d1\u63a7\u8def\u5f84\n],\u9ed8\u8ba4\u662f\u6839\u636e\u6587\u4ef6\u4fee\u6539\u65f6\u95f4\u76d1\u63a7\uff0c\u5efa\u8bae\u6709\u6761\u4ef6\u7684\u4e0aInotify\uff0c\u6027\u80fd\u66f4\u4f73\uff01"},{"id":81,"parent_id":44,"title":"Phar \u652f\u6301","mdFileName":"components\/phar\/index.md","url":"components\/phar\/index.html","level":1,"content":"Phar \u652f\u6301\u76ee\u524d imi \u5df2\u7ecf\u5b8c\u5168\u652f\u6301\u4e86 Phar \u6a21\u5f0f\u8fd0\u884c\uff0c\u5728imi-demo\u4e2d\u7ed9\u51fa\u4e86\u4f7f\u7528\u793a\u4f8b\uff0c\u8bf7\u81ea\u884c\u67e5\u770b\u76f8\u5173\u4ee3\u7801\u3002\uff08\u5176\u5b9e\u53ef\u4ee5\u4e0d\u770b\uff0c\u76f4\u63a5\u7528\uff09Phar \u6a21\u5f0f\u751f\u6210 phar \u6587\u4ef6\u9700\u8981\u4fee\u6539php.ini\uff0c\u52a0\u5165\u4ee5\u4e0b\u914d\u7f6e\uff1aphar.readonly=Offimi \u5185\u7f6e\u6253\u5305\u751f\u6210 phar \u547d\u4ee4\uff1abin\/build-phar\u76ee\u524d\uff0c\u9ed8\u8ba4\uff08\u5f3a\u5236\uff09\u751f\u6210\u4e3aimi\/src\/imi.phar"},{"id":83,"parent_id":82,"title":"Atomic","mdFileName":"components\/struct\/atomic.md","url":"components\/struct\/atomic.html","level":1,"content":"Atomic\u57fa\u4e8e Swoole \u63d0\u4f9b\u7684 Swoole\\Atomic\uff0c\u76f4\u63a5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\uff0c\u5c31\u53ef\u4ee5\u5728worker\u8fdb\u7a0b\u4e2d\u4f7f\u7528\uff0c\u6570\u636e\u4e92\u901a\u3002\u4f7f\u7528\u65f6\u65e0\u9700\u52a0\u9501\uff01\u914d\u7f6e\u65b9\u5f0f\u5728\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165\u4ee5\u4e0b\u8282'atomics'    =&gt;    [\n    \/\/ \u5b9a\u4e49\u540d\u4e3aname1\u7684\uff0c\u521d\u59cb\u503c\u4e3a0\n    'name1',\n    \/\/ \u5b9a\u4e49\u540d\u4e3aname2\u7684\uff0c\u521d\u59cb\u503c\u4e3a10\n    'name2'    =&gt;    10,\n],\u4f7f\u7528\u65b9\u5f0fuse \\Imi\\Util\\AtomicManager;\n\n\/\/ \u83b7\u53d6 Swoole\\Atomic \u5bf9\u8c61\n$atomic = AtomicManager::getInstance('name1');\n\n\/\/ \u52a01\uff0c\u8fd4\u56de\u7ed3\u679c\n$number = AtomicManager::::add('name1');\n\n\/\/ \u52a010\uff0c\u8fd4\u56de\u7ed3\u679c\n$number = AtomicManager::::add('name1', 10);\n\n\/\/ \u51cf1\uff0c\u8fd4\u56de\u7ed3\u679c\n$number = AtomicManager::::sub('name1');\n\n\/\/ \u51cf10\uff0c\u8fd4\u56de\u7ed3\u679c\n$number = AtomicManager::::sub('name1', 10);\n\n\/\/ \u83b7\u53d6\u5f53\u524d\u503c\n$number = AtomicManager::get('name1');\n\n\/\/ \u8bbe\u7f6e\u5f53\u524d\u503c\u4e3a100\nAtomicManager::get('name1', 100);\n\n\/\/ -----------------------------------------------\n\n\/\/ \u5982\u679c\u5f53\u524d\u6570\u503c\u7b49\u4e8e100\u8fd4\u56detrue\uff0c\u5e76\u5c06\u5f53\u524d\u6570\u503c\u8bbe\u7f6e\u4e3a1\n\/\/ \u5982\u679c\u5f53\u524d\u6570\u503c\u4e0d\u7b49\u4e8e100\u8fd4\u56defalse\n$number = AtomicManager::cmpset('name1', 100, 1);\n\n\/**\n * \u5f53\u539f\u5b50\u8ba1\u6570\u7684\u503c\u4e3a0\u65f6\u7a0b\u5e8f\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\u3002\u53e6\u5916\u4e00\u4e2a\u8fdb\u7a0b\u8c03\u7528wakeup\u53ef\u4ee5\u518d\u6b21\u5524\u9192\u7a0b\u5e8f\u3002\u5e95\u5c42\u57fa\u4e8eLinux Futex\u5b9e\u73b0\uff0c\u4f7f\u7528\u6b64\u7279\u6027\uff0c\u53ef\u4ee5\u4ec5\u75284\u5b57\u8282\u5185\u5b58\u5b9e\u73b0\u4e00\u4e2a\u7b49\u5f85\u3001\u901a\u77e5\u3001\u9501\u7684\u529f\u80fd\u3002\n * \u8d85\u65f6\u8fd4\u56defalse\uff0c\u9519\u8bef\u7801\u4e3aEAGAIN\uff0c\u53ef\u4f7f\u7528swoole_errno\u51fd\u6570\u83b7\u53d6\n * \u6210\u529f\u8fd4\u56detrue\uff0c\u8868\u793a\u6709\u5176\u4ed6\u8fdb\u7a0b\u901a\u8fc7wakeup\u6210\u529f\u5524\u9192\u4e86\u5f53\u524d\u7684\u9501\n * \u4f7f\u7528wait\/wakeup\u7279\u6027\u65f6\uff0c\u539f\u5b50\u8ba1\u6570\u7684\u503c\u53ea\u80fd\u4e3a0\u62161\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u65e0\u6cd5\u6b63\u5e38\u4f7f\u7528\n * \u5f53\u7136\u539f\u5b50\u8ba1\u6570\u7684\u503c\u4e3a1\u65f6\uff0c\u8868\u793a\u4e0d\u9700\u8981\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\uff0c\u8d44\u6e90\u5f53\u524d\u5c31\u662f\u53ef\u7528\u3002wait\u51fd\u6570\u4f1a\u7acb\u5373\u8fd4\u56detrue\n * @param string $name \u539f\u5b50\u8ba1\u6570\u5bf9\u8c61\u540d\u79f0\n * @param float $timeout \u6307\u5b9a\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4e3a-1\uff0c\u8868\u793a\u6c38\u4e0d\u8d85\u65f6\uff0c\u4f1a\u6301\u7eed\u7b49\u5f85\u76f4\u5230\u6709\u5176\u4ed6\u8fdb\u7a0b\u5524\u9192\n * @return bool\n *\/\n$result = AtomicManager::wait('name1');\n\/\/ \u8d85\u65f6\u65f6\u95f4100\u6beb\u79d2\n$result = AtomicManager::wait('name1', 0.1);\n\n\/**\n * \u5524\u9192\u5904\u4e8ewait\u72b6\u6001\u7684\u5176\u4ed6\u8fdb\u7a0b\u3002\n * \u5f53\u524d\u539f\u5b50\u8ba1\u6570\u5982\u679c\u4e3a0\u65f6\uff0c\u8868\u793a\u6ca1\u6709\u8fdb\u7a0b\u6b63\u5728wait\uff0cwakeup\u4f1a\u7acb\u5373\u8fd4\u56detrue\n * \u5f53\u524d\u539f\u5b50\u8ba1\u6570\u5982\u679c\u4e3a1\u65f6\uff0c\u8868\u793a\u5f53\u524d\u6709\u8fdb\u7a0b\u6b63\u5728wait\uff0cwakeup\u4f1a\u5524\u9192\u7b49\u5f85\u7684\u8fdb\u7a0b\uff0c\u5e76\u8fd4\u56detrue\n * \u5982\u679c\u540c\u65f6\u6709\u591a\u4e2a\u8fdb\u7a0b\u5904\u4e8ewait\u72b6\u6001\uff0c$n\u53c2\u6570\u53ef\u4ee5\u63a7\u5236\u5524\u9192\u7684\u8fdb\u7a0b\u6570\u91cf\n * \u88ab\u5524\u9192\u7684\u8fdb\u7a0b\u8fd4\u56de\u540e\uff0c\u4f1a\u5c06\u539f\u5b50\u8ba1\u6570\u8bbe\u7f6e\u4e3a0\uff0c\u8fd9\u65f6\u53ef\u4ee5\u518d\u6b21\u8c03\u7528wakeup\u5524\u9192\u5176\u4ed6\u6b63\u5728wait\u7684\u8fdb\u7a0b\n * @param string $name \u539f\u5b50\u8ba1\u6570\u5bf9\u8c61\u540d\u79f0\n * @param integer $n\n * @return void\n *\/\nAtomicManager::wakeup('name1'); \/\/ \u7b2c\u4e8c\u4e2a\u53c2\u6570\u6211\u4e5f\u4e0d\u77e5\u9053\u5e72\u561b\u7684\uff0cswoole\u6587\u6863\u6ca1\u5199"},{"id":84,"parent_id":82,"title":"Channel","mdFileName":"components\/struct\/co-channel.md","url":"components\/struct\/co-channel.html","level":1,"content":"\u534f\u7a0b Channel\u57fa\u4e8e Swoole \u63d0\u4f9b\u7684 Swoole\\Coroutine\\Channel\uff0c\u76f4\u63a5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\uff0c\u5c31\u53ef\u4ee5\u5728worker\u8fdb\u7a0b\u4e2d\u4f7f\u7528\uff0c\u6570\u636e\u4e92\u901a\u3002Swoole\\Coroutine\\Channel\u53ef\u4ee5\u4f5c\u4e3a\u961f\u5217\u4f7f\u7528\uff0c\u652f\u6301\u591a\u751f\u4ea7\u8005\u534f\u7a0b\u548c\u591a\u6d88\u8d39\u8005\u534f\u7a0b\u3002\u5e95\u5c42\u81ea\u52a8\u5b9e\u73b0\u4e86\u534f\u7a0b\u7684\u5207\u6362\u548c\u8c03\u5ea6\u3002\u914d\u7f6e\u65b9\u5f0f\u5728\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165\u4ee5\u4e0b\u8282'coroutineChannels'    =&gt;    [\n    \/\/ \u5b9a\u4e49\u540d\u4e3aname1\u7684\uff0c\u901a\u9053\u5360\u7528\u7684\u5185\u5b58\u7684\u5c3a\u5bf8\u4e3a64kb\n    \/\/ \u5f53\u8bbe\u7f6e\u4e3a0\u65f6\uff0c\u5e95\u5c42\u5c06\u4e0d\u518d\u8bbe\u7f6e\u7f13\u51b2\u533a\uff0cpush\u548cpop\u64cd\u4f5c\u4f1a\u7acb\u5373\u6302\u8d77\u5f53\u524d\u534f\u7a0b\u3002\n    'name1'    =&gt;    [64 * 1024],\n],\u4f7f\u7528\u65b9\u5f0fuse \\Imi\\Util\\CoroutineChannelManager;\n\n\/\/ \u83b7\u53d6 Swoole\\Coroutine\\Channel \u5bf9\u8c61\n$channel = CoroutineChannelManager::getInstance('name1');\n\n\/\/ \u5411\u961f\u5217\u4e2d\u52a0\u5165\u4e00\u4e2a\u6210\u5458\nCoroutineChannelManager::push('name1', 'test');\n\/\/ \u8fd8\u652f\u6301\u6570\u7ec4\uff0c\u7b49\u4e00\u5207\u53ef\u4ee5\u88ab\u5e8f\u5217\u5316\u7684\u503c\nCoroutineChannelManager::push('name1', [1, 2, 3]);\n\n\/\/ \u5f39\u51fa\u4e00\u4e2a\u6210\u5458\uff0c\u5982\u679c\u6ca1\u6709\u503c\u5219\u4e3afalse\n$result = CoroutineChannelManager::pop('name1');\n\n\/\/ \u83b7\u53d6\u901a\u9053\u7684\u72b6\u6001\n$result = CoroutineChannelManager::stats('name');\n\/*\n$result \u683c\u5f0f\u5982\u4e0b\uff1a\n[\n    \/\/ \u6d88\u8d39\u8005\u6570\u91cf\uff0c\u8868\u793a\u5f53\u524d\u901a\u9053\u4e3a\u7a7a\uff0c\u6709N\u4e2a\u534f\u7a0b\u6b63\u5728\u7b49\u5f85\u5176\u4ed6\u534f\u7a0b\u8c03\u7528push\u65b9\u6cd5\u751f\u4ea7\u6570\u636e\n    'consumer_num'    =&gt;    1,\n    \/\/ \u751f\u4ea7\u8005\u6570\u91cf\uff0c\u8868\u793a\u5f53\u524d\u901a\u9053\u5df2\u6ee1\uff0c\u6709N\u4e2a\u534f\u7a0b\u6b63\u5728\u7b49\u5f85\u5176\u4ed6\u534f\u7a0b\u8c03\u7528pop\u65b9\u6cd5\u6d88\u8d39\u6570\u636e\n    'producer_num'  =&gt;    1,\n    \/\/ \u901a\u9053\u4e2d\u7684\u5143\u7d20\u6570\u91cf\n    'queue_num'    =&gt;    10,\n    \/\/ \u901a\u9053\u5f53\u524d\u5360\u7528\u7684\u5185\u5b58\u5b57\u8282\u6570\n    'queue_bytes'    =&gt;    1024,\n]\n*\/\n\n\/\/ \u5173\u95ed\u901a\u9053\u3002\u5e76\u5524\u9192\u6240\u6709\u7b49\u5f85\u8bfb\u5199\u7684\u534f\u7a0b\u3002\nCoroutineChannelManager::close('name1');\n"},{"id":85,"parent_id":82,"title":"MemoryTable","mdFileName":"components\/struct\/memory-table.md","url":"components\/struct\/memory-table.html","level":1,"content":"MemoryTableimi \u652f\u6301 MemoryTableModel\uff0c\u4e5f\u652f\u6301\u76f4\u63a5\u5b9a\u4e49\u548c\u64cd\u4f5cMemoryTable\u3002\u914d\u7f6e\u65b9\u6cd5\/\/ \u5185\u5b58\u8868\u914d\u7f6e\n'memoryTable'   =&gt;  [\n    \/\/ name =&gt; \u914d\u7f6e\n    't1'    =&gt;  [\n        \/\/ \u5b9a\u4e49\u5b57\u6bb5\n        'columns'   =&gt;  [\n            ['name' =&gt; 'name', 'type' =&gt; \\Swoole\\Table::TYPE_STRING, 'size' =&gt; 16],\n            ['name' =&gt; 'quantity', 'type' =&gt; \\Swoole\\Table::TYPE_INT],\n        ],\n        'lockId'    =&gt;  'atomic', \/\/ \u9501 ID\uff0c\u975e\u5fc5\u8bbe\u3002\u4e0d\u914d\u7f6e\u5c31\u4e0d\u5141\u8bb8\u4f7f\u7528\u9501\uff0c\u5176\u5b83\u7684\u53ef\u4ee5\u6b63\u5e38\u7528\n    ],\n    'connectContext'    =&gt;  [\n        \/\/ \u6307\u5b9a\u5b9e\u73b0\u4e86 Imi\\Util\\MemoryTable\\IMemoryTableOption \u63a5\u53e3\u7684\u6765\uff0c\u6765\u5b9a\u4e49\u8868\u7ed3\u6784\n        'class' =&gt;  \\Imi\\Server\\ConnectContext\\StoreHandler\\MemoryTable\\ConnectContextOption::class,\n        'lockId'=&gt;  'atomic', \/\/ \u540c\u4e0a\n    ],\n],\u4f7f\u7528\u65b9\u6cd5\u5199\u5165use Imi\\Util\\MemoryTableManager;\n$key = 'a'; \/\/ \u4e3b\u952e\n$value = [\n    'name'      =&gt;  'abc',\n    'quantity'  =&gt;  123,\n];\nMemoryTableManager::set($tableName, $key, $value);\u8bfb\u53d6\/\/ \u83b7\u53d6\u4e00\u884c\n$row = MemoryTableManager::get($tableName, $key);\n\n\/\/ \u83b7\u53d6\u5355\u4e2a\u5b57\u6bb5\n$field = 'quantity';\n$value = MemoryTableManager::get($tableName, $key, $field);\u5220\u9664MemoryTableManager::del($tableName, $key);\u6570\u636e\u884c\u662f\u5426\u5b58\u5728MemoryTableManager::exist($tableName, $key);\u539f\u5b50\u81ea\u589eMemoryTableManager::incr($tableName, $key, $field); \/\/ +1\nMemoryTableManager::incr($tableName, $key, $field, 123); \/\/ +123\u539f\u5b50\u81ea\u51cfMemoryTableManager::decr($tableName, $key, $field); \/\/ -1\nMemoryTableManager::decr($tableName, $key, $field, 123); \/\/ -123\u83b7\u53d6\u884c\u6570MemoryTableManager::count($tableName);\u52a0\u9501\u6267\u884c\u9700\u8981\u914d\u7f6e lockIdMemoryTableManager::lock($tableName, function(){\n    \/\/ \u65b9\u6cd5\u4f53\u5185\u90e8\u90fd\u5728\u9501\u4e2d\u6267\u884c\uff0c\u6267\u884c\u5b8c\u81ea\u52a8\u91ca\u653e\u9501\n    $row = MemoryTableManager::get($tableName, $key);\n    $row['quantity'] = 456;\n    MemoryTableManager::set($tableName, $key, $row);\n});\u5b9e\u73b0 IMemoryTableOption \u63a5\u53e3\u793a\u4f8b\u4ee3\u7801\uff1a&lt;?php\nnamespace Imi\\Server\\ConnectContext\\StoreHandler\\MemoryTable;\n\nuse Imi\\Util\\MemoryTable\\IMemoryTableOption;\n\n\/**\n * Swoole \u5185\u5b58\u8868\n *\/\nclass ConnectContextOption implements IMemoryTableOption\n{\n    \/**\n     * \u83b7\u53d6\u914d\u7f6e\n     *\n     * @return array\n     *\/\n    public function getOption($option = null): array\n    {\n        if(!$option)\n        {\n            $option = [];\n        }\n        if(!isset($option['size']))\n        {\n            $option['size'] = 65536;\n        }\n        $option['columns'] = [\n            ['name' =&gt; 'data', 'type' =&gt; \\Swoole\\Table::TYPE_STRING, 'size' =&gt; $option['dataLength'] ?? 1024],\n        ];\n        return $option;\n    }\n\n}"},{"id":86,"parent_id":82,"title":"Enum","mdFileName":"components\/struct\/enum.md","url":"components\/struct\/enum.html","level":1,"content":"\u679a\u4e3e\u7531\u4e8e PHP \u672c\u8eab\u4e0d\u652f\u6301\u679a\u4e3e\u7c7b\u578b\uff0cimi \u7279\u522b\u57fa\u4e8e\u6ce8\u89e3\u5b9e\u73b0\u4e86\u679a\u4e3e\u7c7b\u3002\u679a\u4e3e\u7c7b\u5b9a\u4e49\u7ee7\u627fImi\\Enum\\BaseEnum\u7c7b\uff0c\u7136\u540e\u5728\u7c7b\u5e38\u91cf\u4e0a\u9762\u5199\u4e0a\u6ce8\u89e3@EnumItem\uff0c\u53c2\u6570\u662f\u5f53\u524d\u5e38\u91cf\u7684\u6587\u5b57\u8bf4\u660e\u3002&lt;?php\nnamespace ImiDemo\\HttpDemo\\MainServer\\Enum;\n\nuse Imi\\Enum\\BaseEnum;\nuse Imi\\Enum\\Annotation\\EnumItem;\n\nclass Status extends BaseEnum\n{\n    \/**\n     * @EnumItem(&quot;\u6b63\u786e&quot;)\n     *\/\n    const YES = 1;\n\n    \/**\n     * @EnumItem(&quot;\u9519\u8bef&quot;)\n     *\/\n    const NO = 0;\n}\u4f7f\u7528\/\/ \u6839\u636e\u540d\u79f0\u83b7\u5f97\u5e38\u91cf\u503c\nStatus::getValue('YES');\n\n\/\/ \u6839\u636e\u503c\u83b7\u5f97\u6587\u5b57\u8bf4\u660e\nStatus::getText(Status::YES);\n\n\/\/ \u6839\u636e\u503c\u83b7\u5f97 @EnumItem \u6ce8\u89e3\u5bf9\u8c61\nStatus::getData(Status::YES);\n\n\/\/ \u83b7\u53d6\u679a\u4e3e\u7c7b\u4e2d\u6240\u6709\u540d\u79f0\nStatus::getNames();\n\n\/\/ \u83b7\u53d6\u679a\u4e3e\u7c7b\u4e2d\u6240\u6709\u503c\nStatus::getValues();"},{"id":87,"parent_id":82,"title":"ArrayData","mdFileName":"components\/struct\/ArrayData.md","url":"components\/struct\/ArrayData.html","level":1,"content":"ArrayData\u6570\u7ec4\u6570\u636e\u57fa\u7c7b\uff0c\u652f\u6301\u4f7f\u7528 a.b.c \u65b9\u5f0f\u64cd\u4f5c\u6570\u636e$data = [\n    'a' =&gt;  [\n        'b' =&gt;  [\n            'c' =&gt;  [\n                'name'  =&gt;  'imi',\n            ]\n        ]\n    ]\n];\n$data = new \\Imi\\Util\\ArrayData($data);\n\/\/ 3 \u79cd\u4e0d\u540c\u64cd\u4f5c\u65b9\u6cd5\uff0c\u8f93\u51fa\u90fd\u662f imi\nvar_dump($data-&gt;get('a.b.c.name'));\nvar_dump($data['a.b.c.name']);\nvar_dump($data-&gt;{'a.b.c.name'});\n\n$data-&gt;set('a.id', 123); \/\/ a.id \u76f4\u63a5\u4f5c\u4e3akey\uff0c\u800c\u4e0d\u662f\u591a\u7ea7\u6570\u7ec4\nvar_dump($data['a.id']); \/\/ false\nvar_dump($data-&gt;get()['a.id']); \/\/ 123\n\n$data-&gt;setVal('a.id', 456);\nvar_dump($data['a.id']); \/\/ 456\n\n$data-&gt;clear(); \/\/ \u5168\u90e8\u6e05\u9664"},{"id":88,"parent_id":82,"title":"LazyArrayObject","mdFileName":"components\/struct\/LazyArrayObject.md","url":"components\/struct\/LazyArrayObject.html","level":1,"content":"LazyArrayObject\u540c\u65f6\u53ef\u4ee5\u4f5c\u4e3a\u6570\u7ec4\u548c\u5bf9\u8c61\u8bbf\u95ee\u7684\u7c7b\/\/ $object = new \\Imi\\Util\\LazyArrayObject;\n$object = new \\Imi\\Util\\LazyArrayObject([\n    'id'    =&gt;  123,\n    'name'  =&gt;  'imi',\n]);\n\n$object['id'] = 111;\necho 'id:', $object-&gt;id, PHP_EOL;\n\n$object-&gt;id = 222;\necho 'id:', $object['id'], PHP_EOL;\n\n$arrayData = $object-&gt;toArray();\nvar_dump($arrayData);"},{"id":89,"parent_id":82,"title":"ArrayList","mdFileName":"components\/struct\/ArrayList.md","url":"components\/struct\/ArrayList.html","level":1,"content":"ArrayList\u9650\u5b9a\u6210\u5458\u7c7b\u578b\u7684\u6570\u7ec4\u5217\u8868\u5982\u679c\u6210\u5458\u7c7b\u578b\u4e0d\u6b63\u786e\uff0c\u4f1a\u629b\u51fa\\InvalidArgumentException\u5f02\u5e38class TestModel\n{\n    public $id;\n\n    public $name;\n\n    public function __construct($id, $name)\n    {\n        $this-&gt;id = $id;\n        $this-&gt;name = $name;\n    }\n}\n\n\/\/ $list = new \\Imi\\Util\\ArrayList(TestModel::class);\n$list = new \\Imi\\Util\\ArrayList(TestModel::class, [\n    new TestModel(1, 'a'),\n    new TestModel(2, 'b'),\n]);\n\nforeach($list as $index =&gt; $item)\n{\n    var_dump($index, $item);\n}\n\n\/\/ \u53d6\u5176\u4e2d\u67d0\u4e2a\u6210\u5458\n$item0 = $list[0];\n\n\/\/ \u8f6c\u4e3a\u6570\u7ec4\n$arrayList = $list-&gt;toArray();\nvar_dump($arrayList);\n\n\/\/ \u79fb\u9664\u591a\u4e2a\u6210\u5458\n$arrayList-&gt;remove($list[1], $list[2]);\n\n\/\/ \u6e05\u7a7a\n$arrayList-&gt;clear();\n\n\/\/ \u7edf\u8ba1\u6570\u91cf\necho $arrayList-&gt;count();"},{"id":90,"parent_id":82,"title":"FilterableList","mdFileName":"components\/struct\/FilterableList.md","url":"components\/struct\/FilterableList.html","level":1,"content":"FilterableList\u8fc7\u6ee4\u5b57\u6bb5\u7684\u5217\u8868\uff0c\u6bcf\u4e00\u4e2a\u6210\u5458\u5e94\u8be5\u662f\u6570\u7ec4\u6216\u5bf9\u8c61$data = [\n    ['id'=&gt;1, 'name'=&gt;'a'],\n    ['id'=&gt;2, 'name'=&gt;'b'],\n];\n\n\/\/ \u4e24\u4e2a\u6beb\u65e0\u610f\u4e49\u7684\u5b9e\u4f8b\u5316\u5199\u6cd5\n$list = new FilterableList;\n$list = new FilterableList($data);\n\/\/ \u53ea\u4fdd\u7559 name \u5b57\u6bb5\n$list = new FilterableList($data, ['name']);\n$list = new FilterableList($data, ['name'], 'allow');\n\/\/ \u5254\u9664 name \u5b57\u6bb5\n$list = new FilterableList($data, ['name'], 'deny');\n\nforeach($list as $index =&gt; $item)\n{\n    var_dump($index, $item);\n}\n\n\/\/ \u53d6\u5176\u4e2d\u67d0\u4e2a\u6210\u5458\n$item0 = $list[0];\n\n\/\/ \u8f6c\u4e3a\u6570\u7ec4\n$arrayList = $list-&gt;toArray();\nvar_dump($arrayList);\n\n\/\/ \u79fb\u9664\u591a\u4e2a\u6210\u5458\n$arrayList-&gt;remove($list[1], $list[2]);\n\n\/\/ \u6e05\u7a7a\n$arrayList-&gt;clear();\n\n\/\/ \u7edf\u8ba1\u6570\u91cf\necho $arrayList-&gt;count();"},{"id":92,"parent_id":91,"title":"\u5168\u5c40\u51fd\u6570","mdFileName":"utils\/functions.md","url":"utils\/functions.html","level":1,"content":"\u5168\u5c40\u51fd\u6570imigo\u542f\u52a8\u4e00\u4e2a\u534f\u7a0b\uff0c\u81ea\u52a8\u521b\u5efa\u548c\u9500\u6bc1\u4e0a\u4e0b\u6587imigo(function(){\n    $value = Redis::get('key');\n    \/\/ \u65e0\u9700\u624b\u52a8\u91ca\u653e\u4efb\u4f55\u8d44\u6e90\n});\u4f20\u5165\u53c2\u6570\uff1aimigo(function($id, $name){\n    echo $id, ':', $name, PHP_EOL; \/\/ 1:test\n}, 1, 'test');imiCallable\u4e3a\u4f20\u5165\u7684\u56de\u8c03\u81ea\u52a8\u521b\u5efa\u548c\u9500\u6bc1\u4e0a\u4e0b\u6587\uff0c\u5e76\u8fd4\u56de\u65b0\u7684\u56de\u8c03$callable = imiCallable(function(){\n    return 'abc';\n});\nfunction test($a)\n{\n    $value = $a(); \/\/ abc\n}\ntest($callable);\u5f00\u65b0\u534f\u7a0b\u53bb\u6267\u884c\u56de\u8c03\uff0c\u65e0\u6cd5\u83b7\u53d6\u8fd4\u56de\u503c\uff1a$callable = imiCallable(function(){\n    return 'abc';\n}, true); \/\/ \u8fd9\u91cc\u52a0\u4e86 true\nfunction test($a)\n{\n    $value = $a(); \/\/ \u534f\u7a0bID\n}\ntest($callable);"},{"id":93,"parent_id":91,"title":"Imi","mdFileName":"utils\/Imi.md","url":"utils\/Imi.html","level":1,"content":"Imi\u7c7b\u540d: Imi\\Util\\Imi\u6846\u67b6\u91cc\u6742\u4e03\u6742\u516b\u7684\u5404\u79cd\u5de5\u5177\u65b9\u6cd5\u57fa\u672c\u90fd\u653e\u5728\u8fd9\u4e2a\u7c7b\u65b9\u6cd5\u4ec5\u5217\u51fa\u53ef\u80fd\u5e38\u7528\u7684\u65b9\u6cd5\uff0c\u5927\u591a\u6570\u65b9\u6cd5\u65e0\u9700\u4e86\u89e3\u3002parseDotRule\u5904\u7406\u6309.\u5206\u9694\u7684\u89c4\u5219\u6587\u672c\uff0c\u652f\u6301.\u8f6c\u4e49\u4e0d\u5206\u9694\/\/ ['a', 'b', 'c']\nvar_dump(Imi::parseDotRule('a.b.c'));\n\n\/\/ ['a.b', 'c']\nvar_dump(Imi::parseDotRule('a\\.b.c'));getClassShortName\u83b7\u53d6\u7c7b\u77ed\u540d\u79f0\/\/ C\necho Imi::getClassShortName('A\\B\\C');getNamespacePath\u6839\u636e\u547d\u540d\u7a7a\u95f4\u83b7\u53d6\u771f\u5b9e\u8def\u5f84\uff0c\u8fd4\u56denull\u5219\u4e3a\u83b7\u53d6\u5931\u8d25\/\/ \/mnt\/d\/projects\/imi-demo\/vendor\/yurunsoft\/imi\/src\/\necho Imi::getNamespacePath('Imi'), PHP_EOL;\n\n\/\/ \/mnt\/d\/projects\/imi-demo\/HttpDemo\/\necho Imi::getNamespacePath('ImiDemo\\HttpDemo'), PHP_EOL;getClassPropertyValue\u83b7\u53d6\u7c7b\u5c5e\u6027\u7684\u503c\uff0c\u503c\u4e3abeans\u914d\u7f6e\u6216\u9ed8\u8ba4\u914d\u7f6e\uff0c\u652f\u6301\u4f20\u5165Bean\u540d\u79f0\u6784\u9020\u65b9\u6cd5\u8d4b\u503c\u65e0\u6cd5\u53d6\u51fa\/\/ \u9ed8\u8ba4\u4e3aImi\\Server\\Group\\Handler\\Redis\necho Imi::getClassPropertyValue('ServerGroup', 'groupHandler');getImiCmd\u83b7\u53d6imi\u547d\u4ee4\u884c\/\/ php \/mnt\/d\/projects\/imi-demo\/HttpDemo\/bin\/imi server\/reload\necho Imi::getImiCmd('server', 'reload');"},{"id":94,"parent_id":91,"title":"Args","mdFileName":"utils\/Args.md","url":"utils\/Args.html","level":1,"content":"Args\u7c7b\u540d: Imi\\Util\\Args\u547d\u4ee4\u884c\u53c2\u6570\u64cd\u4f5c\u7c7b\u65b9\u6cd5get\u83b7\u53d6\u503c\/\/ \u4e0d\u59a8\u8fd0\u884c\u52a0\u4e00\u4e2a -abc 123 \u53c2\u6570\u770b\u770b\u6548\u679c\nvar_dump(Args::get('abc'));\n\n\/\/ \u652f\u6301\u9ed8\u8ba4\u503c\nvar_dump(Args::get('abc', 'default'));exists\u6307\u5b9a\u6570\u636e\u662f\u5426\u5b58\u5728var_dump(Args::exists('abc'));"},{"id":95,"parent_id":91,"title":"ArrayUtil","mdFileName":"utils\/ArrayUtil.md","url":"utils\/ArrayUtil.html","level":1,"content":"ArrayUtil\u7c7b\u540d: Imi\\Util\\ArrayUtil\u6570\u7ec4\u5e2e\u52a9\u7c7b\u65b9\u6cd5remove\u4ece\u6570\u7ec4\u4e2d\u79fb\u9664\u4e00\u4e2a\u5143\u7d20$array = [1, 2, 3, 4, 5];\n\n\/\/ \u5220\u9664\u4e00\u4e2a\u5143\u7d20\uff1a[1, 3, 4, 5]\nvar_dump(ArrayUtil::remove($array, 2));\n\n\/\/ \u5220\u9664\u591a\u4e2a\u5143\u7d20\uff1a[1, 5]\nvar_dump(ArrayUtil::remove($array, 2, 3, 4));recursiveMerge\u591a\u7ef4\u6570\u7ec4\u9012\u5f52\u5408\u5e76\uff0c\u5177\u4f53\u6548\u679c\u8bf7\u770b\u4e0b\u9762\u4ee3\u7801\u53ca\u8fd0\u884c\u7ed3\u679c$array1 = [\n    'a'    =&gt;    [\n        'b1'    =&gt;    [\n            'c1'    =&gt;    1,\n        ],\n        'b2'    =&gt;    [\n            'c2'    =&gt;    2,\n        ]\n    ]\n];\n$array2 = [\n    'a'    =&gt;    [\n        'b1'    =&gt;    [\n            'c1'    =&gt;    3,\n        ]\n    ]\n];\n\n\/\/ array_merge\nprint_r(array_merge($array1, $array2));\n\n\/\/ +\nprint_r($array1 + $array2);\n\n\/\/ ArrayUtil::recursiveMerge\nprint_r(ArrayUtil::recursiveMerge($array1, $array2));\u8fd0\u884c\u7ed3\u679c\uff1aArray\n(\n    [a] =&gt; Array\n        (\n            [b1] =&gt; Array\n                (\n                    [c1] =&gt; 3\n                )\n        )\n)\nArray\n(\n    [a] =&gt; Array\n        (\n            [b1] =&gt; Array\n                (\n                    [c1] =&gt; 1\n                )\n            [b2] =&gt; Array\n                (\n                    [c2] =&gt; 2\n                )\n        )\n)\nArray\n(\n    [a] =&gt; Array\n        (\n            [b1] =&gt; Array\n                (\n                    [c1] =&gt; 3\n                )\n            [b2] =&gt; Array\n                (\n                    [c2] =&gt; 2\n                )\n        )\n)columnToKey\u5c06\u4e8c\u7ef4\u6570\u7ec4\u7b2c\u4e8c\u7eac\u67d0key\u53d8\u4e3a\u4e00\u7ef4\u7684key$array = [\n    ['id'=&gt;1,'name'=&gt;'a'],\n    ['id'=&gt;2,'name'=&gt;'b'],\n    ['id'=&gt;3,'name'=&gt;'c'],\n];\n\n\/\/ \u4fdd\u7559\u539f\u59cb\u5b57\u6bb5\nprint_r(ArrayUtil::columnToKey($array, 'id'));\n\n\/\/ \u53bb\u9664\u539f\u59cb\u5b57\u6bb5\nprint_r(ArrayUtil::columnToKey($array, 'id', false));\u8fd0\u884c\u7ed3\u679c\uff1aArray\n(\n    [1] =&gt; Array\n        (\n            [id] =&gt; 1\n            [name] =&gt; a\n        )\n    [2] =&gt; Array\n        (\n            [id] =&gt; 2\n            [name] =&gt; b\n        )\n    [3] =&gt; Array\n        (\n            [id] =&gt; 3\n            [name] =&gt; c\n        )\n\n)\nArray\n(\n    [1] =&gt; Array\n        (\n            [name] =&gt; a\n        )\n    [2] =&gt; Array\n        (\n            [name] =&gt; b\n        )\n    [3] =&gt; Array\n        (\n            [name] =&gt; c\n        )\n)isAssoc\u5224\u65ad\u6570\u7ec4\u662f\u5426\u4e3a\u5173\u8054\u6570\u7ec4$array = [1, 2, 3];\n\/\/ false\nvar_dump(ArrayUtil::isAssoc($array));\n\n$array = [1, 'b'=&gt;2, 3];\n\/\/ true\nvar_dump(ArrayUtil::isAssoc($array));random\u968f\u673a\u83b7\u5f97\u6570\u7ec4\u4e2d\u7684\u503c\uff0c\u8fd4\u56de\u4e00\u4e2a\u4fdd\u6301\u952e\u503c\u5bf9\u5e94\u7684\u6570\u7ec4$array = [1, 2, 3];\n\/\/ \u8fd4\u56de\u968f\u673a\u7684\u6570\u7ec4\uff0c\u5982\uff1a[k1=&gt;v1]\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7f3a\u7701\u9ed8\u8ba4\u4e3a1\nvar_dump(ArrayUtil::random($array));\n\n\/\/ \u8fd4\u56de\u968f\u673a\u7684\u6570\u7ec4\uff0c\u5982\uff1a[k1=&gt;v1, k2=&gt;v2]\nvar_dump(ArrayUtil::random($array, 2));"},{"id":96,"parent_id":91,"title":"Bit","mdFileName":"utils\/Bit.md","url":"utils\/Bit.html","level":1,"content":"Bit\u7c7b\u540d: Imi\\Util\\Bit\u4f4d\u64cd\u4f5c\u5de5\u5177\u7c7b\u65b9\u6cd5has\u5224\u65ad\u662f\u5426\u5305\u542b\u503c\/\/ true\nvar_dump(Bit::has(LOCK_SH | LOCK_NB, LOCK_NB));\n\n\/\/ false\nvar_dump(Bit::has(LOCK_SH, LOCK_NB));"},{"id":97,"parent_id":91,"title":"ClassObject","mdFileName":"utils\/ClassObject.md","url":"utils\/ClassObject.html","level":1,"content":"ClassObject\u7c7b\u540d: Imi\\Util\\ClassObject\u7c7b\u548c\u5bf9\u8c61\u76f8\u5173\u5de5\u5177\u7c7b\u65b9\u6cd5isAnymous\u662f\u5426\u662f\u533f\u540d\u7c7b\u5bf9\u8c61\/\/ true\nvar_dump(ClassObject::isAnymous(App::getBean('Logger')));\n\n\/\/ false\nvar_dump(ClassObject::isAnymous(new \\Imi\\Log\\Logger));\u5904\u7406\u53ef\u80fd\u662f\u540c\u7ea7\u7684\u7c7b\u540d\u5982\u679c $className \u662f\u4e00\u4e2a\u7c7b\u540d\uff0c\u5219\u539f\u6837\u8fd4\u56de\u5426\u5219\u8fd4\u56de $sameLevelClass \u540c\u7ea7\u4e0b\u7684\u7c7b\u540dClassObject::parseSameLevelClassName($className, $sameLevelClass)\u5c06\u65b9\u6cd5\u7684\u53c2\u6570\u5904\u7406\u6210 kv \u6570\u7ec4class A\n{\n    public function test($id, $name, $age = 9999)\n    {\n\n    }\n}\n\n$args = [\n    19260817,\n    'imiphp.com',\n];\n\n$result1 = ClassObject::convertArgsToKV('A', 'test', $args, true);\nvar_dump($result1);\n\/*\narray(3) {\n  [&quot;id&quot;]=&gt;\n  int(19260817)\n  [&quot;name&quot;]=&gt;\n  string(10) &quot;imiphp.com&quot;\n  [&quot;age&quot;]=&gt;\n  int(9999)\n}\n*\/\n\n$result2 = ClassObject::convertArgsToKV('A', 'test', $args, false);\nvar_dump($result2);\n\/*\narray(2) {\n  [&quot;id&quot;]=&gt;\n  int(19260817)\n  [&quot;name&quot;]=&gt;\n  string(10) &quot;imiphp.com&quot;\n}\n*\/"},{"id":98,"parent_id":91,"title":"Coroutine","mdFileName":"utils\/Coroutine.md","url":"utils\/Coroutine.html","level":1,"content":"Coroutine\u7c7b\u540d: Imi\\Util\\Coroutine\u534f\u7a0b\u5e2e\u52a9\u7c7b\u7ee7\u627f\u4e86\\Swoole\\Coroutine\u65b9\u6cd5isIn\u5224\u65ad\u5f53\u524d\u662f\u5426\u5728\u534f\u7a0b\u4e2d\u8fd0\u884cvar_dump(Coroutine::isIn());\u7531\u4e8e\u7ee7\u627f\u4e86 Swoole \u7684\u534f\u7a0b\u7c7b\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528\u5176\u5168\u90e8\u65b9\u6cd5"},{"id":99,"parent_id":91,"title":"File","mdFileName":"utils\/File.md","url":"utils\/File.html","level":1,"content":"File\u7c7b\u540d: Imi\\Util\\File\u6587\u4ef6\u76f8\u5173\u5de5\u5177\u7c7b\u65b9\u6cd5enum\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\u5bf9\u8c61\u3002\/\/ \u679a\u4e3e\u5f53\u524d\u76ee\u5f55\u53ca\u6240\u6709\u5b50\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\uff0c\u4e0d\u5305\u542b.\u548c..\nforeach(File::enum(__DIR__) as $fileName)\n{\n    echo (string)$fileName, PHP_EOL;\n}enumPHPFile\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\u5bf9\u8c61\u3002\/\/ \u679a\u4e3e\u5f53\u524d\u76ee\u5f55\u53ca\u6240\u6709\u5b50\u76ee\u5f55\u4e2d\u7684PHP\u6587\u4ef6\nforeach(File::enumPHPFile(__DIR__) as $fileName)\n{\n    echo (string)$fileName, PHP_EOL;\n}path\u7ec4\u5408\u8def\u5f84\uff0c\u76ee\u5f55\u540e\u7684\/\u4e0d\u662f\u5fc5\u987b\/\/ abc\/index.html\necho File::path('abc', 'index.html');\n\n\/\/ \u652f\u6301\u534f\u8baeuri\uff0c\u591a\u4f59\u7684\/\u4f1a\u5408\u5e76\u4e3a\u4e00\u4e2a\uff1ahttp:\/www.baidu.com\/a\/b\/index.html\necho File::path('http:\/\/www.baidu.com', 'a\/\/b\/\/\/', 'index.html');readAll\u6839\u636e\u6587\u4ef6\u6253\u5f00\u53e5\u67c4\uff0c\u8bfb\u53d6\u6587\u4ef6\u6240\u6709\u5185\u5bb9$fp = fopen(__FILE__, 'r');\necho File::readAll($fp);\nfclose($fp);readFile\u8bfb\u53d6\u6587\u4ef6\u6240\u6709\u5185\u5bb9\uff0c\u4f18\u5148\u4f7f\u7528\u534f\u7a0b\uff0c\u5982\u679c\u4e0d\u652f\u6301\u5219\u4f7f\u7528\u4f20\u7edf\u963b\u585e\u65b9\u5f0fecho File::readFile(__FILE__);writeFile\u5199\u5165\u6587\u4ef6\uff0c\u4f18\u5148\u4f7f\u7528\u534f\u7a0b\uff0c\u5982\u679c\u4e0d\u652f\u6301\u5219\u4f7f\u7528\u4f20\u7edf\u963b\u585e\u65b9\u5f0f\/\/ \u5199\u5165\u6587\u4ef6\nFile::writeFile('a.txt', '123');\n\n\/\/ \u8ffd\u52a0\u8fdb\u6587\u4ef6\nFile::writeFile('a.txt', '456', FILE_APPEND);createDir\u521b\u5efa\u4e00\u4e2a\u76ee\u5f55\/\/ \u9012\u5f52\u521b\u5efa\u76ee\u5f55\uff0c\u6743\u9650\u9ed8\u8ba40755\nFile::createDir('a\/b\/c');\n\n\/\/ \u9012\u5f52\u521b\u5efa\u76ee\u5f55\uff0c\u6743\u9650\u4e3a0777\nFile::createDir('a\/b\/c', 0777);createFile\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\/\/ \u521b\u5efa\u6587\u4ef6\uff0c\u76ee\u5f55\u4e0d\u5b58\u5728\u5219\u81ea\u52a8\u521b\u5efa\uff0c\u6743\u9650\u9ed8\u8ba40755\nFile::createFile('a\/b\/c.txt');\n\n\/\/ \u521b\u5efa\u6587\u4ef6\uff0c\u76ee\u5f55\u4e0d\u5b58\u5728\u5219\u81ea\u52a8\u521b\u5efa\uff0c\u6743\u9650\u4e3a0777\nFile::createFile('a\/b\/c.txt', 0777);"},{"id":100,"parent_id":91,"title":"ObjectArrayHelper","mdFileName":"utils\/ObjectArrayHelper.md","url":"utils\/ObjectArrayHelper.html","level":1,"content":"ObjectArrayHelper\u7c7b\u540d: Imi\\Util\\ObjectArrayHelper\u5bf9\u8c61\u53ca\u6570\u7ec4\u5e2e\u52a9\u7c7b\u667a\u80fd\u8bc6\u522b\u6570\u7ec4\u548c\u5bf9\u8c61\uff0c\u652f\u6301\u5bf9a.b.c\u8fd9\u6837\u7684name\u5c5e\u6027\u8fdb\u884c\u64cd\u4f5c\u65b9\u6cd5\u4ee5\u4e0b\u6240\u6709\u793a\u4f8b\uff0c\u524d\u63d0\u4ee3\u7801\u4e3a\uff1a$data = [\n    'a'    =&gt;    [\n        'b'    =&gt;    [\n            'c'    =&gt;    '111',\n        ],\n    ],\n];\n\/\/ \u4e5f\u53ef\u4ee5\u662f\u4efb\u610f\u5bf9\u8c61\u53ca\u6570\u7ec4\u7684\u6df7\u5408\u7528\u6cd5\uff0c\u5982\uff1a\n$data = new \\stdClass;\n$data-&gt;a = [];\n$data-&gt;a['b'] = new \\stdClass;\n$data-&gt;a['b']-&gt;c = '111';get\u83b7\u53d6\u503c\/\/ 111\necho ObjectArrayHelper::get($data, 'a.b.c');\n\n\/\/ 222\necho ObjectArrayHelper::get($data, 'a.b.c.d', '222');set\u8bbe\u7f6e\u503cObjectArrayHelper::set($data, 'a.b.c2', '333');remove\u79fb\u9664\u503cObjectArrayHelper::remove($data, 'a.b.c2');remove\u503c\u662f\u5426\u5b58\u5728var_dump(ObjectArrayHelper::exists($data, 'a.b.c2'));filter\u8fc7\u6ee4\u5c5e\u6027$data = [\n    'id'    =&gt;    1,\n    'name'    =&gt;    'imi',\n];\n\/\/ $data = new stdClass;\n\/\/ $data-&gt;id = 1;\n\/\/ $data-&gt;name = 'imi';\n\n\/\/ \u4ee5\u4e0a\u4e24\u4e2a\u90fd\u652f\u6301\n\n\/\/ \u53ea\u4fdd\u7559 name \u5b57\u6bb5\nvar_dump(ObjectArrayHelper::filter($data, ['name']));\n\n\/\/ \u5254\u9664 name \u5b57\u6bb5\nvar_dump(ObjectArrayHelper::filter($data, ['name'], 'deny'));"},{"id":101,"parent_id":91,"title":"Random","mdFileName":"utils\/Random.md","url":"utils\/Random.html","level":1,"content":"Random\u7c7b\u540d: Imi\\Util\\Random\u968f\u673a\u751f\u6210\u4e00\u4e9b\u4e1c\u897f\u7684\u5de5\u5177\u7c7b\u65b9\u6cd5int\u968f\u673a\u6574\u6570\/\/ \u968f\u673a\u8303\u56f4\uff1aPHP_INT_MIN-PHP_INT_MAX\necho Random::int(), PHP_EOL;\n\n\/\/ \u968f\u673a\u8303\u56f4\uff1a1-20\necho Random::int(1, 20), PHP_EOL;number\u968f\u673a\u751f\u6210\u5c0f\u6570\/\/ \u968f\u673a\u8303\u56f4\uff1aPHP_INT_MIN-PHP_INT_MAX\necho Random::number(), PHP_EOL;\n\n\/\/ \u968f\u673a\u8303\u56f4\uff1a12-20\necho Random::number(1.2, 20), PHP_EOL;text\u968f\u673a\u751f\u6210\u6587\u672c\/\/ \u4eceabcdefg\u4e2d\u968f\u673a4-6\u4e2a\u5b57\u7b26\necho Random::text('abcdefg', 4, 6), PHP_EOL;letter\u968f\u673a\u751f\u6210\u5b57\u6bcd\/\/ \u968f\u673a\u5927\u5c0f\u5199\u5b57\u6bcd4-6\u4e2a\necho Random::letter(4, 6), PHP_EOL;digital\u968f\u673a\u751f\u6210\u6570\u5b57\u548cRandom::int()\u65b9\u6cd5\u4e0d\u540c\u7684\u662f\uff0c\u8fd9\u4e2a\u662f\u751f\u6210\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5\u4e0d\u9650\u5236\u6570\u503c\u7684\u5927\u5c0f\u3002\/\/ \u968f\u673a100\u4e2a\u6570\u5b57\necho Random::digital(100, 100), PHP_EOL;letterAndNumber\/\/ \u968f\u673a\u751f\u62104-6\u4e2a\u5b57\u6bcd+\u6570\u5b57\necho Random::letterAndNumber(4, 6);"},{"id":102,"parent_id":91,"title":"Swoole","mdFileName":"utils\/Swoole.md","url":"utils\/Swoole.html","level":1,"content":"Swoole\u7c7b\u540d: Imi\\Util\\SwooleSwoole \u73af\u5883\u4e0b\u7684\u4e00\u4e9b\u5de5\u5177\u7c7b\u3002\u65b9\u6cd5getMasterPID\u83b7\u53d6master\u8fdb\u7a0bpidecho Swoole::getMasterPID();getManagerPID\u83b7\u53d6manager\u8fdb\u7a0bpidecho Swoole::getManagerPID();"},{"id":103,"parent_id":91,"title":"Text","mdFileName":"utils\/Text.md","url":"utils\/Text.html","level":1,"content":"Text\u7c7b\u540d: Imi\\Util\\Text\u5b57\u7b26\u4e32\u5de5\u5177\u7c7b\u65b9\u6cd5startwith\u5b57\u7b26\u4e32\u662f\u5426\u4ee5\u53e6\u4e00\u4e2a\u5b57\u7b26\u4e32\u5f00\u5934\/\/ true\nvar_dump(Text::startwith('http:\/\/www.baidu.com', 'http:\/\/'));\n\n\/\/ false\nvar_dump(Text::startwith('http:\/\/www.baidu.com', 'https:\/\/'));endwith\u5b57\u7b26\u4e32\u662f\u5426\u4ee5\u53e6\u4e00\u4e2a\u5b57\u7b26\u4e32\u7ed3\u5c3e\/\/ true\nvar_dump(Text::endwith('http:\/\/www.baidu.com\/index.html', '.html'));\n\n\/\/ false\nvar_dump(Text::endwith('http:\/\/www.baidu.com\/index.html', '.htm'));insert\u63d2\u5165\u5b57\u7b26\u4e32$str = 'abde';\n\/\/ abcde\necho Text::insert($str, 2, 'c'), PHP_EOL;isEmpty\u5b57\u7b26\u4e32\u662f\u5426\u4e3a\u7a7a\u5b57\u7b26\u4e32\u6216\u8005\u4e3anull\/\/ true\nvar_dump(Text::isEmpty(''));\n\n\/\/ true\nvar_dump(Text::isEmpty(null));\n\n\/\/ false\nvar_dump(Text::isEmpty(0));\n\n\/\/ false\nvar_dump(Text::isEmpty('0'));toCamelName\u8f6c\u4e3a\u9a7c\u5cf0\u547d\u540d\uff0c\u4f1a\u628a\u4e0b\u5212\u7ebf\u540e\u5b57\u6bcd\u8f6c\u4e3a\u5927\u5199\/\/ adminUserAge\necho Text::toCamelName('admin_user_age'), PHP_EOL;toPascalName\u8f6c\u4e3a\u6bcf\u4e2a\u5355\u8bcd\u5927\u5199\u7684\u547d\u540d\uff0c\u4f1a\u628a\u4e0b\u5212\u7ebf\u540e\u5b57\u6bcd\u8f6c\u4e3a\u5927\u5199\/\/ AdminUserAge\necho Text::toPascalName('admin_user_age'), PHP_EOL;toUnderScoreCase\u8f6c\u4e3a\u4e0b\u5212\u7ebf\u547d\u540d\/\/ admin_user_age\necho Text::toUnderScoreCase('AdminUserAge'), PHP_EOL;\n\n\/\/ Admin_User_Age\necho Text::toUnderScoreCase('AdminUserAge', false), PHP_EOL;"},{"id":104,"parent_id":91,"title":"Pagination","mdFileName":"utils\/Pagination.md","url":"utils\/Pagination.html","level":1,"content":"Pagination\u7c7b\u540d: Imi\\Util\\Pagination\u5206\u9875\u8ba1\u7b97\u7c7b\u65b9\u6cd5\u6784\u9020\u65b9\u6cd5public function __construct($page, $count)$page \u5f53\u524d\u9875\u7801$count \u6bcf\u9875\u6570\u91cfgetPage\u5b57\u9762\u610f\u601dsetPage\u5b57\u9762\u610f\u601dgetCount\u5b57\u9762\u610f\u601dsetCount\u5b57\u9762\u610f\u601dgetLimitOffset\u83b7\u53d6\u504f\u79fb\u91cf\uff0c\u5982 limit 20, 10 \u4e2d\u7684 20getLimitEndOffset\u83b7\u53d6\u7ed3\u675f\u7684\u504f\u79fb\u91cf\uff0c\u5982 limit 20, 10 \u4e2d\u7684 29calcPageCount\u6839\u636e\u8bb0\u5f55\u6570\u8ba1\u7b97\u603b\u9875\u6570$records = 101;\n$page = new \\Imi\\Util\\Pagination(1, 10);\n$pagination-&gt;calcPageCount($records); \/\/ 11\u4f8b\u5b50$page = new \\Imi\\Util\\Pagination(10, 15);\n$limit = 'limit ' . $page-&gt;getLimitOffset() . ',' . $page-&gt;getCount();\necho $limit;"},{"id":105,"parent_id":91,"title":"DateTime","mdFileName":"utils\/DateTime.md","url":"utils\/DateTime.html","level":1,"content":"DateTime\u7c7b\u540d: Imi\\Util\\DateTime\u65e5\u671f\u65f6\u95f4\u5de5\u5177\u7c7b\u65b9\u6cd5getSecondsByInterval\u5c06\u4e00\u4e2a \\DateInterval\uff0c\u4e0e\u5f53\u524d\u65f6\u95f4\u8fdb\u884c\u8ba1\u7b97\uff0c\u83b7\u53d6\u6beb\u79d2\u6570$d1 = new DateTime(&quot;2019-06-21&quot;);\n$d2 = new DateTime(&quot;2018-06-21&quot;);\n$diff = $d2-&gt;diff($d1); \n$s = \\Imi\\Util\\DateTime::getSecondsByInterval($diff);\nvar_dump($s); \/\/ 31622400"},{"id":106,"parent_id":91,"title":"KVStorage","mdFileName":"utils\/KVStorage.md","url":"utils\/KVStorage.html","level":1,"content":"KVStorage\u7c7b\u540d: Imi\\Util\\KVStoragekv\u5b58\u50a8\u7c7b\uff0c\u57fa\u4e8eSplObjectStorage\uff0c\u652f\u6301\u975e\u5bf9\u8c61\u952e\u4f7f\u7528\u65b9\u6cd5\u540c\uff1aSplObjectStorage\uff0c\u4e0d\u518d\u5c40\u9650\u4e8e\u5bf9\u8c61"},{"id":107,"parent_id":91,"title":"ServerManage","mdFileName":"utils\/ServerManage.md","url":"utils\/ServerManage.html","level":1,"content":"ServerManage\u7c7b\u540d\uff1aImi\\ServerManageimi \u652f\u6301\u670d\u52a1\u76d1\u542c\u591a\u4e2a\u7aef\u53e3\u3001\u591a\u4e2a\u534f\u8bae\uff0c\u8be5\u7c7b\u7528\u4e8e\u7ba1\u7406\u76d1\u542c\u7aef\u53e3\u7684\u670d\u52a1\u3002\u53ef\u7528\u65b9\u6cd5\/**\n * \u83b7\u53d6\u670d\u52a1\u5668\u6570\u7ec4\n * @return \\Imi\\Server\\Base[]\n *\/\npublic static function getServers();\n\n\/**\n * \u83b7\u53d6\u670d\u52a1\u5668\u5bf9\u8c61\n * @param string $name\n * @return \\Imi\\Server\\Base\n *\/\npublic static function getServer($name);$name \u53c2\u6570\u662f\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5b9a\u4e49\u7684\u670d\u52a1\u5668\u540d\u79f0\u3002\u5982\u679c\u662f\u4e3b\u670d\u52a1\uff0c\u5f3a\u5236\u4e3a\uff1amain\u83b7\u53d6 Swoole \u670d\u52a1\u5668\u5bf9\u8c61$swooleServer = ServerManage::getServer('main')-&gt;getSwooleServer();"},{"id":109,"parent_id":108,"title":"\u6ce8\u5165\u503c\u6ce8\u89e3","mdFileName":"annotations\/injectValue.md","url":"annotations\/injectValue.html","level":1,"content":"\u6ce8\u5165\u503c\u6ce8\u89e3imi \u4e2d\u6709\u4e00\u7c7b\u6ce8\u89e3\uff0c\u4ed6\u4eec\u652f\u6301\u5c06\u503c\u52a8\u6001\u6ce8\u5165\u5230\u6ce8\u89e3\u5c5e\u6027\u4e2d\uff0c\u5f53\u8c03\u7528\u83b7\u53d6\u6ce8\u89e3\u5c5e\u6027\u65f6\uff0c\u624d\u5b9e\u65f6\u8ba1\u7b97\u5e76\u8fd4\u56de\u3002\u6ce8\u89e3\u8bf4\u660e@ConstValue\u4ece\u5e38\u91cf\u4e2d\u8bfb\u53d6\u503c\u5c5e\u6027\u540d\u79f0\u8bf4\u660ename\u5e38\u91cf\u540ddefault\u5e38\u91cf\u4e0d\u5b58\u5728\u65f6\uff0c\u8fd4\u56de\u7684\u9ed8\u8ba4\u503c@ConfigValue\u4ece\u914d\u7f6e\u4e2d\u8bfb\u53d6\u503c\u5c5e\u6027\u540d\u79f0\u8bf4\u660ename\u914d\u7f6e\u540d\uff0c\u652f\u6301@app\u3001@currentServer\u7b49\u7528\u6cd5default\u914d\u7f6e\u540d\uff0c\u652f\u6301@app\u3001@currentServer\u7b49\u7528\u6cd5\u4e0d\u5b58\u5728\u65f6\uff0c\u8fd4\u56de\u7684\u9ed8\u8ba4\u503c@Inject\u5bf9\u8c61\u6ce8\u5165\uff0c\u4f7f\u7528\uff1aApp::getBean()\u5c5e\u6027\u540d\u79f0\u8bf4\u660enameBean\u540d\u79f0\u6216\u7c7b\u540dargsBean\u5b9e\u4f8b\u5316\u53c2\u6570@RequestInject\u5bf9\u8c61\u6ce8\u5165\uff0c\u4f7f\u7528\uff1aRequestContext::getBean()\u540c@Inject@Callback\u56de\u8c03\u6ce8\u89e3\u5c5e\u6027\u540d\u79f0\u8bf4\u660eclass\u7c7b\u540d\uff0c\u6216\u8005\u4f20\u5165\u5bf9\u8c61\uff0c\u6bd4\u5982\u53ef\u4ee5\u4f7f\u7528 @Inject\u3001@RequestInject \u518d\u6b21\u503c\u6ce8\u5165method\u65b9\u6cd5\u540d\u7528\u6cd5\u793a\u4f8b\/*\n * @Cacheable(\n *   key=&quot;index:{page}&quot;,\n *   ttl=10,\n *   lockable=@Lockable(\n *     id=&quot;index:{page}&quot;,\n *     waitTimeout=999999,\n *   ),\n *   preventBreakdown=true,\n * )\n *\/@DbInject\u6ce8\u5165\u6570\u636e\u5e93\u5bf9\u8c61\u5c5e\u6027\u540d\u79f0\u8bf4\u660ename\u8fde\u63a5\u6c60\u540d\uff0c\u5982\u679c\u4e3anull\u5219\u53d6\u914d\u7f6e@app.db.defaultPoolqueryType\u67e5\u8be2\u7c7b\u578b\uff0c\u5f71\u54cd\u8bfb\u5199\u5206\u79bb\u903b\u8f91\u3002\u53ef\u9009\uff1aQueryType::READ\/QueryType::WRITE\uff0c\u9ed8\u8ba4\u4e3aQueryType::WRITE@RedisInject\u6ce8\u5165Redis\u5bf9\u8c61\u5c5e\u6027\u540d\u79f0\u8bf4\u660ename\u8fde\u63a5\u6c60\u540d\uff0c\u5982\u679c\u4e3anull\u5219\u53d6\u914d\u7f6e@app.redis.defaultPool@PoolResource\u6ce8\u5165\u8fde\u63a5\u6c60\u8d44\u6e90\u5c5e\u6027\u540d\u79f0\u8bf4\u660ename\u8fde\u63a5\u6c60\u540d"},{"id":110,"parent_id":108,"title":"\u65b9\u6cd5\u53c2\u6570\u8fc7\u6ee4\u5668","mdFileName":"annotations\/filterArg.md","url":"annotations\/filterArg.html","level":1,"content":"\u65b9\u6cd5\u53c2\u6570\u8fc7\u6ee4\u5668\u5728\u65b9\u6cd5\u8c03\u7528\u65f6\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u65b9\u6cd5\u53c2\u6570\u8fc7\u6ee4\u5668\uff0c\u5bf9\u4f20\u5165\u65b9\u6cd5\u7684\u53c2\u6570\u8fdb\u884c\u8fc7\u6ee4\u5904\u7406\u3002\u6ce8\u89e3\u8bf4\u660e@FilterArg\u5c5e\u6027\u540d\u79f0\u8bf4\u660ename\u53c2\u6570\u540dfilter\u8fc7\u6ee4\u5668callable\u7528\u6cd5\u793a\u4f8b\u7b80\u5355\u4f7f\u7528\uff1a\/*\n * @FilterArg(name=&quot;data&quot;, filter=&quot;json_decode&quot;)\n *\/\npublic function test($data)\n{\n    var_dump($data); \/\/ \u8fd9\u662f\u4e00\u4e2astdClass\u5bf9\u8c61\n}\n\n$obj-&gt;test('{&quot;id&quot;:1, &quot;message&quot;: &quot;imi nb!&quot;}');\u590d\u6742\u7528\u6cd5\uff1a\u7ed3\u5408@Callback\u3001@Inject\u6ce8\u89e3\u4f7f\u7528\uff0c\u652f\u6301\u4f7f\u7528bean\u4e2d\u7684\u65b9\u6cd5\u3002\/**\n * @Bean(&quot;XXX&quot;)\n *\/\nclass TestXXX\n{\n    public function decode($data)\n    {\n        return json_decode($data, true);\n    }\n}\n\n\/*\n * @FilterArg(name=&quot;data&quot;, filter=@Callback(\n *     class=@Inject(&quot;XXX&quot;),\n *     method=&quot;decode&quot;\n * ))\n *\/\npublic function test($data)\n{\n    var_dump($data); \/\/ \u8fd9\u662f\u4e00\u4e2a\u6570\u7ec4\n}\n\n$obj-&gt;test('{&quot;id&quot;:1, &quot;message&quot;: &quot;imi nb!&quot;}');"},{"id":112,"parent_id":111,"title":"\u4ecb\u7ecd","mdFileName":"dev\/intro.md","url":"dev\/intro.html","level":1,"content":"\u4ecb\u7ecdIMI \u76ee\u524d\u63d0\u4f9b\u4e86\u547d\u4ee4\u884c\u751f\u6210\u5de5\u5177\uff0c\u65b9\u4fbf\u5f00\u53d1\u8005\uff0c\u51cf\u5c11\u91cd\u590d\u65e0\u8c13\u7684\u4f53\u529b\u52b3\u52a8\u3002\u8fd0\u884c\u547d\u4ee4\u884c\u5de5\u5177\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a\u65b9\u5f0f\u4e00\u6846\u67b6\u81ea\u5e26\u6587\u4ef6\uff1avendor\/yurunsoft\/imi\/bin\/imi\u7528\u6846\u67b6\u81ea\u5e26\u6267\u884c\u547d\u4ee4\u884c\uff0c\u9700\u8981\u624b\u52a8\u4f20\u5165-appNamespace &quot;\u9879\u76ee\u547d\u540d\u7a7a\u95f4&quot;\u53c2\u6570\u65b9\u5f0f\u4e8c\u9879\u76ee\u81ea\u5efa\u6587\u4ef6\uff0c\u4ee5imi-demo\u4e3a\u4f8b\uff1aHttpDemo\/bin\/imi\u4f7f\u7528\u9879\u76ee\u81ea\u5efa\u6587\u4ef6\u53ef\u4ee5\u4f20\u5165-appNamespace &quot;\u9879\u76ee\u547d\u540d\u7a7a\u95f4&quot;\u53c2\u6570\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6307\u5b9a\u3002\u9879\u76ee\u8def\u5f84\/config\/config.php\u4e2dnamespace\u8bbe\u7f6e\u4e3a\u9879\u76ee\u547d\u540d\u7a7a\u95f4\u5373\u53ef\u3002\u53ef\u4ee5\u53c2\u8003imi-demo\u793a\u4f8b\u9879\u76ee"},{"id":113,"parent_id":111,"title":"\u670d\u52a1\u5668\u5de5\u5177","mdFileName":"dev\/server.md","url":"dev\/server.html","level":1,"content":"\u670d\u52a1\u5668\u5de5\u5177\u5f00\u542f\u670d\u52a1\u65e0\u53c2\u6570\u793a\u4f8b\uff1aHttpDemo\/bin\/imi server\/start\u505c\u6b62\u670d\u52a1\u65e0\u53c2\u6570\u793a\u4f8b\uff1aHttpDemo\/bin\/imi server\/stop\u91cd\u65b0\u52a0\u8f7d\u670d\u52a1\u53ef\u4ee5\u8ba9\u9879\u76ee\u6587\u4ef6\u66f4\u6539\u751f\u6548\u65e0\u53c2\u6570\u793a\u4f8b\uff1aHttpDemo\/bin\/imi server\/reload"},{"id":114,"parent_id":111,"title":"\u751f\u6210\u5de5\u5177","mdFileName":"dev\/generate.md","url":"dev\/generate.html","level":1,"content":""},{"id":115,"parent_id":114,"title":"\u6a21\u578b\u751f\u6210","mdFileName":"dev\/generate\/model.md","url":"dev\/generate\/model.html","level":2,"content":"\u6a21\u578b\u751f\u6210\u751f\u6210\u6570\u636e\u5e93\u4e2d\u6240\u6709\u8868\u7684\u6a21\u578b\u6587\u4ef6\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86include\u6216exclude\uff0c\u5219\u6309\u7167\u76f8\u5e94\u89c4\u5219\u8fc7\u6ee4\u8868\u3002\u5fc5\u9009\u53c2\u6570\uff1a-namespace \u751f\u6210\u7684Model\u6240\u5728\u547d\u540d\u7a7a\u95f4\u53ef\u9009\u53c2\u6570\uff1a-database \u6570\u636e\u5e93\u540d\uff0c\u4e0d\u4f20\u5219\u53d6\u8fde\u63a5\u6c60\u9ed8\u8ba4\u914d\u7f6e\u7684\u5e93\u540d-poolName \u8fde\u63a5\u6c60\u540d\u79f0\uff0c\u4e0d\u4f20\u5219\u53d6\u9ed8\u8ba4\u8fde\u63a5\u6c60-prefix \u4f20\u503c\u5219\u53bb\u9664\u8be5\u8868\u524d\u7f00-include \u8981\u5305\u542b\u7684\u8868\u540d\uff0c\u4ee5\u534a\u89d2\u9017\u53f7\u5206\u9694-exclude \u8981\u6392\u9664\u7684\u8868\u540d\uff0c\u4ee5\u534a\u89d2\u9017\u53f7\u5206\u9694-override \u662f\u5426\u8986\u76d6\u5df2\u5b58\u5728\u7684\u6587\u4ef6\uff0c\u8bf7\u614e\u91cd\uff01true-\u5168\u8986\u76d6;false-\u4e0d\u8986\u76d6;base-\u8986\u76d6\u57fa\u7c7b;model-\u8986\u76d6\u6a21\u578b\u7c7b;\u9ed8\u8ba4\u7f3a\u7701\u72b6\u6001\u4e3afalse\u793a\u4f8b\uff1aHttpDemo\/bin\/imi generate\/model -namespace &quot;\u547d\u540d\u7a7a\u95f4&quot;"},{"id":116,"parent_id":114,"title":"\u63a7\u5236\u5668\u751f\u6210","mdFileName":"dev\/generate\/controller.md","url":"dev\/generate\/controller.html","level":2,"content":"\u63a7\u5236\u5668\u751f\u6210\u751f\u6210\u4e00\u4e2a Http Controller\u5fc5\u9009\u53c2\u6570\uff1a-name \u751f\u6210\u7684 Controller \u7c7b\u540d-namespace \u751f\u6210\u7684 Controller \u6240\u5728\u547d\u540d\u7a7a\u95f4\u53ef\u9009\u53c2\u6570\uff1a-prefix \u8def\u7531\u524d\u7f00\uff0c\u4e0d\u4f20\u5219\u4e3a\u7c7b\u540d-render \u6e32\u67d3\u65b9\u5f0f\uff0c\u9ed8\u8ba4\u4e3ajson\uff0c\u53ef\u9009\uff1ahtml\/json\/xml-rest \u662f\u5426\u751f\u6210 RESTful \u98ce\u683c\uff0c\u9ed8\u8ba4 false-override \u662f\u5426\u8986\u76d6\u5df2\u5b58\u5728\u7684\u6587\u4ef6\uff0c\u8bf7\u614e\u91cd\uff01(true\/false)\u793a\u4f8b\uff1aHttpDemo\/bin\/imi generate\/httpController -name \u63a7\u5236\u5668\u540d -namespace &quot;\u547d\u540d\u7a7a\u95f4&quot;\n\nHttpDemo\/bin\/imi generate\/httpController -name \u63a7\u5236\u5668\u540d -namespace &quot;\u547d\u540d\u7a7a\u95f4&quot; -rest"},{"id":117,"parent_id":111,"title":"\u8fdb\u7a0b\u5de5\u5177","mdFileName":"dev\/process.md","url":"dev\/process.html","level":1,"content":"\u8fdb\u7a0b\u5de5\u5177\u542f\u52a8\u8fdb\u7a0b\u5f00\u542f\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u53ef\u4ee5\u4efb\u610f\u6dfb\u52a0\u53c2\u6570\u5fc5\u9009\u53c2\u6570\uff1a-name \u8fdb\u7a0b\u540d\u79f0\uff0c\u901a\u8fc7@Process\u6ce8\u89e3\u5b9a\u4e49\u53ef\u9009\u53c2\u6570\uff1a-redirectStdinStdout \u91cd\u5b9a\u5411\u5b50\u8fdb\u7a0b\u7684\u6807\u51c6\u8f93\u5165\u548c\u8f93\u51fa\u3002\u542f\u7528\u6b64\u9009\u9879\u540e\uff0c\u5728\u5b50\u8fdb\u7a0b\u5185\u8f93\u51fa\u5185\u5bb9\u5c06\u4e0d\u662f\u6253\u5370\u5c4f\u5e55\uff0c\u800c\u662f\u5199\u5165\u5230\u4e3b\u8fdb\u7a0b\u7ba1\u9053\u3002\u8bfb\u53d6\u952e\u76d8\u8f93\u5165\u5c06\u53d8\u4e3a\u4ece\u7ba1\u9053\u4e2d\u8bfb\u53d6\u6570\u636e\u3002\u9ed8\u8ba4\u4e3a\u963b\u585e\u8bfb\u53d6\u3002-pipeType \u7ba1\u9053\u7c7b\u578b\uff0c\u542f\u7528$redirectStdinStdout\u540e\uff0c\u6b64\u9009\u9879\u5c06\u5ffd\u7565\u7528\u6237\u53c2\u6570\uff0c\u5f3a\u5236\u4e3a1\u3002\u5982\u679c\u5b50\u8fdb\u7a0b\u5185\u6ca1\u6709\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e3a 0\u793a\u4f8b\uff1aHttpDemo\/bin\/imi process\/start -name \u8fdb\u7a0b\u540d\u79f0\n\n# \u8ddf\u4e0a\u8fdb\u7a0b\u9700\u8981\u83b7\u53d6\u7684\u53c2\u6570\nHttpDemo\/bin\/imi process\/start -name \u8fdb\u7a0b\u540d\u79f0 -a 1 -b 2\u542f\u52a8\u8fdb\u7a0b\u6c60\u57fa\u4e8eSwoole\\Process\\Pool\u5b9e\u73b0\uff0c\u53ef\u4ee5\u8bbe\u5b9a\u8fdb\u7a0b\u6570\u91cf\u3002\u9700\u8981\u5728\u8fdb\u7a0b\u4e2d\u4eba\u4e3a\u5199\u4e0a\u5faa\u73af\uff0c\u5426\u5219\u8fdb\u7a0b\u4e00\u65e6\u7ed3\u675f\uff0c\u4f1a\u7acb\u5373\u62c9\u8d77\u4e00\u4e2a\u65b0\u8fdb\u7a0b\u3002\u5fc5\u9009\u53c2\u6570\uff1a-name \u8fdb\u7a0b\u6c60\u540d\u79f0\uff0c\u901a\u8fc7@ProcessPool\u6ce8\u89e3\u5b9a\u4e49\u53ef\u9009\u53c2\u6570\uff1a-worker \u8fdb\u7a0b\u6570\u91cf\uff0c\u4e0d\u4f20\u5219\u6839\u636e\u6ce8\u89e3\u914d\u7f6e\u8bbe\u5b9a\uff08\u6ce8\u89e3\u4e0d\u8bbe\u7f6e\u5219\u4e3a1\uff09-ipcType \u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u4e3a0\u8868\u793a\u4e0d\u4f7f\u7528\u4efb\u4f55\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7279\u6027\uff0c\u4e0d\u4f20\u5219\u6839\u636e\u6ce8\u89e3\u914d\u7f6e\u8bbe\u5b9a-msgQueueKey \u6d88\u606f\u961f\u5217\u952e\uff0c\u4e0d\u4f20\u5219\u6839\u636e\u6ce8\u89e3\u914d\u7f6e\u8bbe\u5b9a"},{"id":119,"parent_id":118,"title":"\u6027\u80fd\u4f18\u5316","mdFileName":"adv\/performance.md","url":"adv\/performance.html","level":1,"content":"\u6027\u80fd\u4f18\u5316imi \u4e3a\u6027\u80fd\u505a\u4e86\u4ee5\u4e0b\u52aa\u529b\uff1a\u6846\u67b6\u6838\u5fc3\u8fd0\u884c\u65f6\u7f13\u5b58\u9879\u76ee\u8fd0\u884c\u65f6\u7f13\u5b58\u70ed\u66f4\u65b0\u91cd\u542f\u91c7\u7528\u589e\u91cf\u65b9\u5f0f\u6570\u636e\u5e93 Statement \u590d\u7528\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684\u6ce8\u5165\u5904\u7406\u4f7f\u7528\u6846\u67b6\u6838\u5fc3\u8fd0\u884c\u65f6\u7f13\u5b58+\u70ed\u66f4\u65b0\u91cd\u542f\u91c7\u7528\u589e\u91cf\u65b9\u5f0f\uff0c\u6211\u4eec\u7684\u5b9e\u9645\u9879\u76ee\u539f\u672c\u91cd\u542f\u9700\u8981 6 \u79d2\uff0c\u73b0\u5728\u53ea\u9700 1 \u79d2\uff0c\u63d0\u5347\u53ef\u8c13\u662f\u5de8\u5927\u7684\u3002\u4f7f\u7528\u9879\u76ee\u8fd0\u884c\u65f6\u7f13\u5b58\u540e\uff0c\u6bcf\u6b21\u542f\u52a8\u548c\u70ed\u91cd\u542fworker\u8fdb\u7a0b\u65f6\uff0c\u786c\u76d8\u8bfb\u5199\u538b\u529b\u4e0d\u518d\u5de8\u5927\u3002\u6211\u4eec\u5c06\u6301\u7eed\u4e3a\u6027\u80fd\u4f18\u5316\uff0c\u4e3a\u53ef\u9760\u6027\u4f18\u5316\u3002\u4e0a\u9762\u63d0\u5230\u7684\u6846\u67b6\u6838\u5fc3\u8fd0\u884c\u65f6\u7f13\u5b58\u9700\u8981\u5728\u5f00\u53d1\u65f6\u624b\u52a8\u751f\u6210\uff0c\u5e76\u4e14\u5982\u679c\u66f4\u65b0\u6846\u67b6\u9700\u8981\u624b\u52a8\u8fdb\u884c\u6e05\u9664\u5e76\u91cd\u65b0\u751f\u6210\u3002\u8bf7\u53c2\u8003 imi-demo \u4e2d\u7684 HttpDemo\/bin\/buildImiRuntime \u548c HttpDemo\/bin\/clearImiRuntime"},{"id":120,"parent_id":118,"title":"\u53c2\u4e0e\u6846\u67b6\u5f00\u53d1","mdFileName":"adv\/devp.md","url":"adv\/devp.html","level":1,"content":"\u53c2\u4e0e\u6846\u67b6\u5f00\u53d1\u4ed3\u5e93\u7801\u4e91\uff1ahttps:\/\/gitee.com\/yurunsoft\/IMIGithub\uff1ahttps:\/\/github.com\/Yurunsoft\/IMI\u53c2\u4e0e\u65b9\u5f0f\u5728Issues\u4e2d\u63d0\u51fa\u4f60\u53d1\u73b0\u7684BUG\u3001\u65b0\u529f\u80fd\u7684\u9700\u6c42\uff0c\u52a1\u5fc5\u63cf\u8ff0\u6e05\u6670Fork\u4ee3\u7801\uff0c\u5c06\u4f60\u81ea\u5df1\u7684\u4ed3\u5e93\u62c9\u53d6\u5230\u672c\u5730\uff0c\u5f00\u53d1\u6539\u540e\u63d0\u4ea4\u63a8\u9001\uff0c\u5e76\u63d0\u4ea4Pull Requests\u60f3\u8981\u53c2\u4e0e\u6846\u67b6\u5f00\u53d1\u3001\u4e8c\u6b21\u5f00\u53d1\u7684\uff0c\u5982\u6709\u95ee\u9898\u8bf7\u76f4\u63a5\u8054\u7cfb\u5b87\u6da6\uff0c\u63d0\u4f9b\u4eba\u5de5\u5e2e\u52a9"}];
var searchDatas = [];
function initSearchDatas()
{
	searchDatas = JSON.parse(JSON.stringify(originSearchDatas));
	for(var i = 0; i < searchDatas.length; ++i)
	{
		if(void 0 !== searchDatas[i].url)
		{
			searchDatas[i] = parseCatalogItem(searchDatas[i]);
		}
	}
	doSearch($('#search-keyword').val());
}

String.prototype.indexOf2 = function(f){
    var rt = this.match(eval('/' + f + '/i'));
    return (rt == null) ? -1 : rt.index;
}

function switchSearchNode(a)
{
	if ('pushState' in history)
	{
		getChapter(a.attr('href'));
		history.pushState('', '', a.attr('href'));
		$('#treeSearch a').removeClass('curSelectedNode');
		a.addClass('curSelectedNode');
	}
	else
	{
		location = treeNode.url;
	}
}

function searchArticle(keyword)
{
    var keywords = keyword.split(' ');
    var tSearchDatas = searchDatas;
    var result = [];
    keywords.forEach(function(kw){
		if('' === kw)
		{
			return;
		}
        result = [];
        tSearchDatas.forEach(function(item, index){
            if(item.content.indexOf2(kw) > -1 || item.title.indexOf2(kw) > -1)
            {
                result.push(item);
            }
        });
        tSearchDatas = result;
    });
    return result;
}

var searchTimer = null;
function parseSearch()
{
    $('#search-keyword').on('input', function(){
		if(null != searchTimer)
		{
			clearTimeout(searchTimer);
			searchTimer = null;
		}
		var inputKeyword = $(this);
		searchTimer = setTimeout(function(){
			doSearch(inputKeyword.val());
			searchTimer = null;
		}, 200);
		return false;
    });
}

function doSearch(keyword)
{
	var result = searchArticle(keyword);
	if(result.length > 0)
	{
		$('.searchResultNone').hide();
	}
	else
	{
		$('.searchResultNone').show();
	}
	var index = -1;
	$('#treeSearch a').each(function(i, item){
		++index;
		if($(item).hasClass('curSelectedNode'))
		{
			return false;
		}
	});
	layui.laytpl($('#searchListTemplate').html()).render(result, function(html){
		$('#treeSearch').html(html);
		if(index >= 0)
		{
			var node = $('#treeSearch a').get(index);
			if(null !== node)
			{
				$(node).addClass('curSelectedNode');
			}
		}
	});
}

$(function(){

	$('body').on('click', '#treeSearch a', function(e){
		switchSearchNode($(this));
		return false;
	});

	parseSearch();

})