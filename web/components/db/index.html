<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title>数据库操作-IMI Doc - mddoc</title>
    <!-- jQuery-->
    <script src="../../statics/plugin/jquery/jquery-1.12.0.min.js"></script>
	<!-- layui -->
    <link rel="stylesheet" href="../../statics/plugin/layui/css/layui.css" />
    <script src="../../statics/plugin/layui/layui.all.js"></script>
	<!-- zTree -->
    <link rel="stylesheet" href="../../statics/plugin/zTree/css/zTreeStyle/zTreeStyle.css" />
    <script src="../../statics/plugin/zTree/js/jquery.ztree.core.js"></script>
	<!-- SyntaxHighlighter -->
	<script src="../../statics/plugin/SyntaxHighlighter/shCore.js" type="text/javascript"></script>
	<link rel="stylesheet" type="text/css" href="../../statics/plugin/SyntaxHighlighter/shCoreDefault.css"/>
	<!-- 自定义 -->
    <link rel="stylesheet" href="../../statics/css/style.css" />
    <script src="../../statics/js/home.js"></script>
	<link rel="stylesheet" href="../../statics/css/docView.css" />
    <script src="../../statics/js/docView.js"></script>
</head>
<body>
	<!-- top-begin -->
	<div id="navbar">
		<ul class="layui-nav" lay-filter="">
			<div class="navRight">
				<li class="layui-nav-item" lay-unselect>
					<a id="btn-about" href="javascript:;">关于</a>
				</li>
			</div>
		</ul>
		<div class="nav-menu">
			<a href="../../" class="logo">IMI Doc</a>
			<a href="javascript:;" id="navMenuLeft"><i class="layui-icon">&#xe658;</i></a>
			<a href="javascript:;" id="navMenuRight"><i class="layui-icon">&#xe61a;</i></a>
		</div>
		<div class="clear"></div>
	</div>
	<script>
	function openMenuLeft()
	{
		$('#leftbar').addClass('show-item');
		$('#navMenuLeft').addClass('active');
	}
	function closeMenuLeft()
	{
		$('#leftbar').removeClass('show-item');
		$('#navMenuLeft').removeClass('active');
	}
	$('#navMenuLeft').click(function(){
		var isShow = $('#leftbar').hasClass('show-item');
		if(isShow)
		{
			closeMenuLeft();
		}
		else
		{
			closeMenuRight();
			openMenuLeft();
		}
	});
	function openMenuRight()
	{
		$('#navbar > .layui-nav').addClass('show-item')
		$('#navMenuRight').addClass('active').find('i').html('&#xe619;');
	}
	function closeMenuRight()
	{
		$('#navbar > .layui-nav').removeClass('show-item')
		$('#navMenuRight').removeClass('active').find('i').html('&#xe61a;');
	}
	$('#navMenuRight').click(function(){
		var isShow = $('#navbar > .layui-nav').hasClass('show-item');
		if(isShow)
		{
			closeMenuRight();
		}
		else
		{
			closeMenuLeft();
			openMenuRight();
		}
	});
	</script>
	<!-- top-end -->

	<!-- left-begin -->
	<div id="leftbar" class="layui-nav-side">
		<div class="layui-tab layui-tab-brief" style="margin-top:0">
			<ul class="layui-tab-title">
				<li class="layui-this"><i class="layui-icon">&#xe705;</i> 目录</li>
				<li><i class="layui-icon">&#xe615;</i> 搜索</li>
			</ul>
			<div class="layui-tab-content" style="padding:0;overflow-y: auto;position: relative;padding-top: 12px;box-sizing: border-box;">
				<div class="layui-tab-item layui-show">
					<ul id="treeDirectory" class="ztree showIcon"></ul>
				</div>
				<div class="layui-tab-item">
					<div class="searchBox">
						<div id="searchForm">
							<div class="inputBox">
								<input type="text" id="search-keyword" name="keyword" placeholder="搜索关键词" class="layui-input"/>
								<i class="layui-icon input-icon">&#xe615;</i>
							</div>
						</div>
						<ul id="treeSearch" class="ztree">
						</ul>
						<div class="searchResultNone">
							<i class="layui-icon">&#xe615;</i>
							<p>未搜索到结果</p>
						</div>
					</div>
				</div>
			</div>
			<div class="copyright noScroll">mddoc</div>
		</div>
	</div>
	<script id="searchListTemplate" type="text/html">
		{{#  layui.each(d, function(index, item){ }}
		<li>
			<a href="{{ item.url }}"><span>{{ item.title }}</span></a>
		</li>
		{{#  }) }}
	</script>
	<!-- left-end -->

	<div id="body">
		<div id="content_body" name="content_body" style="width:100%;height:100%;border:none;overflow: auto;">
            <div id="article-content" class="markdown-body">
				<script>
					function parseCatalogItem(item)
					{
						item.url = new Array(2 + 1).join('../') + item.url;
						return item;
					}
					document.title = '数据库操作-IMI Doc - mddoc';
					var currentCatalog = parseCatalogItem({"id":47,"parent_id":44,"title":"\u6570\u636e\u5e93\u64cd\u4f5c","mdFileName":"components\/db\/index.md","url":"components\/db\/index.html","level":1});
					var catalogList = [{"id":1,"parent_id":0,"title":"\u57fa\u7840\u5165\u95e8","level":0},{"id":2,"parent_id":1,"title":"\u5e8f\u8a00","mdFileName":"README.md","url":"index.html","level":1},{"id":3,"parent_id":1,"title":"\u4ecb\u7ecd","mdFileName":"base\/intro.md","url":"base\/intro.html","level":1},{"id":4,"parent_id":1,"title":"\u73af\u5883\u8981\u6c42","mdFileName":"base\/env.md","url":"base\/env.html","level":1},{"id":5,"parent_id":1,"title":"\u5f00\u59cb\u4e00\u4e2a\u65b0\u9879\u76ee","mdFileName":"base\/new.md","url":"base\/new.html","level":1},{"id":6,"parent_id":1,"title":"\u914d\u7f6e\u6587\u4ef6","mdFileName":"base\/config.md","url":"base\/config.html","level":1},{"id":7,"parent_id":0,"title":"\u6846\u67b6\u6838\u5fc3","level":0},{"id":8,"parent_id":7,"title":"\u751f\u547d\u5468\u671f","mdFileName":"core\/lifeCycle.md","url":"core\/lifeCycle.html","level":1},{"id":9,"parent_id":7,"title":"\u5bb9\u5668","mdFileName":"core\/container.md","url":"core\/container.html","level":1},{"id":10,"parent_id":7,"title":"\u4e8b\u4ef6","mdFileName":"core\/events.md","url":"core\/events.html","level":1},{"id":11,"parent_id":7,"title":"\u4e2d\u95f4\u4ef6","mdFileName":"core\/middleware.md","url":"core\/middleware.html","level":1},{"id":12,"parent_id":7,"title":"\u8fdb\u7a0b\u540d\u79f0\u7ba1\u7406","mdFileName":"core\/processNameManager.md","url":"core\/processNameManager.html","level":1},{"id":13,"parent_id":0,"title":"Http \u670d\u52a1","level":0},{"id":14,"parent_id":13,"title":"\u8def\u7531","mdFileName":"components\/httpserver\/route.md","url":"components\/httpserver\/route.html","level":1},{"id":15,"parent_id":13,"title":"\u4e2d\u95f4\u4ef6","mdFileName":"components\/httpserver\/middleware.md","url":"components\/httpserver\/middleware.html","level":1},{"id":16,"parent_id":13,"title":"\u63a7\u5236\u5668","mdFileName":"components\/httpserver\/controller.md","url":"components\/httpserver\/controller.html","level":1},{"id":17,"parent_id":13,"title":"RESTful","mdFileName":"components\/httpserver\/restful.md","url":"components\/httpserver\/restful.html","level":1},{"id":18,"parent_id":13,"title":"Session","mdFileName":"components\/httpserver\/session.md","url":"components\/httpserver\/session.html","level":1},{"id":19,"parent_id":13,"title":"\u89c6\u56fe","mdFileName":"components\/httpserver\/view.md","url":"components\/httpserver\/view.html","level":1},{"id":20,"parent_id":13,"title":"\u9519\u8bef\u5f02\u5e38\u5904\u7406","mdFileName":"components\/httpserver\/error.md","url":"components\/httpserver\/error.html","level":1},{"id":21,"parent_id":13,"title":"404\u5904\u7406","mdFileName":"components\/httpserver\/404.md","url":"components\/httpserver\/404.html","level":1},{"id":22,"parent_id":13,"title":"HTTP \u9a8c\u8bc1\u5668","mdFileName":"components\/httpserver\/validation.md","url":"components\/httpserver\/validation.html","level":1},{"id":23,"parent_id":0,"title":"WebSocket \u670d\u52a1","level":0},{"id":24,"parent_id":23,"title":"HTTP \u8def\u7531","mdFileName":"components\/websocketServer\/httpRoute.md","url":"components\/websocketServer\/httpRoute.html","level":1},{"id":25,"parent_id":23,"title":"HTTP \u63a7\u5236\u5668","mdFileName":"components\/websocketServer\/httpController.md","url":"components\/websocketServer\/httpController.html","level":1},{"id":26,"parent_id":23,"title":"WebSocket \u8def\u7531","mdFileName":"components\/websocketServer\/route.md","url":"components\/websocketServer\/route.html","level":1},{"id":27,"parent_id":23,"title":"WebSocket \u63a7\u5236\u5668","mdFileName":"components\/websocketServer\/websocketController.md","url":"components\/websocketServer\/websocketController.html","level":1},{"id":28,"parent_id":23,"title":"\u4e2d\u95f4\u4ef6","mdFileName":"components\/websocketServer\/middleware.md","url":"components\/websocketServer\/middleware.html","level":1},{"id":29,"parent_id":23,"title":"\u8fde\u63a5\u4e0a\u4e0b\u6587","mdFileName":"components\/websocketServer\/session.md","url":"components\/websocketServer\/session.html","level":1},{"id":30,"parent_id":23,"title":"\u8fde\u63a5\u5206\u7ec4","mdFileName":"components\/websocketServer\/group.md","url":"components\/websocketServer\/group.html","level":1},{"id":31,"parent_id":23,"title":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6","mdFileName":"components\/websocketServer\/noMiddleware.md","url":"components\/websocketServer\/noMiddleware.html","level":1},{"id":32,"parent_id":0,"title":"TCP \u670d\u52a1","level":0},{"id":33,"parent_id":32,"title":"\u8def\u7531","mdFileName":"components\/tcpServer\/route.md","url":"components\/tcpServer\/route.html","level":1},{"id":34,"parent_id":32,"title":"TCP \u63a7\u5236\u5668","mdFileName":"components\/tcpServer\/controller.md","url":"components\/tcpServer\/controller.html","level":1},{"id":35,"parent_id":32,"title":"\u4e2d\u95f4\u4ef6","mdFileName":"components\/tcpServer\/middleware.md","url":"components\/tcpServer\/middleware.html","level":1},{"id":36,"parent_id":32,"title":"\u8fde\u63a5\u4e0a\u4e0b\u6587","mdFileName":"components\/tcpServer\/session.md","url":"components\/tcpServer\/session.html","level":1},{"id":37,"parent_id":32,"title":"\u8fde\u63a5\u5206\u7ec4","mdFileName":"components\/tcpServer\/group.md","url":"components\/tcpServer\/group.html","level":1},{"id":38,"parent_id":32,"title":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6","mdFileName":"components\/tcpServer\/noMiddleware.md","url":"components\/tcpServer\/noMiddleware.html","level":1},{"id":39,"parent_id":0,"title":"UDP \u670d\u52a1","level":0},{"id":40,"parent_id":39,"title":"\u8def\u7531","mdFileName":"components\/udpServer\/route.md","url":"components\/udpServer\/route.html","level":1},{"id":41,"parent_id":39,"title":"UDP \u63a7\u5236\u5668","mdFileName":"components\/udpServer\/controller.md","url":"components\/udpServer\/controller.html","level":1},{"id":42,"parent_id":39,"title":"\u4e2d\u95f4\u4ef6","mdFileName":"components\/udpServer\/middleware.md","url":"components\/udpServer\/middleware.html","level":1},{"id":43,"parent_id":39,"title":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6","mdFileName":"components\/udpServer\/noMiddleware.md","url":"components\/udpServer\/noMiddleware.html","level":1},{"id":44,"parent_id":0,"title":"\u529f\u80fd\u7ec4\u4ef6","level":0},{"id":45,"parent_id":44,"title":"\u914d\u7f6e\u8bfb\u5199","mdFileName":"components\/config\/index.md","url":"components\/config\/index.html","level":1},{"id":46,"parent_id":44,"title":"\u8fde\u63a5\u6c60","mdFileName":"components\/pool\/index.md","url":"components\/pool\/index.html","level":1},{"id":47,"parent_id":44,"title":"\u6570\u636e\u5e93\u64cd\u4f5c","mdFileName":"components\/db\/index.md","url":"components\/db\/index.html","level":1},{"id":48,"parent_id":44,"title":"ORM","mdFileName":"components\/orm\/index.md","url":"components\/orm\/index.html","level":1},{"id":49,"parent_id":48,"title":"\u4f7f\u7528\u8bf4\u660e","mdFileName":"components\/orm\/index.md","url":"components\/orm\/index.html","level":2},{"id":50,"parent_id":48,"title":"\u6570\u636e\u8868\u6a21\u578b","mdFileName":"components\/orm\/RDModel.md","url":"components\/orm\/RDModel.html","level":2},{"id":51,"parent_id":50,"title":"\u4f7f\u7528\u65b9\u6cd5","mdFileName":"components\/orm\/RDModel.md","url":"components\/orm\/RDModel.html","level":3},{"id":52,"parent_id":50,"title":"\u6a21\u578b\u4e8b\u4ef6","mdFileName":"components\/orm\/RDModel\/event.md","url":"components\/orm\/RDModel\/event.html","level":3},{"id":53,"parent_id":48,"title":"\u6a21\u578b\u5173\u8054","mdFileName":"components\/orm\/relation\/index.md","url":"components\/orm\/relation\/index.html","level":2},{"id":54,"parent_id":53,"title":"\u4f7f\u7528\u8bf4\u660e","mdFileName":"components\/orm\/relation\/index.md","url":"components\/orm\/relation\/index.html","level":3},{"id":55,"parent_id":53,"title":"\u4e00\u5bf9\u4e00\u5173\u8054","mdFileName":"components\/orm\/relation\/oneToOne.md","url":"components\/orm\/relation\/oneToOne.html","level":3},{"id":56,"parent_id":53,"title":"\u4e00\u5bf9\u591a\u5173\u8054","mdFileName":"components\/orm\/relation\/oneToMany.md","url":"components\/orm\/relation\/oneToMany.html","level":3},{"id":57,"parent_id":53,"title":"\u591a\u5bf9\u591a\u5173\u8054","mdFileName":"components\/orm\/relation\/manyToMany.md","url":"components\/orm\/relation\/manyToMany.html","level":3},{"id":58,"parent_id":53,"title":"\u591a\u6001\u4e00\u5bf9\u4e00\u5173\u8054","mdFileName":"components\/orm\/relation\/polymorphicOneToOne.md","url":"components\/orm\/relation\/polymorphicOneToOne.html","level":3},{"id":59,"parent_id":53,"title":"\u591a\u6001\u4e00\u5bf9\u591a\u5173\u8054","mdFileName":"components\/orm\/relation\/polymorphicOneToMany.md","url":"components\/orm\/relation\/polymorphicOneToMany.html","level":3},{"id":60,"parent_id":53,"title":"\u591a\u6001\u591a\u5bf9\u591a\u5173\u8054","mdFileName":"components\/orm\/relation\/polymorphicManyToMany.md","url":"components\/orm\/relation\/polymorphicManyToMany.html","level":3},{"id":61,"parent_id":44,"title":"Redis","mdFileName":"components\/redis\/index.md","url":"components\/redis\/index.html","level":1},{"id":62,"parent_id":44,"title":"Redis \u6a21\u578b","mdFileName":"components\/orm\/RedisModel.md","url":"components\/orm\/RedisModel.html","level":1},{"id":63,"parent_id":44,"title":"\u5185\u5b58\u8868\u6a21\u578b","mdFileName":"components\/orm\/MemoryTableModel.md","url":"components\/orm\/MemoryTableModel.html","level":1},{"id":64,"parent_id":44,"title":"\u7f13\u5b58","mdFileName":"components\/cache\/index.md","url":"components\/cache\/index.html","level":1},{"id":65,"parent_id":64,"title":"\u4f7f\u7528\u8bf4\u660e","mdFileName":"components\/cache\/index.md","url":"components\/cache\/index.html","level":2},{"id":66,"parent_id":64,"title":"File","mdFileName":"components\/cache\/file.md","url":"components\/cache\/file.html","level":2},{"id":67,"parent_id":64,"title":"Redis","mdFileName":"components\/cache\/redis.md","url":"components\/cache\/redis.html","level":2},{"id":68,"parent_id":64,"title":"RedisHash","mdFileName":"components\/cache\/redisHash.md","url":"components\/cache\/redisHash.html","level":2},{"id":69,"parent_id":44,"title":"\u65e5\u5fd7","mdFileName":"components\/log\/index.md","url":"components\/log\/index.html","level":1},{"id":70,"parent_id":44,"title":"\u9a8c\u8bc1\u5668","mdFileName":"components\/validation\/index.md","url":"components\/validation\/index.html","level":1},{"id":71,"parent_id":44,"title":"Lock \u9501","mdFileName":"components\/lock\/index.md","url":"components\/lock\/index.html","level":1},{"id":72,"parent_id":71,"title":"\u4f7f\u7528\u65b9\u6cd5","mdFileName":"components\/lock\/index.md","url":"components\/lock\/index.html","level":2},{"id":73,"parent_id":71,"title":"RedisLock","mdFileName":"components\/lock\/redis.md","url":"components\/lock\/redis.html","level":2},{"id":74,"parent_id":71,"title":"AtomicLock","mdFileName":"components\/lock\/atomic.md","url":"components\/lock\/atomic.html","level":2},{"id":75,"parent_id":44,"title":"\u4e8b\u4ef6\u76d1\u542c","mdFileName":"components\/event\/index.md","url":"components\/event\/index.html","level":1},{"id":76,"parent_id":44,"title":"\u540e\u53f0\u4efb\u52a1","mdFileName":"components\/task\/index.md","url":"components\/task\/index.html","level":1},{"id":77,"parent_id":44,"title":"AOP","mdFileName":"components\/aop\/index.md","url":"components\/aop\/index.html","level":1},{"id":78,"parent_id":44,"title":"\u8fdb\u7a0b","mdFileName":"components\/process\/index.md","url":"components\/process\/index.html","level":1},{"id":79,"parent_id":44,"title":"\u8fdb\u7a0b\u6c60","mdFileName":"components\/process-pool\/index.md","url":"components\/process-pool\/index.html","level":1},{"id":80,"parent_id":44,"title":"\u70ed\u66f4\u65b0","mdFileName":"components\/hotupdate\/index.md","url":"components\/hotupdate\/index.html","level":1},{"id":81,"parent_id":44,"title":"Phar \u652f\u6301","mdFileName":"components\/phar\/index.md","url":"components\/phar\/index.html","level":1},{"id":82,"parent_id":0,"title":"\u6570\u636e\u7ed3\u6784","level":0},{"id":83,"parent_id":82,"title":"Atomic","mdFileName":"components\/struct\/atomic.md","url":"components\/struct\/atomic.html","level":1},{"id":84,"parent_id":82,"title":"Channel","mdFileName":"components\/struct\/co-channel.md","url":"components\/struct\/co-channel.html","level":1},{"id":85,"parent_id":82,"title":"MemoryTable","mdFileName":"components\/struct\/memory-table.md","url":"components\/struct\/memory-table.html","level":1},{"id":86,"parent_id":82,"title":"Enum","mdFileName":"components\/struct\/enum.md","url":"components\/struct\/enum.html","level":1},{"id":87,"parent_id":82,"title":"ArrayData","mdFileName":"components\/struct\/ArrayData.md","url":"components\/struct\/ArrayData.html","level":1},{"id":88,"parent_id":82,"title":"LazyArrayObject","mdFileName":"components\/struct\/LazyArrayObject.md","url":"components\/struct\/LazyArrayObject.html","level":1},{"id":89,"parent_id":82,"title":"ArrayList","mdFileName":"components\/struct\/ArrayList.md","url":"components\/struct\/ArrayList.html","level":1},{"id":90,"parent_id":82,"title":"FilterableList","mdFileName":"components\/struct\/FilterableList.md","url":"components\/struct\/FilterableList.html","level":1},{"id":91,"parent_id":0,"title":"\u5de5\u5177\u7c7b","level":0},{"id":92,"parent_id":91,"title":"\u5168\u5c40\u51fd\u6570","mdFileName":"utils\/functions.md","url":"utils\/functions.html","level":1},{"id":93,"parent_id":91,"title":"Imi","mdFileName":"utils\/Imi.md","url":"utils\/Imi.html","level":1},{"id":94,"parent_id":91,"title":"Args","mdFileName":"utils\/Args.md","url":"utils\/Args.html","level":1},{"id":95,"parent_id":91,"title":"ArrayUtil","mdFileName":"utils\/ArrayUtil.md","url":"utils\/ArrayUtil.html","level":1},{"id":96,"parent_id":91,"title":"Bit","mdFileName":"utils\/Bit.md","url":"utils\/Bit.html","level":1},{"id":97,"parent_id":91,"title":"ClassObject","mdFileName":"utils\/ClassObject.md","url":"utils\/ClassObject.html","level":1},{"id":98,"parent_id":91,"title":"Coroutine","mdFileName":"utils\/Coroutine.md","url":"utils\/Coroutine.html","level":1},{"id":99,"parent_id":91,"title":"File","mdFileName":"utils\/File.md","url":"utils\/File.html","level":1},{"id":100,"parent_id":91,"title":"ObjectArrayHelper","mdFileName":"utils\/ObjectArrayHelper.md","url":"utils\/ObjectArrayHelper.html","level":1},{"id":101,"parent_id":91,"title":"Random","mdFileName":"utils\/Random.md","url":"utils\/Random.html","level":1},{"id":102,"parent_id":91,"title":"Swoole","mdFileName":"utils\/Swoole.md","url":"utils\/Swoole.html","level":1},{"id":103,"parent_id":91,"title":"Text","mdFileName":"utils\/Text.md","url":"utils\/Text.html","level":1},{"id":104,"parent_id":91,"title":"Pagination","mdFileName":"utils\/Pagination.md","url":"utils\/Pagination.html","level":1},{"id":105,"parent_id":91,"title":"DateTime","mdFileName":"utils\/DateTime.md","url":"utils\/DateTime.html","level":1},{"id":106,"parent_id":91,"title":"KVStorage","mdFileName":"utils\/KVStorage.md","url":"utils\/KVStorage.html","level":1},{"id":107,"parent_id":91,"title":"ServerManage","mdFileName":"utils\/ServerManage.md","url":"utils\/ServerManage.html","level":1},{"id":108,"parent_id":0,"title":"\u6ce8\u89e3","level":0},{"id":109,"parent_id":108,"title":"\u6ce8\u5165\u503c\u6ce8\u89e3","mdFileName":"annotations\/injectValue.md","url":"annotations\/injectValue.html","level":1},{"id":110,"parent_id":108,"title":"\u65b9\u6cd5\u53c2\u6570\u8fc7\u6ee4\u5668","mdFileName":"annotations\/filterArg.md","url":"annotations\/filterArg.html","level":1},{"id":111,"parent_id":0,"title":"\u5f00\u53d1\u8005\u5de5\u5177","level":0},{"id":112,"parent_id":111,"title":"\u4ecb\u7ecd","mdFileName":"dev\/intro.md","url":"dev\/intro.html","level":1},{"id":113,"parent_id":111,"title":"\u670d\u52a1\u5668\u5de5\u5177","mdFileName":"dev\/server.md","url":"dev\/server.html","level":1},{"id":114,"parent_id":111,"title":"\u751f\u6210\u5de5\u5177","mdFileName":"dev\/generate.md","url":"dev\/generate.html","level":1},{"id":115,"parent_id":114,"title":"\u6a21\u578b\u751f\u6210","mdFileName":"dev\/generate\/model.md","url":"dev\/generate\/model.html","level":2},{"id":116,"parent_id":114,"title":"\u63a7\u5236\u5668\u751f\u6210","mdFileName":"dev\/generate\/controller.md","url":"dev\/generate\/controller.html","level":2},{"id":117,"parent_id":111,"title":"\u8fdb\u7a0b\u5de5\u5177","mdFileName":"dev\/process.md","url":"dev\/process.html","level":1},{"id":118,"parent_id":0,"title":"\u8fdb\u9636\u5f00\u53d1","level":0},{"id":119,"parent_id":118,"title":"\u6027\u80fd\u4f18\u5316","mdFileName":"adv\/performance.md","url":"adv\/performance.html","level":1},{"id":120,"parent_id":118,"title":"\u53c2\u4e0e\u6846\u67b6\u5f00\u53d1","mdFileName":"adv\/devp.md","url":"adv\/devp.html","level":1}];
					for(var i = 0; i < catalogList.length; ++i)
					{
						if(void 0 !== catalogList[i].url)
						{
							catalogList[i] = parseCatalogItem(catalogList[i]);
						}
					}
					initTree(catalogList);
				</script>
                <h1>数据库</h1><p>数据库连接池配置方式已经在连接池里讲过，这里就不重复了，直接说使用方法。</p><h2>连接池配置</h2><pre><code class="php">&lt;?php
return [
    'db'    =&gt;    [
        'defaultPool'    =&gt;    'alias1', // 默认连接池
    ],
    'pools' =&gt; [
        // 连接池名称
        'alias1' =&gt; [
            // 同步池子，task进程使用
            'sync' =&gt; [
                'pool' =&gt; [
                    'class' =&gt; \Imi\Db\Pool\SyncDbPool::class,
                    'config' =&gt; [
                        // 池子中最多资源数
                        // 'maxResources' =&gt; 10,
                        // 池子中最少资源数
                        // 'minResources' =&gt; 2,
                        // 资源回收时间间隔，单位：秒
                        // 'gcInterval' =&gt; 60,
                        // 获取资源最大存活时间，单位：秒
                        // 'maxActiveTime' =&gt; 3600,
                        // 等待资源最大超时时间，单位：毫秒
                        // 'waitTimeout' =&gt; 3000,
                        // 负载均衡-轮流
                        // 'resourceConfigMode' =&gt; ResourceConfigMode::TURN,
                        // 负载均衡-随机
                        // 'resourceConfigMode' =&gt; ResourceConfigMode::RANDOM,
                    ],
                ],
                'resource' =&gt; [
                    'host' =&gt; '127.0.0.1',
                    'username' =&gt; 'root',
                    'password' =&gt; 'root',
                    'database' =&gt; 'database',
                    // 'port'    =&gt; '3306',
                    // 'timeout' =&gt; '建立连接超时时间',
                    // 'charset' =&gt; '',
                    // 'strict_type' =&gt; false, //开启严格模式，返回的字段将自动转为数字类型
                ],
            ],
            // 异步池子，worker进程使用
            'async' =&gt; [
                'pool'    =&gt;    [
                    'class'        =&gt;    \Imi\Db\Pool\CoroutineDbPool::class,
                    'config'    =&gt;    [
                        // 同上
                    ],
                ],
                // resource也可以定义多个连接
                'resource'    =&gt;    [
                    [
                        'host'        =&gt; '127.0.0.1',
                        'username'        =&gt; 'root',
                        'password'    =&gt; 'root',
                        'database'    =&gt; 'database',
                        // 'timeout' =&gt; '建立连接超时时间',
                        // 'charset' =&gt; '',
                        // 'options' =&gt; [], // PDO连接选项
                    ],
                    [
                        'host'        =&gt; '127.0.0.2',
                        'username'        =&gt; 'root',
                        'password'    =&gt; 'root',
                        'database'    =&gt; 'database',
                        // 'timeout' =&gt; '建立连接超时时间',
                        // 'charset' =&gt; '',
                        // 'options' =&gt; [], // PDO连接选项
                    ]
                ],
            ],
        ],
        // 从库配置
        // 原连接池名后加.slave即为从库配置，非必设
        // 如果配置了，默认查询走从库，增删改走主库
        // 如果在事务中，默认都走主库
        'alias1.slave' =&gt; [
            // 同步池子，task进程使用
            'sync' =&gt; [
                'pool' =&gt; [
                    'class' =&gt; \Imi\Db\Pool\SyncDbPool::class,
                    'config' =&gt; [
                        // 池子中最多资源数
                        // 'maxResources' =&gt; 10,
                        // 池子中最少资源数
                        // 'minResources' =&gt; 2,
                        // 资源回收时间间隔，单位：秒
                        // 'gcInterval' =&gt; 60,
                        // 获取资源最大存活时间，单位：秒
                        // 'maxActiveTime' =&gt; 3600,
                        // 等待资源最大超时时间，单位：毫秒
                        // 'waitTimeout' =&gt; 3000,
                    ],
                ],
                'resource' =&gt; [
                    'host' =&gt; '127.0.0.1',
                    'username' =&gt; 'root',
                    'password' =&gt; 'root',
                    'database' =&gt; 'database',
                    // 'port'    =&gt; '3306',
                    // 'timeout' =&gt; '建立连接超时时间',
                    // 'charset' =&gt; '',
                    // 'strict_type' =&gt; false, //开启严格模式，返回的字段将自动转为数字类型
                ],
            ],
            // 异步池子，worker进程使用
            'async' =&gt; [
                'pool'    =&gt;    [
                    'class'        =&gt;    \Imi\Db\Pool\CoroutineDbPool::class,
                    'config'    =&gt;    [
                        // 同上
                    ],
                ],
                'resource'    =&gt;    [
                    'host'        =&gt; '127.0.0.1',
                    'username'        =&gt; 'root',
                    'password'    =&gt; 'root',
                    'database'    =&gt; 'database',
                    // 'timeout' =&gt; '建立连接超时时间',
                    // 'charset' =&gt; '',
                    // 'options' =&gt; [], // PDO连接选项
                ],
                // uri 写法
                // 'resource'  =&gt;  [
                //     'tcp://192.168.0.222/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60',
                //     'tcp://192.168.0.222/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60',
                // ],
                // 'resource'  =&gt;  'tcp://192.168.0.222/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60;tcp://192.168.0.222/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60',
            ],
        ]
    ],
];</code></pre><h2>直接操作 Db 对象</h2><pre><code class="php">// 获取新的数据库连接实例
$db = Db::getNewInstance();
// 读库
$db = Db::getNewInstance($poolName, QueryType::READ);
// 写库
$db = Db::getNewInstance($poolName, QueryType::WRITE);

// 获取数据库连接实例，每个RequestContext中共用一个
$db = Db::getInstance();
// 读库
$db = Db::getInstance($poolName, QueryType::READ);
// 写库
$db = Db::getInstance($poolName, QueryType::WRITE);

// 释放连接，回归连接池
Db::release($db);

$returnValue = Db::use(function(IDb $db){
    // 操作 $db
    return 'imi';
}); // imi</code></pre><h2>连贯操作</h2><p>IMI 中数据库查询连贯操作都来自于查询器，查询器的创建方式：</p><pre><code class="php">use Imi\Db\Db;
$query = Db::query();</code></pre><h3>事务</h3><p>手动控制事务：</p><pre><code class="php">// 开启事务
Db::getInstance()-&gt;beginTransaction();
// 提交事务
Db::getInstance()-&gt;commit();
// 回滚事务
Db::getInstance()-&gt;rollBack();</code></pre><p>获取连接顺带自动开启/提交/回滚事务：</p><pre><code class="php">Db::transUse(function(IDb $db){

});
Db::transUse(function(IDb $db){

}, $poolName, QueryType::WRITE);</code></pre><p>获取连接后，想要使用某个连接，执行事务操作，自动开启/提交/回滚事务：</p><pre><code class="php">$db = Db::getInstance();
Db::trans($db, function(IDb $db){

});</code></pre><p><strong>自动事务处理</strong></p><p><code>@Transaction</code> 注解，类：<code>Imi\Db\Annotation\Transaction</code></p><p>这个注解可以加在任意方法上，在方法调用前开启事务，在方法中抛出异常时回滚事务，方法成功返回时提交事务。</p><p><code>@Transaction</code></p><p><code>@Transaction(autoCommit=&quot;自动提交事务true/false，默认为true&quot;)</code></p><p>事务类型：</p><p>事务嵌套（默认）</p><p><code>@Transaction(type=TransactionType::NESTING)</code></p><p>该方法必须在事务中被调用</p><p><code>@Transaction(type=TransactionType::REQUIREMENT)</code></p><p>如果当前不在事务中则开启事务</p><p><code>@Transaction(type=TransactionType::AUTO)</code></p><p>部分回滚：</p><p><code>@Transaction(rollbackType=RollbackType::PART, rollbackLevels=&quot;回滚层数，默认为1&quot;)</code></p><h3>指定表 (table/from)</h3><pre><code class="php">// 指定表名
Db::query()-&gt;table('tb_test');
// 指定表名并且设置别名
Db::query()-&gt;table('tb_test', 'test');
// 指定表名和数据库名
Db::query()-&gt;table('tb_test', null, 'db1');
// 传入参数原样代入到SQL中
Db::query()-&gt;tableRaw('tb_test');</code></pre><blockquote><code>table()</code> 和 <code>tableRaw()</code> 也可以使用 <code>from()</code> 和 <code>fromRaw()</code> 代替。</blockquote><h3>distinct</h3><pre><code class="php">// 结果唯一
Db::query()-&gt;distinct();
// 结果不唯一
Db::query()-&gt;distinct(false);</code></pre><h3>指定字段 (field)</h3><pre><code class="php">// 指定一个字段
Db::query()-&gt;field('id');

// 指定多个字段，也支持设置别名。空格和as都支持
Db::query()-&gt;field('id', 'name1 name', 'age1 as age');

// 和上面的用法等同
Db::query()-&gt;field(['id', 'name1 name', 'age1 as age']);

// 传入参数原样代入到SQL中
Db::query()-&gt;fieldRaw('id, name1 name, age1 as age');</code></pre><h3>条件 where</h3><h4>where</h4><pre><code class="php">// id = 1
Db::query()-&gt;where('id', '=', 1);

// id &gt; 1
Db::query()-&gt;where('id', '&gt;', 1);

// title like '%test%'
Db::query()-&gt;where('title', 'like', '%test%');

// id between 1 and 10
Db::query()-&gt;where('id', 'between', [1, 10]);

// id not between 1 and 10
Db::query()-&gt;where('id', 'not between', [1, 10]);

// or id = 1
Db::query()-&gt;where('id', '=', 1, 'or');
Db::query()-&gt;orWhere('id', '=', 1);</code></pre><h4>TP 风格 where</h4><pre><code class="php">// select * from `tb_test` where (`id` = 1 or (`id` = 2 ) and `title` like '%test%' and `age` &gt; 18 and (`id` = 2 or (`id` = 3 ) ) )
Db::query()-&gt;from('tb_test')-&gt;whereEx([
    'id'    =&gt;    1,
    'or'    =&gt;    [
        'id'    =&gt;    2,
    ],
    'title'    =&gt;    ['like', '%test%'],
    'age'    =&gt;    ['&gt;', 18],
    'and'   =&gt;  [
        'id'    =&gt;  2,
        'or'    =&gt;  [
            'id'    =&gt;  3,
        ]
    ]
]);</code></pre><h4>whereRaw</h4><pre><code class="php">// 传入参数原样代入到SQL中
Db::query()-&gt;whereRaw('id &gt;= 1');
// 传入参数原样代入到SQL中，并且为or条件
Db::query()-&gt;whereRaw('id &gt;= 1', 'or');
Db::query()-&gt;orWhereRaw('id &gt;= 1');</code></pre><h4>whereBrackets</h4><pre><code class="php">// where id = 1 or (age &lt; 14)
Db::query()-&gt;where('id', '=', 1)-&gt;whereBrackets(function(){
    // 直接返回字符串
    return 'age &lt; 14';
}, 'or');

// where id = 1 or (age &lt; 14)
Db::query()-&gt;where('id', '=', 1)-&gt;whereBrackets(function(){
    // 直接返回字符串
    return new \Imi\Db\Query\Where\Where('age', '&lt;', 14);
}, 'or');
Db::query()-&gt;where('id', '=', 1)-&gt;orWhereBrackets(function(){
    // 直接返回字符串
    return new \Imi\Db\Query\Where\Where('age', '&lt;', 14);
});</code></pre><h4>whereStruct</h4><pre><code class="php">// or age &lt; 14
Db::query()-&gt;whereStruct(new \Imi\Db\Query\Where\Where('age', '&lt;', 14), 'or');
Db::query()-&gt;orWhereStruct(new \Imi\Db\Query\Where\Where('age', '&lt;', 14));</code></pre><h4>其它</h4><pre><code class="php">// or age between 1 and 14
Db::query()-&gt;whereBetween('age', 1, 14, 'or');
Db::query()-&gt;orWhereBetween('age', 1, 14);

// or age not between 1 and 14
Db::query()-&gt;whereNotBetween('age', 1, 14, 'or');
Db::query()-&gt;orWhereNotBetween('age', 1, 14);

// or age in (1,2,3)
Db::query()-&gt;whereIn('age', [1, 2, 3], 'or');
Db::query()-&gt;orWhereIn('age', [1, 2, 3]);

// or age not in (1,2,3)
Db::query()-&gt;whereNotIn('age', [1, 2, 3], 'or');
Db::query()-&gt;orWhereNotIn('age', [1, 2, 3]);

// or age is null
Db::query()-&gt;whereIsNull('age', 'or');
Db::query()-&gt;orWhereIsNull('age');

// or age is not null
Db::query()-&gt;whereIsNotNull('age', 'or');
Db::query()-&gt;orWhereIsNotNull('age');</code></pre><h4>JSON 字段支持</h4><p>看如下代码，<code>data</code>为<code>json</code>类型字段，查询<code>json</code>对象中的<code>member.age</code>为<code>11</code>的记录</p><pre><code class="php">Db::query()-&gt;where('data-&gt;member.age', '=', 11)-&gt;select();</code></pre><h3>join</h3><pre><code class="php">// select * from tb_test1 left join tb_test2 on tb_test1.aid = tb_test2.bid
Db::query()-&gt;table('tb_test1')-&gt;join('tb_test2', 'tb_test1.aid', '=', 'tb_test2.bid');
// select * from tb_test1 left join tb_test2 as test2 on tb_test1.aid = test2.bid
Db::query()-&gt;table('tb_test1')-&gt;join('tb_test2', 'tb_test1.aid', '=', 'test2.bid', 'test');
// select * from tb_test1 right join tb_test2 on tb_test1.aid = tb_test2.bid and tb_test1.age &gt; 14
Db::query()-&gt;table('tb_test1')-&gt;join('tb_test2', 'tb_test1.aid', '=', 'tb_test2.bid', null, new \Imi\Db\Query\Where\Where('tb_test1.age', '&gt;', '14'), 'right');

// select * from tb_test1 left join tb_test2 on tb_test1.aid = tb_test2.bid
Db::query()-&gt;table('tb_test1')-&gt;joinRaw('left join tb_test2 on tb_test1.aid = tb_test2.bid');

// 下面三种用法，第5个参数都支持传Where
// left join
Db::query()-&gt;table('tb_test1')-&gt;leftJoin('tb_test2', 'tb_test1.aid', '=', 'tb_test2.bid');
// right join
Db::query()-&gt;table('tb_test1')-&gt;rightJoin('tb_test2', 'tb_test1.aid', '=', 'tb_test2.bid');
// cross join
Db::query()-&gt;table('tb_test1')-&gt;crossJoin('tb_test2', 'tb_test1.aid', '=', 'tb_test2.bid');</code></pre><h3>order</h3><pre><code class="php">// order by id asc, age desc
Db::query()-&gt;order('id')-&gt;order('age', 'desc');

// order by id desc
Db::query()-&gt;orderRaw('id desc');</code></pre><h3>group by</h3><pre><code class="php">// group by id, name
Db::query()-&gt;group('id', 'name');

// group by sum(id)
Db::query()-&gt;groupRaw('sum(id)');</code></pre><h3>having</h3><p><code>having()</code>用法同<code>where()</code></p><p><code>havingRaw()</code>用法同<code>whereRaw()</code></p><p><code>havingBrackets()</code>用法同<code>whereBrackets()</code></p><p><code>havingStruct()</code>用法同<code>whereStruct()</code></p><h3>分页查询</h3><pre><code class="php">// limit 900, 100
Db::query()-&gt;page(10, 100);

// limit 10, 1
Db::query()-&gt;offset(10)-&gt;limit(1);

// limit 1
Db::query()-&gt;limit(1);</code></pre><h2>查询执行</h2><h3>查询记录</h3><h4>查询单行</h4><pre><code class="php">$result = Db::query()-&gt;table('tb_test')-&gt;select();
$result-&gt;get(); // 数组
$result-&gt;get($className); // $className对应的类对象</code></pre><h4>查询多行</h4><pre><code class="php">$result = Db::query()-&gt;table('tb_test')-&gt;select();
$result-&gt;getArray(); // 数组内嵌套数组
$result-&gt;getArray($className); // 数组内嵌套$className对应的类对象
$result-&gt;getRowCount(); // 获取查询出的记录行数</code></pre><h4>聚合函数</h4><pre><code class="php">// count(*)
Db::query()-&gt;table('tb_test')-&gt;count();

// count(id)
Db::query()-&gt;table('tb_test')-&gt;count('id');

// sum(id)
Db::query()-&gt;table('tb_test')-&gt;sum('id');

// avg(id)
Db::query()-&gt;table('tb_test')-&gt;avg('id');

// max(id)
Db::query()-&gt;table('tb_test')-&gt;max('id');

// min(id)
Db::query()-&gt;table('tb_test')-&gt;min('id');

// 其它自定义：test(id)
Db::query()-&gt;table('tb_test')-&gt;aggregate('test', 'id');</code></pre><h3>插入记录</h3><pre><code class="php">// insert into tb_test(name, age) values('yurun', 666)
$result = Db::query()-&gt;table('tb_test')-&gt;insert([
    'name'    =&gt;    'yurun',
    'age'    =&gt;    666,
]);

// insert into tb_test values('yurun', 666)
$result = Db::query()-&gt;table('tb_test')-&gt;insert([
    'yurun',666,
]);

$result-&gt;isSuccess(); // SQL是否执行成功
$result-&gt;getLastInsertId(); // 获取最后插入的ID
$result-&gt;getAffectedRows(); // 获取影响行数</code></pre><h3>批量插入</h3><pre><code class="php">$result = Db::query()-&gt;from('test')-&gt;batchInsert([
    ['name'=&gt;'a'],
    ['name'=&gt;'b'],
    ['name'=&gt;'c'],
]);
$result-&gt;isSuccess(); // SQL是否执行成功
$result-&gt;getAffectedRows(); // 获取影响行数</code></pre><h3>更新记录</h3><pre><code class="php">// update tb_test set name = 'yurun', age = 666 where id = 1
$result = Db::query()-&gt;table('tb_test')-&gt;where('id', '=', 1)-&gt;update([
    'name'    =&gt;    'yurun',
    'age'    =&gt;    666,
]);

// $result使用方法同上</code></pre><h3>替换数据</h3><pre><code class="php">// replace into tb_test set id = 1, name = 'yurun', age = 666
$result = Db::query()-&gt;table('tb_test')-&gt;replace([
    'id'    =&gt;    1,
    'name'    =&gt;    'yurun',
    'age'    =&gt;    666,
]);</code></pre><h3>递增/递减</h3><pre><code class="php">// score 递增 1
$result = Db::query()-&gt;table('tb_test')
                     -&gt;where('id', '=', 1)
                     -&gt;setFieldInc('score')
                     -&gt;update();

// score 递增 10
$result = Db::query()-&gt;table('tb_test')
                     -&gt;where('id', '=', 1)
                     -&gt;setFieldInc('score', 10)
                     -&gt;update();

// score 递减 1
$result = Db::query()-&gt;table('tb_test')
                     -&gt;where('id', '=', 1)
                     -&gt;setFieldDec('score')
                     -&gt;update();

// score 递减 10
$result = Db::query()-&gt;table('tb_test')
                     -&gt;where('id', '=', 1)
                     -&gt;setFieldDec('score', 10)
                     -&gt;update();</code></pre><h3>update/insert/replace时使用表达式</h3><pre><code class="php">// update tb_test set score = score + 1 where id = 1
$result = Db::query()-&gt;table('tb_test')
                     -&gt;where('id', '=', 1)
                     -&gt;setFieldExp('score', 'score + 1')
                     -&gt;update();</code></pre><h3>删除记录</h3><pre><code class="php">// delete from tb_test where id = 1
$result = Db::query()-&gt;table('tb_test')-&gt;where('id', '=', 1)-&gt;delete();

// $result使用方法同上</code></pre><h2>直接执行SQL</h2><pre><code class="php">$result = Db::query()-&gt;execute('select * from tb_test'));

// $result使用方法同上</code></pre><h2>参数绑定</h2><p>复杂的查询时，难免需要拼接 SQL，这时候就需要参数绑定来防止注入了！</p><pre><code class="php">// where id = 123
$result = Db::query()-&gt;whereRaw('id = ?')-&gt;bindValue(1, 123);
$result = Db::query()-&gt;whereRaw('id = :val')-&gt;bindValue(':val', 123);

// 批量绑定
$result = Db::query()-&gt;bindValues([
    ':name'    =&gt;    'yurun',
    ':age'    =&gt;    666,
])-&gt;execute('select * from tb_test where name = :name and age = :age');</code></pre><h2>Result 用法</h2><pre><code class="php">$result = Db::query()-&gt;table('tb_test')-&gt;select();</code></pre><h3>是否执行成功</h3><pre><code class="php">$success = $result-&gt;isSuccess(); // true/false</code></pre><h3>获取最后插入的ID</h3><p>用于获取新增记录的自增字段值</p><pre><code class="php">$lastInsertId = $result-&gt;getLastInsertId(); // int</code></pre><h3>获取影响行数</h3><pre><code class="php">$rows = $result-&gt;getAffectedRows();</code></pre><blockquote>update 时，如果没有值被改变，可能会返回0</blockquote><h3>返回一行数据</h3><h4>返回数组</h4><pre><code class="php">$dataArray = $result-&gt;get();</code></pre><h4>返回对象</h4><p>实例化这个类时，把数组传入构造方法</p><pre><code class="php">$dataArray = $result-&gt;get(XXXModel::class);</code></pre><h3>返回数组列表</h3><h4>成员为数组</h4><pre><code class="php">$list = $result-&gt;getArray();</code></pre><h4>成员为对象</h4><pre><code class="php">$list = $result-&gt;getArray(XXXModel::class);</code></pre><h3>获取一列</h3><pre><code class="php">$ids = Db::query()-&gt;field('id')-&gt;select()-&gt;getColumn();
// 结果格式：[1, 2, 3]</code></pre><h3>获取标量结果</h3><pre><code class="php">$name = Db::query()-&gt;field('name')-&gt;where('id', '=', 1)-&gt;select()-&gt;getScalar();</code></pre><h3>获取记录行数</h3><p>得到取回多少条记录</p><pre><code class="php">$rowCount = $result-&gt;getRowCount();</code></pre><h3>获取执行的SQL</h3><pre><code class="php">$sql = $result-&gt;getSql();</code></pre><h3>获取结果集</h3><pre><code class="php">$statement = $result-&gt;getStatement(); // \Imi\Db\Interfaces\IStatement</code></pre>			</div>
		</div>
	</div>

	<script>
		$(function(){
			var leftBarTimeout = null;
			$('#leftbar').hover(function(e){
				if(null !== leftBarTimeout)
				{
					clearTimeout(leftBarTimeout);
					leftBarTimeout = null;
				}
				if(e.type === 'mouseenter')
				{
					$('.left-show-hide').fadeIn(250);
				}
				else if($('#leftbar').css('left') == '0px')
				{
					$('.left-show-hide').fadeOut(500);
				}
			});
		});
		function showLeftbar()
		{
			$('#leftbar').css('left', 0);
			$('#body').css('padding-left','');
			$('.left-show-hide > i.layui-icon').html('&#xe603;');
		}
		function hideLeftbar()
		{
			$('#leftbar').css('left', '-240px');
			$('#body').css('padding-left',0);
			$('.left-show-hide > i.layui-icon').html('&#xe602;');
			$('.left-show-hide').fadeIn(250);
		}
		$('.left-show-hide').click(function(){
			if($('#leftbar').css('left') == '0px')
			{
				hideLeftbar();
			}
			else
			{
				showLeftbar();
			}
		})
	</script>
    <script src="../../statics/js/mddoc-search.js"></script>
</body>
</html>